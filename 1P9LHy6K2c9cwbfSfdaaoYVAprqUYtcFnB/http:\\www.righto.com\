http://www.righto.com/
HTTP/1.0 200 OK
Content-Type: text/html; charset=UTF-8
Expires: Wed, 23 Jul 2014 01:10:53 GMT
Date: Wed, 23 Jul 2014 01:10:53 GMT
Cache-Control: private, max-age=0
Last-Modified: Mon, 21 Jul 2014 11:07:39 GMT
ETag: "c7835605-f335-4693-9cdd-a5bb6e6696f5"
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Server: GSE
Alternate-Protocol: 80:quic,80:quic

<!DOCTYPE html>
<html class='v2' dir='ltr'>
<head>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<script type="text/javascript">(function() { var b=window,f="chrome",g="tick",k="jstiming";(function(){function d(a){this.t={};this.tick=function(a,d,c){var e=void 0!=c?c:(new Date).getTime();this.t[a]=[e,d];if(void 0==c)try{b.console.timeStamp("CSI/"+a)}catch(h){}};this[g]("start",null,a)}var a;b.performance&&(a=b.performance.timing);var n=a?new d(a.responseStart):new d;b.jstiming={Timer:d,load:n};if(a){var c=a.navigationStart,h=a.responseStart;0<c&&h>=c&&(b[k].srt=h-c)}if(a){var e=b[k].load;0<c&&h>=c&&(e[g]("_wtsrt",void 0,c),e[g]("wtsrt_","_wtsrt",h),e[g]("tbsd_","wtsrt_"))}try{a=null,
b[f]&&b[f].csi&&(a=Math.floor(b[f].csi().pageT),e&&0<c&&(e[g]("_tbnd",void 0,b[f].csi().startE),e[g]("tbnd_","_tbnd",c))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),null==a&&b.external&&(a=b.external.pageT,e&&0<c&&(e[g]("_tbnd",void 0,b.external.startE),e[g]("tbnd_","_tbnd",c))),a&&(b[k].pt=a)}catch(p){}})();b.tickAboveFold=function(d){var a=0;if(d.offsetParent){do a+=d.offsetTop;while(d=d.offsetParent)}d=a;750>=d&&b[k].load[g]("aft")};var l=!1;function m(){l||(l=!0,b[k].load[g]("firstScrollTime"))}b.addEventListener?b.addEventListener("scroll",m,!1):b.attachEvent("onscroll",m);
 })();</script>
<meta content='blogger' name='generator'/>
<link href='http://www.righto.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://www.righto.com/' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Ken Shirriff&#39;s blog - Atom" href="http://www.righto.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Ken Shirriff&#39;s blog - RSS" href="http://www.righto.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Ken Shirriff&#39;s blog - Atom" href="http://www.blogger.com/feeds/6264947694886887540/posts/default" />
<link rel="openid.server" href="http://www.blogger.com/openid-server.g" />
<link rel="openid.delegate" href="http://www.righto.com/" />
<!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/1735305980-ieretrofit.js"></script>
<![endif]-->
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<title>Ken Shirriff's blog</title>
<script type="text/javascript">
if (navigator.userAgent.indexOf('MSIE 6') == -1) {
  WebFontConfig = {
    google: { families: [ 'Play' ],
    api: '//themes.googleusercontent.com/fonts/css?kit=vx8QUoAjNHH5OJ_a8YxAWw'
    },
    loading: function() {
      if (window.jstiming) window.jstiming.load.tick('webfontLoading');
    },
    active: function() {
      if (window.jstiming) window.jstiming.load.tick('webfontActive');
    }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = '//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
} else {
  document.documentElement.className = 'wf-inactive';
}
</script>
<style type="text/css">
.wf-inactive .header h1, .wf-play-n4-loading .header h1, .wf-play-n4-inactive .header h1 {
  font-family: sans-serif;
}
</style>
<link type='text/css' rel='stylesheet' href='https://www.blogger.com/static/v1/widgets/1535467126-widget_css_2_bundle.css' />
<link type='text/css' rel='stylesheet' href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=6264947694886887540&zx=c7835605-f335-4693-9cdd-a5bb6e6696f5' />
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Josh Peterson
URL:      www.noaesthetic.com
----------------------------------------------- */
/* Variable definitions
====================
<Variable name="keycolor" description="Main Color" type="color" default="#66bbdd"/>
<Group description="Page Text" selector="body">
<Variable name="body.font" description="Font" type="font"
default="normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="body.text.color" description="Text Color" type="color" default="#222222"/>
</Group>
<Group description="Backgrounds" selector=".body-fauxcolumns-outer">
<Variable name="body.background.color" description="Outer Background" type="color" default="#66bbdd"/>
<Variable name="content.background.color" description="Main Background" type="color" default="#ffffff"/>
<Variable name="header.background.color" description="Header Background" type="color" default="transparent"/>
</Group>
<Group description="Links" selector=".main-outer">
<Variable name="link.color" description="Link Color" type="color" default="#2288bb"/>
<Variable name="link.visited.color" description="Visited Color" type="color" default="#888888"/>
<Variable name="link.hover.color" description="Hover Color" type="color" default="#33aaff"/>
</Group>
<Group description="Blog Title" selector=".header h1">
<Variable name="header.font" description="Font" type="font"
default="normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="header.text.color" description="Title Color" type="color" default="#3399bb" />
</Group>
<Group description="Blog Description" selector=".header .description">
<Variable name="description.text.color" description="Description Color" type="color"
default="#777777" />
</Group>
<Group description="Tabs Text" selector=".tabs-inner .widget li a">
<Variable name="tabs.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="tabs.text.color" description="Text Color" type="color" default="#999999"/>
<Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#000000"/>
</Group>
<Group description="Tabs Background" selector=".tabs-outer .PageList">
<Variable name="tabs.background.color" description="Background Color" type="color" default="#f5f5f5"/>
<Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Post Title" selector="h3.post-title, .comments h4">
<Variable name="post.title.font" description="Font" type="font"
default="normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
</Group>
<Group description="Date Header" selector=".date-header">
<Variable name="date.header.color" description="Text Color" type="color"
default="#222222"/>
<Variable name="date.header.background.color" description="Background Color" type="color"
default="transparent"/>
</Group>
<Group description="Post Footer" selector=".post-footer">
<Variable name="post.footer.text.color" description="Text Color" type="color" default="#666666"/>
<Variable name="post.footer.background.color" description="Background Color" type="color"
default="#f9f9f9"/>
<Variable name="post.footer.border.color" description="Shadow Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Gadgets" selector="h2">
<Variable name="widget.title.font" description="Title Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.title.text.color" description="Title Color" type="color" default="#000000"/>
<Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#999999"/>
</Group>
<Group description="Images" selector=".main-inner">
<Variable name="image.background.color" description="Background Color" type="color" default="#ffffff"/>
<Variable name="image.border.color" description="Border Color" type="color" default="#eeeeee"/>
<Variable name="image.text.color" description="Caption Text Color" type="color" default="#222222"/>
</Group>
<Group description="Accents" selector=".content-inner">
<Variable name="body.rule.color" description="Separator Line Color" type="color" default="#eeeeee"/>
<Variable name="tabs.border.color" description="Tabs Border Color" type="color" default="#eeeeee"/>
</Group>
<Variable name="body.background" description="Body Background" type="background"
color="#f6fbf6" default="$(color) none repeat scroll top left"/>
<Variable name="body.background.override" description="Body Background Override" type="string" default=""/>
<Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="url(//www.blogblog.com/1kt/simple/gradients_light.png)"/>
<Variable name="body.background.gradient.tile" description="Body Gradient Tile" type="url"
default="url(//www.blogblog.com/1kt/simple/body_gradient_tile_light.png)"/>
<Variable name="content.background.color.selector" description="Content Background Color Selector" type="string" default=".content-inner"/>
<Variable name="content.padding" description="Content Padding" type="length" default="10px"/>
<Variable name="content.padding.horizontal" description="Content Horizontal Padding" type="length" default="10px"/>
<Variable name="content.shadow.spread" description="Content Shadow Spread" type="length" default="40px"/>
<Variable name="content.shadow.spread.webkit" description="Content Shadow Spread (WebKit)" type="length" default="5px"/>
<Variable name="content.shadow.spread.ie" description="Content Shadow Spread (IE)" type="length" default="10px"/>
<Variable name="main.border.width" description="Main Border Width" type="length" default="0"/>
<Variable name="header.background.gradient" description="Header Gradient" type="url" default="none"/>
<Variable name="header.shadow.offset.left" description="Header Shadow Offset Left" type="length" default="-1px"/>
<Variable name="header.shadow.offset.top" description="Header Shadow Offset Top" type="length" default="-1px"/>
<Variable name="header.shadow.spread" description="Header Shadow Spread" type="length" default="1px"/>
<Variable name="header.padding" description="Header Padding" type="length" default="30px"/>
<Variable name="header.border.size" description="Header Border Size" type="length" default="1px"/>
<Variable name="header.bottom.border.size" description="Header Bottom Border Size" type="length" default="0"/>
<Variable name="header.border.horizontalsize" description="Header Horizontal Border Size" type="length" default="0"/>
<Variable name="description.text.size" description="Description Text Size" type="string" default="140%"/>
<Variable name="tabs.margin.top" description="Tabs Margin Top" type="length" default="0" />
<Variable name="tabs.margin.side" description="Tabs Side Margin" type="length" default="30px" />
<Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="url(//www.blogblog.com/1kt/simple/gradients_light.png)"/>
<Variable name="tabs.border.width" description="Tabs Border Width" type="length" default="1px"/>
<Variable name="tabs.bevel.border.width" description="Tabs Bevel Border Width" type="length" default="1px"/>
<Variable name="date.header.padding" description="Date Header Padding" type="string" default="inherit"/>
<Variable name="date.header.letterspacing" description="Date Header Letter Spacing" type="string" default="inherit"/>
<Variable name="date.header.margin" description="Date Header Margin" type="string" default="inherit"/>
<Variable name="post.margin.bottom" description="Post Bottom Margin" type="length" default="25px"/>
<Variable name="image.border.small.size" description="Image Border Small Size" type="length" default="2px"/>
<Variable name="image.border.large.size" description="Image Border Large Size" type="length" default="5px"/>
<Variable name="page.width.selector" description="Page Width Selector" type="string" default=".region-inner"/>
<Variable name="page.width" description="Page Width" type="string" default="auto"/>
<Variable name="main.section.margin" description="Main Section Margin" type="length" default="15px"/>
<Variable name="main.padding" description="Main Padding" type="length" default="15px"/>
<Variable name="main.padding.top" description="Main Padding Top" type="length" default="30px"/>
<Variable name="main.padding.bottom" description="Main Padding Bottom" type="length" default="30px"/>
<Variable name="paging.background"
color="#ffffff"
description="Background of blog paging area" type="background"
default="transparent none no-repeat scroll top center"/>
<Variable name="footer.bevel" description="Bevel border length of footer" type="length" default="0"/>
<Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left"/>
<Variable name="mobile.background.size" description="Mobile Background Size" type="string" default="auto"/>
<Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff" />
<Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/>
<Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/>
*/
/* Content
----------------------------------------------- */
body {
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #222222;
background: #f6fbf6 none repeat scroll top left;
padding: 0 40px 40px 40px;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
a:link {
text-decoration:none;
color: #121fb3;
}
a:visited {
text-decoration:none;
color: #121fb3;
}
a:hover {
text-decoration:underline;
color: #1a00ff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent url(//www.blogblog.com/1kt/simple/body_gradient_tile_light.png) repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
background: #f6fbf6 none repeat scroll top left;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent url(//www.blogblog.com/1kt/simple/gradients_light.png) repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 40px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 10px #333333;
box-shadow: 0 0 40px rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 10px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: #f6fbf7 url(//www.blogblog.com/1kt/simple/gradients_light.png) repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 42px Play;
color: #666666;
text-shadow: 1px 2px 3px rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #666666;
}
.Header .description {
font-size: 140%;
color: #666666;
}
.header-inner .Header .titlewrapper {
padding: 22px 30px;
}
.header-inner .Header .descriptionwrapper {
padding: 0 30px;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #eeeeee;
}
.tabs-inner .section:first-child ul {
margin-top: -0;
border-top: 0 solid #eeeeee;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.tabs-inner .widget ul {
background: #f5f5f5 url(//www.blogblog.com/1kt/simple/gradients_light.png) repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #eeeeee;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #999999;
border-left: 1px solid #ffffff;
border-right: 1px solid #eeeeee;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #eeeeee;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #eeeeee;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #eeeeee;
}
/* Headings
----------------------------------------------- */
h2 {
margin: 0 0 1em 0;
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
.date-header span {
background-color: transparent;
color: transparent;
padding: inherit;
letter-spacing: inherit;
margin: inherit;
}
.main-inner {
padding-top: 30px;
padding-bottom: 30px;
}
.main-inner .column-center-inner {
padding: 0 15px;
}
.main-inner .column-center-inner .section {
margin: 0 15px;
}
.post {
margin: 0 0 25px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #ffffff;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #222222;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #f9f9f9;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #eeeeee;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #ffffff;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #f9f9f9;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #eeeeee;
}
.blog-pager {
background: transparent none no-repeat scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 0 dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
body.mobile .AdSense {
margin: 0 -40px;
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #222222;
}
.mobile-link-button {
background-color: #121fb3;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid #eeeeee;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #eeeeee;
}
.content-outer {
max-width: 1400px !important;
}
/* fix header */
#header-inner {
width: 100% !important;
background-position: right !important;
}
.titlewrapper {
padding: 11px 30px 0 !important;
}
.descriptionwrapper {
margin-bottom: 0 !important;
}
.description {
font-size: 120% !important;
}
/* suppress things */
.date-header {
display: none;
}
#Attribution1 {
display: none;
}
.post-author, .post-timestamp, .reaction-buttons  {
display: none;
}
/* h2: sidebar titles */
/* h3: post title */
.post-title , .entry-title {
font-size: 180% !important;
margin-top: 0 !important;
}
.entry-title a:link, .entry-title a:visited, .entry-title a:active{
color: #a03;
}
#main h2 {
color:#333;
margin-bottom:.4em;
margin-top: 13px;
font-size:140%;
}
#main h3 {
color:#333;
margin-bottom:.4em;
margin-top: 13px;
font-size:110%;
}
#main h4 {
color:#333;
margin-bottom:.5em;
}
#sidebar-right-1 a:link, #sidebar-right-1 a:visited, #sidebar-right-1 a:active {
color: #666;
}
#sidebar-right-1 h2 {
font-size: 100%;
color: #666;
}
/* disable image box */
element.style {
}
table.chargers img {
height: 18px;
}
table.chargers img {
height: 18px;
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img, .BlogList .item-thumbnail img {
padding: 0;
background: #ffffff;
border: none;
-moz-box-shadow: none;
-webkit-box-shadow: none;
box-shadow: none;
}
/* Special items */
a:link img.hilite, a:visited img.hilite {
color: #888;
}
a:hover img.hilite {
color: #f66;
}
a:active img.hilite {
color: #33c;
}
pre {color:#000000;border:1px solid #000000;}
pre.repl { background-color:#e0e0f0; font-size:120%;}
pre.arc { background-color:#e0e0f0; font-size:120%;}
pre.code { background-color:#e0f0e0; font-size:120%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;text-wrap:unrestricted;}
code { font-size: 120%;}
blockquote { font-size: 110%; background: transparent url("/images/blockquote.gif") no-repeat 0 0; margin: 20px 0px; padding: 0px 40px;}
div.cite {font-size: .8em;.; font-style: italic; color: #888; margin-bottom: 9px;}
a.ref { color: gray;vertical-align: super; text-decoration: none; font-size:60%;margin-left: 2px;}
a img.hilite {
border: 1px solid;
color: #888;
}
table.chargers {
border-width: 1px;
border-spacing: 2px;
border-style: outset;
border-color: gray;
border-collapse: collapse;
background-color: white;
}
table.chargers th.maker {
padding-right: 5px;
text-align: right;
}
table.chargers th {
border-width: 1px;
padding: 3px;
border-style: inset;
border-color: gray;
background-color: white;
text-align: center;
}
table.chargers img {
height: 18px;
}
table.chargers td {
text-align: center;
border-width: 1px;
padding: 2px 8px;
border-style: inset;
border-color: gray;
background-color: white;
}
--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 750px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 750px;
max-width: 750px;
_width: 750px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 240px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 240px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("240px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 240px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 240px;
margin-right: -240px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
--></style>
<script type='text/javascript'>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3782444-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = (document.location.protocol == 'https:' ?
                  'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
<script type="text/javascript">
if (window.jstiming) window.jstiming.load.tick('headEnd');
</script></head>
<body class='loading variant-bold'>
<div class='navbar section' id='navbar'><div class='widget Navbar' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type="text/javascript">
        gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
          if (gapi.iframes && gapi.iframes.getContext) {
            gapi.iframes.getContext().openChild({
                url: 'https://www.blogger.com/navbar.g?targetBlogID\0756264947694886887540\46blogName\75Ken+Shirriff\47s+blog\46publishMode\75PUBLISH_MODE_HOSTED\46navbarType\75LIGHT\46layoutType\75LAYOUTS\46searchRoot\75http://www.righto.com/search\46blogLocale\75en\46v\0752\46homepageUrl\75http://www.righto.com/\46blogFollowUrl\75https://plus.google.com/106338564628446721517\46vt\0756208785917451083065',
                where: document.getElementById("navbar-iframe-container"),
                id: "navbar-iframe"
            });
          }
        });
      </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div itemscope='itemscope' itemtype='http://schema.org/Blog' style='display: none;'>
<meta content='Ken Shirriff&#39;s blog' itemprop='name'/>
</div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header'><div class='widget Header' id='Header1'>
<div id='header-inner' style='background-image: url("https://lh5.googleusercontent.com/-OyFd36t2Doo/T7nMSchO46I/AAAAAAAAKjM/ynuhCCEf_bs/s800/background.jpg"); background-position: left; width: 550px; min-height: 105px; _height: 105px; background-repeat: no-repeat; '>
<div class='titlewrapper' style='background: transparent'>
<h1 class='title' style='background: transparent; border-width: 0px'>
Ken Shirriff's blog
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>Chargers, microprocessors, Arduino, and whatever</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs section' id='crosscol'></div>
<div class='tabs section' id='crosscol-overflow'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main'><div class='widget Blog' id='Blog1'>
<div class='blog-posts hfeed'>
<!-- google_ad_section_start(name=default) -->

          <div class="date-outer">
        

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='6264947694886887540' itemprop='blogId'/>
<meta content='7604293181617350357' itemprop='postId'/>
<a name='7604293181617350357'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='http://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html'>Reverse-engineering the TL431: the most common chip you've never heard of</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-7604293181617350357' itemprop='description articleBody'>
A die photo of the interesting but little-known TL431 power supply IC
provides an opportunity to explore how analog circuits are implemented in silicon.
While the circuit below may look like a maze, the chip is actually relatively simple and can be reverse-engineered with a bit of examination. This article explains how transistors, resistors, and other components are implemented in silicon to form the chip below.
<p>
<a href="http://zeptobars.ru/en/read/TI-TL431-adjustable-shunt-regulator-linear-supply"><img class="hilite" src="https://lh3.googleusercontent.com/-ad3-u81VGO8/U0Aw4FtqruI/AAAAAAAAWys/DA7mq-BBGmk/s400/ti-tl431.jpg" height="400"
alt="Thumbnail of the TL431 die."
title="Thumbnail of the TL431 die.">
</a>
<p>
<div class="cite">
Die photo of the TL431. Original photo by <a href="http://zeptobars.ru/en/read/TI-TL431-adjustable-shunt-regulator-linear-supply">Zeptobars</a>.
</div>
<p>
The TL431 is a "programmable precision reference"<a class="ref" href="#ref1">[1]</a> and is commonly used in switching power supplies, where it provides feedback indicating if the output voltage is too high or too low.
By using a special circuit called a bandgap, the TL431 provides a stable voltage reference across a wide temperature range.
The block diagram of the TL431 below shows that it has a 2.5 volt reference and a comparator<a class="ref" href="#ref1">[1]</a>, but looking at the die shows that internally it is quite different from the block diagram.
<p>
<a href="https://picasaweb.google.com/lh/photo/KlEUYTM6Nxsd6tHE84sYHhje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh5.googleusercontent.com/-vV6gFO7-8cg/U3MOqvljs6I/AAAAAAAAX4A/xVcY4k1a8rc/s300/tl431-diagram-fairchild.png" width="300"
alt="TL431 block diagram from Fairchild datasheet"
title="TL431 block diagram from Fairchild datasheet">
</a>
<p>
<div class="cite">
 TL431 block diagram from the <a href="https://www.fairchildsemi.com/ds/TL/TL431.pdf">datasheet</a>
</div>
<p>
<p>
The TL431 has a long history; it was introduced in 1978<a class="ref" href="#ref2">[2]</a> and has been a key part of many devices since then. It helped regulate the Apple II power supply, and is now used in most ATX power supplies<a class="ref" href="#ref3">[3]</a> as well as the
the <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html">iPhone charger</a> and other chargers.
The MagSafe adapter and other <a href="http://www.fairchildsemi.com/support/referencedesign/docs/RD-337.pdf">laptop adapters</a> use it, as well as <a href="http://www.filewatcher.com/m/02156-90003_A600_A600+_ERD_Vol2_Jun84.pdf.11357470-0.html">minicomputers</a>,
<a href="http://datasheet.octopart.com/TPS92560DGQ-NOPB-Texas-Instruments-datasheet-21222722.pdf">LED</a><a href="http://www.supertex.com/pdf/app_notes/DN-H01.pdf">drivers</a>,
<a href="http://www.irf.com/technical-info/refdesigns/iraudps3.pdf">audio</a> <a href="http://www.allen-heath.com/media/WZ20S-SERVICE-MANUAL.pdf">power</a> supplies,
<a href="http://www.arcade-museum.com/manuals-videogames/J/juno_schem.pdf">video games</a>
and <a href="http://www.onsemi.com/pub_link/Collateral/AND8344-D.PDF">televisions</a>.<a class="ref" href="#ref4">[4]</a>
<p>
The photos below show the TL431 inside six different power supplies. The TL431 comes in many different shapes and sizes; the two most common are shown below.<a class="ref" href="#ref5">[5]</a>
Perhaps a reason the TL431 doesn't get much attention because it looks like a simple transistor, not an IC.
<p>
<a href="https://picasaweb.google.com/lh/photo/bg-Lq2nL6urck-ItD5etuxje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh4.googleusercontent.com/-8gT2gmRPMXU/U3kvOv4I2WI/AAAAAAAAX8k/dkdr1ErDiEs/s600/tl431-examples.png" width="600"
alt="Six examples of power supplies using the TL431. Top row: cheap 5 volt power supply, cheap phone charger, Apple iPhone charger (uses TL431 and 'GB9' variant). Bottom row: MagSafe power adapter, KMS USB charger, Dell ATX power supply (with optoisolators in front)"
title="Six examples of power supplies using the TL431. Top row: cheap 5 volt power supply, cheap phone charger, Apple iPhone charger (uses TL431 and 'GB9' variant). Bottom row: MagSafe power adapter, KMS USB charger, Dell ATX power supply (with optoisolators in front)">
</a>
<p>
<div class="cite">
 Six examples of power supplies using the TL431. Top row: cheap 5 volt power supply, <a href="http://www.righto.com/2012/03/inside-cheap-phone-charger-and-why-you.html">cheap phone charger</a>, <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html">Apple iPhone charger</a> (also 'GB9' variant in lower left). Bottom row: MagSafe power adapter, <a href="http://www.righto.com/2012/11/teardown-of-mysterious-kms-4-port-usb.html">KMS USB charger</a>, Dell ATX power supply (with optoisolators in front)
</div>
<p>
<h2>How components are implemented in the TL431's silicon</h2>
Since the TL431 is a fairly simple IC, it's possible to understand what's going on with the silicon layout by examining it closely. I'll show how the transistors, resistors, fuses, and capacitors are implemented, followed by a reverse-engineering of the full chip.
<h3>Implementing different transistor types in the IC</h3>
The chip uses NPN and PNP bijunction transistors (in contrast to chips like the <a href="http://www.righto.com/2013/01/a-small-part-of-6502-chip-explained.html">6502</a> that use MOSFET transistors).
If you've studied electronics, you've probably seen a diagram of a NPN transistor like the one below, showing the collector (C), base (B), and emitter (E) of the transistor, The transistor is illustrated as a sandwich of P silicon in between two symmetric layers of N silicon; the N-P-N layers make a NPN transistor.
It turns out that on the chip, the transistors look nothing like this. The base isn't even in the middle!
<p>
<a href="https://picasaweb.google.com/lh/photo/VWMi0Jrilua2szic-yEPMRje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh4.googleusercontent.com/-3jRG2w4bgPI/U227A6X_FkI/AAAAAAAAXtg/UZcGsCjqafc/s250/npn-transistor.png" width="250"
alt="Symbol and structure of an NPN transistor."
title="Symbol and structure of an NPN transistor.">
</a>
<p>
<div class="cite">
Symbol and structure of an NPN transistor.
</div>
<p>
The photo below shows one of the transistors in the TL431 as it appears on the chip.
The different pink and purple colors are regions of silicon that has been doped differently, forming N and P regions.
The whitish-yellow areas are the metal layer of the chip on top of the silicon - these form the wires connecting to the collector, emitter, and base.
<p>
Underneath the photo is a cross-section drawing showing approximately how the transistor is constructed.<a class="ref" href="#ref6">[6]</a> There's a lot more than just the N-P-N sandwich you see in books, but if you look carefully at the vertical cross section below the 'E', you can find the N-P-N that forms the transistor. The emitter (E) wire is connected to N+ silicon. Below that is a P layer connected to the base contact (B). And below that is a N+ layer connected (indirectly) to the collector (C).<a class="ref" href="#ref7">[7]</a>
The transistor is surrounded by a P+ ring that isolates it from neighboring components.
Since most of the transistor in the TL431 are NPN transistors with this structure, it's straightforward to pick out the transistors and find the collector, base, and emitter, once you know what to look for.
<p>
<a href="https://picasaweb.google.com/lh/photo/ytgL-uohXOsXhjsc93vBmBje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh3.googleusercontent.com/-K0RidaluGdg/U227BOaJaKI/AAAAAAAAXto/rrnG_QTND3w/s400/transistor-structure.png" width="400"
alt="An NPN transistor from the TL431 die, and its silicon structure."
title="An NPN transistor from the TL431 die, and its silicon structure.">
</a>
<p>
<div class="cite">
An NPN transistor from the TL431 die, and its silicon structure.
</div>
<p>
The NPN output transistor in the TL431 is much larger than the other transistors since it needs to handle the full current load of the device. While most of the transistors are operating on microamps, this transistor supports up to 100 mA. To support this current, it is large (taking up more than 6% of the entire die), and has wide metal connections to the emitter and collector.
<p>
The layout of the output transistor is very different from the other NPN transistors. This transistor is built laterally, with the base between the emitter and collector. The metal on the left connects to the 10 emitters (bluish N silicon), each surrounded by pinkish P silicon for the base (middle wire). The collector (right) has one large contact. The emitter and base wires form nested "fingers". Notice how the metal for the collector gets wider from top to bottom to support the higher current at the bottom of the transistor.
The image below shows a detail of the transistor, and the die photo shows the entire transistor.
<p>
<a href="https://picasaweb.google.com/lh/photo/XAhf4vLHGGm4K90sc6yi0Bje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh6.googleusercontent.com/-7ZA3wPwUcGE/U4DNc_2emhI/AAAAAAAAYAk/xNtOZNosy9o/s250/power-transistor.png" width="250"
alt="Closeup of the high-current output transistor in the TL431 chip."
title="Closeup of the high-current output transistor in the TL431 chip.">
</a>
<p>
<div class="cite">
Closeup of the high-current output transistor in the TL431 chip.
</div>
<p>
The PNP transistors have an entirely different layout from the NPN transistors.
They consist of a circular emitter (P), surrounded by a ring shaped base (N), which is surrounded by the collector (P). This forms a P-N-P sandwich horizontally (laterally), unlike the vertical structure of the NPN transistors.<a class="ref" href="#ref8">[8]</a>
<P>
The diagram below shows one of the PNP transistors in the TL431, along with a cross-section showing the silicon structure.
Note that although the metal contact for the base is on the edge of the transistor, it is electrically connected through the N and N+ regions to its active ring in between the collector and emitter.
<p>
<a href="https://picasaweb.google.com/lh/photo/40-k27qRWHS9NEuOxKiOIhje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh6.googleusercontent.com/-F5OF0I2XN74/U3wYqCt1hoI/AAAAAAAAX90/B6EvsfXPreA/s400/transistor-structure-pnp.png" width="400"
alt="Structure of a PNP transistor in the TL431 chip."
title="Structure of a PNP transistor in the TL431 chip.">
</a>
<p>
<div class="cite">
Structure of a PNP transistor in the TL431 chip.
</div>
<h3>How resistors are implemented in silicon</h3>
Resistors are a key component in an analog chip such as the TL431. They are implemented as a long strip of doped silicon. (In this chip, it looks like P-silicon is used for the resistors.)
Different resistances are obtained by using different lengths of resistive material: the resistance is proportional to the length-to-width ratio.
<p>
The photo below shows three resistors on the die. The three long horizontal strips are the resistive silicon that forms the resistors. Yellowish-white metal conductors pass over the resistors. Note the square contacts where the metal layer is connected to the resistor. The positions of these contacts control the active length of the resistor and thus the resistance. The resistance of the resistor on the bottom is slightly larger because the contacts are slightly farther apart. The top two resistors are connected in series by the metal on the upper left.
<p>
<a href="https://picasaweb.google.com/lh/photo/Tow_NleTlDlZAZwVEyqCdRje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh4.googleusercontent.com/-JAdIauoAiy0/U3gz_N_rHaI/AAAAAAAAX74/dJ9iSMhuswU/s400/resistors.png" width="400"
alt="Resistors in the TL431."
title="Resistors in the TL431.">
</a>
<p>
<div class="cite">
Resistors in the TL431.
</div>
<p>
Resistors in ICs have very poor tolerance - the resistance can vary 20% from chip to chip due to variations in the manufacturing process. This is obviously a problem for a precision chip like the TL431. For this reason, the TL431 is designed so the important parameter is the ratio of resistances, especially R1, R2, R3, and R4. As long as the resistances all vary in the same ratio, their exact values don't matter too much.
The second way the chip reduces the effect of variation is in the chip layout.
The resistors are laid out in parallel bands of the same width to reduce the effect of any asymmetry in the silicon's resistance. The resistors are also placed close together to minimize any variation in silicon properties between different parts of the chip.
Finally, the next section shows how the resistances can be adjusted before the chip is packaged, to fine-tune the chip's performance.
<p>
<h3>Silicon fuses to trim the resistors</h3>
One feature of the TL431 that I didn't expect is fuses for trimming the resistances. During manufacture of the chips, these fuses can be blown to adjust the resistances to increase the accuracy of the chip. Some <a href="http://zeptobars.ru/en/read/OPA627-AD744-real-vs-fake-china-ebay">more expensive chips</a> have laser-trimmed resistors, where a laser burns away part of the resistor before the chip is packaged, providing more control than a fuse.
<p>
The die photo below shows one of the fuse circuits. There is a small resistor (actually two parallel resistors) in parallel with a fuse. Normally, the fuse causes the resistor to be bypassed. During manufacture, the characteristics of the chip can be measured. If more resistance is required, two probes contact the pads and apply a high current. This will blow the fuse, adding the small resistance to the circuit. Thus, the resistance in the final circuit can be slightly adjusted to improve the chip's accuracy.
<p>
<a href="https://picasaweb.google.com/lh/photo/R0lIa2c0fzgDAZafMhnahxje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh6.googleusercontent.com/-m3CU73Nm9Iw/U3gz-Yjc3NI/AAAAAAAAX7w/fslUFLiapME/s400/fuse.png" width="400"
alt="A trimming fuse in the TL431."
title="A trimming fuse in the TL431.">
</a>
<p>
<div class="cite">
A trimming fuse in the TL431.
</div>
<h3>Capacitors</h3>
The TL431 contains two capacitors internally, and they are implemented in very different ways.
<p>
The first capacitor (under the TLR431A text) is a is formed from a reverse-biased diode (the reddish and purple stripes). The junction of a reverse-biased diode has capacitance, which can be used to form a capacitor (<a href="http://books.google.com/books?id=aByz--9D63wC&lpg=PA31&ots=ZJ3V72sLcD&dq=%22junction%20capacitor%22%20integrated%20circuit&pg=PA31#v=onepage&q&f=false">details</a>).
One limitation of this type of capacitor is the capacitance varies with voltage because the junction width changes.
<p>
<a href="https://picasaweb.google.com/lh/photo/8L0hu3BtI9tKfHWOlZ92HRje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh5.googleusercontent.com/-3eSO6VGZcZk/U3wYwFJUlbI/AAAAAAAAX-E/1ROyn8EM528/s350/c1.png" width="350"
alt="A junction capacitor in the TL431 chip with interdigitated PN junctions. The die id is written in metal on top."
title="A junction capacitor in the TL431 chip with interdigitated PN junctions. The die id is written in metal on top.">
</a>
<p>
<div class="cite">
A junction capacitor in the TL431 chip with interdigitated PN junctions. The die id is written in metal on top.
</div>
<p>
The second capacitor is formed in an entirely different manner, and is more like a traditional capacitor with two plates. There's not much to see: it has a large metal plate with the N+ silicon underneath acting as the second plate. The shape is irregular, to fit around other parts of the circuit. This capacitor takes up about 14% of the die, illustrating that capacitors use space very inefficiently in integrated circuits.
The <a href="http://www.ti.com/lit/ds/symlink/tl431.pdf">datasheet</a> indicates these capacitors are each 20 pF; I don't know if this is the real value or not.
<p>
<a href="https://picasaweb.google.com/lh/photo/84pCZm_N0AolcGS6bm75Oxje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh4.googleusercontent.com/-gVLif7QgJsY/U3wYvxwE4_I/AAAAAAAAX-A/VottdnLvbn8/s300/c2.png" height="300"
alt="A capacitor in the TL431 chip."
title="A capacitor in the TL431 chip.">
</a>
<p>
<div class="cite">
A capacitor in the TL431 chip.
</div>
<h2>The TL431 chip reverse-engineered</h2>
<p>
<a href="https://picasaweb.google.com/lh/photo/SqvPTrXtIpronDD3YUbamhje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh5.googleusercontent.com/--zrEJFJtE1E/U3g0BNlQ-jI/AAAAAAAAX8A/bqRAKtlrD24/s600/tl431-labeled.png" height="600"
alt="The components of the TL431, shown on the silicon die."
title="The components of the TL431, shown on the silicon die.">
</a>
<p>
<div class="cite">
The TL431 die, labeled.
</div>
<p>
The diagram above indicates the components on the die of the TL431, labeled to correspond to the schematic below. From the earlier discussion, the structure of each component should be clear. The three pins of the chip are connected to the "ref", "anode", and "cathode" pads.
The chip has a single layer of metal (yellowish-white) that connects the components. The schematic shows resistances in terms of an unknown scale factor R; 100 &ohm; is probably a reasonable value for R, but I don't know the exact value.
One big surprise from looking at the die is the component values are very different from the values in previously-published schematics. These values fundamentally affect how the bandgap voltage reference work.<a class="ref" href="#ref9">[9]</a>
<p>
<a href="https://picasaweb.google.com/lh/photo/BEk-H8YRAU14C11SFfJo6hje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh6.googleusercontent.com/-PgzVS9Most8/U23A90PB6pI/AAAAAAAAXuQ/Cqqu74VxJSM/s600/tl431-schematic.png" width="600"
alt="Internal schematic of the TL431"
title="Internal schematic of the TL431">
</a>
<p>
<div class="cite">
Internal schematic of the TL431
</div>
<h2>How the chip works</h2>
Externally, the TL431's operation is straightforward. If the voltage on the ref pin input goes above 2.5 volts, the output transistor conducts, causing current flow between the cathode and anode pins. In a power supply, this increase in current flow signals the power supply control chip (indirectly), causing it to reduce the power which will bring the voltage back to the desired level. Thus, the power supply uses the TL431 to keep the output voltage stable.
<p>
I'll give a brief summary of the chip's internal operation here, and write up a detailed explanation later. The most interesting part of the chip is the temperature-compensated bandgap voltage reference.<a class="ref" href="#ref10">[10]</a> The key to this is seen by looking at the die: transistor Q5 has 8 times the emitter area as Q4, so the two transistors are affected differently by temperature. The outputs of these transistors are combined by R2, R3, and R4 in the right ratio to cancel out the effects of temperature, forming a stable reference.<a class="ref" href="#ref11">[11]</a><a class="ref" href="#ref12">[12]</a>
<p>
The voltages from the temperature-stabilized bandgap are sent into the comparator, which has inputs Q6 and Q1; Q8 and Q9 drive the comparator. Finally, the output of the comparator goes through Q10 to drive the output transistor Q11.
<h2>Decapping the TL431 the low tech way</h2>
Getting an IC die photo usually involves dissolving the chip in dangerous acids and then photographing the die with an expensive metallurgical microscope. (Zeptobars describes their process <a href="http://zeptobars.ru/en/read/how-to-open-microchip-asic-what-inside">here</a>). I wondered what I'd end up with if I just smashed a TL431 open with Vise-Grip pliers and took a look with a cheap microscope.
I broke the die in half in the process, but still got some interesting results.
The picture below shows the large copper anode inside the package, which acts as a heat sink. Next to this is (most of ) the die, which is normally mounted on the copper anode where the white circle is. Note how much smaller the die is than the package.
<p>
<a href="https://picasaweb.google.com/lh/photo/KpuEBy4VboNYlxfXXhJNnxje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh3.googleusercontent.com/-CIkL2nCLWRY/U23FaFTJqII/AAAAAAAAXus/19SvOhELPR8/s350/tl431-decap.png" width="350"
alt="The TL431 package, the internal anode, and most of the die."
title="The TL431 package, the internal anode, and most of the die.">
</a>
<p>
<div class="cite">
The TL431 package, the internal anode, and most of the die.
</div>
<p>
Using a
<a href="http://www.amazon.com/gp/product/B005O0XVTS/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=B005O0XVTS&linkCode=as2&tag=rightocom&linkId=K4IDNBRRZ357P7LV">basic microscope</a>,
I obtained the photo below. While the picture doesn't have the same quality as Zeptobars', it shows the structure of the chip better than I expected.
This experiment shows that you can do a basic level of chip decapping and die photography without messing around with dangerous acids.
From this photo I can see that the cheap TL431s I ordered off eBay are identical to the one Zeptobars decapped. Since the Zeptobars chip didn't match published schematics, I wondered if they ended up with a strange variant chip variant, but apparently not.
<p>
<a href="https://picasaweb.google.com/lh/photo/5n9QsuYDXXigDhi9aFiwFhje37Q18OFd30djrlgrMEU"><img class="hilite" src="https://lh3.googleusercontent.com/-n5gGsLdXCM4/U23FaARpohI/AAAAAAAAXuw/7p_EsIZGsIY/s300/tl431-die-fragment.png" height="300"
alt="Piece of the TL431 die, photographed through a microscope."
title="Piece of the TL431 die, photographed through a microscope.">
</a>
<p>
<div class="cite">
Piece of the TL431 die, photographed through a microscope.
</div>
<h2>Conclusion</h2>
Is the TL431 really the most popular IC people haven't heard of? There's no way to know for sure, but I think it's a good candidate.
Nobody seems to publish data on which ICs are produced in largest quantities.
Some sources say the 555 timer is the most popular chip with a billion produced every year (which seems improbably high to me). The TL431 must be high up the popularity list -
you probably have a TL431 within arms-reach right now (in your phone charger, laptop power adapter, PC power supply, or monitor).
The difference is that chips such as the 555 and 741 are so well-known that they are almost part of pop culture with
<a target="_blank" href="http://www.amazon.com/s/?_encoding=UTF8&camp=1789&creative=390957&field-keywords=555%20timer&linkCode=ur2&rh=n%3A283155%2Ck%3A555%20timer&tag=rightocom&url=search-alias%3Dstripbooks&linkId=DAP4YWTZR4ZFKZOM">books</a>, <a href="http://www.zazzle.com/back_in_the_day_t_shirt_electronics-235723425983912736">T</a>-<a href="http://www.zazzle.com/classic_555_timer_chip_schematic_circuit_t_shirts-235739902118830235">shirts</a> and even <a href="http://www.zazzle.com/741_op_amp_chip_for_electronics_engineers_mugs-168318217281716788">mugs</a>.
But unless you've worked on power supplies, chances are you've never heard of the TL431.
Thus, the TL431 gets my vote for the most common IC that people are unaware of. If you have other suggestions for ICs that don't get the attention they deserve, leave a comment.
<h2>Acknowledgments</H2>
The die photos are by <a href="http://zeptobars.ru/en/read/TI-TL431-adjustable-shunt-regulator-linear-supply">Zeptobars</a> (except the photo I took).
The schematic and analysis are heavily based on
<a href="http://cbasso.pagesperso-orange.fr/Downloads/Papers/The%20TL431%20in%20loop%20control.pdf">Cristophe Basso</a>'s work.<a class="ref" href="#ref12">[12]</a>
The analysis benefited from discussion with Mikhail of Zeptobars, and the <a href="http://www.visual6502.org/">Visual 6502 group</a>, in particular B. Engl.
<h2>Notes and references</h2>
<p>
<a name="ref1"></a>[1]
Because the TL431 has an unusual function, there's no standard name for its function. Different datasheets describe it as a "<a href="http://www.ti.com.cn/cn/lit/ds/symlink/tl431.pdf">adjustable shunt regulator</a>", a "<a href="http://www.onsemi.com/pub_link/Collateral/TL431-D.PDF">programmable precision reference</a>",
a <a href="http://datasheet.octopart.com/TL431CDT-STMicroelectronics-datasheet-10720077.pdf">programmable shunt voltage reference</a>",
and a "<a href="http://www.onsemi.com/pub_link/Collateral/TND381-D.PDF">programmable zener</a>".
<p>
<a name="ref2"></a>[2]
I dug up some history on the origins of the TL431 from Texas Instruments'
<a href="http://w140.com/sbcman/Technical%20App%20notes/National%20Linear/TI_1977_VoltageRegulatorHandbook.pdf">Voltage Regulator Handbook</a> (1977).
The precursor chip, the TL430, was introduced as an adjustable shunt regulator in 1976
The TL431 was created as an improvement to TL430 with better accuracy and stability and was called a <i>precision</i> adjustable shunt regulator. The TL431 was announced as a future product in 1977 and launched in 1978.
Another future product that TI announced in 1977 was the TL432, which was going to be "Timer/Regulator/Comparator Building Blocks", containing a voltage reference, comparator, and booster transistor in one package. <a href="http://www.datasheetarchive.com/dlmain/Datasheets-112/DSAP0044706.pdf">preliminary datasheet</a>. But when the TL432 came out, the "building block" plan had been abandoned. The TL432 ended up being merely a TL431 with the pins in a different order, to help PC board layout. <a href="http://www.datasheets360.com/pdf/-9201004993761584941?query=tl432">datasheet</a>.
<p>
<a name="ref3"></a>[3]
Modern ATX power supplies (<a href="http://www.onsemi.com/pub_link/Collateral/TND313-D.PDF">example</a>, <a href="http://www.fairchildsemi.com/support/referencedesign/docs/RD-268.pdf">example</a>) often contain three TL431s. One provides feedback for the standby power supply, another provides feedback for the main power supply, and a third is used as a linear regulator for the 3.3V output.
<p>
<a name="ref4"></a>[4]
It's interesting to look at the switching power supplies that <i>don't</i> use the TL431.
Earlier switching power supplies typically used a Zener diode as a voltage reference.
The earliest Apple II power supplies used a Zener diode as the voltage reference (Astec AA11040), but this was soon replaced by a TL431 in the <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/apple/power_supply/Astec_Power_Supplies_Aug82.pdf">Astec AA11040-B</a> revision.
The Commodore <a hef="http://www.zimmers.net/anonftp/pub/cbm/schematics/computers/b/index.html">CBM-II model B</a> used a TL430 instead of TL431, which is an unusual choice.
The original IBM PC power supply used a Zener diode for reference (along with many op amps). Later PC power supplies often used the <a href="http://www.ti.com/lit/ds/symlink/tl494.pdf">TL494</a> PWM controller, which contained its own voltage reference and operated on the secondary side. Other ATX power supplies used the <a href="http://www.sg.com.tw/semigp/data/6105/6105-datasheet.pdf">SG6105</a> which included two TL431s internally.
<p>
Phone chargers usually use the TL431. Inexpensive knockoffs are an exception; they often use a Zener diode instead to save a few cents. Another exception is chargers such as the <a href="http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html">iPad charger</a>, which use primary-side regulation and don't use any voltage feedback from the output at all.
See <a href="http://www.righto.com/2012/02/apple-didnt-revolutionize-power.html">my article on power supply history</a> for more information.
<p>
<a name="ref5"></a>[5]
The TL431 is available in a larger variety of packages than I'd expect.
Two of the photos show the TL431 in a transistor-like package with three leads (TO-92). The remaining photos show the surface-mounted SOT23-3 package. The TL431 also comes in 4-pin, 5-pin, 6-pin, or 8-pin surface-mounted packages (SOT-89, SOT23-5, SOT323-6, SO-8 or MSOP-8), as well as a larger package like a power transistor (TO-252) or an 8-pin IC package (DIP-8).
(<a href="http://datasheet.octopart.com/TL431ACDT-STMicroelectronics-datasheet-10720077.pdf">pictures</a>).
<p>
<a name="ref6"></a>[6]
For more information on how bipolar transistors are implemented in silicon, there are many sources.
<a href="http://www.halbleiter.org/en/fundamentals/bipolar/">Semiconductor Technology</a> gives a good overview of NPN transistor construction.
<a href="http://www.doe.carleton.ca/~tjs/4705Slides.pdf">Basic Integrated Circuit Processing</a> is a presentation that describes transistor fabrication in great detail.
The <a href="http://commons.wikimedia.org/wiki/File:Bipolar_Junction_Transistor_NPN_Structure_integrated_vertical.png">Wikipedia</a> diagram is also useful.
<p>
<a name="ref7"></a>[7]
You might have wondered why there is a distinction between the collector and emitter of a transistor, when the simple picture of a transistor is totally symmetrical. Both connect to an N layer, so why does it matter? As you can see from the die photo, the collector and emitter are very different in a real transistor. In addition to the very large size difference, the silicon doping is different. The result is a transistor will have <a href="http://en.wikibooks.org/wiki/Semiconductors/Introduce_to_Transistor#Operating_Modes">poor gain</a> if the collector and emitter are swapped.
<p>
<a name="ref8"></a>[8]
The PNP transistors in the TL431 have a circular structure that gives them a very different appearance from the NPN transistors.
The circular structure used for PNP transistors in the TL431 is illustrated in <a href="http://www.designinganalogchips.com/">Designing Analog Chips</a> by Hans Camenzind, who was the designer of the 555 timer. If you want to know more about analog chips work, I strongly recommend Camenzind's book, which explains analog circuits in detail with a minimum of mathematics.
Download the
<a href="http://www.designinganalogchips.com/">free PDF</a> or get the
<a href="http://www.amazon.com/gp/product/1589397185/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1589397185&linkCode=as2&tag=rightocom&linkId=HWM4BGAFX7CC36CR">printed version</a>.
<p>
The structure of a PNP transistor is also explained in <a href="http://ecee.colorado.edu/~bart/book/book/chapter5/ch5_8.htm">Principles of Semiconductor Devices</a>.
<a href="http://www.amazon.com/gp/product/0470245999/ref=as_li_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=0470245999&linkCode=as2&tag=rightocom&linkId=SXTNKSWHCNS5SFZR">Analysis and Design of Analog Integrated Circuits</a> provides detailed models of bipolar transistors and how they are fabricated in ICs.
<p>
<a name="ref9"></a>[9]
The transistors and resistors in the die I examined have very different values from values others have published. These values fundamentally affect the operation of the bandgap voltage reference. Specifically,
previous schematics show R2 and R3 in a 1:3 ratio, and Q5 has 2 times the emitter area as Q6.
Looking at the die photo, R2 and R3 are equal, and Q5 has 8 times the emitter area as Q4.
These ratios result in a different &Delta;Vbe. To compensate for this, R1 and R4 are different between previous schematics and the die photo. I will explain this in detail in a later article, but to summarize Vref = 2*Vbe + (2*R1+R2)/R4 * &Delta;Vbe, which works out to about 2.5 volts. Note that the ratio of the resistances matters, not the values; this helps counteract the poor resistor tolerances in a chip.
<p>
In the die, Q8 is formed from two transistors in parallel. I would expect Q8 and Q9 to be identical to form a balanced comparator, so I don't understand the motivation behind this. My leading theory is this adjusts the reference voltage up slightly to hit 2.5V. B. Engl suggests this may help the device operate better at low voltage.
<p>
<a name="ref10"></a>[10]
I won't go into the details of a bandgap reference here, except to mention that it sounds like some crazy quantum device, but it's really just a couple transistors.
For more information on how a bandgap reference works, see <a href="https://www.idt.com/document/whp/how-make-bandgap-voltage-reference-one-easy-lesson-paul-brokaw">How to make a bandgap voltage reference in one easy lesson</a> by Paul Brokaw, inventor of the
<a href="http://en.wikipedia.org/wiki/Brokaw_bandgap_reference">Brokaw bandgap reference</a>. A presentation on the bandgap reference is <a href="http://amesp02.tamu.edu/~sanchez/607%20Lect%204%20Bandgap-2009.pdf">here</a>.
<p>
<a name="ref11"></a>[11]
In a sense, the bandgap circuit in the TL431 operates "backwards" to a regular bandgap voltage reference. A normal bandgap circuit provides the necessary emitter voltages to produce the desired voltage as output. The TL431's circuit takes the reference voltage as input, and the emitter voltages are used as outputs to the comparator. In other words, contrary to the block diagram, there is <i>not</i> a stable voltage reference inside the TL431 that is compared to the ref input. Instead, the ref input generates two signals to the comparator that match when the input is 2.5 volts.
<p>
<a name="ref12"></a>[12]
There are many articles about the TL431, but they tend to be very technical, expecting a background in control theory, Bode plots, etc.
<a href="http://cbasso.pagesperso-orange.fr/Downloads/Papers/The%20TL431%20in%20loop%20control.pdf">The TL431 in Switch-Mode Power Supplies loops</a> is a classic TL431 paper by Christophe Basso and Petr Kadanka. This explains the TL431 from the internals through loop compensation to an actual power supply. It includes a detailed schematic and description of how the TL431 operates internally. Other related articles are at <a href="http://powerelectronics.com/author/christophe-basso">powerelectronics.com</a>.
<a href="http://switchingpowermagazine.com/downloads/15%20Designing%20with%20the%20TL431.pdf">Designing with the TL431</a>, Ray Ridley, Switching Power Magazine is a detailed explanation of how to use the TL431 for power supply feedback, and the details of loop compensation.
<a href="http://www.onsemi.com/pub_link/Collateral/TND381-D.PDF">The TL431 in the Control of Switching Power Supplies</a> is a detailed presentation from ON Semiconductor.
The <a href="http://www.ti.com/lit/ds/symlink/tl431.pdf">TL431 datasheet</a> includes a schematic of the chip's internals. Strangely, the resistances on this schematic are very different from what can be seen from the die.
<p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
</span>
<span class='reaction-buttons'>
</span>
<span class='star-ratings'>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='http://www.blogger.com/comment.g?blogID=6264947694886887540&amp;postID=7604293181617350357' onclick=''>
2 comments:
    </a>
</span>
<span class='post-backlinks post-comment-link'>
<a class='comment-link' href='http://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html#links'>Links to this post</a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='http://www.blogger.com/email-post.g?blogID=6264947694886887540&postID=7604293181617350357' title='Email Post'>
<img alt='' class='icon-action' height='13' src='http://img1.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-1138732533'>
<a href='http://www.blogger.com/post-edit.g?blogID=6264947694886887540&postID=7604293181617350357&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='http://img2.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=7604293181617350357&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=7604293181617350357&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=7604293181617350357&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=7604293181617350357&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=7604293181617350357&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block dummy-container'><g:plusone source='blogger:blog:plusone' href='http://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://www.righto.com/search/label/apple' rel='tag'>apple</a>,
<a href='http://www.righto.com/search/label/electronics' rel='tag'>electronics</a>,
<a href='http://www.righto.com/search/label/power%20supply' rel='tag'>power supply</a>,
<a href='http://www.righto.com/search/label/reverse-engineering' rel='tag'>reverse-engineering</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>
<!-- google_ad_section_end(name=default) -->
<div class='inline-ad'>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0159785530845184";
google_ad_host = "ca-host-pub-1556223355139109";
google_ad_host_channel = "L0007";
/* arcfn_main_Blog1_300x250_as */
google_ad_slot = "6408308186";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<!-- google_ad_section_start -->

            </div></div>
          

          <div class="date-outer">
        

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://lh3.googleusercontent.com/-jh5hlCy0GxE/UEvqFCCnm6I/AAAAAAAANmk/nD85gxt3OLs/s640/charger-ipads.png' itemprop='image_url'/>
<meta content='6264947694886887540' itemprop='blogId'/>
<meta content='1497775255051261544' itemprop='postId'/>
<a name='1497775255051261544'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html'>iPad charger teardown: inside Apple's charger and a risky phony</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1497775255051261544' itemprop='description articleBody'>
<style>
div.ipad-img {
position:relative;
display:inline-block;
}
div.ipad-label {
position:absolute;
top: 5px;
left: 5px;
color: #444;
font-size: 18px;
font-family: arial;
}
</style>
<div style="background:#dde; color:#666; margin: 8px 0;">
This article is now available in Chinese: <a href="http://www.pingapple.com/ipad-charger-teardown-inside-apples-charger-and-a-risky-phony">[中文翻译版本] Apple iPad原装充电器拆解</a>.
</div>
Apple sells their iPad charger for $19, while you can buy an iPad charger on eBay for about $3. From the outside, the chargers look the same. Is there a difference besides the price? In this article, I look inside real and counterfeit chargers and find that the genuine charger has much better construction, power quality, and most importantly safety. The counterfeit turns out to be a 5 watt charger in disguise, half the power of a genuine charger.
<p>
<div class="ipad-img">
<div class="ipad-label" style="color:#aaa">iPad</div>
<div class="ipad-label" style="color:#aaa;left:320px">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/qp7EyA3WqrM9rf8rshd2PNkcRWcsA1_Y1J-NVPnKkng?feat=embedwebsite"><img class="hilite" src="https://lh3.googleusercontent.com/-jh5hlCy0GxE/UEvqFCCnm6I/AAAAAAAANmk/nD85gxt3OLs/s640/charger-ipads.png" height="230" width="640" alt="A real Apple iPad charger (left) and a counterfeit charger (right" title="A real Apple iPad charger (left) and a counterfeit charger (right"></a>
</div>
<p>
From the outside, the real charger (left) and counterfeit charger (right) are almost identical. If you look very closely, you can spot are a few differences in the text: The counterfeit removed "Designed by Apple in California. Assembled in China" and the manufacturer "Foxlink"<a class="ref" href="#ref1">[1]</a>, probably for legal reasons. (But strangely, the counterfeit still says "TM and &copy; 2010 Apple Inc.") The counterfeit charger displays a bunch of certifications (such as UL) that it doesn't actually have. As you will see below, there is no way it could pass safety testing.
<p>
Opening up the chargers reveals big differences between them. The genuine charger on the left is crammed full of components, fitting as much as possible into the case. The counterfeit charger on the right is much simpler with fewer components and much more empty space. The Apple charger uses larger, higher-quality components (in particular the capacitors and the transformer); below you will see that these have a big effect on power quality and safety.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<div class="ipad-label" style="left:320px">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/d9x5PfHSJu_YDbU4E80LVNMTjNZETYmyPJy0liipFm0">
<img class="hilite" src="https://lh5.googleusercontent.com/-A0hqjBlSMqE/Uz5JXJqinOI/AAAAAAAAWto/pPwEp2iNUVA/s600/ipad-chargers-top.png" width="600" height="305"
alt="The components inside a real iPad charger (left) and a counterfeit charger (right)."
title="The components inside a real iPad charger (left) and a counterfeit charger (right).">
</a>
</div>
<p>
<div class="cite">
The components inside a real iPad charger (left) and a counterfeit charger (right).
</div>
<p>
One safety difference is obvious: the Apple charger has much more insulation. The upper (high-voltage) half is wrapped in yellow insulating tape. Some components are encased in shrink tubing, there are plastic insulators between some components, and some wires have extra insulation. The counterfeit charger only has minimal insulation.
<p>
The build quality of the Apple charger is much higher. In the counterfeit charger, some components are visibly crooked or askew. While this doesn't affect the circuit electrically, it indicates a lack of care in construction.
<p>
Flipping the boards over reveals that the circuitry of the genuine Apple charger is much more complex than the counterfeit. The Apple board is crammed with tiny surface-mounted components in every available spot. The counterfeit board has a lot of empty space, with just a few components. Note the reddish insulating tape in the lower center of the Apple board, another safety feature of the genuine charger.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<div class="ipad-label" style="left:320px">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/TxZhIA7NlGKmXQRXzRyKEdMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh6.googleusercontent.com/-EJw0ofsc6kw/Uz5JXGOH7PI/AAAAAAAAWtk/r6WwuhCUQl8/s600/ipad-chargers-bottom.png" width="600" height="335"
alt="The circuit board of a real iPad charger (left) and a counterfeit charger (right)."
title="The circuit board of a real iPad charger (left) and a counterfeit charger (right).">
</a>
</div>
<p>
<div class="cite">
The circuit board of a real iPad charger (left) and a counterfeit charger (right).
</div>
<h2>How the chargers work</h2>
Both the real and counterfeit chargers use similar flyback<a class="ref" href="#ref2">[2]</a> switching power supply circuits. The switching power supply is the <a href="http://www.righto.com/2012/02/apple-didnt-revolutionize-power.html">innovation</a> that allows these chargers to be so compact, unlike the heavy "wall warts" powering older consumer electronics.  The principle of a switching power supply is the power is switched on and off tens of thousands of times a second, allowing it to provide the exact amount of power required with very little power wasted as heat. In addition, the high frequencies allow the charger to use a small transformer, unlike the bulky transformers used for 60 Hz AC.
<p>
Since the counterfeit charger is much simpler, it is easier to understand how it works and I'll explain it first in reference to the picture below. The AC power enters through the white wires in the upper left. It passes through a fusible resistor, which acts as a safety fuse. Below this, the bridge rectifier contains four diodes which convert the AC into DC (at about 170 to 340 volts<a class="ref" href="#ref3">[3]</a>). The input capacitor smooths out this power. The 4-pin control IC<a class="ref" href="#ref4">[4]</a> monitors the charger and uses the switching transistor to turn the high-voltage DC on and off 41,000 times per second.  This chopped DC is fed into the primary winding of the flyback transformer. The transformer converts this to the desired high-current 5 volts. The output diode produces DC, and the output capacitor smooths it out. Finally, the output voltage is available at the USB connector to power your iPad. A few components round out the circuit. A feedback winding on the transformer provides voltage feedback to the control IC. This winding also powers the IC; the IC power capacitor smooths out this power. Finally, the blue snubber<a class="ref" href="#ref5">[5]</a> capacitor absorbs current spikes when the transistor is switched off.<a class="ref" href="#ref6">[6]</a>
<p>
<div class="ipad-img">
<div class="ipad-label">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/HaJHII1B1xZjX2NlyMTlOsFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh3.googleusercontent.com/-OforqHufiec/U2MUQXuKAzI/AAAAAAAAXoM/Qrha7eIiveo/s600/counterfeit-components-labeled.png" width="600" height="440"
alt="Inside a counterfeit iPad charger"
title="Inside a counterfeit iPad charger">
</a>
</div>
<p>
<div class="cite">
Inside a counterfeit iPad charger
</div>
<p>
The genuine iPad charger below operates on similar principles, although the circuit is more advanced. The AC input is on the lower right, and goes through a 2A fuse (in black insulation for safety).  The primary has much more filtering than in the counterfeit charger with a filter coil (common mode choke), inductor, and two large electrolytic capacitors. This increases the cost, but improves the power quality. On the output side (left), the charger has two filter capacitors, including a high-quality aluminum polymer capacitor (with the magenta stripe). The Y capacitors help reduce interference.<a class="ref" href="#ref7">[7]</a> The tiny <a href="http://en.wikipedia.org/wiki/Thermistor#NTC">NTC</a> temperature sensor lets the charger shut down if it overheats.
(I removed some of the charger's insulation to make the components visible in this photo.)
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/_CQ3n2wO2ALNPfVQtSWagsFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh4.googleusercontent.com/-AnmaNOW-jkc/U2MUYvUqhlI/AAAAAAAAXoc/DNmm3BRVC9Q/s600/ipad-components-labeled.png" width="600" height="420"
alt="Inside a genuine iPad charger."
title="Inside a genuine iPad charger.">
</a>
</div>
<p>
<div class="cite">
Inside a genuine iPad charger.
</div>
<p>
On the other side of the circuit board, things get complicated in the Apple charger. Starting with the AC input in the upper right, the charger includes additional input filters as well as spark gaps.<a class="ref" href="#ref8">[8]</a>
The latch release circuit<a class="ref" href="#ref9">[9]</a> lets the charger reset quickly from faults.
The control IC<a class="ref" href="#ref10">[10]</a> provides advanced control of the charger under varying conditions. (This IC is much more complex than the control IC in the counterfeit charger.) The current sense resistor lets the IC monitor the current through the transformer and the line voltage resistors let the IC monitor the input voltage (as well as initially powering-up the IC<a class="ref" href="#ref9">[9]</a>). The protection circuit uses the temperature sensor on the other side of the board to shut down if there is an over-voltage or over-temperature problem.
<a class="ref" href="#ref20">[20]</a>
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/GXqoub1ziD7y9DxvpWk9VcFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh3.googleusercontent.com/-WGdNLkeiiEw/U2MUYDi7tjI/AAAAAAAAXoY/JQswfizz95E/s600/ipad-board-labeled.png" width="600" height="388"
alt="The circuit board inside a genuine iPad charger showing the components."
title="The circuit board inside a genuine iPad charger showing the components.">
</a>
</div>
<p>
<div class="cite">
The circuit board inside a genuine iPad charger showing the components.
</div>
<p>
The secondary side includes some special features for power quality. The Y-capacitor filter works with the Y capacitors to filter out noise. The output filter circuitry is more complex than in the counterfeit. Note that the real charger has a ground connection, unlike the counterfeit charger which has a plastic pin here.<a class="ref" href="#ref11">[11]</a>
<p>
Both chargers use resistors to put special voltages on the USB data lines<a class="ref" href="#ref12">[12]</a> to indicate the charger type, using Apple's proprietary system (<a href="http://www.righto.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html#ref6">details</a>). (This is why iPads say "Charging is not supported with this accessory" with some chargers.) Through these resistors the genuine charger indicates that it is an Apple 2A charger, while the counterfeit indicates that it is an Apple 1A charger. This shows that the counterfeit is really a 5W charger packaged as a 10W charger.
<p>
When looking at these circuits up close, it's easy to forget just how small the components are. The picture below shows one of the surface-mount components (a 0-ohm resistor<a class="ref" href="#ref13">[13]</a>) from the iPad charger. It is just to the left of Roosevelt's chin on the dime.
<p>
<a href="https://picasaweb.google.com/lh/photo/lz0rYaUPo8iUS1192AqXMMFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh4.googleusercontent.com/-QAZddcfw-yg/U2HXBeTxMsI/AAAAAAAAXm8/X4Idr51ncik/s200/dime-0-ohm.png" width="200" height="193"
alt="A zero-ohm resistor from the iPad charger, on top of a dime"
title="A zero-ohm resistor from the iPad charger, on top of a dime">
</a>
<p>
<div class="cite">
A zero-ohm resistor
</div>
<h2>Safety, or lack thereof</h2>
Safety probably isn't something you think about when you plug in your charger, but it's important. Inside the charger is 170 volts or more with very little separating it from your iPad and you. If something goes wrong, the charger can burn up (below), <a href="http://www.myfoxtwincities.com/story/25113149/knock-off-iphone-charger-leaves-man-with-electrical-burn-infection">injure you</a>, or even <a href="http://news.xinhuanet.com/english/china/2013-07/14/c_132540098.htm">kill</a><a href="http://appleinsider.com/articles/13/11/27/thai-man-dies-after-alleged-electrocution-from-charging-iphone-4s-">you</a>.
Devices such as chargers have strict safety standards<a class="ref" href="#ref14">[14]</a> - if you get a charger from a reputable manufacturer. If you buy a cheap counterfeit charger, these safety standards are ignored. You can't see the safety risks from the outside, but by taking the chargers apart, I can show you the dangers of the counterfeit.
<p>
<div class="ipad-img">
<div class="ipad-label">Counterfeit iPhone</div>
<a href="http://goo.gl/DRLyg"><img class="hilite"  src="https://lh6.googleusercontent.com/-J-MiAowyVLA/UD73q408xII/AAAAAAAAM-0/3OLgCyzS0jk/s288/anool.png" height="256" width="288"
 title="Counterfeit iPhone charger that burned up"
 alt="Counterfeit iPhone charger that burned up"
/></a>
</div>
<div class="cite">A Counterfeit iPhone charger that burned up. Photo by Anool Mahidharia. Used with permission</div>

<h3>Creepage and clearance</h3>
The UL regulations<a class="ref" href="#ref14">[14]</a> require safe separation between the high voltage and the low voltage. This is measured by creepage - the distance between them along the circuit board, and clearance - the distance between them through air. The regulations are complex, but in general there should be at least 4mm between high-voltage circuitry and low-voltage circuitry.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/x5qhXbZnhvb6GLtI6vF6H8FWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh4.googleusercontent.com/-3cq7YeRGKWw/U2QfUJYrXqI/AAAAAAAAXpY/sxKJLCGGEOM/s400/ipad-creepage.png" width="400" height="229"
alt="The iPad charger provides safe creepage and clearance distances between the high-voltage side (bottom) and low-voltage side (top)."
title="The iPad charger provides safe creepage and clearance distances between the high-voltage side (bottom) and low-voltage side (top).">
</a>
</div>
<p>
<div class="cite">
The iPad charger provides safe creepage and clearance distances between the primary high-voltage side (bottom) and secondary low-voltage side (top).
</div>
<p>
The image above shows how the genuine iPad charger's circuit board separates the high voltage (bottom) from the low voltage (top).
The happy face on the right marks an empty region that provides a safety gap between the primary and secondary. (This is a contrast with the rest of the circuit board, which is crammed full of components.) This gap of 5.6mm provides a comfortable safety margin. The happy face on the left marks a slot in the board that separates the low voltage and high voltage. The photo below shows how an insulating fin is built into the case and through this slot to protect the USB connector.
Additional reddish-brown insulating tape goes through this slot, and the whole high-voltage section is wrapped in yellow insulating tape. The result is multiple layers of protection.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/o31-EBVllHk1ww0ToQ4TztMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh3.googleusercontent.com/-EKV-18PoL1c/Uz5JY3bFWOI/AAAAAAAAWuA/Tm2UKoHIcjE/s400/ipade-case-fin.png" width="400" height="387"
alt="The iPad charger case has a plastic fin that slides around the USB port to provide extra insulation."
title="The iPad charger case has a plastic fin that slides around the USB port to provide extra insulation.">
</a>
</div>
<p>
<div class="cite">
The iPad charger case has a plastic fin that slides around the USB port to provide extra insulation.
</div>
<p>
The creepage distance on the counterfeit charger board below is scary - only 0.6 mm separation between low and high voltage. The sad face on the right shows where a low-voltage trace is nearly touching the high-voltage trace below. (The ruler on the right indicates millimeters.) The board isn't as bad as it could be: the happy face on the left marks a slot cut in the circuit board under the transformer to increase the creepage distance. But overall, this board is unsafe. If you use the charger in a humid bathroom and a drop of water condenses across the 0.6 mm gap, then zap!
<p>
<div class="ipad-img">
<div class="ipad-label">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/4oR5PJJ-mvkhjvJ-63-bocFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh5.googleusercontent.com/-Tztia6eaz8Q/U2Mpm5nuTpI/AAAAAAAAXpE/Yf9YqkWu-No/s400/counterfeit-creepage.png" width="400" height="179"
alt="Dangerous creepage in a counterfeit iPad charger."
title="Dangerous creepage in a counterfeit iPad charger.">
</a>
</div>
<p>
<div class="cite">
Dangerous creepage in a counterfeit iPad charger.
</div>
<h3>Safety in the transformer</h3>
For safety, the high-voltage and low-voltage sides of the charger must be electrically isolated.<a class="ref" href="#ref15">[15]</a> But obviously the electrical power needs to get through somehow. The flyback transformer accomplishes this task by using magnetic fields to transfer the power without a dangerous direct connection.
Because the transformer is a large and relatively expensive component, it is tempting to take safety and quality short cuts here.
The genuine transformer (left) is considerably larger than the counterfeit (right), which is a hint of better quality and more power capacity.
Disassembling the transformers shows that this is the case.
<p>
<div class="ipad-img">
<div class="ipad-label" style="top:200px">iPad</div>
<div class="ipad-label" style="left:280px;top:200px">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/Cl2LNybla9buZo_SWfHWV9MTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh4.googleusercontent.com/-kYaWfZoEnmo/Uz5JbDUtApI/AAAAAAAAWug/gIkRh0xrKBc/s400/transformers.png" width="400" height="238"
alt="The flyback transformers from an iPad charger (left) and a counterfeit charger (right). Dime and banana are for scale."
title="The flyback transformers from an iPad charger (left) and a counterfeit charger (right). Dime and banana are for scale.">
</a>
</div>
<p>
<div class="cite">
The flyback transformers from an iPad charger (left) and a counterfeit charger (right). Dime and banana are for scale.
</div>
<p>
The key safety requirement of the transformer is to separate the high-voltage windings from the low-voltage secondary winding, and the counterfeit charger fails here. The pictures below show the transformers after removing primary windings and insulating tape, revealing the secondary winding.

The wires look similar at first glance, but the the genuine charger (left) has triple-insulated wire while the counterfeit (right) is uninsulated except for a thin varnish. The triple-insulated wire is an important safety feature that keeps the high voltage out even if there is a flaw in the insulating tape and in the wire's insulation. Also note the additional black and white insulation on the wires where they leave the transformer.
In the counterfeit charger, the only thing separating the secondary winding from high voltage is the insulating tape. If there is a flaw in the tape or the wires shift too far, then zap!
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/7lElJ9L80RzQSYndjZpNAcFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh4.googleusercontent.com/-6XuM9Maryt4/U15uw8T-ddI/AAAAAAAAXi4/J4g78gezqNQ/h250/trans-real-secondary.png" height="250" width="332"
alt="Inside the transformer of an iPad charger, This is the triple-insulated secondary winding."
title="Inside the transformer of an iPad charger, This is the triple-insulated secondary winding.">
</a>
</div>
<div class="ipad-img">
<div class="ipad-label">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/HfaLr8q5pw0x3Xs_6OEbv9MTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh3.googleusercontent.com/--ffXppCFgKo/Uz5JaLPUEfI/AAAAAAAAWuM/isg-K-ar5tU/h250/trans-fake-3.png" height="250" width="229"
alt="The secondary winding does not have triple-insulated wiring. This is a major safety flaw in the counterfeit iPad charger."
title="The secondary winding does not have triple-insulated wiring. This is a major safety flaw in the counterfeit iPad charger.">
</a>
</div>
<h2>The real charger provides much more power with much less noise</h2>
Lab measurements of the output from the chargers shows a couple problems with the counterfeit. First, the counterfeit turns out to provide at most 5.9W, not 10W. Second, the output voltage is extremely noisy and full of spikes.
<p>
The following voltage-vs-current graphs show the performance of the iPad charger (left) and counterfeit charger (right) under increasing load. The line for the real charger goes much farther to the right, showing that the real charger provides much more current. By my measurements, the real charger provides a maximum of 10.1 watts, while the counterfeit charger provides only 5.9 watts. The consequence is the real charger will charge your iPad almost twice as fast.
(For details on these graphs, see my article <a href="http://www.righto.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html">testing a dozen chargers</a>.)
The other thing to note is the line for the Apple charger is smooth and thin, while the counterfeit charger's line is all over the place. This indicates that the power provided by the counterfeit charger is noisy and low quality.
<p>
<div class="ipad-img">
<div class="ipad-label" style="color:#aaa">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/J6du_Vi_dn0HBj8VEsVRotMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh6.googleusercontent.com/-yPrI4tegpf8/Uz7cHKx_hyI/AAAAAAAAWyM/AV0_glyNBIw/s288/ipad-vi.png" width="288" height="210"
alt="Voltage vs current graph for iPad charger"
title="Voltage vs current graph for iPad charger">
</a>
</div>
<div class="ipad-img">
<div class="ipad-label" style="color:#aaa">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/eCm04QRrHCjXSzSMgrJDitMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh5.googleusercontent.com/-MFw_PhOhtfU/Uz7cHGm6x7I/AAAAAAAAWyQ/Y_f_tTdoavQ/s288/ipad-fake-vi.png" width="288" height="210"
alt="Voltage vs current graph for fake iPad charger"
title="Voltage vs current graph for fake iPad charger">
</a>
</div>
<p>
The next pair of graphs shows the power quality. The yellow line shows the voltage. The real charger has a stable yellow thin line, while the counterfeit charger's output has large voltage spikes. (I had to change the scale to get the output to fit on the screen, so the counterfeit charger is actually twice as bad as it appears here.) The bottom of the counterfeit charger's yellow line is wavy, due to 120 Hz ripple appearing in the output voltage.
<p>
<div class="ipad-img">
<div class="ipad-label" style="color:#aaa">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/ChlTXOGtH2Kr5p-flxTgjtkcRWcsA1_Y1J-NVPnKkng?feat=embedwebsite"><img class="hilite" src="https://lh5.googleusercontent.com/-xNY2SKl78hk/UDOvk3kuapI/AAAAAAAAMfQ/xfRNcQf2Zik/s288/hifreq012.png" height="216" width="288" title="High frequency oscilloscope trace from Apple iPad charger" alt="High frequency oscilloscope trace from Apple iPad charger"></a>
</div>
<div class="ipad-img">
<div class="ipad-label" style="color:#aaa">Counterfeit</div>
<a href="https://picasaweb.google.com/lh/photo/Xheg_AXjTy7xxi1BRTokjdkcRWcsA1_Y1J-NVPnKkng?feat=embedwebsite"><img class="hilite" src="https://lh3.googleusercontent.com/-oztCiSGIEXo/UDOvoTfWw7I/AAAAAAAAMgg/YN_voXBBW3I/s288/hifreq020.png" height="216" width="288" title="High frequency oscilloscope trace from counterfeit iPad charger" alt="High frequency oscilloscope trace from counterfeit iPad charger"></a>
</div>
<p>
The orange line shows the frequency spectrum of the output: lower is better, and higher is exponentially worse. The counterfeit spectrum is much higher in general, with a large spike at the switching frequency. This shows that the counterfeit charger's power is worse across the frequency spectrum.
<p>
You might wonder if the power quality actually matters. The biggest impact it has is on touchscreen performance. The interference from bad power supplies is known to cause the touchscreen to behave erratically.<a class="ref" href="#ref16">[16]</a> If your screen malfunctions when plugged into a charger, this is probably the cause.
<h2>Inside the real charger's transformer</h2>
There's more inside the transformer that you'd expect. This section does a full teardown of the transformer from the genuine charger.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/OWiEs9rpPn14emhMDF3u0tMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh6.googleusercontent.com/-87V1E2ElbsI/Uz5PZzjI8JI/AAAAAAAAWvs/tRyD6L5dGeE/h250/ipad-trans-1.png" height="250" width="206"
alt="A copper band surrounds the ferrite core in the flyback transformer from an iPad charger."
title="A copper band surrounds the ferrite core in the flyback transformer from an iPad charger."></a>
</div>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/W4e_YVNHR6AnrP7Kt4K2iNMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh6.googleusercontent.com/-5EU7w3wO3Jk/Uz5PZWQyDCI/AAAAAAAAWvg/LKe-wmy0cfA/h250/ipad-trans-2.png" height="250" width="375"
alt="Removing the ferrite core and insulation reveals the double-stranded primary winding."
title="Removing the ferrite core and insulation reveals the double-stranded primary winding.">
</a>
</div>
<p>
The first photo above shows that underneath the the first layer of yellow insulating tape, a layer of copper foil is attached to the transformer's ferrite core to ground it. Next, removing the ferrite core and more insulation reveals the double-stranded primary winding. The high-voltage input is fed into this winding.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/VveHXeM8U_3Ej0iv6sKIVNMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh5.googleusercontent.com/-GH_zQDe85k8/Uz5PZy4nTjI/AAAAAAAAWvo/4ijbgSO_EuI/h250/ipad-trans-3.png" height="250" width="279"
alt="After removing the triple-stranded bias winding and insulating tape, the secondary winding of the transformer is visible. Note the triple-insulated wires used for the secondary winding."
title="After removing the triple-stranded bias winding and insulating tape, the secondary winding of the transformer is visible. Note the triple-insulated wires used for the secondary winding."></a>
</div>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/kp7Vq4qw9-dYVQ0ILaYEidMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh4.googleusercontent.com/-Bqvjjur_W0o/Uz5PaqYDayI/AAAAAAAAWv4/Mm3p-dUEAAg/h250/ipad-trans-4.png" height="250" width="321"
alt="The next layer of insulation contains copper foil."
title="The next layer of insulation contains copper foil.">
</a>
</div>
<p>
Underneath the primary winding and more insulating tape is the triple-stranded bias winding, which provides feedback and power to the control IC. (In the photo, this winding has been removed and is surrounding the transformer.)
After removing more insulating tape, the secondary winding of the transformer is visible. As discussed in the safety section, the secondary winding has triple-insulated wires and extra insulation where the wires leave the transformer.
The next layer of insulation (right) contains copper foil. This helps reduce interference.
<p>
<div class="ipad-img">
<div class="ipad-label">iPad</div>
<a href="https://picasaweb.google.com/lh/photo/aECMcSJDqX8YECULF2r3zNMTjNZETYmyPJy0liipFm0"><img class="hilite" src="https://lh6.googleusercontent.com/-xoZDt141LqY/Uz5PbCVzJgI/AAAAAAAAWv8/nAt2aRT4GvQ/h250/ipad-trans-5.png" height="250" width="284"
alt="The innermost layer of the iPad charger flyback transformer is the primary winding."
title="The innermost layer of the iPad charger flyback transformer is the primary winding."></a>
</div>
<p>
Finally, the innermost layer of the iPad charger flyback transformer is the second half of the primary winding (above). Splitting the primary winding into two layers is more expensive, but results in a better transformer due to better coupling of the magnetic fields.
<p>
In comparison, the transformer of the counterfeit charger is much lower quality.
(I haven't included the pictures for reasons of space; click through to see them.)
It simply has the bias winding (<a href="https://picasaweb.google.com/106338564628446721517/Ipad?authkey=Gv1sRgCMid55eH0M__1wE#5998312443408346626">pic</a>), secondary winding (<a href="https://picasaweb.google.com/106338564628446721517/Ipad?authkey=Gv1sRgCMid55eH0M__1wE#5998312467746525682">pic</a>), and primary winding (<a href="https://picasaweb.google.com/106338564628446721517/Ipad?authkey=Gv1sRgCMid55eH0M__1wE#5998312476753762290">pic</a>)
, separated by insulating tape.
Unlike the genuine transformer, the counterfeit saves cost by omitting the copper foil layers. The counterfeit also doesn't use the more expensive split, multi-stranded windings that the genuine charger uses.
As discussed earlier, the secondary winding is plain copper wire, not triple-insulated wire, which is a significant safety flaw.
<h2>How does the iPad charger compare to the iPhone charger?</h2>
The iPad charger is considerably larger than the iPhone charger and provides twice the power. In my detailed <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html#ref12">iPhone charger teardown</a> I looked at the internals of the iPhone charger.  The iPhone charger (below) uses two circuit boards that combine to form a one inch cube, which is impressive engineering. The iPhone and iPad chargers are both flyback switching power supplies, but the feedback mechanisms are very different.<a class="ref" href="#ref17">[17]</a>
Overall, I like the iPhone charger more than the iPad charger from a design standpoint, mainly because of the harder engineering challenge of cramming everything into a much smaller space.
<p>
<div class="ipad-img">
<div class="ipad-label">iPhone</div>
<a href="https://picasaweb.google.com/lh/photo/HyHgq6XVpWDiM55su0SDweEaoRUAVJWIvGebgDMsook?feat=embedwebsite"><img class="hilite" src="https://lh4.googleusercontent.com/-NY-4wTwsx64/T6V-B-8vszI/AAAAAAAAKKE/mJFOTHAfhwI/w300/charger-apple-ycap.png" width="300" height="259"

 title="Inside the iPhone charger: input inductor (green), Y capacitor (blue), flyback transformer (yellow), USB connector (silver). The primary circuit board is on top and the secondary board on the bottom."

 alt="Inside the iPhone charger: input inductor (green), Y capacitor (blue), flyback transformer (yellow), USB connector (silver). The primary circuit board is on top and the secondary board on the bottom."

 /></a>
</div>
<h2>Schematics</h2>
In my <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html">iPhone charger teardown</a>, I drew up a <a href="http://arcfn.com/files/charger-schematic.pdf">schematic</a> of the charger, but for the iPad chargers I didn't need to do this.  The genuine iPad charger is almost identical<a class="ref" href="#ref18">[18]</a> to the
<a href="http://iwatt.com/wp-content/uploads/2013/07/EBC10007_Reference_Design.pdf">reference design schematic</a> provided by iWatt. The counterfeit charger is almost identical to the schematic in the
<a href="http://www.superchip.cn/Private/ProductFiles/DB02A%EF%BC%88500mA%E5%85%85%E7%94%B5%E5%99%A8%E9%A9%B1%E5%8A%A8IC%EF%BC%89.pdf">DB02A controller datasheet</a>. You can see from the schematics that the genuine charger has a much more complex circuit than the counterfeit. (Click the thumbnails above to get to the datasheets.)
<p>
<div class="ipad-img">
<div class="ipad-label" style="top:-10px">iPad</div>
<a href="http://iwatt.com/wp-content/uploads/2013/07/EBC10007_Reference_Design.pdf"><img class="hilite" src="https://lh4.googleusercontent.com/-NoSguWBpjuQ/U2XCDtIYptI/AAAAAAAAXqA/DmvX19nE-K4/h150/reference-design-thumbnail.png" height="150" width="273"
alt="Thumbnail: Click for schematic of iPad charger based on iWatt 1691 controller."
title="Thumbnail: Click for schematic of iPad charger based on iWatt 1691 controller.">
</a>
</div>
<div class="ipad-img">
<div class="ipad-label" style="top:-10px">Counterfeit</div>
<a href="http://www.superchip.cn/Private/ProductFiles/DB02A%EF%BC%88500mA%E5%85%85%E7%94%B5%E5%99%A8%E9%A9%B1%E5%8A%A8IC%EF%BC%89.pdf"><img class="hilite" src="https://lh5.googleusercontent.com/-qSTnhw2XsqQ/U2XCDoX5Q1I/AAAAAAAAXp8/oWq-LdYY9eA/h150/counterfeit-schematic-thumbnail.png" height="150" width="305"
alt="Thumbnail: Click for schematic of counterfeit iPad charger based on DB02A controller."
title="Thumbnail: Click for schematic of counterfeit iPad charger based on DB02A controller.">
</a>
</div>
<h2>Is the Apple charger worth the price?</h2>
Apple's charger is expensive compared to other chargers, but is a high quality product.
You should definitely stay away from the cheap counterfeit chargers, as they are low quality and dangerous. Non-Apple name brand chargers are generally good quality according to my <a href="http://www.righto.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html">tests</a>, with some better than Apple.
If you want to get an Apple charger without the high price, the best way I've found is to buy a <i>used</i> one on eBay from a US source. I've bought several for testing, and they have always been genuine.
<p>
I <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html#ref6">wrote earlier</a> about Apple's huge profit margins on chargers. Apple has since dropped their charger prices from $29 to $19, which is more reasonable, but looking at the price of similar chargers from other manufacturers and the <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html#ref14">cost of components</a>, I think Apple has a huge profit margin even at $19.<a class="ref" href="#ref19">[19]</a>
<p>
In any case, the iPad charger is an impressive piece of engineering with a lot of interesting circuitry inside. The counterfeit charger is also impressive in its own way - it's amazing that a charger can be manufactured and sold for such a low price (if you don't care about safety and quality). Overall, you mostly get what you pay for; even if you can't tell from the outside, there are big differences inside the case.
<h2>Notes and references</h2>
<a name="ref1"></a>[1]
<a href="http://www.foxlink.com/">Foxlink</a> (Taiwan), <a href="http://en.wikipedia.org/wiki/Foxconn">Foxconn</a> (Taiwan), and <a href="http://en.wikipedia.org/wiki/Flextronics">Flextronics</a> (Singapore) are all manufacturers for Apple with confusingly similar names.
Foxconn is the company with controversy over employee treatment; this charger is made by Foxlink, a different company.
Interestingly, the chairmen of both companies are brothers and the companies do a lot of business with each other. The companies state that they are entirely independent, though (<a href="http://www.foxconn.com/06523.html">statement</a>, <a href="http://www.foxlink.com/_en/4_ir/12_consolidate/2011_consolidated.pdf">Foxlink annual report</a>).
Foxconn and Flextronics are the world's #1 and #3 largest electronics manufacturing companies according to the <a href="http://mfgmkt.com/mmi-top-50.html">MMI top 50 for 2013</a>, while Foxlink is smaller.
<p>
<a name="ref2"></a>[2]
The chargers uses a flyback design, where the transformer operates "backwards" from how you might expect. When a voltage pulse is sent into the transformer, the output diode blocks the output so there is no output - instead a magnetic field builds up in the transformer. The transformer core has a tiny <a href="http://electronicdesign.com/energy/mind-gap-and-improve-your-low-power-flyback-transformer-design">air gap</a> to help store this field. When the voltage input stops, the magnetic field collapses, transferring power to the output winding. Flyback power supplies are very common for low-wattage power supplies.
<p>
<a name="ref3"></a>[3]
You might wonder why the DC voltage inside the power supply is so much higher than the line voltage. The DC voltage is approximately sqrt(2) times the AC voltage, since the diode charges the capacitor to the peak of the AC signal. Thus, the input of 100 to 240 volts AC is converted to a DC voltage of 145 to 345 volts internally. This isn't enough to be officially <a href="http://en.wikipedia.org/wiki/High_voltage">high voltage</a> but I'll call it high voltage for convenience. According to standards, anything under 50 volts AC or 120 V dc is considered <a href="http://en.wikipedia.org/wiki/Extra-low_voltage">extra-low voltage</a> and is considered safe under normal conditions. But I'll refer to the 5V output as low voltage for convenience.
<p>
<a name="ref4"></a>[4]
The counterfeit charger uses a DB02A controller IC. This controller only has four pins and is in a TO-94 (SIP-4) package. (According to the official JEDEC standard, TO-94 is a <a href="http://www.semicon-data.de/js/geoms/TO-94.jpg">bolt-like package</a> for large SCRs. It's a puzzle why some companies use TO-94 to describe 4-pin inline packages.)
According to the <a href="http://www.superchip.cn/Private/ProductFiles/DB02A%EF%BC%88500mA%E5%85%85%E7%94%B5%E5%99%A8%E9%A9%B1%E5%8A%A8IC%EF%BC%89.pdf">datasheet</a> (Chinese),
the chip is for 500mA-1000mA chargers, which explains why the counterfeit charger only produces 5 watts, instead of the 10 watts an iPad charger is supposed to produce.
This controller is very inexpensive, <a href="http://detail.1688.com/offer/1119663690.html?spm=a261b.2187593.0.0">available for &#165; 0.35</a> (about 6 cents).
<p>
I couldn't find any US chips similar to this chip, even after a lot of searching; it appears to be a Chinese design with datasheets only in Chinese, manufactured by <a href="http://superchip.cn">"Fine Made" Shenzhen Fuman Electronics</a>.
Since the chip only has four pins, I expected it to be a trivial Ringing Choke Converter (RCC) circuit with just a couple transistors side the chip - but I cracked it open with Vise-Grips and it turns out to be a fairly complex chip.
I took a picture through a microscope of the IC die, which is about 1 mm across. One interesting feature is the many white pads around the outside of the die, which are used to blow fuses to trim various resistances in the chip. I wasn't expecting to see this level of quality and sophistication.
The die has the label "N7113 802" at the right; I don't know what this indicates. Three of the four wires connect in the lower left, and the fourth in the lower right.
<p>
<a href="https://picasaweb.google.com/lh/photo/q39d53EArjuzTdGhJrH79cFWekyiEK53GdPErvknGW0"><img class="hilite" src="https://lh3.googleusercontent.com/-FRH0UCd-GSk/U2nIK-4K0qI/AAAAAAAAXro/rYEL_1FUWl8/s400/db02a-die.png" height="400" width="291"
alt="Die photo of the DB02A SMPS controller chip."
title="Die photo of the DB02A SMPS controller chip.">
</a>
<p>
<div class="cite">
Die photo of the DB02A SMPS controller chip used in the counterfeit charger.
</div>
<p>
<p>
<a name="ref5"></a>[5]
When a diode or transistor switches, it creates a voltage spike, which can be controlled by a special snubber or clamp circuit.  For a lot of information on snubbers and clamps, see <a href="http://www.ee.bgu.ac.il/~pel/pdf-files/smnr13.pdf">Passive Lossless Snubbers for High Frequency PWM Conversion</a> and <a href="http://www.onsemi.com/pub_link/Collateral/SMPSRM-D.PDF">Switchmode Power Supply Reference Manual</a>.
<p>
<a name="ref6"></a>[6]
In the counterfeit charger, the switching transistor is a ALJ 13003 NPN power transistor (<a href="http://www.datasheet-pdf.com/datasheet-html/A/L/J/ALJ13003_ALJ.pdf.html">datasheet</a>), apparently made by <a href="http://www.szlongjing.com/">Shenzhen LongJing Microelectronics Co.</a> This transistor is a version of Motorola's MJE 13003 switchmode transistor which was introduced in 1976 (<i>MJE</i> indicates power device in a plastic package).
The bridge rectifier is a B6M (<a href="http://www.digikey.com/product-detail/en/B6M-E3%2F45/B6M-E3%2F45-ND/2152706">datasheet</a>). The output diode is a <a href="http://pdf.datasheetcatalog.com/datasheet/wte/SR220-TB.pdf">SR260</a> Schottky barrier rectifier.
<p>
<a name="ref7"></a>[7]
The iPad charger uses special Y-capacitors to bridge the high-voltage and low-voltage sides of the charger. This capacitor helps reduce EMI interference, and is specially designed to avoid any safety hazard. It does, however, pass a tiny amount of electricity - if you feel a tingle from your charger, these capacitors are probably the cause.
For more information on X and Y capacitors, see <a href="http://www.kemet.com/kemet/web/homepage/kechome.nsf/file/KEMET%20Kollege%20Presentations/$file/EvoxRifaRFIandSMD.pdf">Kemet's presentation</a> and <a href="http://www.eetasia.com/ARTICLES/2004NOV/B/2004NOV16_POW_TA.pdf?SOURCES=DOWNLOAD">Designing low leakage current power supplies</a>.
<p>
<a name="ref8"></a>[8]
The iPad has two spark gaps next to inductor L1 (the input AC common mode choke). I couldn't find a lot of information on this sort of spark gap, but one example of it is an <a href="http://www.infineon.com/dgdl/Datasheet_ICE3BR1765J_v2_3_19Nov2012.pdf?folderId=db3a304412b407950112b408e8c90004&fileId=db3a30431a5c32f2011a7a6a5b73688b">Infineon SMPS design</a>, where similar spark gaps are designed to discharge accumulated charge for a 3KV lightning surge test.
<p>
<a name="ref9"></a>[9]
The Apple charger includes a "latch release circuit". If there is a fault, the control IC will shut down the charger until power is removed. However, after unplugging a charger, the input capacitors may store power for many seconds. (You may have seen LEDs remain illuminated for several seconds after unplugging devices.) The latch release circuit ensures that the charger will reset properly even if you plug it back in quickly. It does this by providing a separate diode bridge for the charger's power - this circuit has a much smaller capacitor, so it will power off quickly.
(See the schematic for details.) This seems like over-engineering to me, adding extra circuitry for this rare case.
<p>
In normal use, by the way, the control IC is powered by the transformer's feedback winding. But if the control IC isn't running, the transformer won't work, leading to a chicken-and-egg situation. The solution is a startup power path where the control IC gets enough power from the AC input to start up, and then switches to the transformer.
<p>
<a name="ref10"></a>[10]
The genuine charger uses a complex control chip manufactured by iWatt, the <a href="http://iwatt.com/product/iw1691/">1691</a>.
This chip monitors the input line voltage, the current through the transformer, and the voltage feedback from the transformer. It controls the switching frequency and length of time the power is switched on, with different behavior under no load, low load, and high load, as well as constant monitoring for faults.
A detailed presentation on the iW1691 is <a href="http://iwatt.com/wp-content/uploads/2013/04/iW1691_UltraSmSize_HighEfficiency_wDigPwrCtrl.pdf">here</a>.
This chip sells for about 30 cents, but I expect Apple gets a better price.
<p>
<a name="ref11"></a>[11]
The real charger has a metal ground pin that connects to the power plug, while the counterfeit has a plastic pin. This is one difference between the chargers that is visible externally if you slide the power plug off the charger. Ironically, the US plug doesn't use the ground connection, so this is one safety issue that doesn't make any difference in practice.
<p>
<a name="ref12"></a>[12]
Apple uses a proprietary technique for the charger to indicate to the device what kind of charger it is.
Different types of Apple chargers use resistances to put different voltages on the USB D+ and D- pins. For details on USB charging protocols, see my <a href="http://www.arcfn.com/2012/03/inside-cheap-phone-charger-and-why-you.html#ref10">earlier references</a>.
<p>
<a name="ref13"></a>[13]
While it would be nice to find superconductors inside the charger, unfortunately the zero-ohm resistor is a bit more than 0 ohms. While this resistor may seem pointless, it allows the manufacturers to substitute a resistor later if different transistors require it.
<p>
<a name="ref14"></a>[14]
The outside of the charger has the slightly mysterious text:
"For use with information technology equipment". This indicates that the charger is covered by the safety standard <a href="http://ulstandardsinfonet.ul.com/scopes/scopes.asp?fn=60950-1.html">UL 60950-1</a>, which specifies the various isolation distances required. For a brief overview of isolation distances, see <a href="http://www.i-spec.com/Basics/circuit_separation.html">i-Spec Circuit Separation</a> and some of my <a href="http://www.arcfn.com/2012/03/inside-cheap-phone-charger-and-why-you.html#ref6">earlier references</a>.
<p>
<a name="ref15"></a>[15]
Only a few special components can safely bridge the gap between the high voltage side of the charger and the low voltage side. The most obvious is the transformer.
Y-capacitors can also bridge the primary and secondary side because they are designed not to
pass dangerous currents, and not to short out if they fail.  Optoisolators use a light signal to provide feedback between the circuits in an iPhone charger, but are not used in the iPad charger.
<p>
<a name="ref16"></a>[16]
For an explanation of why the noisy output from cheap chargers messes up touchscreens, see
<a href="http://www.cypress.com/touch/Noise_Wars_Projected_Capacitance_Strikes_Back.pdf">Noise Wars: Projected Capacitance Strikes Back</a>. The article discusses how capacitive touchscreen ICs need to sense pico-Coulombs of charge, which is very difficult when AC noise is present. The article blames touchscreen problems on aftermarket low cost chargers.
<p>
<a name="ref17"></a>[17]
The biggest difference between the iPhone charger and the iPad charger is the feedback used to regulate the voltage. The iPhone charger measures the output voltage with a TL431 chip and sends a feedback signal to the control IC via an optoisolator. The iPad charger avoids these components by using primary-side regulation. Instead of measuring the actual output voltage, the iPad control IC looks at the voltage in the feedback winding, which should approximately match the output voltage.
<p>
<a name="ref18"></a>[18]
I noticed only a few significant differences between the iPad charger and iWatt's published <a href="http://iwatt.com/wp-content/uploads/2013/07/EBC10007_Reference_Design.pdf">1691 charger reference design</a>. This probably means iWatt did most of the design work for Apple.
<p>
Comparing the actual charger with the reference design shows a few filtering improvements.
The charger has RC snubbers the input bridge rectifier (a rare feature also in the <a href="http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html#ref6">iPhone charger</a>).
The charger has an extra diode on the secondary for filtering, as well as a (zener?) diode in the switching transistor drive circuit.
The iPad charger uses two Y-capacitors instead of one, and a R/C filter attached to the Y-capacitor on the secondary side. The charger connects line ground to secondary ground through a resistor.
The reference design doesn't show the USB data resistors<a class="ref" href="#ref12">[12]</a>.
<p>
<a name="ref19"></a>[19]
Some people think that I'm ignoring Apple's cost of designing chargers when figuring their large profit margin.
First, if you spend $2 million on design and manufacture 200 million chargers, then design adds only one cent to the cost per charger.
Second, iWatt's designers deserve credit for the complex control chip and the reference design, which is most of the design work.
<p>
<a name="ref20"></a>[20]
For those interested in the components, the iPad charger's primary diodes (F6w) are 1.5A 60V Schottky Barrier Diodes (<a href="http://www.sanken-ele.co.jp/en/prod/semicon/pdf/sjpw-f6e.pdf">datasheet</a>).

The "T3" diodes are fast switching diodes (<a href="http://www.diodes.com/datasheets/ds30119.pdf">datasheet</a>).

The switching transistor is an Infineon SPA04N60C Cool MOS&reg; 650V power transistor (<a href="http://www.datasheets360.com/pdf/-1244314659508659336?query=SPA04N60C">datasheet</a>).

The bridge rectifier is a bridge: MB10S CD 0.5A bridge rectifier with high surge capacity (<a href="https://www.fairchildsemi.com/ds/MB/MB10S.pdf">datasheet</a>).

The component in the protection circuit that looks like a transistor is a BAV70 dual high-speed switching diode (<a href="http://www.nxp.com/documents/data_sheet/BAV70_SER.pdf">datasheet</a>).

The output diode is a SBR10U45SP5 10A super barrier rectifier (<a href="http://www.diodes.com/datasheets/sbr/SBR10U45SP5.pdf">datasheet</a>).
The Y capacitors are 220pF 250V.
The input capacitors are <a href="http://www.manyue.com/brands.html">Samxon</a> 10&micro;Fand 4.7&micro;F 400v electrolytics.
The output capacitors are a <a href="http://www.koshin.com.hk/en/catalog.asp?titleName=KLH">Koshin KLH</a> 820&micro;F 6.3V aluminum electrolytic, and a 820 &micro;F 6.3V <a href="ftp://helpedia.com/pub/temp/datasheets/capacitors/_Datasheets%20Set%204/_3/Samxon/Samxon.X-CON%20%5Bpolymer%20thru-hole%5D%20ULR%20Series.pdf">X-CON ULR</a> aluminum polymer capacitor (which is more expensive than a regular electrolytic, but filters better because of its lower <a href="http://en.wikipedia.org/wiki/Equivalent_series_resistance">ESR</a>).
<p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
</span>
<span class='reaction-buttons'>
</span>
<span class='star-ratings'>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='http://www.blogger.com/comment.g?blogID=6264947694886887540&amp;postID=1497775255051261544' onclick=''>
47 comments:
    </a>
</span>
<span class='post-backlinks post-comment-link'>
<a class='comment-link' href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html#links'>Links to this post</a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='http://www.blogger.com/email-post.g?blogID=6264947694886887540&postID=1497775255051261544' title='Email Post'>
<img alt='' class='icon-action' height='13' src='http://img1.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-1138732533'>
<a href='http://www.blogger.com/post-edit.g?blogID=6264947694886887540&postID=1497775255051261544&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='http://img2.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1497775255051261544&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1497775255051261544&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1497775255051261544&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1497775255051261544&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1497775255051261544&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block dummy-container'><g:plusone source='blogger:blog:plusone' href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://www.righto.com/search/label/apple' rel='tag'>apple</a>,
<a href='http://www.righto.com/search/label/electronics' rel='tag'>electronics</a>,
<a href='http://www.righto.com/search/label/oscilloscope' rel='tag'>oscilloscope</a>,
<a href='http://www.righto.com/search/label/power%20supply' rel='tag'>power supply</a>,
<a href='http://www.righto.com/search/label/teardown' rel='tag'>teardown</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>
<!-- google_ad_section_end -->
<div class='inline-ad'>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0159785530845184";
google_ad_host = "ca-host-pub-1556223355139109";
google_ad_host_channel = "L0007";
/* arcfn_main_Blog1_300x250_as */
google_ad_slot = "6408308186";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<!-- google_ad_section_start -->

            </div></div>
          

          <div class="date-outer">
        

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://lh4.googleusercontent.com/-oERQdl6lNgc/UxPnrSKrGVI/AAAAAAAAWqc/JmG4HVfgI8U/s300/fishpool.jpg' itemprop='image_url'/>
<meta content='6264947694886887540' itemprop='blogId'/>
<meta content='1044032893343964609' itemprop='postId'/>
<a name='1044032893343964609'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='http://www.righto.com/2014/03/the-programming-error-that-cost-mt-gox.html'>The programming error that cost Mt Gox 2609 bitcoins</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1044032893343964609' itemprop='description articleBody'>
In October 2011, Mt Gox lost over 2609 bitcoins by accidentally creating transactions that can never be redeemed.
(At the time, 2609 bitcoins were worth about $8000, but they would be worth almost $1.5 million dollars now.)

The problem was <a href="https://bitcointalk.org/index.php?topic=50206.0">discussed on the Bitcoin forum</a>, but I think it's worth taking a closer look at it in light of Mt Gox's <a href="http://www.npr.org/blogs/thetwo-way/2014/02/28/283863219/mtgox-files-for-bankruptcy-nearly-500m-of-bitcoins-lost">recent massive bitcoin loss and bankruptcy</a>. This problem reveals how easy it is to lose bitcoins through software errors. It also reveals that Mt Gox has made careless and expensive programming errors before.

<h2>The problem</h2>
When you send bitcoins to an address, what happens inside the Bitcoin transaction is more complicated than you would expect.
The transaction contains a tiny computer program in the <a href="https://en.bitcoin.it/wiki/Script">Bitcoin Script</a> language, and this program is executed to determine if the bitcoins can be spent. Normally the program requires a public key and signature in order to spend the bitcoins. The program checks that the public key matches the address you sent the bitcoins to, and the signature is valid, proving the spender of the bitcoins has the private key. If everything matches, the bitcoins can be spent.
<p>
You might wonder why Bitcoin uses such a complex system to validate transactions. The idea is that by providing a programming language, Bitcoin allows many different types of transactions, such as escrow transactions or more complex <a href="https://en.bitcoin.it/wiki/Contracts">contracts</a>.
<p>
Going into a bit more detail, a typical <i>scriptPubKey</i> program looks like:
<pre style="border:none">
OP_DUP
OP_HASH160
f2e63314c350094550c703fcdcd4850ad37d8310
OP_EQUALVERIFY
OP_CHECKSIG
</pre>
<p>
This program is part of a <a href="http://blockexplorer.com/tx/81f591582b436c5b129f347fe7e681afd6811417973c4a4f83b18e92a9d130fd">transaction</a> that sent bitcoins to the address <code>1P9LHy6K2c9cwbfSfdaaoYVAprqUYtcFnB</code> (which in hex is the <code>f2e633...</code> value above). In order for that address to redeem the bitcoins, they must provide the public key for the address <code>1P9L...</code> and provide the signature for the spending transaction (which proves they have the private key).
Walking through the execution of the program, it first duplicates the provided public key, computes the 160-bit hash of it, and verifies that it is equal to the provided public key address. Then it checks the signature for validity. If all goes well, the bitcoins can be spent. If there is a problem, the transaction is rejected.
<p>
In Mt Gox's <a href="http://blockexplorer.com/tx/81f591582b436c5b129f347fe7e681afd6811417973c4a4f83b18e92a9d130fd">bad transactions</a>, they made a small but costly error. The script is:
<pre style="border:none">
OP_DUP
OP_HASH160
0
OP_EQUALVERIFY
OP_CHECKSIG
</pre>
Note that in place of the destination address hash, this transaction has the byte 0, representing OP_0, which pushes an empty array of bytes. Since it's impossible for the 160-bit hash to match an empty array, it's impossible for this script to complete successfully, and the bitcoins can never be spent. (For more information on how these scripts work, see my article <a href="http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html">Bitcoins the hard way</a>).
<h2>Why does Bitcoin permit broken transactions?</h2>
You might wonder why Bitcoin permits transactions that can never be spent. Unfortunately, it would be very difficult to determine if a script can be satisfied or not.
Bitcoin is designed to give people a lot of flexibility with the Script language, even though it's easy to shoot yourself in the foot.
In addition, a complex algorithm to reject transactions would be very dangerous - if clients and miners disagree on the validity of a transaction, a blockchain fork will result, causing <a href="http://bitcoinmagazine.com/3668/bitcoin-network-shaken-by-blockchain-fork/">chaos</a>.
<p>
(The computer scientists are probably yelling "halting problem" at this point. However, that doesn't apply because the Bitcoin Script language doesn't have loops so it's guaranteed to halt. A non-terminating script would be a disaster since miners and clients would lock up, so the language prohibits looping.)
<p>
In addition, it's common to lose bitcoins by using an address when you don't have the private key, and there's no way software could detect that. Strangely, people often do this on purpose. Many transactions deliberately send tiny amounts of bitcoins to bad addresses to <a href=http://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html">hide text and images</a> in the blockchain. Other people have <a href="https://blockchain.info/address/1CounterpartyXXXXXXXXXXXXXXXUWLpVr">deliberately lost over a million dollars</a> in bitcoins in a <a href="https://counterparty.co/">Counterpary</a> <a href="https://en.bitcoin.it/wiki/Proof_of_burn">proof-of-burn</a>.
<p>
<a href="https://picasaweb.google.com/lh/photo/JBetMD405Obx3wScYiNwIKNTQ8Yf_fOdBXli6Rl3Pxs?feat=directlink"><img class="hilite" src="https://lh4.googleusercontent.com/-oERQdl6lNgc/UxPnrSKrGVI/AAAAAAAAWqc/JmG4HVfgI8U/s300/fishpool.jpg"></a>
<div class="cite" style="color:#222">
 Gold coins from the <a href="http://en.wikipedia.org/wiki/Fishpool_Hoard">Fishpool Hoard</a>. Unlike lost bitcoins, lost gold coins can sometimes be recovered.
</div>
<h2>Another interesting script bug</h2>
While analyzing coinbase transactions, I came across another interesting bug that lost bitcoins. Some <a href="https://blockexplorer.com/tx/d84b37dd3f1073385ef729869e90fcb5d7e86feb0bc11614cace82637778037e">transactions</a> have the meaningless and unredeemable script:
<pre style="border:none">
OP_IFDUP
OP_IF
OP_2SWAP
OP_VERIFY
OP_2OVER
OP_DEPTH
</pre>
<p>
That script turns out to be the ASCII text <code>script</code>. Instead of putting the redemption script into the transaction, the P2Pool miners accidentally put in the literal word "script". The associated bitcoins are lost forever due to this error.
<h2>Conclusion</h2>
Losing bitcoins due to programming errors is very easy. Mt Gox has lost thousands of bitcoins in the past this way, as have others. I don't know what happened to Mt Gox recently (although I know it <a href="http://www.righto.com/2014/02/the-bitcoin-malleability-attack-hour-by.html">wasn't OP_PUSHDATA2 malleability</a>), but based on history it is worth keeping programming errors in mind.
<p>
If you want some scary reading describing other major Bitcoin losses, take a look at <a href="https://bitcointalk.org/index.php?topic=83794.0">List of Major Bitcoin Heists, Thefts, Hacks, Scams, and Losses</a>.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
</span>
<span class='reaction-buttons'>
</span>
<span class='star-ratings'>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='http://www.blogger.com/comment.g?blogID=6264947694886887540&amp;postID=1044032893343964609' onclick=''>
3 comments:
    </a>
</span>
<span class='post-backlinks post-comment-link'>
<a class='comment-link' href='http://www.righto.com/2014/03/the-programming-error-that-cost-mt-gox.html#links'>Links to this post</a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='http://www.blogger.com/email-post.g?blogID=6264947694886887540&postID=1044032893343964609' title='Email Post'>
<img alt='' class='icon-action' height='13' src='http://img1.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-1138732533'>
<a href='http://www.blogger.com/post-edit.g?blogID=6264947694886887540&postID=1044032893343964609&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='http://img2.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1044032893343964609&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1044032893343964609&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1044032893343964609&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1044032893343964609&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=1044032893343964609&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block dummy-container'><g:plusone source='blogger:blog:plusone' href='http://www.righto.com/2014/03/the-programming-error-that-cost-mt-gox.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://www.righto.com/search/label/bitcoin' rel='tag'>bitcoin</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

            </div></div>
          

          <div class="date-outer">
        

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='http://farm4.staticflickr.com/3780/9305154893_e1b7925728_n.jpg' itemprop='image_url'/>
<meta content='6264947694886887540' itemprop='blogId'/>
<meta content='870235476863918854' itemprop='postId'/>
<a name='870235476863918854'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html'>Bitcoin mining the hard way: the algorithms, protocols, and bytes</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-870235476863918854' itemprop='description articleBody'>
<style>
.gist table.lines {
 font-size: 12px;
}
.smallscript .gist-data {
 max-height: 150px;
}
.gist-data {
 max-height: 350px;
}
.gist-meta {
 font-size: 80% !important;
}

.mining {
  border-collapse: collapse;
}

.mining td {
  font-size: 74%;
  padding: 3px;
  border: 1px solid #ccc;
}
.mining td {
  text-align: right;
  font-family: "Courier New", Courier, monospace;
}
.mining.left td {
  text-align: left;
}
.cc {
  font-size: 80%;
}
</style>

This article explains Bitcoin mining in details, right down to the hex data and network traffic.
If you've ever wondered what really happens in Bitcoin mining, you've come to the right place.
My previous article, <a href="http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html">Bitcoins the hard way</a> described how I manually created a Bitcoin transaction and sent it into the system. In this article, I show what happens next: how a transaction gets mined into a block.
<h2>The purpose of mining</h2>
Bitcoin mining is often thought of as the way to create new bitcoins. But that's really just a secondary purpose.
The primary importance of mining is to ensure that all participants have a consistent view of the Bitcoin data.
Because Bitcoin is a distributed peer-to-peer system, there is no central database that keeps track of who owns bitcoins. Instead, the log of all transactions is distributed across the network.
<p>
The main problem with a distributed transaction log is how to avoid inconsistencies that could allow someone to spend the same bitcoins twice.
The solution in Bitcoin is to <i>mine</i> the outstanding transactions into a block of transactions approximately every 10 minutes, which makes them official. Conflicting or invalid transactions aren't allowed into a block, so the double spend problem is avoided.
<p>
Although mining transactions into blocks avoid double-spending, it raises new problems: What stops people from randomly mining blocks? How do you decide who gets to mine a block? How does the network agree on which blocks are valid?
Solving those problems is the key innovation of Bitcoin:
mining is made very, very difficult, a technique called <a href="https://en.bitcoin.it/wiki/Proof_of_work">proof-of-work</a>.
It takes an insanely huge amount of computational effort to mine a block, but it is easy for peers on the network to verify that a block has been successfully mined.<a class="ref" href="#ref1">[1]</a>
<p>
Each mined block references the previous block, forming an unbroken chain back to the first Bitcoin block. This blockchain ensures that everyone agrees on the transaction record. It also ensures that nobody can tamper with blocks in the chain since re-mining all the following blocks would be computationally infeasible.<a class="ref" href="#ref2">[2]</a>
As long as nobody has more than half the computational resources, mining remains competitive and nobody can control the blockchain.
<p>
As a side-effect, mining adds new bitcoins to the system. For each block mined, miners currently get 25 new bitcoins (currently worth about $15,000), which encourages miners to do the hard work of mining blocks. With the possibility of receiving $15,000 every 10 minutes, there is a lot of money in mining.
<!--
<p>
<a href="http://www.flickr.com/photos/blackpawn/12373819423/">
 <img src=https://lh4.googleusercontent.com/-opz1-9RgIls/UwBUD3Yc6CI/AAAAAAAAWgs/qmfpt69l36Q/s800/mining.jpg"
 alt="Bitcoin mining setup By Jim Scott (blackpawn)"
 title="Bitcoin mining setup By Jim Scott (blackpawn)"></a>
<div class="cite">
 Hardware to mine bitcoins at 32 billion hashes per second (32 GH/s)
 <br>Photo by Jim Scott (blackpawn)
 <a class="cc" href="http://creativecommons.org/licenses/by-nc-sa/2.0/deed.en">(CC BY-NC-SA 2.0)</a>
</div>
-->
<h2>How mining works</h2>
Mining requires a task that is very difficult to perform, but easy to verify.
Bitcoin mining uses cryptography, with a hash function called <a href="https://en.bitcoin.it/wiki/Protocol_specification#Hashes">double SHA-256</a>. A hash takes a chunk of data as input and shrinks it down into a smaller hash value (in this case 256 bits). With a cryptographic hash, there's no way to get a hash value you want without trying a whole lot of inputs. But once you find an input that gives the value you want, it's easy for anyone to verify the hash. Thus, cryptographic hashing becomes a good way to implement the Bitcoin "proof-of-work".
<p>
In more detail, to mine a block, you first collect the new transactions into a block. Then you hash the block to form a 256-bit block hash value. If the hash starts with enough zeros<a class="ref" href="#ref3">[3]</a>, the block has been successfully mined and is sent into the Bitcoin network and the hash becomes the identifier for the block.
Most of the time the hash isn't successful, so you modify the block slightly and try again, over and over billions of times. About every 10 minutes someone will successfully mine a block, and the process starts over.
<p>
The diagram below shows the structure of a specific block, and how it is hashed. The yellow part is the block header, and it is followed by the transactions that go into the block. The first transaction is the special <i>coinbase</i> transaction that grants the mining reward to the miner. The remaining transactions are standard Bitcoin transactions moving bitcoins around.
If the hash of the header starts with enough zeros<a class="ref" href="#ref3">[3]</a>, the block is successfully mined. For the block below, the hash is successful: <code><a href="https://blockchain.info/block/0000000000000000e067a478024addfecdc93628978aa52d91fabd4292982a50">0000000000000000e067a478024addfecdc93628978aa52d91fabd4292982a50</a></code> and the block became block
<a href="https://blockchain.info/block-height/286819">#286819</a> in the blockchain.
<p>
<a href="https://picasaweb.google.com/lh/photo/3V5HFm-d02drHoFB3Vqs0qNTQ8Yf_fOdBXli6Rl3Pxs"><img class="hilite" src="https://lh5.googleusercontent.com/-ZlySzt0yUA4/Uwgj0uEaIxI/AAAAAAAAWkM/xDazaTmKQgA/s500/block-diagram-ghash.png" width="500"
alt="Structure of a Bitcoin block"
title="Structure of a Bitcoin block">
</a>
<p>
<div class="cite">
Structure of a Bitcoin block
</div>
<p>
The block header contains a handful of fields that describe the block.
The first field in the block is the protocol version. It is followed by the hash of the previous block in the blockchain, which ensures all the blocks form an unbroken sequence in the blockchain. (Inconveniently, the hash is reversed in the header.)
The next field is the <i>Merkle root</i>,<a class="ref" href="#ref4">[4]</a> a special hash of all the transactions in the block. This is also a key part of Bitcoin security, since it ensures that transactions cannot be changed once they are part of a block.<a class="ref" href="#ref5">[5]</a>
Next is a (moderately accurate) timestamp of the block, followed by the mining difficulty value <i>bits</i>.<a class="ref" href="#ref3">[3]</a>
Finally, the <i>nonce</i> is an arbitrary value that is incremented on each hash attempt to provide a new hash value. The tricky part of mining is finding a nonce that works.
<p>
<a href="http://www.flickr.com/photos/gastev/9305154893/" title="Untitled by Gastev, on Flickr"><img src="http://farm4.staticflickr.com/3780/9305154893_e1b7925728_n.jpg" width="320" height="240" alt="Untitled"></a>
<div class="cite">
ASIC Bitcoin Miner
<br>
Photo by Mirko Tobias Schaefer, <a class="cc" href="http://creativecommons.org/licenses/by/2.0/deed.en">(CC BY 2.0)</a>
</div>
<h2>A short program to mine a block</h2>
I wrote a Python program that mines the above block. The program itself is pretty simple - the hardest part of the code is computing the difficulty target from <i>bits</i>.<a class="ref" href="#ref3">[3]</a> Otherwise it's just a loop over different nonce values. Each iteration puts the data into a structure, hashes it, and tests the result.
<p>
<div class="smallscript">
<script src="https://gist.github.com/shirriff/cd5c66da6ba21a96bb26.js"></script>
</div>
<p>
The following table shows the hash obtained for selected nonce values. The key point is that each nonce generates a basically-random hash value. Every so often a "lucky" nonce will generate a hash starting with some zeroes. To get a lot of zeroes, you need to try an exponentially large number of nonces. For this block, the "winning" nonce is 856192328.
<p>
<table class="mining">
<tr><th>nonce</th><th>hash</th></tr>
<tr><td>0</td><td>5c56c2883435b38aeba0e69fb2e0e3db3b22448d3e17b903d774dd5650796f76</td></tr>
<tr><td>1</td><td>28902a23a194dee94141d1b70102accd85fc2c1ead0901ba0e41ade90d38a08e</td></tr>
<tr><td>2</td><td>729577af82250aaf9e44f70a72814cf56c16d430a878bf52fdaceeb7b4bd37f4</td></tr>
<tr><td>3</td><td>8491452381016cf80562ff489e492e00331de3553178c73c5169574000f1ed1c</td></tr>
<tr><td>39</td><td>03fd5ff1048668cd3cde4f3fb5bde1ff306d26a4630f420c78df1e504e24f3c7</td></tr>
<tr><td>990</td><td>0001e3a4583f4c6d81251e8d9901dbe0df74d7144300d7c03cab15eca04bd4bb</td></tr>
<tr><td>52117</td><td>0000642411733cd63264d3bedc046a5364ff3c77d2b37ca298ad8f1b5a9f05ba</td></tr>
<tr><td>1813152</td><td>00000c94a85b5c06c9b06ace1ba7c7f759e795715f399c9c1b1b7f5d387a319f</td></tr>
<tr><td>19745650</td><td>000000cdccf49f13f5c3f14a2c12a56ae60e900c5e65bfe1cc24f038f0668a6c</td></tr>
<tr><td>243989801</td><td>0000000ce99e2a00633ca958a16e17f30085a54f04667a5492db49bcae15d190</td></tr>
<tr><td>856192328</td><td>0000000000000000e067a478024addfecdc93628978aa52d91fabd4292982a50</td></tr>
</table>
<p>
I should point out that I cheated by starting with a block that could be successfully mined.
Most of the attempts to mine a block will fail entirely - none of the nonce values will succeed. In that case, you need to modify the block slightly and try again. The timestamp can be adjusted (which is why the timestamp in mined blocks is often wrong). New transactions can be added to the block, changing the Merkle hash. The coinbase transaction can be modified - this turns out to be very important for mining pools. Any of these changes will result in totally different hashes, so the nonce values can be tried again.
<p>
My Python program does about 42,000 hashes per second, which is a million times slower than the hardware used by real miners. My program would take about 11 million years on average to mine a block from scratch.
<h2>Mining is very hard</h2>
The difficulty of mining a block is astounding. At the <a href="https://blockchain.info/stats">current difficulty</a>, the chance of a hash succeeding is a bit less than one in 10<sup>19</sup>.
Finding a successful hash is harder than finding a particular grain of sand from all the <a href="http://www.npr.org/blogs/krulwich/2012/09/17/161096233/which-is-greater-the-number-of-sand-grains-on-earth-or-stars-in-the-sky">grains of sand on Earth</a>.

To find a hash every ten minutes, the Bitcoin hash rate needs to be insanely large.
Currently, the <a href="https://blockchain.info/charts/hash-rate">miners on the Bitcoin network</a> are doing about 25 million gigahashes per second. That is, every second about 25,000,000,000,000,000 blocks gets hashed. I estimate (very roughly) that the total hardware used for Bitcoin mining cost tens of millions of dollars and uses as much power as the country of Cambodia.<a class="ref" href="#ref6">[6]</a>
<p>
Note that finding a successful hash is an entirely arbitrary task that doesn't accomplish anything useful in itself. The only purpose of finding a small hash is to make mining difficult, which is fundamental to Bitcoin security. It seems to me that the effort put into Bitcoin mining has gone off the rails <a href="https://blockchain.info/charts/hash-rate?timespan=2year&showDataPoints=false&daysAverageString=1&show_header=true&scale=0&address=">recently</a>.
<p>
Mining is funded mostly by the 25 bitcoin reward per block, and slightly by the transaction fees (about 0.1 bitcoin per block). Since the mining reward currently works out to about $15,000 per block, that pays for a lot of hardware. Per transaction, miners are getting about $34 in mining reward and $0.10 in fees (<a href="https://blockchain.info/stats">stats</a>).
<p>
<a href="http://www.openmobilefree.net/?p=1308">
 <img src="https://lh4.googleusercontent.com/-IVkp7OXLukI/Uwg9nsE1zxI/AAAAAAAAWkg/aMYel-8J-cU/s400/IMG_1480.jpg"
 alt="FPGA Bitcoin mining setup with 41 Icarus"
 title="FPGA Bitcoin mining setup with 41 Icarus"></a>
<div class="cite">
15 GH/s FPGA Bitcoin mining configuration with 41 Icarus. Photo by permission of Xiangfu Liu
</div>

<h2>Mining with a pool</h2>
Because mining is so difficult, it is typically done in mining pools,
where a bunch of miners share the work and share the rewards. If you mine by yourself, you might successfully mine a block and get 25 bitcoin every few years. By mining as part of a pool, you could get a fraction of a bitcoin every day instead, which for most people is preferable.
<p>
Mining pools use an interesting technique to see how much work miners are doing. They send out a block to be mined, and get updates from a miner whenever a miner gets a partial solution. Each partial solution proves the miner is working hard on the problem and gives the miner a share in the final reward when someone succeeds in mining the block.
<p>
For instance, if Bitcoin mining requires a hash starting with 15 zeroes, the mining pool can ask for hashes starting with 10 zeroes, which is a million times easier. Depending on the power of their hardware, a miner might find such a solution every few seconds or a few times an hour. Eventually one of these solutions will start with not just 10 zeroes but 15 zeroes, successfully mining the block and winning the reward for the pool.<a class="ref" href="#ref7">[7]</a> The reward is then split based on each miner's count of shares as a fraction of the total, and the pool operator takes a small percentage for overhead.<a class="ref" href="#ref8">[8]</a>
<p>
Most of the time someone outside the pool will mine a block first. In that case, the pool operator sends out new data and the miners just start mining the new block. People in a pool can get edgy if a long time goes without a payout because of bad luck in mining.
<h2>Stratum: The communication between a pool and the miners</h2>
Next I'll look in detail at the communication between a miner and the mining pool.
The communication between the pool and the miners is interesting.
The pool must efficiently provide work to the miners and collect their results quickly. The pool must make sure miners aren't duplicating work. And the pool must make sure miners don't waste time working on a block that has already been mined.
<p>
An important issue for mining pools is how to support fast miners. The nonce field in the header is too small for fast miners since they will run through all the possible values faster than the pool can send blocks. The solution is to allow miners to update the coinbase transaction so they can put additional nonces there. This makes mining more complicated since after building the coinbase transaction the miner must recompute the Merkle hash tree and then try mining the block.
<p>
I'm going to look at the <a href="http://mining.bitcoin.cz/stratum-mining">Stratum</a> mining pool protocol that is used by many pools.
(Some alternative protocols are the <a href="https://en.bitcoin.it/wiki/Getwork">Getwork</a> and <a href="https://en.bitcoin.it/wiki/Getblocktemplate">Getblocktemplate</a> protocols.)
The following Python program uses the Stratum protocol to make a mining request to the <a href="http://ghash.io/">GHash.IO</a> mining pool and displays the results. (This program is a minimal demonstration; don't use this code for real mining.)
<p>
<div class="smallscript">
<script src="https://gist.github.com/shirriff/f9b3fe82b798ffbb261a.js"></script>
</div>
</p>
The information below is what the mining pool sends back over the network in response to the program above. Since the Stratum protocol uses
<a href="http://www.jsonrpc.org/specification">JSON-RPC</a>
the results are readable ASCII rather than the binary packets used by most of Bitcoin.
This provides all the data needed to start mining as part of the pool:
<pre style="word-wrap:break-word; background-color:#eee">
{"id":1,"result":[[["mining.set_difficulty","b4b6693b72a50c7116db18d6497cac52"],["mining.notify","ae6812eb4cd7735a302a8a9dd95cf71f"]],"4bc6af58",4],"error":null}

{"id":null,"params":[16],"method":"mining.set_difficulty"}

{"id":null,"params":["58af8d8c","975b9717f7d18ec1f2ad55e2559b5997b8da0e3317c803780000000100000000","01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4803636004062f503253482f04428b055308","2e522cfabe6d6da0bd01f57abe963d25879583eea5ea6f08f83e3327eba9806b14119718cbb1cf04000000000000000000000001fb673495000000001976a91480ad90d403581fa3bf46086a91b2d9d4125db6c188ac00000000",["ea9da84d55ebf07f47def6b9b35ab30fc18b6e980fc618f262724388f2e9c591","f8578e6b5900de614aabe563c9622a8f514e11d368caa78890ac2ed615a2300c","1632f2b53febb0a999784c4feb1655144793c4e662226aff64b71c6837430791","ad4328979dba3e30f11c2d94445731f461a25842523fcbfa53cd42b585e63fcd","a904a9a41d1c8f9e860ba2b07ba13187b41aa7246f341489a730c6dc6fb42701","dd7e026ac1fff0feac6bed6872b6964f5ea00bd8913a956e6b2eb7e22363dc5c","2c3b18d8edff29c013394c28888c6b50ed8733760a3d4d9082c3f1f5a43afa64"],"00000002","19015f53","53058b41",false],"method":"mining.notify"
{"id":2,"result":true,"error":null}
{"id":null,"params":[16],"method":"mining.set_difficulty"}
</pre>
The first line is a response from the pool server with the subscription details. The first values are not too important. The value <code>4bc6af58</code> is the value <i>extranonce1</i> that is used when building the block. Each client gets a unique value to ensure that all the mining clients generate unique blocks and don't duplicate work. The following value (<code>4</code> bytes) is the length of the <i>extranonce2_size</i> value that the miner puts in the coinbase while mining.
<p>
The second line is a <i>mining.set_difficulty</i> message to our client. With a difficulty of 16, I can get a share every hour or two on my PC.
In comparison, the Bitcoin mining difficulty is 3,129,573,174.52<a class="ref" href="#ref3">[3]</a> - thus it's about 200 million times easier to get a share in this pool than to successfully mine a block independently. That's why people join pools.
<p>
The third line is a <i>mining.notify</i> notification to our client. This message defines that block for us to mine. There's a lot of data returned under "params", so I'll explain it field by field.
<p>
<table class="mining left">
<tr><td>job_id</td><td>58af8d8c</td></tr>
<tr><td>prevhash</td><td>975b9717f7d18ec1f2ad55e2559b5997b8da0e3317c803780000000100000000</td></tr>
<tr><td>coinb1</td><td style="background-color:#fbb4b5">0100000001000000000000000000000000000000000000000000000000000000<br>0000000000ffffffff4803636004062f503253482f04428b055308</td></tr>
<tr><td>coinb2</td><td style="background-color:#b3cde3">2e522cfabe6d6da0bd01f57abe963d25879583eea5ea6f08f83e3327eba9806b<br>14119718cbb1cf04000000000000000000000001fb673495000000001976a914<br>80ad90d403581fa3bf46086a91b2d9d4125db6c188ac00000000</td></tr>
<tr><td>merkle_branch</td><td>["ea9da84d55ebf07f47def6b9b35ab30fc18b6e980fc618f262724388f2e9c591", ...]</td></tr>
<tr><td>version</td><td>00000002</td></tr>
<tr><td>nbits</td><td>19015f53</td></tr>
<tr><td>ntime</td><td>53058b41</td></tr>
<tr><td>clean_jobs</td><td>false</td></tr>
</table>
<p>
The <i>job_id</i> is used to identify this mining task if the miner reports back success.
<p>
Most of the fields are used in the block header. The <i>prevhash</i> is the hash of the <a href="https://blockchain.info/block/000000000000000117c80378b8da0e33559b5997f2ad55e2f7d18ec1975b9717">previous block</a>. Apparently mixing big-ending and little-endian isn't confusing enough so this hash value also has every block of 4 bytes reversed. The <i>version</i> is the block protocol version. The <i>nbits</i> indicates the difficulty<a class="ref" href="#ref3">[3]</a> of the block. The timestamp <i>ntime</i> is not necessarily accurate.
<p>
The <i>coinb1</i> and <i>coinb2</i> fields allow the miner to build the coinbase transaction for the block. This transaction is formed by concatenating <i>coinb1</i>, the <i>extranonce1</i> value obtained at the start, the <i>extranonce2</i> that the miner has generated, and <i>coinb2</i>. The result is a transaction in Bitcoin protocol. The <i>merkle_branch</i> hash list lets the miner efficiently recompute the Merkle hash with the new coinbase transaction.
<p>
<i>clean_jobs</i> is used if the miner needs to restart the mining jobs.
<p>
After receiving this data, the miner can start generating coinbase transactions and mining blocks.
<p>
<a href="http://www.flickr.com/photos/0xf2/11900550615/" title="Butterfly Labs Jalapeño by 0xF2, on Flickr"><img src="http://farm8.staticflickr.com/7413/11900550615_faafc6ccda_n.jpg" width="400" alt="Butterfly Labs Jalapeño"></a>
<div class="cite">
Butterfly Labs Jalapeño ASIC miner, 7+ GH/s, by 0xF2,
<a class="cc" href="http://creativecommons.org/licenses/by-nd/2.0/deed.en">
(CC BY-ND 2.0)</a>
</div>
<h2>Creating a block for a pool</h2>
Once the miner has received the information from the pool, it is straightforward to form the coinbase transaction by joining the <i style="background-color:#fbb4b5">coinb1</i>, <i style="background-color:#ccebbc">extranonce1</i>, <i style="background-color:#ffffcc">extranonce2</i>, and <i style="background-color:#b3cde3">coinb2</i> to form a coinbase transaction. The diagram below shows how the combination of these four values forms a complete transaction, with the nonces in the middle of the coinbase script. (The block below is slightly different from the one described earlier.)
<p>
<a href="https://picasaweb.google.com/lh/photo/9eiaMxuKqrix7zoF_zpUe6NTQ8Yf_fOdBXli6Rl3Pxs"><img class="hilite" src="https://lh6.googleusercontent.com/-pJStNHlIqhM/UwWzLbv3DUI/AAAAAAAAWi4/B36hVAAV9-g/s400/coinbase-txn2.png" width="400"
alt="A coinbase transaction generated by the GHash.io mining pool"
title="A coinbase transaction generated by the GHash.io mining pool">
</a>
<p>
<div class="cite">
A coinbase transaction generated by the GHash.io mining pool
</div>
<p>
The structure of the coinbase transaction is similar to a regular transaction, but there are a few important differences. A normal transaction transfers bitcoins from <i>inputs</i> (usually source addresses) to <i>outputs</i> (usually destination addresses). A coinbase transaction is generating new bitcoins out of thin air, rather than doing a transfer, so the transaction is slightly different. The previous output hash and index are irrelevant for the coinbase transaction. the first script is the <i>scriptSig</i> which signs the transaction to prove ownership of the incoming bitcoins. In a coinbase transaction, this is irrelevant, so instead the field is called the <i>coinbase</i> and is mostly arbitrary data.<a class="ref" href="#ref9">[9]</a> (Many miners <a href="http://www.righto.com/2014/02/ascii-bernanke-wikileaks-photographs.html">hide messages</a> in there.) The <i>value</i> field in the coinbase transaction is the 25 bitcoin mining reward plus any bitcoins left over from the other transactions (the left over bitcoins are treated as mining fees). Finally, both regular transactions and the coinbase transaction use the second script (<i>scriptPubKey</i>) to specify the recipients of the bitcoins.<a class="ref" href="#ref10">[10]</a>
For details on transactions, see my <a href="http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html">my previous article</a>.
<p>
Once the coinbase transaction is created, the hash for this coinbase transaction is combined with the <i>merkle_branch</i> data from the pool to generate the Merkle hash<a class="ref" href="#ref4">[4]</a> for the entire set of transactions. Because of the structure of the Merkle hash (explained below), this allows the hash for the entire set of transactions to be recomputed easily.
<p>
Finally, the block header is built from the new Merkle hash and the data provided by the pool, and the hash algorithm can iterate over the nonce values in the header, just like the Python program earlier. Once all the nonce values have been tried, the miner increments the extranonce2, generates a new coinbase transaction and continues.
<p>
<a href="https://picasaweb.google.com/lh/photo/tJQvX-_G_FHvQeOnWpC_vaNTQ8Yf_fOdBXli6Rl3Pxs"><img class="hilite" src="https://lh3.googleusercontent.com/-jLFgAFAUvyc/UwWzLFgx9yI/AAAAAAAAWi0/8g_kWPsRXDY/s400/mined-block-header2.png" width="400"
alt="A Bitcoin block header"
title="A Bitcoin block header">
</a>
<p>
<div class="cite">
A Bitcoin block header
</div>
<p>
<h2>Informing the mining pool of success</h2>
The difficulty<a class="ref" href="#ref3">[3]</a> for a mining pool is set much lower than the Bitcoin mining difficulty (fewer leading zeros required), so it's much easier to get a share. When a block is hashed to the pool's difficulty, you send a simple JSON message to the mining pool to submit it:
<pre style="background-color:#eee">
{"method": "mining.submit", "params": ["kens.worker1", "58af8db7", "00000000", "53058d7b", "e8832204"], "id":4}
</pre>
The parameters are the worker name, job id, extranonce2, time, and header nonce. This information is sufficient for the pool to build the matching coinbase transaction and header, and verify the block. If the hash meets the pool difficulty, you get a share. If the hash also meets the much, much harder Bitcoin difficulty, the block has been successfully mined. In this case the pool submits the block to the Bitcoin network and everyone with shares gets paid accordingly.
<p>
<a href="http://www.flickr.com/photos/oddduck/8283574163/" title="Bitcoin mining op by heyaudy, on Flickr"><img src="https://farm9.staticflickr.com/8076/8283574163_d67bab4fe1.jpg" width="300" height="300" alt="Bitcoin mining op"></a>
<div class="cite">
 Bitcoin mining setup by Austin Davis-Richardson.
 <a class="cc" href="http://creativecommons.org/licenses/by-nc-sa/2.0/deed.en">(CC BY-NC-SA 2.0)</a>
</div>
<h2>Mining for fun and profit</h2>
If you're curious about mining, it's surprisingly easy to try out mining yourself, although you'll be lucky to earn even a penny. Just create an account at a mining pool such as <a href="btcguild.com">BTC Guild</a>, download mining software such as <a href="http://sourceforge.net/projects/cpuminer/">cpuminer</a> (minerd.exe), and run the software to start mining. For a pool with low difficulty, you should get shares in a few minutes; in a pool with a higher difficulty (such as GHash.IO), it may take you an hour or two to get a share, which is more frustrating.<a class="ref" href="#ref3">[3]</a>
<p>
<a href="https://picasaweb.google.com/lh/photo/63AN7dHppMhU9-Jos7ktl6NTQ8Yf_fOdBXli6Rl3Pxs"><img class="hilite" src="https://lh6.googleusercontent.com/-UhxwAysW9Ag/UwbZ9Un-IRI/AAAAAAAAWjk/BZHBWnWIsuQ/s500/minerd.png" width="500"
alt="Example of Bitcoin mining"
title="Example of Bitcoin mining">
</a>
<p>
<div class="cite">
Unprofitable Bitcoin CPU mining on my PC
</div>
<p>
The screenshot above shows what mining looks like as you get shares and blocks get mined. I got lucky and it only took me a minute to successfully mine a share. A minute later someone successfully mined a block, so the pool tells everyone to start over. Another block was mined less than a minute after that - although blocks are 10 minutes apart on average, the times can vary widely. It took 12 minutes for my next share to be generated. After running for a while, I earned 0.00000043 BTC, which is a tiny fraction of a cent.
<p>
Bitcoin mining is an "arms race". Originally people could mine with the CPU on a regular PC, but that hasn't been practical for a while. Next mining was offloaded to GPUs. Now, mining is done with special-purpose ASIC hardware, which is rapidly increasing in speed. For-profit mining is very competitive, and you'll need to look elsewhere for information.
<p>
If you want to try out mining just for fun, you may prefer to mine a currency such as Dogecoin rather than Bitcoin. First, Dogecoin uses a different hash algorithm which doesn't work well with ASIC hardware, so you're not as disadvantaged compared to professional miners.
Second, because dogecoins are worth much less than bitcoins, you'll end up with a much larger number of dogecoins, which seems more rewarding.
For Dogecoin mining, I used the <a href="http://dogepool.pw">dogepool.pw</a> pool somewhat arbitrarily. The process is almost the same as Bitcoin mining, except you use the <i>scrypt</i> algorithm instead of <i>sha256d</i>.
There are many other <a href="https://en.bitcoin.it/wiki/List_of_alternative_cryptocurrencies">alternative cryptocurrencies</a> to choose from.
<h2>Notes and references</h2>
<a name="ref1"></a>[1]
Bitcoin mining seems like a <a href="http://en.wikipedia.org/wiki/NP_(complexity)">NP</a> (nondeterministic polynomial) problem since a solution can be quickly verified. However, there are a couple of issues with making this rigorous. First, since hashes are a fixed size, mining can be done in constant time (but with a very large constant of 2^256). Thus, you'd need to consider an extended mining scheme where the difficulty can go to infinity. Second, mining would need to be turned into a decision problem - e.g. instead of finding a nonce, the problem would be "Is there a successful nonce less than k". (Note that if you can solve that problem, you can rapidly find the nonce with binary search.)
<p>
With these changes, the mining problem is in NP.
The next question is if it is NP-complete. That is, can an arbitrary NP-complete problem be turned into a mining problem? I believe that is currently unknown.
<p>
<a name="ref2"></a>[2]
You might wonder what happens if two miners succeed in mining a block at approximately the same time. Has the problem of conflicting transactions has just been replaced by the problem of conflicting blocks?) The rule is that only the <a href="https://en.bitcoin.it/wiki/Block_chain">longest chain</a>
of valid blocks is used, and the other branch is ignored. Thus, when a miner extends the chain with one of the two parallel blocks, the other block becomes an orphan block and is ignored.
<p>
Orphan blocks are <a href="https://blockchain.info/orphaned-blocks">fairly common</a>, roughly one a day.
For this reason, the (somewhat arbitrary) <a href="https://en.bitcoin.it/wiki/Confirmation">recommendation</a> is to wait for six confirmations (about one hour) before considering a transaction solidly confirmed.
<p>
<a name="ref3"></a>[3]
I've been describing a successful hash as starting with enough zeros, but there's an <a href="https://en.bitcoin.it/wiki/Difficulty">official definition of difficulty</a>.
A valid block must have a hash below a target value. (Since the target starts with a bunch of zeros, so will the valid hash.)
<p>
There are two different hard-to-understand ways of representing the target.
The first, <i>bits</i> is a mantissa/exponent representation of the target in 32 bits.
The second, <i>difficulty</i> is the ratio between a base target and the current target.
A difficulty of <i>N</i> is <i>N</i> times as difficult as this base target.
The base target is <code>0x00000000FFFF0000000000000000000000000000000000000000000000000000</code>, which corresponds to approximately 1 in 2<sup>32</sup> or 1 in 4.2 billion hashes succeeding.<p>
Difficulty changes approximately every two weeks to keep the block hash rate around 1 every 10 minutes. The <a href="https://blockchain.info/stats">https://blockchain.info/stats</a> difficulty value is
3,129,573,174.52, corresponding to a target of <code>00000000000000015f5300000000000000000000000000000000000000000000</code>.
Multiplying my PC's performance by the current difficulty shows it would take my PC about 35,000 years to mine a block.

<p>
The pool difficulty is important when using a mining pool.
My PC can do about 12 million hashes/sec running cpuminer, so at a difficulty of 1 my PC could find a block every 6 minutes. The BTC Guild pool uses a difficulty of 2, so I get a share about every 12 minutes. GHash.IO has a minimum difficulty of 16 on the other hand, so I only get a share every hour or two on the average. (My overall earnings would be similar either way, since the shares per block scale inversely with the difficulty.)
<p>
<a name="ref4"></a>[4]
Instead of hashing all the transactions into the block directly, the transactions are first hashed together to yield a <i>Merkle root</i>. The Merkle root is the root of a binary <a href="https://en.bitcoin.it/wiki/Protocol_specification#Merkle_Trees">Merkle tree</a>. The idea is to start with all the transaction hashes. Pairs of hashes are hashed together to yield new hashes. The process is repeated on the new list of hashes and continues recursively until a single hash is obtained. This final root hash is the value used when computing the block. (See <a href="http://en.wikipedia.org/wiki/Merkle_tree">Wikipedia</a> for more details.)
<p>
In the Merkle tree, each transaction is hashed. Then pairs of hashes are hashed together. Then pairs of the new hashes are hashed together, and so on, until a single hash remains. This allows the hash of a single transaction to be verified efficiently without recomputing all the hashes. One place this comes in useful is generating a new coinbase transaction for a mining pool.
<p>
The (<a href="http://www.google.com/patents/US4309569">patented</a>) idea of a Merkle tree is if you need to modify or verify a single transaction, you don't need to recompute everything, but can just recompute the affected pairs. Personally, I think the Merkle tree is a pointless optimization for Bitcoin and for reasonable transaction numbers it would be faster to do a single large hash, rather than multiple hashes up the Merkle tree.
<p>
Here's some demonstration code to compute the Merkle root for the block I'm discussing. The 99 transaction hashes are hard-coded for convenience. The resulting Merkle root is <code>871714dcbae6c8193a2bb9b2a69fe1c0440399f38d94b3a0f1b447275a29978a</code>
<p>
<div class="smallscript">
<script src="https://gist.github.com/shirriff/c9fb5d98e6da79d9a772.js"></script>
</div>
<p>
<a name="ref5"></a>[5]
There are a few ways that third parties can modify transactions without invalidating the signature on the transaction. This is known as transaction malleability. These modifications change the hash of the transaction. Since the hash is part of the block, a transaction has a fixed hash and cannot be modified by malleability once it has been mined into a block. (Unless the whole block is orphaned, of course.)
<p>
<a name="ref6"></a>[6]
It's hard to estimate the cost of mining because the hardware is changing so rapidly and it's unclear what is actually in use, but I'll do a rough calculation. Looking at the <a href="http://www.bitcoinx.com/bitcoin-mining-hardware/">Bitcoin mining hardware</a> and <a href="https://en.bitcoin.it/wiki/Mining_hardware_comparison">Mining hardware comparison</a> pages, the HashBlaster looks like the most efficient currently available at 375 MH/s/$ and 1818 MH/s/W. The Bitcoin network is 25 billion MH/s, which works out to about $70 million hardware cost and 15 MW.
(This is about the total power consumption of <a href="http://en.wikipedia.org/wiki/List_of_countries_by_electricity_production">Cambodia</a>.)
At $0.15/kWH, that would be about $50,000/day on electricity ($300 per block or $0.70 per transaction).
Since mining generates about $140,000 per day, spending $50,000 per day on electricity seems like the right ballpark.
Other estimates are at <a href="https://news.ycombinator.com/item?id=6845189">Hacker News</a>.
<p>
<a name="ref7"></a>[7]
You might wonder why a miner doesn't cheat. If they successfully mine a block, why not submit it themselves so they can claim the full mining reward, rather than splitting it? The main reason is the coinbase transaction has the pool's address, not the miner's address. If the miner submits the block bypassing the pool, the reward still goes to the pool. And if the miner changes the address, the hash is no longer valid.
<p>
<a name="ref8"></a>[8]
There are several different <a href="https://en.bitcoin.it/wiki/Comparison_of_mining_pools">reward systems</a> used by mining pools. For instance, a pool can pay out the exact amount earned from a block or an average amount. Or a pool can pay a fixed amount per share. A pool can weight shares by time to avoid miners switching between pools mid-block. These different systems can balance risk between the miners and the pool operator and adjust the variance of payments.
For details, see the Bitcoin wiki <a href="https://en.bitcoin.it/wiki/Mining_pool_reward_FAQ">here</a> or <a href="https://en.bitcoin.it/wiki/Pooled_mining">here</a>.
<p>
<a name="ref9"></a>[9]
I've figured out a lot of the structure of the coinbase script above.
First it contains the block height (0x046063 or 286819), which is
<a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">required for version 2</a>). Next is the string '/P2SH/' which indicates the miner supports
<a href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki">Pay To Script Hash</a>).
This is followed by a timestamp. Next is 8 bytes of the two nonces. This is followed by apparently-random data and then the text "Happy NY! Yours GHash.IO".
<p>
<a name="ref10"></a>[10]
The typical coinbase script format has changed over time. Originally, the output scripts were all <a href="https://en.bitcoin.it/wiki/Script#Standard_Generation_Transaction_.28pay-to-pubkey.29">pay-to-pubkey</a>, with the script: <code><i>public_key</i> OP_CHECKSIG</code>. This script puts the public key itself in the script.
However, now about 95% of coinbase transactions use the standard <a href="https://en.bitcoin.it/wiki/Script#Standard_Transaction_to_Bitcoin_address_.28pay-to-pubkey-hash.29">pay-to-pubkey-hash</a> script: <code>OP_DUP OP_HASH160 <i>addr</i> OP_EQUALVERIFY OP_CHECKSIG</code>. This script only includes the public key hash (the address) and requires the redeemer to provide the public key.
To see the difference, compare the output scripts in
<a href="https://blockchain.info/tx/aeac613c5c8faf803a99425f5fe178bf3baadf8aeec8b65727cbc5c720342215">this transaction</a> and
<a href="https://blockchain.info/tx/b56f86a450824dcb47fa45cbf51a40db6d60594cdf689f9ee7cc6c48a93d9360">this transaction</a>.
<p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
</span>
<span class='reaction-buttons'>
</span>
<span class='star-ratings'>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='http://www.blogger.com/comment.g?blogID=6264947694886887540&amp;postID=870235476863918854' onclick=''>
14 comments:
    </a>
</span>
<span class='post-backlinks post-comment-link'>
<a class='comment-link' href='http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html#links'>Links to this post</a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='http://www.blogger.com/email-post.g?blogID=6264947694886887540&postID=870235476863918854' title='Email Post'>
<img alt='' class='icon-action' height='13' src='http://img1.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-1138732533'>
<a href='http://www.blogger.com/post-edit.g?blogID=6264947694886887540&postID=870235476863918854&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='http://img2.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=870235476863918854&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=870235476863918854&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=870235476863918854&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=870235476863918854&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='http://www.blogger.com/share-post.g?blogID=6264947694886887540&postID=870235476863918854&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block dummy-container'><g:plusone source='blogger:blog:plusone' href='http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='http://www.righto.com/search/label/bitcoin' rel='tag'>bitcoin</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

        </div></div>
      
<!-- google_ad_section_end -->
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://www.righto.com/search?updated-max=2014-02-23T09:22:00-08:00&amp;max-results=7' id='Blog1_blog-pager-older-link' title='Older Posts'>Older Posts</a>
</span>
<a class='home-link' href='http://www.righto.com/'>Home</a>
</div>
<div class='clear'></div>
<div class='blog-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://www.righto.com/feeds/posts/default' target='_blank' type='application/atom+xml'>Posts (Atom)</a>
</div>
</div>
<script type="text/javascript">window.___gcfg = {'lang': 'en'};</script>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget PopularPosts' id='PopularPosts1'>
<h2>Popular Posts</h2>
<div class='widget-content popular-posts'>
<ul>
<li>
<div class='item-thumbnail-only'>
<div class='item-thumbnail'>
<a href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html' target='_blank'>
<img alt='' border='0' height='72' src='https://lh3.googleusercontent.com/-jh5hlCy0GxE/UEvqFCCnm6I/AAAAAAAANmk/nD85gxt3OLs/s72-c/charger-ipads.png' width='72'/>
</a>
</div>
<div class='item-title'><a href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html'>iPad charger teardown: inside Apple's charger and a risky phony</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-thumbnail'>
<a href='http://www.righto.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html' target='_blank'>
<img alt='' border='0' height='72' src='https://lh3.googleusercontent.com/-zO_0pO2xHGA/UDXL2yu-vmI/AAAAAAAAM4k/t9d1RNi0V_I/s72-c/chargers.png' width='72'/>
</a>
</div>
<div class='item-title'><a href='http://www.righto.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html'>A dozen USB chargers in the lab: Apple is very good, but not quite the best</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-title'><a href='http://www.righto.com/2009/08/multi-protocol-infrared-remote-library.html'>A Multi-Protocol Infrared Remote Library for the Arduino</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-title'><a href='http://www.righto.com/2012/05/apple-iphone-charger-teardown-quality.html'>Apple iPhone charger teardown: quality in a tiny expensive package</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-thumbnail'>
<a href='http://www.righto.com/2012/03/inside-cheap-phone-charger-and-why-you.html' target='_blank'>
<img alt='' border='0' height='72' src='https://lh3.googleusercontent.com/-CblJ2EJedW8/T7z8QWAtNtI/AAAAAAAAKmI/uSuHSPgSeFM/s72-c/charger-iphone4.png' width='72'/>
</a>
</div>
<div class='item-title'><a href='http://www.righto.com/2012/03/inside-cheap-phone-charger-and-why-you.html'>Tiny, cheap, and dangerous: Inside a (fake) iPhone charger</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-thumbnail'>
<a href='http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html' target='_blank'>
<img alt='' border='0' height='72' src='https://lh4.googleusercontent.com/-anHnnkgfQw8/Ut4QeV-Q9yI/AAAAAAAAWXA/RvR5tOvR4tk/s72-c/signing-thumb.png' width='72'/>
</a>
</div>
<div class='item-title'><a href='http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html'>Bitcoins the hard way: Using the raw Bitcoin protocol</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-thumbnail'>
<a href='http://www.righto.com/2013/06/teardown-and-exploration-of-magsafe.html' target='_blank'>
<img alt='' border='0' height='72' src='https://lh5.googleusercontent.com/-Myi16qZurOM/UaolXHkC_6I/AAAAAAAATQc/AlLeCmPmvWM/s72-c/magsafe-charred.png' width='72'/>
</a>
</div>
<div class='item-title'><a href='http://www.righto.com/2013/06/teardown-and-exploration-of-magsafe.html'>Teardown and exploration of Apple's Magsafe connector</a></div>
</div>
<div style='clear: both;'></div>
</li>
<li>
<div class='item-thumbnail-only'>
<div class='item-title'><a href='http://www.righto.com/2009/07/secrets-of-arduino-pwm.html'>Secrets of Arduino PWM</a></div>
</div>
<div style='clear: both;'></div>
</li>
</ul>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=PopularPosts&widgetId=PopularPosts1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("PopularPosts1"));' target='configPopularPosts1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget Label' id='Label1'>
<h2>Labels</h2>
<div class='widget-content cloud-label-widget-content'>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/6502'>6502</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='http://www.righto.com/search/label/8085'>8085</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='http://www.righto.com/search/label/apple'>apple</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='http://www.righto.com/search/label/arc'>arc</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='http://www.righto.com/search/label/arduino'>arduino</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/bitcoin'>bitcoin</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='http://www.righto.com/search/label/c%23'>c#</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/calculator'>calculator</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/css'>css</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='http://www.righto.com/search/label/electronics'>electronics</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='http://www.righto.com/search/label/f%23'>f#</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='http://www.righto.com/search/label/fractals'>fractals</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/genome'>genome</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='http://www.righto.com/search/label/haskell'>haskell</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/html5'>html5</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/ipv6'>ipv6</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='http://www.righto.com/search/label/ir'>ir</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/java'>java</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/javascript'>javascript</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/math'>math</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/oscilloscope'>oscilloscope</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/photo'>photo</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/power%20supply'>power supply</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='http://www.righto.com/search/label/random'>random</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='http://www.righto.com/search/label/reverse-engineering'>reverse-engineering</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/sheevaplug'>sheevaplug</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/snark'>snark</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/spanish'>spanish</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='http://www.righto.com/search/label/teardown'>teardown</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/theory'>theory</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='http://www.righto.com/search/label/Z-80'>Z-80</a>
</span>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=Label&widgetId=Label1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("Label1"));' target='configLabel1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget AdSense' id='AdSense1'>
<div class='widget-content'>
<script type="text/javascript"><!--
google_ad_client="pub-0159785530845184";
google_ad_host="pub-1556223355139109";
google_alternate_ad_url="http://www.blogger.com/img/blogger_ad160x600.html";
google_ad_width=160;
google_ad_height=600;
google_ad_format="160x600_as";
google_ad_type="text_image";
google_ad_host_channel="0001";
google_color_border="E6E6E6";
google_color_bg="E6E6E6";
google_color_link="B8A80D";
google_color_url="999999";
google_color_text="000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=AdSense&widgetId=AdSense1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("AdSense1"));' target='configAdSense1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget LinkList' id='LinkList2'>
<h2>Power supply posts</h2>
<div class='widget-content'>
<ul>
<li><a href='http://www.arcfn.com/2012/05/apple-iphone-charger-teardown-quality.html'>iPhone charger teardown</a></li>
<li><a href='http://www.arcfn.com/2012/10/a-dozen-usb-chargers-in-lab-apple-is.html'>A dozen USB chargers</a></li>
<li><a href='http://www.righto.com/2013/06/teardown-and-exploration-of-magsafe.html'>Magsafe hacking</a></li>
<li><a href='http://www.arcfn.com/2012/03/inside-cheap-phone-charger-and-why-you.html'>Inside a fake iPhone charger</a></li>
<li><a href='http://www.arcfn.com/2012/02/apple-didnt-revolutionize-power.html'>Power supply history</a></li>
</ul>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=LinkList&widgetId=LinkList2&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("LinkList2"));' target='configLinkList2' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget HTML' id='HTML2'>
<div class='widget-content'>
<a href="http://www.blogger.com/profile/08097301407311055124"><img src="https://lh4.googleusercontent.com/-4nE0TSEWMU8/T7-1iAcgXbI/AAAAAAAAKpo/bUaz-b76Cv4/s800/name.png" /></a>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=HTML&widgetId=HTML2&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("HTML2"));' target='configHTML2' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div><div class='widget BlogArchive' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>&#9660;&#160;</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2014-01-01T00:00:00-08:00&amp;updated-max=2015-01-01T00:00:00-08:00&amp;max-results=8'>2014</a>
<span class='post-count' dir='ltr'>(8)</span>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>&#9660;&#160;</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2014_05_01_archive.html'>May</a>
<span class='post-count' dir='ltr'>(2)</span>
<ul class='posts'>
<li><a href='http://www.righto.com/2014/05/reverse-engineering-tl431-most-common.html'>Reverse-engineering the TL431: the most common chi...</a></li>
<li><a href='http://www.righto.com/2014/05/a-look-inside-ipad-chargers-pricey.html'>iPad charger teardown: inside Apple&#39;s charger and ...</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2014_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2014_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2013-01-01T00:00:00-08:00&amp;updated-max=2014-01-01T00:00:00-08:00&amp;max-results=24'>2013</a>
<span class='post-count' dir='ltr'>(24)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_11_01_archive.html'>November</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_09_01_archive.html'>September</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_08_01_archive.html'>August</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_07_01_archive.html'>July</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_06_01_archive.html'>June</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_04_01_archive.html'>April</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2013_01_01_archive.html'>January</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2012-01-01T00:00:00-08:00&amp;updated-max=2013-01-01T00:00:00-08:00&amp;max-results=10'>2012</a>
<span class='post-count' dir='ltr'>(10)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_12_01_archive.html'>December</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_11_01_archive.html'>November</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_10_01_archive.html'>October</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_05_01_archive.html'>May</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2012_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2011-01-01T00:00:00-08:00&amp;updated-max=2012-01-01T00:00:00-08:00&amp;max-results=11'>2011</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_12_01_archive.html'>December</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_07_01_archive.html'>July</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_05_01_archive.html'>May</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_04_01_archive.html'>April</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2011_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2010-01-01T00:00:00-08:00&amp;updated-max=2011-01-01T00:00:00-08:00&amp;max-results=22'>2010</a>
<span class='post-count' dir='ltr'>(22)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_12_01_archive.html'>December</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_11_01_archive.html'>November</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_10_01_archive.html'>October</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_08_01_archive.html'>August</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_06_01_archive.html'>June</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_05_01_archive.html'>May</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_04_01_archive.html'>April</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2010_01_01_archive.html'>January</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2009-01-01T00:00:00-08:00&amp;updated-max=2010-01-01T00:00:00-08:00&amp;max-results=22'>2009</a>
<span class='post-count' dir='ltr'>(22)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_12_01_archive.html'>December</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_11_01_archive.html'>November</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_09_01_archive.html'>September</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_08_01_archive.html'>August</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_07_01_archive.html'>July</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_06_01_archive.html'>June</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_04_01_archive.html'>April</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2009_01_01_archive.html'>January</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/search?updated-min=2008-01-01T00:00:00-08:00&amp;updated-max=2009-01-01T00:00:00-08:00&amp;max-results=27'>2008</a>
<span class='post-count' dir='ltr'>(27)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_07_01_archive.html'>July</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_06_01_archive.html'>June</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_05_01_archive.html'>May</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_04_01_archive.html'>April</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_03_01_archive.html'>March</a>
<span class='post-count' dir='ltr'>(10)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

          &#9658;&#160;
        
</span>
</a>
<a class='post-count-link' href='http://www.righto.com/2008_02_01_archive.html'>February</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=BlogArchive&widgetId=BlogArchive1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("BlogArchive1"));' target='configBlogArchive1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div><div class='widget HTML' id='HTML1'>
<div class='widget-content'>
<script type="text/javascript"><!--
amazon_ad_tag = "rightocom"; amazon_ad_width = "160"; amazon_ad_height = "600"; amazon_ad_link_target = "new"; amazon_color_background = "F6F6F6"; amazon_color_link = "0B3660";//--></script>
<script type="text/javascript" src="http://www.assoc-amazon.com/s/ads.js"></script>

<!--<script charset="utf-8" type="text/javascript" src="http://ws.amazon.com/widgets/q?ServiceVersion=20070822&MarketPlace=US&ID=V20070822/US/rightocom/8001/b3f6b083-3c2a-4444-a0de-6d75351ee9d6"> </script> <noscript><a href="http://ws.amazon.com/widgets/q?ServiceVersion=20070822&MarketPlace=US&ID=V20070822%2FUS%2Frightocom%2F8001%2Fb3f6b083-3c2a-4444-a0de-6d75351ee9d6&Operation=NoScript">Amazon.com Widgets</a></noscript>-->
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=HTML&widgetId=HTML1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("HTML1"));' target='configHTML1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div><div class='widget LinkList' id='LinkList1'>
<h2>Quick links</h2>
<div class='widget-content'>
<ul>
<li><a href='http://www.arcfn.com/2009/08/multi-protocol-infrared-remote-library.html'>Arduino IR library</a></li>
<li><a href='http://www.righto.com/2013/01/a-small-part-of-6502-chip-explained.html'>6502 reverse-engineering</a></li>
</ul>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=LinkList&widgetId=LinkList1&action=editWidget&sectionId=sidebar-right-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("LinkList1"));' target='configLinkList1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot section' id='footer-1'></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3'><div class='widget Attribution' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple template. Powered by <a href='http://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=6264947694886887540&widgetType=Attribution&widgetId=Attribution1&action=editWidget&sectionId=footer-3' onclick='return _WidgetManager._PopupConfig(document.getElementById("Attribution1"));' target='configAttribution1' title='Edit'>
<img alt='' height='18' src='http://img1.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<script type="text/javascript">
if (window.jstiming) window.jstiming.load.tick('widgetJsBefore');
</script><script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/2423294629-widgets.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type='text/javascript'>
if (typeof(BLOG_attachCsiOnload) != 'undefined' && BLOG_attachCsiOnload != null) { window['blogger_templates_experiment_id'] = "templatesV2";window['blogger_blog_id'] = '6264947694886887540';BLOG_attachCsiOnload(''); }_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d6264947694886887540','//www.righto.com/','6264947694886887540');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '6264947694886887540', 'bloggerUrl': 'http://www.blogger.com', 'title': 'Ken Shirriff\47s blog', 'pageType': 'index', 'url': 'http://www.righto.com/', 'canonicalUrl': 'http://www.righto.com/', 'canonicalHomepageUrl': 'http://www.righto.com/', 'homepageUrl': 'http://www.righto.com/', 'blogspotFaviconUrl': 'http://www.righto.com/favicon.ico', 'enabledCommentProfileImages': true, 'adultContent': false, 'disableAdSenseWidget': false, 'analyticsAccountNumber': 'UA-3782444-1', 'searchLabel': '', 'searchQuery': '', 'pageName': '', 'pageTitle': 'Ken Shirriff\47s blog', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'languageDirection': 'ltr', 'feedLinks': '\74link rel\75\42alternate\42 type\75\42application/atom+xml\42 title\75\42Ken Shirriff\46#39;s blog - Atom\42 href\75\42http://www.righto.com/feeds/posts/default\42 /\76\n\74link rel\75\42alternate\42 type\75\42application/rss+xml\42 title\75\42Ken Shirriff\46#39;s blog - RSS\42 href\75\42http://www.righto.com/feeds/posts/default?alt\75rss\42 /\76\n\74link rel\75\42service.post\42 type\75\42application/atom+xml\42 title\75\42Ken Shirriff\46#39;s blog - Atom\42 href\75\42http://www.blogger.com/feeds/6264947694886887540/posts/default\42 /\76\n', 'meTag': '', 'openIdOpTag': '\74link rel\75\42openid.server\42 href\75\42http://www.blogger.com/openid-server.g\42 /\76\n\74link rel\75\42openid.delegate\42 href\75\42http://www.righto.com/\42 /\76\n', 'latencyHeadScript': '\74script type\75\42text/javascript\42\76(function() { var b\75window,f\75\42chrome\42,g\75\42tick\42,k\75\42jstiming\42;(function(){function d(a){this.t\75{};this.tick\75function(a,d,c){var e\75void 0!\75c?c:(new Date).getTime();this.t[a]\75[e,d];if(void 0\75\75c)try{b.console.timeStamp(\42CSI/\42+a)}catch(h){}};this[g](\42start\42,null,a)}var a;b.performance\46\46(a\75b.performance.timing);var n\75a?new d(a.responseStart):new d;b.jstiming\75{Timer:d,load:n};if(a){var c\75a.navigationStart,h\75a.responseStart;0\74c\46\46h\76\75c\46\46(b[k].srt\75h-c)}if(a){var e\75b[k].load;0\74c\46\46h\76\75c\46\46(e[g](\42_wtsrt\42,void 0,c),e[g](\42wtsrt_\42,\42_wtsrt\42,h),e[g](\42tbsd_\42,\42wtsrt_\42))}try{a\75null,\nb[f]\46\46b[f].csi\46\46(a\75Math.floor(b[f].csi().pageT),e\46\0460\74c\46\46(e[g](\42_tbnd\42,void 0,b[f].csi().startE),e[g](\42tbnd_\42,\42_tbnd\42,c))),null\75\75a\46\46b.gtbExternal\46\46(a\75b.gtbExternal.pageT()),null\75\75a\46\46b.external\46\46(a\75b.external.pageT,e\46\0460\74c\46\46(e[g](\42_tbnd\42,void 0,b.external.startE),e[g](\42tbnd_\42,\42_tbnd\42,c))),a\46\46(b[k].pt\75a)}catch(p){}})();b.tickAboveFold\75function(d){var a\0750;if(d.offsetParent){do a+\75d.offsetTop;while(d\75d.offsetParent)}d\75a;750\76\75d\46\46b[k].load[g](\42aft\42)};var l\75!1;function m(){l||(l\75!0,b[k].load[g](\42firstScrollTime\42))}b.addEventListener?b.addEventListener(\42scroll\42,m,!1):b.attachEvent(\42onscroll\42,m);\n })();\74/script\076', 'mobileHeadScript': '', 'adsenseClientId': 'pub-0159785530845184', 'ieCssRetrofitLinks': '\74!--[if IE]\76\74script type\75\42text/javascript\42 src\75\42https://www.blogger.com/static/v1/jsbin/1735305980-ieretrofit.js\42\76\74/script\76\n\74![endif]--\076', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/76f25a6f2e06af76', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sf': 'n'}}, {'name': 'skin', 'data': {'vars': {'content_padding': '10px', 'paging_background': 'transparent none no-repeat scroll top center', 'image_border_small_size': '2px', 'body_background_gradient_cap': 'url(//www.blogblog.com/1kt/simple/gradients_light.png)', 'tabs_selected_background_color': '#eeeeee', 'body_rule_color': '#eeeeee', 'header_shadow_spread': '3px', 'header_shadow_offset_left': '1px', 'header_padding': '30px', 'link_visited_color': '#121fb3', 'mobile_background_size': 'auto', 'post_title_font': 'normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'tabs_text_color': '#999999', 'date_header_margin': 'inherit', 'header_background_gradient': 'url(//www.blogblog.com/1kt/simple/gradients_light.png)', 'header_bottom_border_size': '0', 'content_shadow_spread_webkit': '5px', 'header_shadow_offset_top': '2px', 'mobile_button_color': '#ffffff', 'widget_title_font': 'normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'main_section_margin': '15px', 'keycolor': '#1119cc', 'content_shadow_spread': '40px', 'image_background_color': '#ffffff', 'header_font': 'normal normal 42px Play', 'header_background_color': '#f6fbf7', 'main_border_width': '0', 'main_padding': '15px', 'tabs_border_color': '#eeeeee', 'image_text_color': '#222222', 'description_text_size': '140%', 'post_footer_background_color': '#f9f9f9', 'body_background_gradient_tile': 'url(//www.blogblog.com/1kt/simple/body_gradient_tile_light.png)', 'page_width': 'auto', 'tabs_background_gradient': 'url(//www.blogblog.com/1kt/simple/gradients_light.png)', 'mobile_background_overlay': 'transparent none repeat scroll top left', 'main_padding_bottom': '30px', 'tabs_background_color': '#f5f5f5', 'image_border_large_size': '5px', 'post_margin_bottom': '25px', 'body_background_override': '', 'tabs_margin_side': '30px', 'link_hover_color': '#1a00ff', 'description_text_color': '#666666', 'body_text_color': '#222222', 'content_padding_horizontal': '10px', 'endSide': 'right', 'page_width_selector': '.region-inner', 'date_header_padding': 'inherit', 'post_footer_text_color': '#666666', 'startSide': 'left', 'date_header_color': 'transparent', 'tabs_font': 'normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'post_footer_border_color': '#eeeeee', 'body_font': 'normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'footer_bevel': '0', 'tabs_bevel_border_width': '1px', 'date_header_background_color': 'transparent', 'content_shadow_spread_ie': '10px', 'widget_title_text_color': '#000000', 'header_border_horizontalsize': '0', 'image_border_color': '#ffffff', 'tabs_border_width': '1px', 'content_background_color': '#ffffff', 'link_color': '#121fb3', 'header_text_color': '#666666', 'date_header_letterspacing': 'inherit', 'tabs_margin_top': '0', 'main_padding_top': '30px', 'header_border_size': '0', 'tabs_selected_text_color': '#000000', 'content_background_color_selector': '.content-inner', 'body_background_color': '#f6fbf6', 'widget_alternate_text_color': '#999999'}, 'override': '.content-outer {\n  max-width: 1400px !important;\n}\n\n/* fix header */\n#header-inner {\n  width: 100% !important;\n  background-position: right !important;\n}\n.titlewrapper {\n  padding: 11px 30px 0 !important;\n}\n.descriptionwrapper {\n  margin-bottom: 0 !important;\n}\n.description {\n  font-size: 120% !important;\n}\n\n/* suppress things */\n\n.date-header {\n  display: none;\n}\n#Attribution1 {\n  display: none;\n}\n.post-author, .post-timestamp, .reaction-buttons  {\n  display: none;\n}\n\n/* h2: sidebar titles */\n/* h3: post title */\n\n.post-title , .entry-title {\n  font-size: 180% !important;\n  margin-top: 0 !important;\n}\n\n.entry-title a:link, .entry-title a:visited, .entry-title a:active{\n  color: #a03;\n}\n#main h2 {\ncolor:#333;\nmargin-bottom:.4em;\nmargin-top: 13px;\nfont-size:140%;\n}\n#main h3 {\ncolor:#333;\nmargin-bottom:.4em;\nmargin-top: 13px;\nfont-size:110%;\n}\n#main h4 {\ncolor:#333;\nmargin-bottom:.5em;\n}\n#sidebar-right-1 a:link, #sidebar-right-1 a:visited, #sidebar-right-1 a:active {\n  color: #666;\n}\n#sidebar-right-1 h2 {\n  font-size: 100%;\n  color: #666;\n}\n\n/* disable image box */\nelement.style {\n}\ntable.chargers img {\nheight: 18px;\n}\ntable.chargers img {\nheight: 18px;\n}\n.post-body img, .post-body .tr-caption-container {\npadding: 5px;\n}\n.post-body img, .post-body .tr-caption-container, .Profile img, .Image img, .BlogList .item-thumbnail img {\npadding: 0;\nbackground: #ffffff;\nborder: none;\n-moz-box-shadow: none;\n-webkit-box-shadow: none;\nbox-shadow: none;\n}\n\n/* Special items */\n\na:link img.hilite, a:visited img.hilite {\ncolor: #888;\n}\na:hover img.hilite {\ncolor: #f66;\n}\na:active img.hilite {\ncolor: #33c;\n}\n\npre {color:#000000;border:1px solid #000000;}\npre.repl { background-color:#e0e0f0; font-size:120%;}\npre.arc { background-color:#e0e0f0; font-size:120%;}\npre.code { background-color:#e0f0e0; font-size:120%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;text-wrap:unrestricted;}\ncode { font-size: 120%;}\nblockquote { font-size: 110%; background: transparent url(\42/images/blockquote.gif\42) no-repeat 0 0; margin: 20px 0px; padding: 0px 40px;}\ndiv.cite {font-size: .8em;.; font-style: italic; color: #888; margin-bottom: 9px;}\na.ref { color: gray;vertical-align: super; text-decoration: none; font-size:60%;margin-left: 2px;}\na img.hilite {\nborder: 1px solid;\ncolor: #888;\n}\n\ntable.chargers {\nborder-width: 1px;\nborder-spacing: 2px;\nborder-style: outset;\nborder-color: gray;\nborder-collapse: collapse;\nbackground-color: white;\n}\ntable.chargers th.maker {\npadding-right: 5px;\ntext-align: right;\n}\ntable.chargers th {\nborder-width: 1px;\npadding: 3px;\nborder-style: inset;\nborder-color: gray;\nbackground-color: white;\ntext-align: center;\n}\ntable.chargers img {\nheight: 18px;\n}\ntable.chargers td {\ntext-align: center;\nborder-width: 1px;\npadding: 2px 8px;\nborder-style: inset;\nborder-color: gray;\nbackground-color: white;\n}'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\75classic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\75flipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\75magazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\75mosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\75sidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\75snapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\75timeslide'}}}]);
_WidgetManager._RegisterWidget('_PopularPostsView', new _WidgetInfo('PopularPosts1', 'sidebar-right-1', null, document.getElementById('PopularPosts1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', null, document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AdSenseView', new _WidgetInfo('AdSense1', 'sidebar-right-1', null, document.getElementById('AdSense1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList2', 'sidebar-right-1', null, document.getElementById('LinkList2'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HTMLView', new _WidgetInfo('HTML2', 'sidebar-right-1', null, document.getElementById('HTML2'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', null, document.getElementById('BlogArchive1'), {'languageDirection': 'ltr'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HTMLView', new _WidgetInfo('HTML1', 'sidebar-right-1', null, document.getElementById('HTML1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList1', 'sidebar-right-1', null, document.getElementById('LinkList1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {'attribution': 'Simple template. Powered by \74a href\75\47http://www.blogger.com\47 target\75\47_blank\47\76Blogger\74/a\76.'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false}, 'displayModeFull'));
</script>
</body>
</html>
