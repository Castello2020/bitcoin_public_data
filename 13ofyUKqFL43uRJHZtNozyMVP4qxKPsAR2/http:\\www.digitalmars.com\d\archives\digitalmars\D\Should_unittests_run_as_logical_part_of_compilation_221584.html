http://www.digitalmars.com/d/archives/digitalmars/D/Should_unittests_run_as_logical_part_of_compilation_221584.html
HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 08:16:13 GMT
Server: Apache/2.2.22 (FreeBSD) PHP/5.3.15 with Suhosin-Patch mod_ssl/2.2.22 OpenSSL/0.9.8x DAV/2
Last-Modified: Fri, 04 Jul 2014 21:09:38 GMT
ETag: "185c79-156ae-4fd648b08a880"
Accept-Ranges: bytes
Content-Length: 87726
Connection: close
Content-Type: text/html


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>
digitalmars.D - Should unittests run as logical part of compilation?
</title>
<link rel="stylesheet" type="text/css" href="http://www.digitalmars.com/forum.css" />
<link rel="stylesheet" type="text/css" href="http://www.digitalmars.com/forum-print.css" media="print" />
</head>

<body>
<div id="heading">
<a href="http://www.digitalmars.com/"><img src="http://www.digitalmars.com/dmlogo.gif" BORDER=0 WIDTH=270 HEIGHT=53 ALT="www.digitalmars.com"></a>

  <a href="http://www.digitalmars.com/" title="Digital Mars"><img src="http://www.digitalmars.com/home.png" border=0></a>
&nbsp; <a href="http://www.digitalmars.com/advancedsearch.html" title="Search Digital Mars web site"><img src="http://www.digitalmars.com/search.png" border=0></a>
&nbsp; <a href="http://www.digitalmars.com/NewsGroup.html" title="News Groups"><img src="http://www.digitalmars.com/news.png" border=0></a>
&nbsp; <a href="http://www.digitalmars.com/d/" title="D Programming Language"><img src="http://www.digitalmars.com/d.png" border=0></a>
&nbsp; <a href="http://www.digitalmars.com/download/freecompiler.html" title="C/C++ compilers">C &amp; C++</a>
&nbsp; <a href="http://www.digitalmars.com/dscript/" title="DMDScript">DMDScript</a>

&nbsp;<a href="index.html" title="topic index"><img src="http://www.digitalmars.com/blue-index.png" border=0></a>
<a href="Why_CTFE_is_context-sensitive_221625.html" title="Why CTFE is context-sensitive?"><img src="http://www.digitalmars.com/blue-left.png" border=0></a>
<a href="GUI_Editors_for_D_221565.html" title="GUI Editors for D"><img src="http://www.digitalmars.com/blue-right.png" border=0></a>

</div>
<div id="navigation">

<div class="navblock">
<form method="get" action="http://www.google.com/search">
<div style="text-align:center">
<input id="q" name="q" size="10" value="Search" onFocus='if(this.value == "Search"){this.value="";}'>
<input type="hidden" id="domains" name="domains" value="www.digitalmars.com">
<input type="hidden" id="sitesearch" name="sitesearch" value="www.digitalmars.com/d/archives">
<input type="hidden" id="sourceid" name="sourceid" value="google-search">
<input type="submit" id="submit" name="submit" value="Go">
</div>
</form>
</div>

<div class="navblock">
<h2>D Programming</h2>
<ul>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D">digitalmars.D</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/bugs">digitalmars.D.bugs</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/dtl">digitalmars.D.dtl</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/ide">digitalmars.D.ide</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/dwt">digitalmars.D.dwt</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/announce">digitalmars.D.announce</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/learn">digitalmars.D.learn</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/D/debugger">digitalmars.D.debugger</a></li>
<li><a href="http://www.digitalmars.com/d/archives/D/gnu">D.gnu</a></li>
<li><a href="http://www.digitalmars.com/d/archives/">D</a></li>
</ul>
</div>

<div class="navblock">
<h2>C/C++ Programming</h2>
<ul>
<li><a href="http://www.digitalmars.com/d/archives/c++">c++</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/announce">c++.announce</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/atl">c++.atl</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/beta">c++.beta</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/chat">c++.chat</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/command-line">c++.command-line</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/dos">c++.dos</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/dos/16-bits">c++.dos.16-bits</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/dos/32-bits">c++.dos.32-bits</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/idde">c++.idde</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/mfc">c++.mfc</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/rtl">c++.rtl</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/stl">c++.stl</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/stl/hp">c++.stl.hp</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/stl/port">c++.stl.port</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/stl/sgi">c++.stl.sgi</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/stlsoft">c++.stlsoft</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/windows">c++.windows</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/windows/16-bits">c++.windows.16-bits</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/windows/32-bits">c++.windows.32-bits</a></li>
<li><a href="http://www.digitalmars.com/d/archives/c++/wxwindows">c++.wxwindows</a></li>
</ul>
</div>

<div class="navblock">
<h2>Other</h2>
<ul>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/empire">digitalmars.empire</a></li>
<li><a href="http://www.digitalmars.com/d/archives/digitalmars/DMDScript">digitalmars.DMDScript</a></li>
<li><a href="http://www.digitalmars.com/d/archives/electronics">electronics</a></li>
</ul>
</div>

<div class="navblock">
<script type="text/javascript"><!--
google_ad_client = "pub-5628673096434613";
google_ad_width = 120;
google_ad_height = 90;
google_ad_format = "120x90_0ads_al_s";
google_ad_channel ="7651800615";
google_color_border = "336699";
google_color_bg = "C6C8EB";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

<hr>
<script src="http://www.gmodules.com/ig/ifr?url=http://www.google.com/ig/modules/translatemypage.xml&up_source_language=en&w=160&h=60&title=&border=&output=js"></script>
</div>

</div>
<div id="sidebar">
<!-- Google ad -->
<script type="text/javascript"><!--
google_ad_client = "pub-5628673096434613";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_channel ="7651800615";
google_page_url = document.location;
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div id="content">

<h2>digitalmars.D - Should unittests run as logical part of compilation?</h2>
<div id="PostingTOC">
<ul>
<li>
<a href="#N221584">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 25 2014
</li>
<ul>
<li>
<a href="#N221586">
"deadalnix" &lt;deadalnix gmail.com&gt;</a>
 Jan 25 2014
</li>
<li>
<a href="#N221588">
"Jakob Ovrum" &lt;jakobovrum gmail.com&gt;</a>
 Jan 25 2014
</li>
<li>
<a href="#N221589">
Johannes Pfau &lt;nospam example.com&gt;</a>
 Jan 25 2014
</li>
<li>
<a href="#N221590">
"bearophile" &lt;bearophileHUGS lycos.com&gt;</a>
 Jan 25 2014
</li>
<li>
<a href="#N221592">
"Mike" &lt;none none.com&gt;</a>
 Jan 25 2014
</li>
<ul>
<li>
<a href="#N221664">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221606">
"Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt;</a>
 Jan 25 2014
</li>
<ul>
<li>
<a href="#N221635">
Jacob Carlborg &lt;doob me.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221665">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221608">
"Rikki Cattermole" &lt;alphaglosined gmail.com&gt;</a>
 Jan 25 2014
</li>
<ul>
<li>
<a href="#N221636">
Jacob Carlborg &lt;doob me.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221666">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221667">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221611">
"H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt;</a>
 Jan 25 2014
</li>
<li>
<a href="#N221624">
"anonymous" &lt;anonymous example.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221626">
"simendsjo" &lt;simendsjo gmail.com&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221668">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221627">
"Dicebot" &lt;public dicebot.lv&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221637">
"Idan Arye" &lt;GenericNPC gmail.com&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221669">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221676">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221696">
Alix Pexton &lt;alix.DOT.pexton gmail.DOT.com&gt;</a>
 Jan 27 2014
</li>
<ul>
<li>
<a href="#N221730">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 27 2014
</li>
</ul>
<li>
<a href="#N221726">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 27 2014
</li>
</ul>
</ul>
</ul>
<li>
<a href="#N221651">
"Steven Schveighoffer" &lt;schveiguy yahoo.com&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221670">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221652">
"Gary Willoughby" &lt;dev nomad.so&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221672">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
</ul>
<li>
<a href="#N221659">
Ary Borenszweig &lt;ary esperanto.org.ar&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221673">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 26 2014
</li>
<ul>
<li>
<a href="#N221698">
Ary Borenszweig &lt;ary esperanto.org.ar&gt;</a>
 Jan 27 2014
</li>
<ul>
<li>
<a href="#N221731">
Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;</a>
 Jan 27 2014
</li>
</ul>
</ul>
</ul>
<li>
<a href="#N221660">
=?UTF-8?B?U2ltZW4gS2rDpnLDpXM=?= &lt;simen.kjaras gmail.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221671">
"Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221675">
"Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221678">
"H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221679">
"H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221682">
Knud Soerensen &lt;4tuu4k002 sneakemail.com&gt;</a>
 Jan 26 2014
</li>
<li>
<a href="#N221684">
"Atila Neves" &lt;atila.neves gmail.com&gt;</a>
 Jan 27 2014
</li>
<li>
<a href="#N221685">
"Atila Neves" &lt;atila.neves gmail.com&gt;</a>
 Jan 27 2014
</li>
<li>
<a href="#N221701">
"Idan Arye" &lt;GenericNPC gmail.com&gt;</a>
 Jan 27 2014
</li>
<li>
<a href="#N221710">
=?windows-1252?Q?Simen_Kj=E6r=E5s?= &lt;simen.kjaras gmail.com&gt;</a>
 Jan 27 2014
</li>
<li>
<a href="#N221714">
"Dicebot" &lt;public dicebot.lv&gt;</a>
 Jan 27 2014
</li>
</ul>
</ul>
</div>
<div id="Posting"><div id="PostingHeading"><a name="N221584"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <img src="http://www.digitalmars.com/grey-left.png" border=0> <a href="#N221586"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221584"> writes</a>:</a></div>
<pre class="PostingBody">
There's this simple realization that unittests could (should?) be 
considered an intrinsic part of the build process. In order for an 
executable to be worth running, it should pass the regular semantic 
checks and also the unittests, which in a sense are extended semantic 
checks that fall outside the traditional charter of the compiler.

In that view, asserts inside unittests should fail with the same message 
format as regular compilation errors, i.e.

./modulename.d(103): Unittest failed: user-defined message

Stack traces and other artifacts printed by failing asserts should come 
after, indented. An IDE user should run unittest with the usual "build" 
command and be able to click on the unittest failures just the same as 
build errors.

In particular, this view of unittests declares our current stance on 
running unittests ("run unittests just before main()") as meaningless. 
Indeed that has bothered me for quite a while - unittests are part of 
the build/acceptance, not part of every run. To wit, this is a growing 
idiom in D programs:

version(unittest) void main() {}
else void main()
{
     ...
}

What do you think? Logistically it shouldn't be too hard to arrange 
things to cater to this approach.


Andrei
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221586"><img src="http://www.digitalmars.com/grey-up.png" border=0> <a href="#N221588"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "deadalnix" &lt;deadalnix gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221586"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the 
 same message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message

 Stack traces and other artifacts printed by failing asserts 
 should come after, indented. An IDE user should run unittest 
 with the usual "build" command and be able to click on the 
 unittest failures just the same as build errors.

 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }

 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.


 Andrei
</pre><br>
+1, unittest passed as command line argument to dmd should run 
unittests as compilation step and main should remain untouched.
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221588"><a href="#N221586"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221589"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Jakob Ovrum" &lt;jakobovrum gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221588"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }
</pre><br>
This idiom is probably mostly obsolete now that we have the -main 
flag. An IDE can build with -unittest -main -run and exclude the 
source file that normally defines `main`.

<pre class="PostingQuote">
 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.
</pre><br>
I like it, as long as it doesn't mean unit tests are enabled by 
default, as that would probably be very surprising both for 
building release binaries and from a security perspective.
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221589"><a href="#N221588"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221590"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Johannes Pfau &lt;nospam example.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221589"> writes</a>:</a></div>
<pre class="PostingBody">
Am Sat, 25 Jan 2014 14:55:30 -0800
schrieb Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt;:

<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be 
 considered an intrinsic part of the build process. In order for an 
 executable to be worth running, it should pass the regular semantic 
 checks and also the unittests, which in a sense are extended semantic 
 checks that fall outside the traditional charter of the compiler.
 
 [....]
 
 Andrei
</pre><br>
But please keep some way to manually run unittests - otherwise cross
compilers will have lots of fun running unittests ;-)

(IMHO this is the responsibility of a build tool, not of the compiler)
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221590"><a href="#N221589"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221592"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "bearophile" &lt;bearophileHUGS lycos.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221590"> writes</a>:</a></div>
<pre class="PostingBody">
Andrei Alexandrescu:

<pre class="PostingQuote">
 version(unittest) void main() {}
 else void main()
 {
     ...
 }
</pre><br>
This is an example of bit a more general need: in D I'd like to 
create modules that can be imported from other modules to use 
their functionality; and to run their own main() when they are 
not imported from other modules. It's a simple feature that is 
still missing in D.

Bye,
bearophile
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221592"><a href="#N221590"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221606"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221664"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Mike" &lt;none none.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221592"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.
 [...]
 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.
</pre><br>
How does this work for those who build on one machine and test on 
another?  I'm currently building on a Linux host, and deploying 
to a bare-metal ARM Cortex-M processor.  Also, with limited 
amounts of flash, I may only have enough room for unit tests or 
my program, but not both.  (Just so you know, I don't actually 
use the unit test feature yet, but I intend to)

This seems more like a workflow feature rather than a build 
feature.  But integration into the toolchain could be pretty cool 
(like you said, clicking on a messages in the output window, and 
zooming right to the point of failure).

It seems to me that having an additional tool in the tool chain 
(the unit tester) along with the compiler, linker, debugger, 
etc.. that could be initiated by the build process, is the way to 
go.  If compiling unit tests, the build process could generate a 
unit test executable, run the unit test executable, and, assuming 
all tests pass, then generate the production executable.  I think 
such a tool could scale to my platform, somehow, I suppose.

Mike
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221664"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221592"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221664"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/25/14 4:26 PM, Mike wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
 [...]
 What do you think? Logistically it shouldn't be too hard to arrange
 things to cater to this approach.
</pre><br>
 How does this work for those who build on one machine and test on
 another?
</pre><br>
Yah, thanks (and Johannes too) for making this point. That means we 
should not prevent the option of running them separately.

<pre class="PostingQuote">
 This seems more like a workflow feature rather than a build feature.
 But integration into the toolchain could be pretty cool (like you said,
 clicking on a messages in the output window, and zooming right to the
 point of failure).
</pre><br>
That is correct - an build environment thing.


Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221606"><a href="#N221592"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221608"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221635"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221606"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the 
 same message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message
</pre><br>
I already attempt to get unittests to fail at compile time by 
using static assert. I think running it during compilation would 
be a great change. Though cross compiling is a valid concern and 
should be addressed.

Many are use to the notion that unittest are separate from 
compilation, I think this is only due to familiarity. Other than 
the cross-compile issue, I believe moving it closer to the time 
of compilation is the correct direction, but it will get distaste 
from those familiar with JUnit/NUnit and other unittesting 
frameworks just as it currently does.
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221635"><img src="http://www.digitalmars.com/grey-up.png" border=0> <a href="#N221665"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221606"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Jacob Carlborg &lt;doob me.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221635"> writes</a>:</a></div>
<pre class="PostingBody">
On 2014-01-26 04:52, Jesse Phillips wrote:

<pre class="PostingQuote">
 I already attempt to get unittests to fail at compile time by using
 static assert. I think running it during compilation would be a great
 change. Though cross compiling is a valid concern and should be addressed.
</pre><br>
It's already possible to do CTFE unit tests:

<a href="http://forum.dlang.org/thread/ks1brj">http://forum.dlang.org/thread/ks1brj</a>$1l6c$1 digitalmars.com

-- 
/Jacob Carlborg
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221665"><a href="#N221635"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221606"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221665"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/25/14 7:52 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the same
 message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message
</pre><br>
 I already attempt to get unittests to fail at compile time by using
 static assert. I think running it during compilation would be a great
 change.
</pre><br>
That's great but I wasn't thinking of CTFEing unittests as much as just 
running them right after building.

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221608"><a href="#N221606"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221611"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221636"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Rikki Cattermole" &lt;alphaglosined gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221608"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 ./modulename.d(103): Unittest failed: user-defined message
</pre><br>
be invaluable to doing this without adding this specific 
behaviour. (Really should deal with that.)

<pre class="PostingQuote">
 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:
</pre><br>
runtime would be useful. Because what happens when you need to 
test e.g. an OS feature with it? Or have a dependency that simply 
cannot run at compile time?

I'm all for being able to selectively run unittests and having 
the ability to have some run at compile time.
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221636"><img src="http://www.digitalmars.com/grey-up.png" border=0> <a href="#N221666"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221608"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Jacob Carlborg &lt;doob me.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221636"> writes</a>:</a></div>
<pre class="PostingBody">
On 2014-01-26 05:29, Rikki Cattermole wrote:

<pre class="PostingQuote">
 I'm all for being able to selectively run unittests and having the
 ability to have some run at compile time.
</pre><br>
That's already possible: 
<a href="http://forum.dlang.org/thread/ks1brj">http://forum.dlang.org/thread/ks1brj</a>$1l6c$1 digitalmars.com

-- 
/Jacob Carlborg
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221666"><a href="#N221636"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221667"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221608"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221666"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/25/14 8:29 PM, Rikki Cattermole wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 ./modulename.d(103): Unittest failed: user-defined message
</pre><br>
 invaluable to doing this without adding this specific behaviour. (Really
 should deal with that.)
</pre><br>
What about static assert(false, "message")?

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221667"><a href="#N221666"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221608"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221667"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 3:20 AM, anonymous wrote:
<pre class="PostingQuote">
 On Sunday, 26 January 2014 at 05:17:15 UTC, H. S. Teoh wrote:
<pre class="PostingQuote">
 On Sun, Jan 26, 2014 at 04:29:10AM +0000, Rikki Cattermole wrote:
<pre class="PostingQuote">
 Having the ability to run unittests at both compile time and runtime
 would be useful. Because what happens when you need to test e.g. an
 OS feature with it? Or have a dependency that simply cannot run at
 compile time?

 I'm all for being able to selectively run unittests and having the
 ability to have some run at compile time.
</pre><br>
 +1. Some of my unittests can only be run at runtime: like testing file
 I/O.  Obviously, other unittests can also be run at compile-time, so
 it's useful to have both.
</pre><br>
 I don't think the tests are supposed to be CTFE'd. They'd be
 compiled (to a temporary executable?) and then run normally.
</pre><br>
Yah, that was my idea.

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221611"><a href="#N221608"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221624"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221611"> writes</a>:</a></div>
<pre class="PostingBody">
On Sun, Jan 26, 2014 at 04:29:10AM +0000, Rikki Cattermole wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu
 wrote:
</pre><br>
<pre class="PostingQuote">
<pre class="PostingQuote">
In particular, this view of unittests declares our current stance
on running unittests ("run unittests just before main()") as
meaningless. Indeed that has bothered me for quite a while -
unittests are part of the build/acceptance, not part of every run.
To wit, this is a growing idiom in D programs:
</pre><br>
 Having the ability to run unittests at both compile time and runtime
 would be useful. Because what happens when you need to test e.g. an
 OS feature with it? Or have a dependency that simply cannot run at
 compile time?
 
 I'm all for being able to selectively run unittests and having the
 ability to have some run at compile time.
</pre><br>
+1. Some of my unittests can only be run at runtime: like testing file
I/O.  Obviously, other unittests can also be run at compile-time, so
it's useful to have both.


T

-- 
Кто везде - тот нигде.
</pre>
<div id="PostingFooting"> Jan 25 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221624"><a href="#N221611"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221626"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "anonymous" &lt;anonymous example.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221624"> writes</a>:</a></div>
<pre class="PostingBody">
On Sunday, 26 January 2014 at 05:17:15 UTC, H. S. Teoh wrote:
<pre class="PostingQuote">
 On Sun, Jan 26, 2014 at 04:29:10AM +0000, Rikki Cattermole 
 wrote:
<pre class="PostingQuote">
 Having the ability to run unittests at both compile time and 
 runtime
 would be useful. Because what happens when you need to test 
 e.g. an
 OS feature with it? Or have a dependency that simply cannot 
 run at
 compile time?
 
 I'm all for being able to selectively run unittests and having 
 the
 ability to have some run at compile time.
</pre><br>
 +1. Some of my unittests can only be run at runtime: like 
 testing file
 I/O.  Obviously, other unittests can also be run at 
 compile-time, so
 it's useful to have both.
</pre><br>
I don't think the tests are supposed to be CTFE'd. They'd be
compiled (to a temporary executable?) and then run normally.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221626"><a href="#N221624"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221627"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221668"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "simendsjo" &lt;simendsjo gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221626"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process.
</pre><br>

<pre class="PostingQuote">
 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless.
</pre><br>

I wouldn't mind having unittests be a part of the compilation 
process, but I really don't think "running before main" is 
useless.
This lets me compile a version on my desktop and push the binary 
to a small VPS staging for running runtime tests. Compiling any 
non-trivial code on 512MB with the DMD frontend is impossible. I 
can also send a fully working application with unittests to a 
client as a beta before giving a production version.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221668"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221626"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221668"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 3:25 AM, simendsjo wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process.
</pre><br>

<pre class="PostingQuote">
 In particular, this view of unittests declares our current stance on
 running unittests ("run unittests just before main()") as meaningless.
</pre><br>

 I wouldn't mind having unittests be a part of the compilation process,
 but I really don't think "running before main" is useless.
 This lets me compile a version on my desktop and push the binary to a
 small VPS staging for running runtime tests. Compiling any non-trivial
 code on 512MB with the DMD frontend is impossible. I can also send a
 fully working application with unittests to a client as a beta before
 giving a production version.
</pre><br>
Does it help that the client runs them every time? I.e. does the n+1th 
run of the unittests bring more information than the first?

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221627"><a href="#N221626"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221637"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Dicebot" &lt;public dicebot.lv&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221627"> writes</a>:</a></div>
<pre class="PostingBody">
On Sunday, 26 January 2014 at 11:25:25 UTC, simendsjo wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei 
 Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process.
</pre><br>

<pre class="PostingQuote">
 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless.
</pre><br>

 I wouldn't mind having unittests be a part of the compilation 
 process, but I really don't think "running before main" is 
 useless.
 This lets me compile a version on my desktop and push the 
 binary to a small VPS staging for running runtime tests. 
 Compiling any non-trivial code on 512MB with the DMD frontend 
 is impossible. I can also send a fully working application with 
 unittests to a client as a beta before giving a production 
 version.
</pre><br>
I simply think that "-unittest" should not emit any existing 
"main" function by default (only stub one if --main is set) and 
other than that we are pretty good at current stage. Running 
tests is necessary part of build system indeed but dmd is not a 
build system and should not force any assumptions about it.

Initial idea to make tests always run before the program starts 
does not work though, that is true. But currently we have enough 
tools to do it in any way specific project needs.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221637"><a href="#N221627"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221651"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221669"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Idan Arye" &lt;GenericNPC gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221637"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the 
 same message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message

 Stack traces and other artifacts printed by failing asserts 
 should come after, indented. An IDE user should run unittest 
 with the usual "build" command and be able to click on the 
 unittest failures just the same as build errors.

 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }

 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.


 Andrei
</pre><br>
I don't think unit tests should be run on *each* build - if I'm 
fidgeting with a specific piece of my code, and building&amp;running 
it after each change, I don't want to waste time running the 
unittests of the entire project.

I do agree that unittests shouldn't be part of each run though. I 
think the `-unittest` flag should ignore the `main` function 
altogether, creating a unittests only executable, and the build 
system will be responsible for running it.

How about keeping the old behavior of `-unittest` for backward 
compatibility, and having a new syntax - `-unittest=filename`, 
where "filename" is the name of the unittests executable. That 
way both the unittest and the regular executables will be created 
at the same time - which will speed things up, as most of the 
compilation work can be shared between those two builds - and 
have different file names, so the build system - which will make 
configuring the build system more straightforward.

If we make the unittest a separate executable, there won't be a 
`main` function waiting for command line arguments, so we can use 
the command line arguments for the unittests. We can have flags 
for only running tests of specific packages, or for running the 
tests under certain restrictions etc.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221669"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221637"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221676"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221669"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 4:58 AM, Idan Arye wrote:
<pre class="PostingQuote">
 I don't think unit tests should be run on *each* build - if I'm
 fidgeting with a specific piece of my code, and building&amp;running it
 after each change, I don't want to waste time running the unittests of
 the entire project.
</pre><br>
Hah, interesting. So unittests of one module should run again iff there 
were changes in that module or other modules that that depends on.

<pre class="PostingQuote">
 How about keeping the old behavior of `-unittest` for backward
 compatibility, and having a new syntax - `-unittest=filename`, where
 "filename" is the name of the unittests executable.
</pre><br>
Sounds interesting.

<pre class="PostingQuote">
 That way both the
 unittest and the regular executables will be created at the same time -
 which will speed things up, as most of the compilation work can be
 shared between those two builds - and have different file names, so the
 build system - which will make configuring the build system more
 straightforward.
</pre><br>
Yeppers. One other thought I had was to define a special flag e.g. 
--4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".

<pre class="PostingQuote">
 If we make the unittest a separate executable, there won't be a `main`
 function waiting for command line arguments, so we can use the command
 line arguments for the unittests. We can have flags for only running
 tests of specific packages, or for running the tests under certain
 restrictions etc.
</pre><br>
There we go :o).


Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221676"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221669"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221696"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221676"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special flag e.g.
 --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".
</pre><br>
 I really think it would be better to use
 --4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the intent
 clearer.
</pre><br>
I'm just saying it should not clash with any application argument.

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221696"><img src="http://www.digitalmars.com/grey-up.png" border=0> <a href="#N221726"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221676"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221730"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Alix Pexton &lt;alix.DOT.pexton gmail.DOT.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221696"> writes</a>:</a></div>
<pre class="PostingBody">
On 27/01/2014 4:15 AM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special flag e.g.
 --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".
</pre><br>
 I really think it would be better to use
 --4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the intent
 clearer.
</pre><br>
 I'm just saying it should not clash with any application argument.

 Andrei
</pre><br>
Hows about making it so that unittests are only run if the executable 
name has a "_ut" suffix, or some other special name/convention?

A...

---
This email is free from viruses and malware because avast! Antivirus protection
is active.
<a href="http://www.avast.com">http://www.avast.com</a>
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221730"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221696"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221730"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/27/14 3:10 AM, Alix Pexton wrote:
<pre class="PostingQuote">
 On 27/01/2014 4:15 AM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special flag e.g.
 --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".
</pre><br>
 I really think it would be better to use
 --4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the intent
 clearer.
</pre><br>
 I'm just saying it should not clash with any application argument.

 Andrei
</pre><br>
 Hows about making it so that unittests are only run if the executable
 name has a "_ut" suffix, or some other special name/convention?

 A...
</pre><br>
Something like that would work nicely with a build system - the 
executable name has a specific suffix and is promoted to the 
non-unittest suffix once it has passed unittests.

Andrei
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221726"><a href="#N221696"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221676"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221726"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 10:08 PM, H. S. Teoh wrote:
<pre class="PostingQuote">
 On Sun, Jan 26, 2014 at 08:15:23PM -0800, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special flag e.g.
 --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".
</pre><br>
 I really think it would be better to use
 --4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the intent
 clearer.
</pre><br>
 I'm just saying it should not clash with any application argument.
</pre><br>

 That won't work if the application is a git client looking for an SHA
 hash argument...
</pre><br>
Of course it works unless there's a clash with this particular SHA.

<pre class="PostingQuote">
 Let's not add arbitrary things like this to D programs, it doesn't
 address the issue and only introduces needless special cases.
</pre><br>
I don't see that a special case. The only idea here is to produce one 
single debug executable containing unittests and running them on demand 
(e.g. by the build system).



Andrei
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221651"><a href="#N221637"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221652"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221670"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Steven Schveighoffer" &lt;schveiguy yahoo.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221651"> writes</a>:</a></div>
<pre class="PostingBody">
On Sat, 25 Jan 2014 17:55:30 -0500, Andrei Alexandrescu  
&lt;SeeWebsiteForEmail erdani.org&gt; wrote:

<pre class="PostingQuote">
 What do you think? Logistically it shouldn't be too hard to arrange  
 things to cater to this approach.
</pre><br>
After reading other opinions, this is what I think:

1. unit tests should be built as a separate binary. So when you build foo  
with -unittest, you get foo_unittest in addition to foo.
2. If you want to run unit tests, run foo_unittest. If you want simply the  
program, run foo.

I don't see a huge need for having unit tests run before the normal  
program. But maybe we should add a switch to make that work.

Building and running it as part of compilation seems like an incorrect  
function of the compiler. This is best left to an IDE/build script. Also,  
building unit tests still needs to be opt-in. Some projects can take a  
long time to build unit tests (dcollections takes about 20x longer to  
compile unit tests, last time I checked), and a quick compile-test-debug  
cycle is a key feature of D.

-Steve
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221670"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221651"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221670"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 12:43 PM, Steven Schveighoffer wrote:
<pre class="PostingQuote">
 On Sat, 25 Jan 2014 17:55:30 -0500, Andrei Alexandrescu
 &lt;SeeWebsiteForEmail erdani.org&gt; wrote:

<pre class="PostingQuote">
 What do you think? Logistically it shouldn't be too hard to arrange
 things to cater to this approach.
</pre><br>
 After reading other opinions, this is what I think:

 1. unit tests should be built as a separate binary. So when you build
 foo with -unittest, you get foo_unittest in addition to foo.
 2. If you want to run unit tests, run foo_unittest. If you want simply
 the program, run foo.
</pre><br>
Makes sense, though we could massage the unittests into the executable.

<pre class="PostingQuote">
 I don't see a huge need for having unit tests run before the normal
 program. But maybe we should add a switch to make that work.
</pre><br>
Guess we'd need to keep things running as they do for backwards 
compatibility.

<pre class="PostingQuote">
 Building and running it as part of compilation seems like an incorrect
 function of the compiler. This is best left to an IDE/build script.
 Also, building unit tests still needs to be opt-in. Some projects can
 take a long time to build unit tests (dcollections takes about 20x
 longer to compile unit tests, last time I checked), and a quick
 compile-test-debug cycle is a key feature of D.
</pre><br>
Yah it should be all nicely controllable by the build system.


Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221652"><a href="#N221651"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221659"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221672"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> "Gary Willoughby" &lt;dev nomad.so&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221652"> writes</a>:</a></div>
<pre class="PostingBody">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the 
 same message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message

 Stack traces and other artifacts printed by failing asserts 
 should come after, indented. An IDE user should run unittest 
 with the usual "build" command and be able to click on the 
 unittest failures just the same as build errors.

 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }

 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.


 Andrei
</pre><br>
I don't fully understand this. Are you proposing to disconnect 
running unittest and evoking main? So unittests can be compiled 
and run without actually running the program?

If this is the case then yes it would be nice to be able to do 
this but i would also recommend keeping the current behaviour of 
invoking main after the unittests have run, purely because 
developers (myself included) like to run the application often in 
debug/unittest mode during development.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221672"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221652"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221672"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 1:04 PM, Gary Willoughby wrote:
<pre class="PostingQuote">
 I don't fully understand this. Are you proposing to disconnect running
 unittest and evoking main? So unittests can be compiled and run without
 actually running the program?
</pre><br>
Right.

<pre class="PostingQuote">
 If this is the case then yes it would be nice to be able to do this but
 i would also recommend keeping the current behaviour of invoking main
 after the unittests have run, purely because developers (myself
 included) like to run the application often in debug/unittest mode
 during development.
</pre><br>
We'd need to preserve backward compatibility.


Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221659"><a href="#N221652"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221660"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221673"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Ary Borenszweig &lt;ary esperanto.org.ar&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221659"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/25/14, 7:55 PM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
</pre><br>
I can imagine someone who discovered a bug late at night, has a fix and 
needs to upload the new executable as soon as possible: he quickly 
comments all failing unit tests to make them pass. The next morning he 
uncomments them and fixes them with tranquility.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221673"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221659"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221698"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221673"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/26/14 5:36 PM, Ary Borenszweig wrote:
<pre class="PostingQuote">
 On 1/25/14, 7:55 PM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
</pre><br>
 I can imagine someone who discovered a bug late at night, has a fix and
 needs to upload the new executable as soon as possible: he quickly
 comments all failing unit tests to make them pass. The next morning he
 uncomments them and fixes them with tranquility.
</pre><br>
The point being?

Andrei
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221698"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221673"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <a href="#N221731"><img src="http://www.digitalmars.com/blue-right.png" border=0 alt="reply"></a> Ary Borenszweig &lt;ary esperanto.org.ar&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221698"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/27/14, 1:04 AM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 5:36 PM, Ary Borenszweig wrote:
<pre class="PostingQuote">
 On 1/25/14, 7:55 PM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
</pre><br>
 I can imagine someone who discovered a bug late at night, has a fix and
 needs to upload the new executable as soon as possible: he quickly
 comments all failing unit tests to make them pass. The next morning he
 uncomments them and fixes them with tranquility.
</pre><br>
 The point being?

 Andrei
</pre><br>
That it's annoying if you can't build an executable because some tests 
fail. Sometimes you know tests fail but you didn't have time to fix them 
(but you did fix the code).
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221731"><img src="http://www.digitalmars.com/grey-up.png" border=0> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221698"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Andrei Alexandrescu &lt;SeeWebsiteForEmail erdani.org&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221731"> writes</a>:</a></div>
<pre class="PostingBody">
On 1/27/14 3:39 AM, Ary Borenszweig wrote:
<pre class="PostingQuote">
 On 1/27/14, 1:04 AM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 5:36 PM, Ary Borenszweig wrote:
<pre class="PostingQuote">
 On 1/25/14, 7:55 PM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
</pre><br>
 I can imagine someone who discovered a bug late at night, has a fix and
 needs to upload the new executable as soon as possible: he quickly
 comments all failing unit tests to make them pass. The next morning he
 uncomments them and fixes them with tranquility.
</pre><br>
 The point being?

 Andrei
</pre><br>
 That it's annoying if you can't build an executable because some tests
 fail. Sometimes you know tests fail but you didn't have time to fix them
 (but you did fix the code).
</pre><br>
Got it, thanks.

Andrei
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221660"><a href="#N221659"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221671"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> =?UTF-8?B?U2ltZW4gS2rDpnLDpXM=?= &lt;simen.kjaras gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221660"> writes</a>:</a></div>
<pre class="PostingBody">
On 2014-01-25 23:06, Jakob Ovrum wrote:
<pre class="PostingQuote">
 On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 In particular, this view of unittests declares our current stance on
 running unittests ("run unittests just before main()") as meaningless.
 Indeed that has bothered me for quite a while - unittests are part of
 the build/acceptance, not part of every run. To wit, this is a growing
 idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }
</pre><br>
 This idiom is probably mostly obsolete now that we have the -main flag.
 An IDE can build with -unittest -main -run and exclude the source file
 that normally defines `main`.
</pre><br>
Except that would exclude any unit tests in the module that defines main.

Of course, if you want to be evil, you could even write unit tests for main:

int main() {
     return 3;
} unittest {
     assert(main() == 3);
}

--
   Simen
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221671"><a href="#N221660"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221675"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221671"> writes</a>:</a></div>
<pre class="PostingBody">
On Monday, 27 January 2014 at 03:45:00 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 On 1/25/14 7:52 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 I already attempt to get unittests to fail at compile time by 
 using
 static assert. I think running it during compilation would be 
 a great
 change.
</pre><br>
 That's great but I wasn't thinking of CTFEing unittests as much 
 as just running them right after building.

 Andrei
</pre><br>
I'm aware of that, my point being that I'm already trying to get 
them to run as frequently as possible.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221675"><a href="#N221671"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221678"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Jesse Phillips" &lt;Jesse.K.Phillips+D gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221675"> writes</a>:</a></div>
<pre class="PostingBody">
On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special flag 
 e.g. --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run 
 unittests".
</pre><br>
I really think it would be better to use 
--4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the 
intent clearer.
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221678"><a href="#N221675"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221679"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221678"> writes</a>:</a></div>
<pre class="PostingBody">
On Sun, Jan 26, 2014 at 07:53:30PM -0800, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 3:25 AM, simendsjo wrote:
<pre class="PostingQuote">
On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
There's this simple realization that unittests could (should?) be
considered an intrinsic part of the build process.
</pre><br>

<pre class="PostingQuote">
In particular, this view of unittests declares our current stance on
running unittests ("run unittests just before main()") as
meaningless.
</pre><br>

I wouldn't mind having unittests be a part of the compilation
process, but I really don't think "running before main" is useless.
This lets me compile a version on my desktop and push the binary to a
small VPS staging for running runtime tests. Compiling any
non-trivial code on 512MB with the DMD frontend is impossible. I can
also send a fully working application with unittests to a client as a
beta before giving a production version.
</pre><br>
 Does it help that the client runs them every time? I.e. does the n+1th
 run of the unittests bring more information than the first?
</pre><br>

It's very useful when you're in a code-compile-run development cycle,
when you're likely to be making some further changes after every
execution. Any regressions are quickly caught by unittests.

Obviously, it's useless to run the same unittests twice when nothing has
changed, but then, I thought the idea was that you *don't* compile with
-unittest when shipping the executable.


T

-- 
Once the bikeshed is up for painting, the rainbow won't suffice. -- Andrei
Alexandrescu
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221679"><a href="#N221678"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221682"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "H. S. Teoh" &lt;hsteoh quickfur.ath.cx&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221679"> writes</a>:</a></div>
<pre class="PostingBody">
On Sun, Jan 26, 2014 at 08:15:23PM -0800, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
On Monday, 27 January 2014 at 03:58:54 UTC, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
Yeppers. One other thought I had was to define a special flag e.g.
--4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run unittests".
</pre><br>
I really think it would be better to use
--4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the intent
clearer.
</pre><br>
 I'm just saying it should not clash with any application argument.
</pre><br>

That won't work if the application is a git client looking for an SHA
hash argument...

Let's not add arbitrary things like this to D programs, it doesn't
address the issue and only introduces needless special cases.


T

-- 
"Hi." "'Lo."
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221682"><a href="#N221679"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221684"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> Knud Soerensen &lt;4tuu4k002 sneakemail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221682"> writes</a>:</a></div>
<pre class="PostingBody">
I am already doing something very similar.

When I make a module I add this to the top.
#!/usr/bin/rdmd --shebang -unittest --main
(I would like to add -cov=100 but I can't get it to work)
Then I just run the module to compile and run unit tests.

My programs with main is always very small,
typical calling a module function with the arguments.

Doing the unit testing in the end of the compile would
mean that we could ensure that dependencies  was unit testing before
use. That would be nice.

Another thing I find really tedious about D unit testing can you read
about here.

<a href="http://forum.dlang.org/post/lc514a">http://forum.dlang.org/post/lc514a</a>$sd7$1 digitalmars.com

Knud



On 2014-01-25 23:55, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) be
 considered an intrinsic part of the build process. In order for an
 executable to be worth running, it should pass the regular semantic
 checks and also the unittests, which in a sense are extended semantic
 checks that fall outside the traditional charter of the compiler.
 
 In that view, asserts inside unittests should fail with the same message
 format as regular compilation errors, i.e.
 
 ./modulename.d(103): Unittest failed: user-defined message
 
 Stack traces and other artifacts printed by failing asserts should come
 after, indented. An IDE user should run unittest with the usual "build"
 command and be able to click on the unittest failures just the same as
 build errors.
 
 In particular, this view of unittests declares our current stance on
 running unittests ("run unittests just before main()") as meaningless.
 Indeed that has bothered me for quite a while - unittests are part of
 the build/acceptance, not part of every run. To wit, this is a growing
 idiom in D programs:
 
 version(unittest) void main() {}
 else void main()
 {
     ...
 }
 
 What do you think? Logistically it shouldn't be too hard to arrange
 things to cater to this approach.
 
 
 Andrei
</pre><br>

-- 
Join me on
Skype	   knudhs
Facebook   <a href="http://www.facebook.com/profile.php?id=1198821880">http://www.facebook.com/profile.php?id=1198821880</a>
Linkedin   <a href="http://www.linkedin.com/pub/0/117/a54">http://www.linkedin.com/pub/0/117/a54</a>
Twitter    <a href="http://twitter.com/knudsoerensen">http://twitter.com/knudsoerensen</a>
bitcoin donations: 13ofyUKqFL43uRJHZtNozyMVP4qxKPsAR2
</pre>
<div id="PostingFooting"> Jan 26 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221684"><a href="#N221682"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221685"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Atila Neves" &lt;atila.neves gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221684"> writes</a>:</a></div>
<pre class="PostingBody">
I share the opinion others have expressed here that running unit 
tests should be the responsability of the build system.

Atila

On Saturday, 25 January 2014 at 22:55:33 UTC, Andrei Alexandrescu 
wrote:
<pre class="PostingQuote">
 There's this simple realization that unittests could (should?) 
 be considered an intrinsic part of the build process. In order 
 for an executable to be worth running, it should pass the 
 regular semantic checks and also the unittests, which in a 
 sense are extended semantic checks that fall outside the 
 traditional charter of the compiler.

 In that view, asserts inside unittests should fail with the 
 same message format as regular compilation errors, i.e.

 ./modulename.d(103): Unittest failed: user-defined message

 Stack traces and other artifacts printed by failing asserts 
 should come after, indented. An IDE user should run unittest 
 with the usual "build" command and be able to click on the 
 unittest failures just the same as build errors.

 In particular, this view of unittests declares our current 
 stance on running unittests ("run unittests just before 
 main()") as meaningless. Indeed that has bothered me for quite 
 a while - unittests are part of the build/acceptance, not part 
 of every run. To wit, this is a growing idiom in D programs:

 version(unittest) void main() {}
 else void main()
 {
     ...
 }

 What do you think? Logistically it shouldn't be too hard to 
 arrange things to cater to this approach.


 Andrei
</pre><br>
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221685"><a href="#N221684"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221701"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Atila Neves" &lt;atila.neves gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221685"> writes</a>:</a></div>
<pre class="PostingBody">
<pre class="PostingQuote">
 +1. Some of my unittests can only be run at runtime: like 
 testing file
 I/O.  Obviously, other unittests can also be run at 
 compile-time, so
 it's useful to have both.
</pre><br>
Tests that do I/O aren't unit tests. They're more likely 
integration tests.

Atila
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221701"><a href="#N221685"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221710"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Idan Arye" &lt;GenericNPC gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221701"> writes</a>:</a></div>
<pre class="PostingBody">
On Monday, 27 January 2014 at 11:10:04 UTC, Alix Pexton wrote:
<pre class="PostingQuote">
 On 27/01/2014 4:15 AM, Andrei Alexandrescu wrote:
<pre class="PostingQuote">
 On 1/26/14 8:08 PM, Jesse Phillips wrote:
<pre class="PostingQuote">
 On Monday, 27 January 2014 at 03:58:54 UTC, Andrei 
 Alexandrescu wrote:
<pre class="PostingQuote">
 Yeppers. One other thought I had was to define a special 
 flag e.g.
 --4c5ad7908c2aa1b3de32ea25968cdf49 that says "just run 
 unittests".
</pre><br>
 I really think it would be better to use
 --4c5ad7908c2aa1b3de42ea25968cdf49 instead, it just makes the 
 intent
 clearer.
</pre><br>
 I'm just saying it should not clash with any application 
 argument.

 Andrei
</pre><br>
 Hows about making it so that unittests are only run if the 
 executable name has a "_ut" suffix, or some other special 
 name/convention?

 A...
</pre><br>
How about exposing the sybmol of the function that runs the 
unittest, and having a "dunittest" tool for running the tests 
stored inside a regular executable? (I think it's possible?)
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221710"><a href="#N221701"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <a href="#N221714"><img src="http://www.digitalmars.com/blue-down.png" border=0 alt="next sibling"></a> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> =?windows-1252?Q?Simen_Kj=E6r=E5s?= &lt;simen.kjaras gmail.com&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221710"> writes</a>:</a></div>
<pre class="PostingBody">
On 2014-01-25 22:55, Andrei Alexandrescu wrote:
[Good stuff]
<pre class="PostingQuote">
 What do you think? Logistically it shouldn't be too hard to arrange
 things to cater to this approach.
</pre><br>
As evinced by Bugzilla 5091[0], I always run unit tests separately from 
the rest of the program, and so fully support this motion. As others 
have pointed out, there are possible problems with cross-compilation, 
but all in all, I think treating unit tests as a build step rather than 
something to do with execution is a Good Thing�.


[0]: <a href="https://d.puremagic.com/issues/show_bug.cgi?id=5091">https://d.puremagic.com/issues/show_bug.cgi?id=5091</a>

--
   Simen
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div><div id="Posting"><div id="PostingHeading"><a name="N221714"><a href="#N221710"><img src="http://www.digitalmars.com/blue-up.png" border=0 alt="prev sibling"></a> <img src="http://www.digitalmars.com/grey-down.png" border=0> <a href="#N221584"><img src="http://www.digitalmars.com/blue-left.png" border=0 alt="parent"></a> <img src="http://www.digitalmars.com/grey-right.png" border=0> "Dicebot" &lt;public dicebot.lv&gt; <a href="http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D&artnum=221714"> writes</a>:</a></div>
<pre class="PostingBody">
On Monday, 27 January 2014 at 12:18:55 UTC, Idan Arye wrote:
<pre class="PostingQuote">
 How about exposing the sybmol of the function that runs the 
 unittest, and having a "dunittest" tool for running the tests 
 stored inside a regular executable? (I think it's possible?)
</pre><br>
It is already possible via library solution.
</pre>
<div id="PostingFooting"> Jan 27 2014
</div>
</div>
<div id="footer_ad">
<br><br><br><br>
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-5628673096434613";
google_ad_width = 300;
google_ad_height = 250;
google_ad_format = "300x250_as";
google_ad_type = "text_image";
google_ad_channel ="7651800615";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

<!--
<br>
<br>
<SCRIPT charset="utf-8" type="text/javascript" src="http://ws.amazon.com/widgets/q?ServiceVersion=20070822&MarketPlace=US&ID=V20070822/US/classicempire/8006/adfa749b-6f27-4cdf-a046-716a8fab7cab"> </SCRIPT> <NOSCRIPT><A HREF="http://ws.amazon.com/widgets/q?ServiceVersion=20070822&MarketPlace=US&ID=V20070822%2FUS%2Fclassicempire%2F8006%2Fadfa749b-6f27-4cdf-a046-716a8fab7cab&Operation=NoScript">Amazon.com Widgets</A></NOSCRIPT>
-->

</center>
</div>
</div></BODY></HTML>

