http://forums.oscommerce.com/topic/381786-getipaddress-development/?p=1612336
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 23 Jul 2014 11:55:52 GMT
Content-Type: text/html;charset=UTF-8
Connection: close
Set-Cookie: session_id=ada6028f292c1efd2c5b44d2e21510ac; path=/; domain=.oscommerce.com; httponly
Set-Cookie: modpids=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; Max-Age=0; path=/; domain=.oscommerce.com
Cache-Control: no-cache, must-revalidate, max-age=0
Expires: Tue, 22 Jul 2014 11:55:52 GMT
Pragma: no-cache
Content-Encoding: gzip
Vary: Accept-Encoding

<!DOCTYPE html>
	<html lang="en"  xmlns:fb="http://www.facebook.com/2008/fbml">
	<head>
		<meta charset="UTF-8" />
		<title>getIPAddress() development - Development Proposals - osCommerce Support Forum</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<link rel="shortcut icon" href='http://forums.oscommerce.com/favicon.ico' />
		<link rel="image_src" href='http://forums.oscommerce.com/public/style_images/master/oscommerce_meta.png' />
		<script type='text/javascript'>
		//<![CDATA[
			jsDebug			= 0; /* Must come before JS includes */
			DISABLE_AJAX	= parseInt(0); /* Disables ajax requests where text is sent to the DB; helpful for charset issues */
			inACP			= false;
			var isRTL		= false;
			var rtlIe		= '';
			var rtlFull		= '';
		//]]>
		</script>
		
	
				
			<link rel="stylesheet" type="text/css" title="Main" media="screen" href="http://forums.oscommerce.com/public/style_css/css_1/calendar_select.css?ipbv=f0051d8914fe132bc0130fe6bbd729c6" />
		
	

				
			<link rel="stylesheet" type="text/css" title="Main" media="screen,print" href="http://forums.oscommerce.com/public/style_css/css_1/ipb_common.css?ipbv=f0051d8914fe132bc0130fe6bbd729c6" />
		
	

				
			<link rel="stylesheet" type="text/css" title="Main" media="screen,print" href="http://forums.oscommerce.com/public/style_css/css_1/ipb_styles.css?ipbv=f0051d8914fe132bc0130fe6bbd729c6" />
		
	

				
			<link rel="stylesheet" type="text/css"  href="http://forums.oscommerce.com/public/style_css/prettify.css?ipbv=f0051d8914fe132bc0130fe6bbd729c6" />
		
	
	

<!--[if lte IE 7]>
	<link rel="stylesheet" type="text/css" title='Main' media="screen" href="http://forums.oscommerce.com/public/style_css/css_1/ipb_ie.css" />
<![endif]-->
<!--[if lte IE 8]>
	<style type='text/css'>
		.ipb_table { table-layout: fixed; }
		.ipsLayout_content { width: 99.5%; }
	</style>
<![endif]-->

	<style type='text/css'>
		img.bbc_img { max-width: 100% !important; }
	</style>

		<meta property="og:title" content="getIPAddress() development - Development Proposals"/>
		<meta property="og:site_name" content="osCommerce Support Forum"/>
		<meta property="og:type" content="article" />
		
	
		
		
			<meta property="og:updated_time" content="1406116551" />
		
		
		
		
	

		
		
			<meta name="keywords" content="getIPAddress,development,Get,address,client,since,v300,public,static,function" />
		
		
		
		
	

		
		
			<meta name="description" content="getIPAddress() development - posted in Development Proposals: /**
 * Get the IP address of the client
 *
 * @since v3.0.0
 */
 
    public static function getIPAddress() {
      if ( isset(&#036;_SERVER&#91;HTTP_X_FORWARDED_FOR&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;HTTP_X_FORWARDED_FOR&#93;;
      } elseif ( isset(&#036;_SERVER&#91;HTTP_CLIENT_IP&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;HTTP_CLIENT_IP&#93;;
      } else {
        &#036;ip = &#036;_SERVER&#91;REMOTE_ADDR&#93;..." />
		
		
		
			<meta property="og:description" content="getIPAddress() development - posted in Development Proposals: /**
 * Get the IP address of the client
 *
 * @since v3.0.0
 */
 
    public static function getIPAddress() {
      if ( isset(&#036;_SERVER&#91;HTTP_X_FORWARDED_FOR&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;HTTP_X_FORWARDED_FOR&#93;;
      } elseif ( isset(&#036;_SERVER&#91;HTTP_CLIENT_IP&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;HTTP_CLIENT_IP&#93;;
      } else {
        &#036;ip = &#036;_SERVER&#91;REMOTE_ADDR&#93;..." />
		
		
	

		
		
			<meta name="identifier-url" content="http://forums.oscommerce.com/topic/381786-getipaddress-development/?p=1612336" />
		
		
			<meta property="og:url" content="http://forums.oscommerce.com/topic/381786-getipaddress-development/?p=1612336" />
		
		
		
	

<meta property="og:image" content="http://forums.oscommerce.com/public/style_images/master/oscommerce_meta.png"/>
		
		
		
		<script type='text/javascript' src='http://forums.oscommerce.com/public/js/3rd_party/prototype.js'></script>
	
	<script type='text/javascript' src='http://forums.oscommerce.com/public/js/ipb.js?ipbv=f0051d8914fe132bc0130fe6bbd729c6&amp;load=quickpm,hovercard,sharelinks,topic,rating,like'></script>
	
		<script type='text/javascript' src='http://forums.oscommerce.com/public/js/3rd_party/scriptaculous/scriptaculous-cache.js'></script>
	
	<script type="text/javascript" src='http://forums.oscommerce.com/cache/lang_cache/1/ipb.lang.js?nck=fb99e14e49767998a66e3b7a9956074d' charset='UTF-8'></script>


	
		
			
			
			
			
				<link id="ipsCanonical" rel="canonical" href="http://forums.oscommerce.com/topic/381786-getipaddress-development/" />
			
		

			
			
			
			
				<link rel='stylesheet' type='text/css' title='Main' media='print' href='http://forums.oscommerce.com/public/style_css/css_1/ipb_print.css' />
			
		

			
			
			
			
				<link rel='up' href='http://forums.oscommerce.com/forum/86-development-proposals/' />
			
		

			
			
			
			
				<link rel='author' href='http://forums.oscommerce.com/user/288489-taipo/' />
			
		
	

	



<script type='text/javascript'>
	//<![CDATA[
		/* ---- URLs ---- */
		ipb.vars['base_url'] 			= 'http://forums.oscommerce.com/index.php?s=ada6028f292c1efd2c5b44d2e21510ac&';
		ipb.vars['board_url']			= 'http://forums.oscommerce.com';
		ipb.vars['img_url'] 			= "http://forums.oscommerce.com/public/style_images/master";
		ipb.vars['loading_img'] 		= 'http://forums.oscommerce.com/public/style_images/master/loading.gif';
		ipb.vars['active_app']			= 'forums';
		ipb.vars['upload_url']			= 'http://forums.oscommerce.com/uploads';
		/* ---- Member ---- */
		ipb.vars['member_id']			= parseInt( 0 );
		ipb.vars['is_supmod']			= parseInt( 0 );
		ipb.vars['is_admin']			= parseInt( 0 );
		ipb.vars['secure_hash'] 		= '880ea6a14ea49e853634fbdc5015a024';
		ipb.vars['session_id']			= 'ada6028f292c1efd2c5b44d2e21510ac';
		ipb.vars['twitter_id']			= 0;
		ipb.vars['fb_uid']				= 0;
		ipb.vars['auto_dst']			= parseInt( 0 );
		ipb.vars['dst_in_use']			= parseInt(  );
		ipb.vars['is_touch']			= false;
		ipb.vars['member_group']		= {"g_mem_info":"1"}
		/* ---- cookies ----- */
		ipb.vars['cookie_id'] 			= '';
		ipb.vars['cookie_domain'] 		= '.oscommerce.com';
		ipb.vars['cookie_path']			= '/';
		/* ---- Rate imgs ---- */
		ipb.vars['rate_img_on']			= 'http://forums.oscommerce.com/public/style_images/master/star.png';
		ipb.vars['rate_img_off']		= 'http://forums.oscommerce.com/public/style_images/master/star_off.png';
		ipb.vars['rate_img_rated']		= 'http://forums.oscommerce.com/public/style_images/master/star_rated.png';
		/* ---- Uploads ---- */
		ipb.vars['swfupload_swf']		= 'http://forums.oscommerce.com/public/js/3rd_party/swfupload/swfupload.swf';
		ipb.vars['swfupload_enabled']	= true;
		ipb.vars['use_swf_upload']		= ( '' == 'flash' ) ? true : false;
		ipb.vars['swfupload_debug']		= false;
		/* ---- other ---- */
		ipb.vars['highlight_color']     = "#ade57a";
		ipb.vars['charset']				= "UTF-8";
		ipb.vars['time_offset']			= "0";
		ipb.vars['hour_format']			= "24";
		ipb.vars['seo_enabled']			= 1;
		
		ipb.vars['seo_params']			= {"start":"-","end":"\/","varBlock":"?","varPage":"page-","varSep":"&","varJoin":"="};
		
		/* Templates/Language */
		ipb.templates['inlineMsg']		= "";
		ipb.templates['ajax_loading'] 	= "<div id='ajax_loading'><img src='http://forums.oscommerce.com/public/style_images/master/ajax_loading.gif' alt='" + ipb.lang['loading'] + "' /></div>";
		ipb.templates['close_popup']	= "<img src='http://forums.oscommerce.com/public/style_images/master/close_popup.png' alt='x' />";
		ipb.templates['rss_shell']		= new Template("<ul id='rss_menu' class='ipbmenu_content'>#{items}</ul>");
		ipb.templates['rss_item']		= new Template("<li><a href='#{url}' title='#{title}'>#{title}</a></li>");
		
		ipb.templates['autocomplete_wrap'] = new Template("<ul id='#{id}' class='ipb_autocomplete' style='width: 250px;'></ul>");
		ipb.templates['autocomplete_item'] = new Template("<li id='#{id}' data-url='#{url}'><img src='#{img}' alt='' class='ipsUserPhoto ipsUserPhoto_mini' />&nbsp;&nbsp;#{itemvalue}</li>");
		ipb.templates['page_jump']		= new Template("<div id='#{id}_wrap' class='ipbmenu_content'><h3 class='bar'>Jump to page</h3><p class='ipsPad'><input type='text' class='input_text' id='#{id}_input' size='8' /> <input type='submit' value='Go' class='input_submit add_folder' id='#{id}_submit' /></p></div>");
		ipb.templates['global_notify'] 	= new Template("<div class='popupWrapper'><div class='popupInner'><div class='ipsPad'>#{message} #{close}</div></div></div>");
		
		
		ipb.templates['header_menu'] 	= new Template("<div id='#{id}' class='ipsHeaderMenu boxShadow'></div>");
		
		Loader.boot();
	//]]>
	</script>
	</head>
	<body id='ipboard_body'>
		<p id='content_jump' class='hide'><a id='top'></a><a href='#j_content' title='Jump to content' accesskey='m'>Jump to content</a></p>
		<div id='ipbwrapper'>
			<!-- ::: TOP BAR: Sign in / register or user drop down and notification alerts ::: -->
			<div id='header_bar' class='clearfix'>
				<div class='main_width'>
					<script type='text/javascript'>
// And then move
document.observe("dom:loaded", function(){
	$('nav_app_ipchat').down('a').observe( 'click', function(e) {
		var _chatUrl	= $('nav_app_ipchat').down('a').href;
	
		if( _chatUrl.charAt( _chatUrl.length - 1 ) == '#' )
		{
			_chatUrl	= _chatUrl.substr( 0, _chatUrl.length - 1 );
		}
	
		if( _chatUrl.indexOf('?') != '-1' )
		{
			_chatUrl	+= '&_popup=1';
		}
		else
		{
			_chatUrl	+= '?_popup=1';
		}
		
		window.open( _chatUrl, "chatpopout", "status=0,toolbar=0,location=1,menubar=0,directories=0,resizable=1,scrollbars=1,height=550,width=750" );
		
		Event.stop(e);
		return false;
	});
});
</script>
					<div id='user_navigation' class='not_logged_in'>
							
							<ul class='ipsList_inline right'>
								<li>
									<span class='services'>
										
										
										
									</span>
									&nbsp;&nbsp;&nbsp;&nbsp;
									<a href='http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=login' title='Sign In' id='sign_in'>Sign In</a>&nbsp;&nbsp;&nbsp;
								</li>
								<li>
									<a href="http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=register" title='Create Account' id='register_link'>Create Account</a>
								</li>
							</ul>
						</div>
				</div>
			</div>
			<!-- ::: BRANDING STRIP: Logo and search box ::: -->
			<div id='branding'>
				<div class='main_width'>
					<div id='logo'>
						
<div id='chat-tab-count-wrap'><span id='chat-tab-count' class='ipsHasNotifications' title='' style='display:none;'>1</span></div>
<script type='text/javascript'>
// And then move
document.observe("dom:loaded", function(){
	var _thisHtml	= $('nav_app_ipchat').down('a').innerHTML;
	_thisHtml = _thisHtml + $('chat-tab-count-wrap').innerHTML;
	$('nav_app_ipchat').down('a').update( _thisHtml ).setStyle( { position: 'relative' } );
	$('chat-tab-count-wrap').remove();
	$('chat-tab-count').show();
});
</script>

							<a href='http://forums.oscommerce.com' title='Go to community index' rel="home" accesskey='1'><img src='http://forums.oscommerce.com/public/style_images/1_oscommerce_white_fill.png' alt='Logo' /></a>
						
					</div>
					
						<div id='search' class='right'>
	<form action="http://forums.oscommerce.com/index.php?app=core&amp;module=search&amp;do=search&amp;fromMainBar=1" method="post" id='search-box' >
		<fieldset>
			<label for='main_search' class='hide'>Search</label>
			<a href='http://forums.oscommerce.com/index.php?app=core&amp;module=search&amp;search_in=forums' title='Advanced Search' accesskey='4' rel="search" id='adv_search' class='right'>Advanced</a>
			<span id='search_wrap' class='right'>
				<input type='text' id='main_search' name='search_term' class='inactive' size='17' tabindex='100' />
				<span class='choice ipbmenu clickable' id='search_options' style='display: none'></span>
				<ul id='search_options_menucontent' class='ipbmenu_content ipsPad' style='display: none'>
					<li class='title'><strong>Search section:</strong></li>
					<li class='special'>
							<label for='s_topic' title='This topic'>
								<input type='radio' name='search_app' value="forums:topic:381786" class='input_radio' id='s_topic' checked="checked" /><strong>This topic</strong>
							</label>
						</li>
					
					
					<li class='app'><label for='s_forums' title='Forums'><input type='radio' name='search_app' class='input_radio' id='s_forums' value="forums"  />Forums</label></li>
					<li class='app'><label for='s_members' title='Members'><input type='radio' name='search_app' class='input_radio' id='s_members' value="members"  />Members</label></li>
					<li class='app'><label for='s_core' title='Help Files'><input type='radio' name='search_app' class='input_radio' id='s_core' value="core"  />Help Files</label></li>
					
						
					

						
					

						
					

						<li class='app'>
								<label for='s_calendar' title='Calendar'>
									<input type='radio' name='search_app' class='input_radio' id='s_calendar' value="calendar"  />Calendar
								</label>
							</li>
					

						
					

						
					

						<li class='app'>
								<label for='s_tracker' title='Bug Reports'>
									<input type='radio' name='search_app' class='input_radio' id='s_tracker' value="tracker"  />Bug Reports
								</label>
							</li>
					

						
					

						
					

						
					
				</ul>
				<input type='submit' class='submit_input clickable' value='Search' />
			</span>
			
		</fieldset>
	</form>
</div>
					
				</div>
			</div>
			<!-- ::: APPLICATION TABS ::: -->
			<div id='primary_nav' class='clearfix'>
				<div class='main_width'>
					<ul class='ipsList_inline' id='community_app_menu'>
						
							<li class='right'>
								<a href="http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=navigation&amp;inapp=forums" rel="quickNavigation" accesskey='9' id='quickNavLaunch' title='Open Quick Navigation'><span>&nbsp;</span></a>
							</li>
						
						<li id='nav_explore' class='right'>
							<a href='http://forums.oscommerce.com/index.php?app=core&amp;module=search&amp;do=viewNewContent&amp;search_app=forums' accesskey='2' title='View New Content'>View New Content</a>
						</li>
            <li id='nav_menu_300' class="left skip_moremenu ">
              <a id='nav_menu_300_trigger' href='http://www.oscommerce.com' title='' >Website <span class='dropdownIndicator'></span></a>
              <div id='nav_menu_300_menucontent' class='submenu_container clearfix boxShadow' style='display: none'>
                  <div class="left">
                    <ul class="submenu_links">
                        <li class='submenu_li'><a href='http://www.oscommerce.com' title='' >Website</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Products' title='' >Downloads</a></li>
                        <li class='submenu_li'><a href='http://addons.oscommerce.com' title='' >Add-Ons</a></li>
                        <li class='submenu_li'><a href='http://shops.oscommerce.com' title='' >Live Shops</a></li>
                    </ul>
                  </div>
                </div>
                <script type='text/javascript'>
                  document.observe("dom:loaded", function(){
                    new ipb.Menu( $('nav_menu_300_trigger'), $('nav_menu_300_menucontent'), { eventType: 'mouseover', closeOnMouseout: 'nav_menu_300' } );
                  });
                </script>
            </li>
						
            <li id='nav_menu_400' class="left skip_moremenu ">
              <a id='nav_menu_400_trigger' href='http://www.oscommerce.com/Services' title='' >Services <span class='dropdownIndicator'></span></a>
              <div id='nav_menu_400_menucontent' class='submenu_container clearfix boxShadow' style='display: none'>
                  <div class="left">
                    <ul class="submenu_links">
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&hosting' title='' >Hosting</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&developers' title='' >Developers</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&templates' title='' >Templates</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&books' title='' >Books</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&payment' title='' >Payment</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&shipping' title='' >Shipping</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&marketing' title='' >Marketing</a></li>
                        <li class='submenu_li'><a href='http://www.oscommerce.com/Services&crm' title='' >CRM</a></li>
                    </ul>
                  </div>
                </div>
                <script type='text/javascript'>
                  document.observe("dom:loaded", function(){
                    new ipb.Menu( $('nav_menu_400_trigger'), $('nav_menu_400_menucontent'), { eventType: 'mouseover', closeOnMouseout: 'nav_menu_400' } );
                  });
                </script>
            </li>
            <li id='nav_menu_500' class="left skip_moremenu ">
              <a id='nav_menu_500_trigger' href='http://forums.oscommerce.com/subscriptions/' title='' >Customers <span class='dropdownIndicator'></span></a>
              <div id='nav_menu_500_menucontent' class='submenu_container clearfix boxShadow' style='display: none'>
                  <div class="left">
                    <ul class="submenu_links">
                        
                        <li class='submenu_li'><a href='http://www.oscommerce.com/_&Sponsorship' title='' >Community Sponsorships</a></li>
                        
                        <li class='submenu_li'><a href='https://ssl.oscommerce.com/Account&Partner' title='' >Partner Dashboard</a></li>
                        <li class='submenu_li'><a href='http://forums.oscommerce.com/forum/85-support-tickets/' title='' >Support Tickets (Discontinued)</a></li>
                    </ul>
                  </div>
                </div>
                <script type='text/javascript'>
                  document.observe("dom:loaded", function(){
                    new ipb.Menu( $('nav_menu_500_trigger'), $('nav_menu_500_menucontent'), { eventType: 'mouseover', closeOnMouseout: 'nav_menu_500' } );
                  });
                </script>
            </li>
						
								
									
								

									
								

									
								

									
								

									
								

									
																				<li id='nav_app_ipchat' class="left "><a href='http://forums.oscommerce.com/chat/' title='Go to Live Chat'>Live Chat</a></li>
									
								

									
																				<li id='nav_app_tracker' class="left "><a href='http://forums.oscommerce.com/tracker/' title='Go to Bug Reports'>Bug Reports</a></li>
									
								

									
								

									
								

									
								
							
      <li id='nav_app_ccs' class="left "><a href='http://library.oscommerce.com' title='Go to Documentation' >Documentation</a></li>
						<li id='nav_other_apps' style='display: none'>
							<a href='#' class='ipbmenu' id='more_apps'>More <img src='http://forums.oscommerce.com/public/style_images/master/useropts_arrow.png' /></a>
						</li>
					</ul>
				</div>
			</div>
			
			<!-- ::: MAIN CONTENT AREA ::: -->
			<div id='content' class='clearfix'>
				<!-- ::: NAVIGATION BREADCRUMBS ::: -->
				<div id='secondary_navigation' class='clearfix'>
						<ol class='breadcrumb top ipsList_inline left'>
														<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
									<a href='http://forums.oscommerce.com/' itemprop="url">
										<span itemprop="title">osCommerce Support Forum</span>
									</a>
								</li>
								
							
								<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
									<span class='nav_sep'>&rarr;</span>
									 <a href='http://forums.oscommerce.com/forum/88-development/' title='Return to Development' itemprop="url"><span itemprop="title">Development</span></a>
								</li>
								
							

								<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
									<span class='nav_sep'>&rarr;</span>
									 <a href='http://forums.oscommerce.com/forum/86-development-proposals/' title='Return to Development Proposals' itemprop="url"><span itemprop="title">Development Proposals</span></a>
								</li>
								
							
						</ol>
					</div>
					<br />
				<noscript>
					<div class='message error'>
						<strong>Javascript Disabled Detected</strong>
						<p>You currently have javascript disabled. Several functions may not work. Please re-enable javascript to access full functionality.</p>
					</div>
					<br />
				</noscript>
				<!-- ::: CONTENT ::: -->
				
					<div class='ipsAd'><style type="text/css">
#osCCS { margin-top: 5px; clear: both; min-height: 65px; }
#osCCSDesc { font-size: 0.95em; padding-left: 480px; margin-top: -60px; padding-top: 4px; min-height: 60px; }
</style>

<div class='general_box'>
  <div style="float: right; margin-top: -6px;">
<a href="http://www.oscommerce.com/Services&amp;hosting" target="_blank" class="ipsButton_secondary">Hosting</a>
<a href="http://www.oscommerce.com/Services&amp;developers" target="_blank" class="ipsButton_secondary">Developers</a>
<a href="http://www.oscommerce.com/Services&amp;templates" target="_blank" class="ipsButton_secondary">Templates</a>
<a href="http://www.oscommerce.com/Services&amp;books" target="_blank" class="ipsButton_secondary">Books</a>
<a href="http://www.oscommerce.com/Services&amp;payment" target="_blank" class="ipsButton_secondary">Payment</a>
<a href="http://www.oscommerce.com/Services&amp;shipping" target="_blank" class="ipsButton_secondary">Shipping</a>
<a href="http://www.oscommerce.com/Services&amp;marketing" target="_blank" class="ipsButton_secondary">Marketing</a>
<a href="http://www.oscommerce.com/Services&amp;crm" target="_blank" class="ipsButton_secondary">CRM</a>
  </div>
  <p><span style='font-size: 0.95em; font-weight: bold;'><a href='http://www.oscommerce.com/Services' target='_blank'>Our Partners</a></span></p>
  <div id="osCCS" style="display: block;"></div>
</div>

<br /></div>
				
				




<script type="text/javascript">
//<![CDATA[
	ipb.topic.inSection    = 'topicview';
	ipb.topic.topic_id     = 381786;
	ipb.topic.forum_id     = 86;
	ipb.topic.redirectPost = 1;
	ipb.topic.start_id     = 0;
	ipb.topic.page_id      = 0;
	ipb.topic.topPid       = 0;
	ipb.topic.counts       = { postTotal: 17,
							  curStart:  ipb.topic.start_id,
							  perPage:   20 };
	//Search Setup
	ipb.vars['search_type']			= 'forum';
	ipb.vars['search_type_id']		= 86;
	ipb.vars['search_type_2']		= 'topic';
	ipb.vars['search_type_id_2']	= 381786;
	
	
	// Delete stuff set up
	ipb.topic.deleteUrls['hardDelete'] = new Template( ipb.vars['base_url'] + "app=forums&module=moderate&section=moderate&do=04&f=86&t=381786&page=&auth_key=880ea6a14ea49e853634fbdc5015a024&p=#{pid}" );
	ipb.topic.deleteUrls['softDelete'] = new Template( ipb.vars['base_url'] + "app=forums&module=moderate&section=moderate&do=postchoice&tact=sdelete&t=381786&f=86&auth_key=880ea6a14ea49e853634fbdc5015a024&selectedpids[#{pid}]=#{pid}&pid=#{pid}" );
	
	
	ipb.topic.modPerms	  = [];
	
	
	ipb.templates['post_moderation'] = new Template("<div id='comment_moderate_box' class='ipsFloatingAction' style='display: none'><span class='desc'>With <span id='comment_count'>#{count}</span> checked posts: </span><select id='tactInPopup' class='input_select'><option value='approve'>Approve</option><option value='delete'>Hide</option><option value='sundelete'>Unhide</option><option value='deletedo'>Delete</option><option value='merge'>Merge</option><option value='split'>Split</option><option value='move'>Move</option></select>&nbsp;&nbsp;<input type='button' class='input_submit' id='submitModAction' value='Go' /></div>");
	
//]]>
</script>





	<a href='http://forums.oscommerce.com/user/288489-taipo/' class='ipsUserPhotoLink left'>

<img src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' alt='Photo' class='ipsUserPhoto ipsUserPhoto_medium' />

	</a>

<div itemscope itemtype="http://schema.org/Article" class='ipsBox_withphoto'>
	<span itemprop="aggregateRating" itemscope itemtype="http://schema.org/AggregateRating" class='rating ipsType_smaller'>
			
			
				<img src='http://forums.oscommerce.com/public/style_images/master/star_off.png' alt='-' class='rate_img' />
			
			
			
				<img src='http://forums.oscommerce.com/public/style_images/master/star_off.png' alt='-' class='rate_img' />
			
			
			
				<img src='http://forums.oscommerce.com/public/style_images/master/star_off.png' alt='-' class='rate_img' />
			
			
			
				<img src='http://forums.oscommerce.com/public/style_images/master/star_off.png' alt='-' class='rate_img' />
			
			
			
				<img src='http://forums.oscommerce.com/public/style_images/master/star_off.png' alt='-' class='rate_img' />
			
			
			<span id='rating_text'>
				
			</span>
			
		</span>
	<h1 itemprop="name" class='ipsType_pagetitle'>getIPAddress() development</h1>
	<div class='desc lighter blend_links'>
		 Started by <span itemprop="creator"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>, <span itemprop="dateCreated" datetime="2011-11-29">Nov 29 2011 00:40</span>
	</div>
	
	<meta itemprop="interactionCount" content="UserComments:17" />
</div>



<br />
<div class='topic_controls'>
	
	


	<ul class='topic_buttons'>
			<li class='disabled'><span>Please log in to reply</span></li>
			
			
		</ul>
</div>

<div class='maintitle clear clearfix'>
	<span class='ipsType_small'>
		16 replies to this topic
	</span>
	
</div>

<div class='topic hfeed clear clearfix'>
	
	

	<div class='ipsBox'>
		<div class='ipsBox_container' id='ips_Posts'>
			
				<!--post:1612248-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612248'>
		<a id='entry1612248'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612248' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612248' rel='bookmark' title='getIPAddress() development: post #1'>
					
					#1
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #1' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-29T00:40:35+00:00">29 November 2011 - 00:40</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000--><pre class='prettyprint lang-auto linenums:0'>/**
 * Get the IP address of the client
 *
 * @since v3.0.0
 */
 
    public static function getIPAddress() {
      if ( isset(&#036;_SERVER&#91;'HTTP_X_FORWARDED_FOR'&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;'HTTP_X_FORWARDED_FOR'&#93;;
      } elseif ( isset(&#036;_SERVER&#91;'HTTP_CLIENT_IP'&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;'HTTP_CLIENT_IP'&#93;;
      } else {
        &#036;ip = &#036;_SERVER&#91;'REMOTE_ADDR'&#93;;
      }
 
      return &#036;ip;
    }
</pre> <br />This looks like it needs a lot of work.<br /> <br />- HTTP_X_FORWARDED_FOR can often be stacked with a string of IP addresses<br />- With some 'cloud' or server farm configurations like Rackspace, the HTTP_X_CLUSTER_CLIENT_IP is the actual IP on others it is not<br />  That means it is possible to be registering an upstream IP of a load-bearing switch or proxy server as the IP instead of the real one.<br />- Both CLIENT_IP and HTTP_X_FORWARDED_FOR addresses can be spoofed so need to be validated for example using FILTER_VALIDATE_IP
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612248'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612248" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612248', { domLikeStripId: 'like_post_1612248', app: 'forums', type: 'pid', typeid: '1612248' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612248' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612248);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612248') )
	{
		$('multiq_1612248').show();
	}
	
	if( $('toggle_post_1612248') )
	{
		$('toggle_post_1612248').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612248] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612316-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612316'>
		<a id='entry1612316'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612316' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612316' rel='bookmark' title='getIPAddress() development: post #2'>
					
					#2
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #2' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="37791" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/37791-debs/' title='View Profile'><span itemprop="name">Debs</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Debs</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/37791-debs/" title="View Profile: Debs" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/c7519dc1f0158863f586e868bedc6299?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			133 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Debs</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Female</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Fargo, ND UNITED STATES</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Debs' ); return false;" title="@Debs">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-29T11:09:31+00:00">29 November 2011 - 11:09</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Wed, 16 Jul 2014 10:35:14 +0000-->Perhaps this could be helpful to you. I have successfully used this for a script I made (to read geoip and direct or block traffic). It should catch proxy traffic etc. correctly. It has served me well for a couple years. I am not aware that it could be easily spoofed.<br />
 <br />
function getUserIP() {<br />
   &#036;IP_seeker = '';<br />
   if (getenv('HTTP_CLIENT_IP')) {<br />
	  &#036;IP_seeker = getenv('HTTP_CLIENT_IP');<br />
   } elseif (getenv('HTTP_X_FORWARDED_FOR')) {<br />
	  &#036;IP_seeker = getenv('HTTP_X_FORWARDED_FOR');<br />
   } elseif (getenv('HTTP_X_FORWARDED')) {<br />
	  &#036;IP_seeker = getenv('HTTP_X_FORWARDED');<br />
   } elseif (getenv('HTTP_FORWARDED_FOR')) {<br />
	  &#036;IP_seeker = getenv('HTTP_FORWARDED_FOR');<br />
   } elseif (getenv('HTTP_FORWARDED')) {<br />
	  &#036;IP_seeker = getenv('HTTP_FORWARDED');<br />
   } else {<br />
	  &#036;IP_seeker = &#036;_SERVER['REMOTE_ADDR'];<br />
   }<br />
   return &#036;IP_seeker;<br />
}
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612316'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612316" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612316', { domLikeStripId: 'like_post_1612316', app: 'forums', type: 'pid', typeid: '1612316' }, parseInt('0') );
</script>
				
								
				
				
				
			
				<ul id='postControlsNormal_1612316' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612316);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612316') )
	{
		$('multiq_1612316').show();
	}
	
	if( $('toggle_post_1612316') )
	{
		$('toggle_post_1612316').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612316] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612332-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612332'>
		<a id='entry1612332'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612332' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612332' rel='bookmark' title='getIPAddress() development: post #3'>
					
					#3
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #3' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-29T12:07:24+00:00">29 November 2011 - 12:07</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000-->Some proxy servers will allow for client ip spoofing but most that do will only allow an actual IP address to be passed.<br /> <br />Example header:<br /> <br /> <br /><pre class='prettyprint lang-auto linenums:0'>
GET /index.php HTTP/1.1
Host: www.testsite.local
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.24) Gecko/20111103 Firefox/3.6.24
Accept: */*
Client-IP: 111.222.333.444</pre> <br />Some proxy servers will pass that client-ip through even though it is a made up/forged client-ip.<br /> <br />Other configurations will pass through the forged client-IP but still send the correct HTTP_X_FORWARDED_FOR ip address.<br /> <br /> <br />The HTTP_X_FORWARDED_FOR 'can be' completely spoofed where code can be sent rather than an IP address which is why it is an absolute must to test to make sure the HTTP_X_FORWARDED_FOR - which is often a comma separated list of IPs, are actually IP addresses if it is intended to use an ip address for the HTTP_FORWARDED_FOR stack.<br /> <br />Example header<br /> <br /><pre class='prettyprint lang-auto linenums:0'>
 
GET /index.php HTTP/1.1
Host: www.testsite.local
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.24) Gecko/20111103 Firefox/3.6.24
Accept: */*
X-FORWARDED-FOR: &#60;script&gt;alert(document.cookie)&lt;/script&gt;</pre> <br />This will pop an alert with the cookie displayed<br /> <br />On top of all of that there are the following to check for as well:<br />- &#036;_SERVER[ &quot;HTTP_PROXY_USER&quot; ]<br />- &#036;_SERVER[ &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; ]<br /> <br /> <br />Then there are the peculiar configurations where the &#036;_SERVER[ &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; ] is the same as the &#036;_SERVER[ &quot;REMOTE_ADDR&quot; ] then the &#036;_SERVER[ &quot;HTTP_X_FORWARDED_FOR&quot; ] if set, is the actual visitors IP address. However if those two IP addresses differ then the &#036;_SERVER[ &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; ] is the actual visitors IP address.<br /> <br />Example header:<br /> <br /><pre class='prettyprint lang-auto linenums:0'>
 
GET /index.php HTTP/1.1
Host: www.testsite.local
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.24) Gecko/20111103 Firefox/3.6.24
Accept: */*
X-FORWARDED-FOR: 111.111.111.111,222.222.222.222
X-CLUSTER-CLIENT-IP: 123.123.123.123</pre> <br />If the &#036;_SERVER[ &quot;REMOTE_ADDR&quot; ] is 123.123.123.123 (which is the same as the X_CLUSTER_CLIENT_IP above) then the users actual users IP address will be 222.222.222.222 (the last ip in the X-FORWARDED-FOR stack).
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612332'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612332" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612332', { domLikeStripId: 'like_post_1612332', app: 'forums', type: 'pid', typeid: '1612332' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612332' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612332);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612332') )
	{
		$('multiq_1612332').show();
	}
	
	if( $('toggle_post_1612332') )
	{
		$('toggle_post_1612332').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612332] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612333-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612333'>
		<a id='entry1612333'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612333' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612333' rel='bookmark' title='getIPAddress() development: post #4'>
					
					#4
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #4' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-29T12:09:55+00:00">29 November 2011 - 12:09</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000-->Here is a function from osC_Sec which attempts to find the correct IP address:<br /> <br /><pre class='prettyprint lang-auto linenums:0'>
 
	/**
	 * getRealIP()
	 *
	 * @return
	 */
	function getRealIP() {
		if ( isset( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; ) &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; ) ) {
			foreach ( array_reverse( explode( &quot;,&quot;, &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; ) ) as &#036;xff_ip ) {
				&#036;xff_ip = trim( &#036;xff_ip );
  
				if ( &#036;this-&gt;check_ip( &#036;xff_ip ) ) {
					&#036;ip_addresses&#91;&#93; = &#036;xff_ip;
				}
			}
			foreach ( &#036;ip_addresses as &#036;ip ) {
				if ( &#33;empty( &#036;ip ) &amp;&amp; &#036;this-&gt;check_ip( &#036;ip ) ) {
					&#036;HTTP_X_FORWARDED_FOR = &#036;ip;
					break;
				}
			}
		}
		if ( isset( &#036;_SERVER&#91; &quot;HTTP_PROXY_USER&quot; &#93; ) &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_PROXY_USER&quot; &#93; ) ) {
			if ( false &#33;== &#036;this-&gt;check_ip( &#036;_SERVER&#91; &quot;HTTP_PROXY_USER&quot; &#93; ) ) return &#036;_SERVER&#91; &quot;HTTP_PROXY_USER&quot; &#93;;
		}
		# this is to deal with the rackspace type server clouds
		if ( isset( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) &amp;&amp; isset( &#036;HTTP_X_FORWARDED_FOR ) ) {
			# if the cluster client ip is the same as the remote addr
			if ( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; == &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; ) {
				# then the http x forwarded for will be the users IP address
				return &#036;HTTP_X_FORWARDED_FOR;
			} else {
				# if not the same then the cluster client ip will prob be the user IP, either way
				# it wont be the remote addr which will always in this instance be the proxy
				if ( false &#33;== &#036;this-&gt;check_ip( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) )
					return &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93;;
			}
		}
		if ( isset( &#036;_SERVER&#91; &quot;HTTP_CLIENT_IP&quot; &#93; ) &amp;&amp; &#33;empty( &#036;HTTP_X_FORWARDED_FOR ) ) {
			if ( false &#33;== &#036;this-&gt;check_ip( &#036;_SERVER&#91; &quot;HTTP_CLIENT_IP&quot; &#93; ) ) return &#036;_SERVER&#91; &quot;HTTP_CLIENT_IP&quot; &#93;;
		}
		return &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93;;
	}
</pre> <br />The check_ip() function is quite simple and checks the format of IPv4 addresses:<br /><pre class='prettyprint lang-auto linenums:0'>
 
	/**
	 * check_ip()
	 *
	 * @param mixed &#036;ip
	 * @return
	 */
	function check_ip( &#036;ip ) {
		if ( false &#33;== ( bool )preg_match( &quot;/^(&#91;1-9&#93;|&#91;1-9&#93;&#91;0-9&#93;|1&#91;0-9&#93;&#91;0-9&#93;|2&#91;0-4&#93;&#91;0-9&#93;|25&#91;0-5&#93;)&quot; . &quot;(&#092;.(&#91;0-9&#93;|&#91;1-9&#93;&#91;0-9&#93;|1&#91;0-9&#93;&#91;0-9&#93;|2&#91;0-4&#93;&#91;0-9&#93;|25&#91;0-5&#93;)){3}&#036;/&quot;, trim( &#036;ip ) ) ) {
			return true;
		} else &#036;this-&gt;senda403Header();
	}
</pre>
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612333'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612333" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612333', { domLikeStripId: 'like_post_1612333', app: 'forums', type: 'pid', typeid: '1612333' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612333' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612333);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612333') )
	{
		$('multiq_1612333').show();
	}
	
	if( $('toggle_post_1612333') )
	{
		$('toggle_post_1612333').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612333] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612336-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612336'>
		<a id='entry1612336'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612336' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612336' rel='bookmark' title='getIPAddress() development: post #5'>
					
					#5
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #5' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-29T12:22:58+00:00">29 November 2011 - 12:22</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000-->osCommerce 2.3.1 has a good attempt at this too via the tep_get_ip_address() in includes/functions/general.php<br /> <br />Somewhere between all of those above include 2.3.1, will be the right balance for determining the IP address.<br /> <br />The 2.3.1 ip address validation function is:<br /><pre class='prettyprint lang-auto linenums:0'>
 
  function tep_validate_ip_address(&#036;ip_address) {
    if (function_exists('filter_var') &amp;&amp; defined('FILTER_VALIDATE_IP')) {
      return filter_var(&#036;ip_address, FILTER_VALIDATE_IP, array('flags' =&gt; FILTER_FLAG_IPV4));
    }
 
    if (preg_match('/^(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#036;/', &#036;ip_address)) {
      &#036;parts = explode('.', &#036;ip_address);
 
      foreach (&#036;parts as &#036;ip_parts) {
        if ( (intval(&#036;ip_parts) &gt; 255) || (intval(&#036;ip_parts) &lt; 0) ) {
          return false; // number is not within 0-255
        }
      }
 
      return true;
    }
 
    return false;
  }
</pre> <br />Achieves the same as mine, but probably does a better job at determining a clean IPv4 ip address format.
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612336'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612336" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612336', { domLikeStripId: 'like_post_1612336', app: 'forums', type: 'pid', typeid: '1612336' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612336' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612336);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612336') )
	{
		$('multiq_1612336').show();
	}
	
	if( $('toggle_post_1612336') )
	{
		$('toggle_post_1612336').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612336] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612465-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612465'>
		<a id='entry1612465'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612465' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612465' rel='bookmark' title='getIPAddress() development: post #6'>
					
					#6
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #6' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-11-30T13:01:47+00:00">30 November 2011 - 13:01</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000--><pre class='prettyprint lang-auto linenums:0'>/**
 * Get the IP address of the client
 *
 * @since v3.0.0
 */
 
    public static function getIPAddress() {
      if ( isset(&#036;_SERVER&#91;'HTTP_X_FORWARDED_FOR'&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;'HTTP_X_FORWARDED_FOR'&#93;;
      } elseif ( isset(&#036;_SERVER&#91;'HTTP_CLIENT_IP'&#93;) ) {
        &#036;ip = &#036;_SERVER&#91;'HTTP_CLIENT_IP'&#93;;
      } else {
        &#036;ip = &#036;_SERVER&#91;'REMOTE_ADDR'&#93;;
      }
 
      return &#036;ip;
    }</pre> <br /> <br />Apart from the inherent issues with the function above, i.e. the HTTP_X_FORWARDED_FOR can often be a string of IPs separated by a comma or space, the issue is that at least two of those headers above can be spoofed by an attacker.<br /> <br />These headers can be spoofed:<br />- HTTP_PROXY_USER<br />- HTTP_X_FORWARDED_FOR<br />- HTTP_CLIENT_IP<br />- HTTP_PROXY_USER<br />- HTTP_X_CLUSTER_CLIENT_IP<br /> <br />Many 3rd party payment modules depend on the correct ip address as part of their authenticating their callbacks from their server IP addresses.<br /> <br />Chronopay for example: (ext/modules/payment/chronopay/callback.php)<br /><pre class='prettyprint lang-auto linenums:0'>&#036;ip_address = tep_get_ip_address();
 
  if ( (&#036;ip_address == '69.20.58.35') || (&#036;ip_address == '207.97.201.192') ) {</pre> <br />If an attacker sent a spoofed HTTP_CLIENT_IP or spoofed HTTP_X_FORWARDED_FOR of any of those two ip addresses they could create a bit of mischief.<br /> <br />To a lesser extent/impact, ip logging via action_recorder could also be affected by this issue.<br /> <br />It is tricky because there are legitimate situations where the HTTP_X_FORWARDED_FOR would be the correct ip address, as mentioned, for example on clustered server configs where the HTTP_X_CLUSTER_CLIENT_IP and the REMOTE_ADDR are the same IP address (proxy servers). In that instance, where a 3rd party payment provider depended on the REMOTE_ADDR, well this would cause callbacks to fail where the REMOTE_ADDR was expected to be the IP address of the 3rd party payment processor server and not a reverse proxy server, load balancer or gateway server further up the chain within the cluster.<br /> <br />The REMOTE_ADDR in many of those configurations could well be a proxy server of some form further up the chain whereas the HTTP_X_FORWARDED_FOR could be the only header that contains the correct IP address 69.20.58.35.<br /> <br />But you just cannot depend on the HTTP_X_FORWARDED_FOR or &#036;_SERVER['HTTP_CLIENT_IP']. By themselves, they are not dependable ways of determining the correct users IP address.<br /> <br />The solution may be to try and automatically determine the reverse proxy server addresses on setting up the site, and then register those in the configure.php settings.<br /> <br />Then you can for example on a cluster configuration, determine that because the registered reverse proxy IP (in the configure.php file) and the REMOTE_ADDR are the same, then that is at least a verifiable check that the  HTTP_X_FORWARDED_FOR ip will not be spoofed (in cluster configurations). <br /> <br />This is because the REMOTE_ADDR cannot be spoofed, and the clusters reverse proxy/gateway/load balancers ip address is locked into the configure.php file. With those two safe vectors, the ip address determined from the HTTP_X_FORWARDED_FOR header could then be safely set as the visitors IP address.<br /> <br />Without at least those two checks in place, those headers and any of those spoofable headers above should not be depended on by themselves to determine the real IP address.
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612465'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612465" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612465', { domLikeStripId: 'like_post_1612465', app: 'forums', type: 'pid', typeid: '1612465' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612465' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612465);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612465') )
	{
		$('multiq_1612465').show();
	}
	
	if( $('toggle_post_1612465') )
	{
		$('toggle_post_1612465').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612465] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612817-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612817'>
		<a id='entry1612817'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612817' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612817' rel='bookmark' title='getIPAddress() development: post #7'>
					
					#7
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #7' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T05:05:01+00:00">03 December 2011 - 05:05</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:49 +0000-->Below is a bit of a rewrite of both the tep_validate and tep_get_ip functions<br /> <br />The concept here is as follows:<br />On install, if HTTP_X_FORWARDED_FOR is set, the HTTP_REVERSE_PROXY_IP is discovered from the  HTTP_X_FORWARDED_FOR (since the site installer can be trusted not to spoof the  HTTP_X_FORWARDED_FOR) then it has to be defined in the configure.php file then the 'principle ideas' in following functions would be the best method of determining the ip address.<br /><pre class='prettyprint lang-auto linenums:0'>
  function tep_validate_ip_address( &#036;ip_address ) {
	  # This has been updated to include IPv6
	  if ( function_exists( 'filter_var' )
		  &amp;&amp; defined( 'FILTER_VALIDATE_IP' )
		  &amp;&amp; defined( 'FILTER_FLAG_IPV4' )
		  &amp;&amp; defined( 'FILTER_FLAG_IPV6' ) ) {
		  if ( filter_var( &#036;ip, FILTER_VALIDATE_IP,
								FILTER_FLAG_IPV4 ||
								FILTER_FLAG_IPV6 ) &#33;== false ) {
								return &#036;ip;
		  }
	  }
 
	if ( preg_match( '/^(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#036;/', &#036;ip_address ) ) {
	  &#036;parts = explode( '.', &#036;ip_address );
 
	  foreach ( &#036;parts as &#036;ip_parts ) {
		if ( ( intval( &#036;ip_parts ) &gt; 255 ) || ( intval( &#036;ip_parts ) &lt; 0 ) ) {
		  return false; // number is not within 0-255
		}
	  }
	  return true;
	}
	return false;
  }
 
  function tep_get_ip_address() {
	global &#036;_SERVER;
 
	if ( isset( &#036;_SERVER ) ) {
	  # Cloudfare HTTP_CF_CONNECTING_IP cannot be spoofed but research needs to be
	  # done to securely determine if Cloudfare is installed. With that check in place, the
	  # following could be allowed
	  /* if ( isset( &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93; ) &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93; ) ) {
		   &#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93;;
		}*/
	  # This below is the only time an ip address can be safely
	  # determined from any header other than the _SERVER variable REMOTE_ADDR
	  # In order for this to work, HTTP_REVERSE_PROXY_IP needs to be defined in configure.php
	  # in order to avoid this function from falling for spoofed HTTP_X_FORWARDED_FOR IP addresses
	  if ( ( isset( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) // cloud configuration detected - or spoofed ip header
		&amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) )
		&amp;&amp; ( defined( 'HTTP_REVERSE_PROXY_IP' ) ) ) { // defined in configure.php
		
				# where the HTTP_X_CLUSTER_CLIENT_IP = the remote address but differs from the reverse proxy IP
				# and HTTPS is off, then the remote_addr is the users ip address
				# see: http&#58;//goo.gl/xfVls
		if ( ( getenv( &quot;HTTPS&quot; ) == &quot;off&quot; )
		  &amp;&amp; ( tep_validate_ip_address( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) == &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; )
		  &amp;&amp; ( &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; &#33;== HTTP_REVERSE_PROXY_IP )
		  &amp;&amp; ( tep_validate_ip_address( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) &#33;== HTTP_REVERSE_PROXY_IP ) ) {
			  # ignore HTTP_X_FORWARDED_FOR even if it is set
			  # The users ip in this instance is still the REMOTE_ADDR
			  &#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93;;
		}
		# When using https, many cloud configurations employ HTTP_X_FORWARDED_FOR for the
		# user ip address. See: http&#58;//goo.gl/xfVls
		# However the HTTP_X_FORWARDED_FOR can be spoofed so relying on it could
		# result in an attacker exploiting this by sending both an HTTP_X_CLUSTER_CLIENT_IP
		# and an HTTP_X_FORWARDED_FOR to trigger this function to accept their spoofed ip
		# address.
		if ( ( getenv( &quot;HTTPS&quot; ) == &quot;on&quot; )
		  &amp;&amp; ( isset( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; )
		  &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; ) )
		  &amp;&amp; ( tep_validate_ip_address( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) == HTTP_REVERSE_PROXY_IP )
		  &amp;&amp; ( &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; == HTTP_REVERSE_PROXY_IP )
		  &amp;&amp; ( false &#33;== strpos( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93;, &quot;,&quot; ) ) ) {
			&#036;ip = explode( ',', &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; );
			&#036;ip_addresses&#91;&#93; = tep_validate_ip_address( trim( &#036;ip&#91; count( &#036;ip ) - 1 &#93; ) ); // &lt;= UNRELIABLE&#33;&#33;&#33; but a step up from the current method
		}
		  
	  }
	  # Get the REMOTE_ADDR
	  &#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93;;
	}
	  
		
	  # Set the first IP address in the array as the users IP
	  foreach ( &#036;ip_addresses as &#036;ip ) {
		if ( &#33;empty( &#036;ip ) &amp;&amp; tep_validate_ip_address( &#036;ip ) ) {
		  &#036;ip_address = &#036;ip;
		  break;
		}
	  }
	return &#036;ip_address;
  }
</pre> <br />In the concept above, an attacker could still spoof the HTTP_X_FORWARDED_FOR but it would need several other parameters to be true in order for it to work, i.e the server must be running behind SSL which 'can' be triggered on some configurations by calling the url with https, but many webservers do not allow this if HTTPS is set to off, and, HTTP_REVERSE_PROXY_IP has to be defined as well in order for the function to accept an ip address from the HTTP_X_FORWARDED_FOR.<br /> <br />Its not a perfect idea by any stretch of the imagination and it needs work, but it could be a step in the right direction?<br /> <br />I do not have a test site set up on a distributed load baring webserver, so the concepts above are not tested in the wild and are mostly theories derived from reading: <a href='http://goo.gl/xfVls' class='bbc_url' title='External link' rel='nofollow external'>http://goo.gl/xfVls</a><br /> <br />Anyone have an opinion on this. I am all ears.
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612817'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612817" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612817', { domLikeStripId: 'like_post_1612817', app: 'forums', type: 'pid', typeid: '1612817' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612817' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612817);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612817') )
	{
		$('multiq_1612817').show();
	}
	
	if( $('toggle_post_1612817') )
	{
		$('toggle_post_1612817').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612817] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612853-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612853'>
		<a id='entry1612853'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612853' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612853' rel='bookmark' title='getIPAddress() development: post #8'>
					
					#8
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #8' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T13:32:16+00:00">03 December 2011 - 13:32</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br />
 <br />
Great concept&#33; It would be nice to have a generalized solution other projects can also use. Perhaps publishing an initial repository on Github and posting it to the PHP general mailing list could help bring in others to work on and finalize a standard routine.<br />
 <br />
The logic could be slightly improved:<br />
 <br />
1) tep_validate_ip_address() should either return a boolean or a string (ip address), not both; perhaps with isValidIpAddress() and getFilteredIpAddress() functions.<br />
 <br />
2) If the filter_var() function exists in tep_validate_ip_address(), a check on &#036;ip is performed and it's value returned - this should be &#036;ip_address as &#036;ip is not defined.<br />
 <br />
3) In tep_get_ip_address(), if &#036;_SERVER is not set, a foreach on &#036;ip_addresses is performed although the variable has not been set.<br />
 <br />
Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612853'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612853" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612853', { domLikeStripId: 'like_post_1612853', app: 'forums', type: 'pid', typeid: '1612853' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612853' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612853);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612853') )
	{
		$('multiq_1612853').show();
	}
	
	if( $('toggle_post_1612853') )
	{
		$('toggle_post_1612853').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612853] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612855-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612855'>
		<a id='entry1612855'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612855' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612855' rel='bookmark' title='getIPAddress() development: post #9'>
					
					#9
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #9' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T13:51:11+00:00">03 December 2011 - 13:51</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br />
 <br />
Some good logic optimizations can also be found here:<br />
 <br />
<a href='http://stackoverflow.com/a/2031935' class='bbc_url' title='External link' rel='nofollow external'>http://stackoverflow.com/a/2031935</a><br />
 <br />
Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612855'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612855" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612855', { domLikeStripId: 'like_post_1612855', app: 'forums', type: 'pid', typeid: '1612855' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612855' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612855);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612855') )
	{
		$('multiq_1612855').show();
	}
	
	if( $('toggle_post_1612855') )
	{
		$('toggle_post_1612855').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612855] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612876-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612876'>
		<a id='entry1612876'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612876' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612876' rel='bookmark' title='getIPAddress() development: post #10'>
					
					#10
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #10' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T19:15:58+00:00">03 December 2011 - 19:15</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Thanks for that Harald, here is a rejig of the code:<br /> <br /><pre class='prettyprint lang-auto linenums:0'>
 
  function validate_ipaddress( &#036;ip_address ) {
	  # This has been updated to include IPv6
	  if ( function_exists( 'filter_var' )
		  &amp;&amp; defined( 'FILTER_VALIDATE_IP' )
		  &amp;&amp; defined( 'FILTER_FLAG_IPV4' )
		  &amp;&amp; defined( 'FILTER_FLAG_IPV6' ) ) {
		  if ( filter_var( &#036;ip_address, FILTER_VALIDATE_IP,
								FILTER_FLAG_IPV4 ||
								FILTER_FLAG_IPV6 ) === false ) {
								# do something here, perhaps die();
		  } else return &#036;ip_address;
	  }
 
	if ( preg_match( '/^(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#092;.(&#092;d{1,3})&#036;/', &#036;ip_address ) ) {
	  &#036;parts = explode( '.', &#036;ip_address );
 
	  foreach ( &#036;parts as &#036;ip_parts ) {
		if ( ( intval( &#036;ip_parts ) &gt; 255 ) || ( intval( &#036;ip_parts ) &lt; 0 ) ) {
		  # do something here, perhaps die(); because number is not within 0-255
		}
	  }
	  return &#036;ip_address;
	}
  }
 
  function getIPAddress() {
	# Cloudfare HTTP_CF_CONNECTING_IP cannot be spoofed but research needs to be
	# done to securely determine if Cloudfare is installed. With that check in place, the
	# following could be allowed
	/* if ( isset( &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93; ) &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93; ) ) {
		 &#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;HTTP_CF_CONNECTING_IP&quot; &#93;;
	  }*/
	# This below is the only time an ip address can be safely
	# determined from any header other than the _SERVER variable REMOTE_ADDR
	# In order for this to work, HTTP_REVERSE_PROXY_IP needs to be defined in configure.php
	# in order to avoid this function from falling for spoofed HTTP_X_FORWARDED_FOR IP addresses
	if ( ( isset( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) // cloud configuration detected - or spoofed ip header
	  &amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) )
	  &amp;&amp; ( defined( 'HTTP_REVERSE_PROXY_IP' ) ) ) { // defined in configure.php
	  
			  # where the HTTP_X_CLUSTER_CLIENT_IP = the remote address but differs from the reverse proxy IP
			  # and HTTPS is off, then the remote_addr is the users ip address
			  # see: http&#58;//goo.gl/xfVls
	  if ( ( getenv( &quot;HTTPS&quot; ) == &quot;off&quot; )
		&amp;&amp; ( validate_ipaddress( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) == &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; )
		&amp;&amp; ( &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; &#33;== HTTP_REVERSE_PROXY_IP )
		&amp;&amp; ( validate_ipaddress( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) &#33;== HTTP_REVERSE_PROXY_IP ) ) {
			# ignore HTTP_X_FORWARDED_FOR even if it is set
			# The users ip in this instance is still the REMOTE_ADDR
			&#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93;;
	  }
	  # When using https, many cloud configurations employ HTTP_X_FORWARDED_FOR for the
	  # user ip address. See: http&#58;//goo.gl/xfVls
	  # However the HTTP_X_FORWARDED_FOR can be spoofed so relying on it could
	  # result in an attacker exploiting this by sending both an HTTP_X_CLUSTER_CLIENT_IP
	  # and an HTTP_X_FORWARDED_FOR to trigger this function to accept their spoofed ip
	  # address.
	  if ( ( getenv( &quot;HTTPS&quot; ) == &quot;on&quot; )
		&amp;&amp; ( isset( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; )
		&amp;&amp; &#33;empty( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; ) )
		&amp;&amp; ( validate_ipaddress( &#036;_SERVER&#91; &quot;HTTP_X_CLUSTER_CLIENT_IP&quot; &#93; ) == HTTP_REVERSE_PROXY_IP )
		&amp;&amp; ( &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93; == HTTP_REVERSE_PROXY_IP )
		&amp;&amp; ( false &#33;== strpos( &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93;, &quot;,&quot; ) ) ) {
		  &#036;ip = explode( ',', &#036;_SERVER&#91; &quot;HTTP_X_FORWARDED_FOR&quot; &#93; );
		  &#036;ip_addresses&#91;&#93; = validate_ipaddress( trim( &#036;ip&#91; count( &#036;ip ) - 1 &#93; ) ); // &lt;= UNRELIABLE&#33;&#33;&#33; but a step up from the current method
	  }
		
	}
	# Get the REMOTE_ADDR
	&#036;ip_addresses&#91;&#93; = &#036;_SERVER&#91; &quot;REMOTE_ADDR&quot; &#93;;
	  
	# Set the first IP address in the array as the users IP
	foreach ( &#036;ip_addresses as &#036;ip ) {
	  if ( &#33;empty( &#036;ip ) &amp;&amp; validate_ipaddress( &#036;ip ) ) {
		&#036;ip_address = &#036;ip;
		break;
	  }
	}
  return &#036;ip_address;
  }
</pre> <br />Taipo
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612876'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612876" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612876', { domLikeStripId: 'like_post_1612876', app: 'forums', type: 'pid', typeid: '1612876' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612876' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612876);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612876') )
	{
		$('multiq_1612876').show();
	}
	
	if( $('toggle_post_1612876') )
	{
		$('toggle_post_1612876').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612876] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612881-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612881'>
		<a id='entry1612881'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612881' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612881' rel='bookmark' title='getIPAddress() development: post #11'>
					
					#11
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #11' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T20:03:31+00:00">03 December 2011 - 20:03</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000--><blockquote class='ipsBlockquote' data-author="Harald Ponce de Leon" data-cid="1612855" data-time="1322920271"><p>Hi Te..<br /> <br />Some good logic optimizations can also be found here:<br /> <br /><a href='http://stackoverflow.com/a/2031935' class='bbc_url' title='External link' rel='nofollow external'>http://stackoverflow.com/a/2031935</a><br /> <br />Kind regards,<br /></p></blockquote> <br />Thanks for that.<br /> <br />The primary issue I am wanting to address is the inherent risk presented by IP Address spoofing when using any other &#036;_SERVER array key other than REMOTE_ADDR to determine the visitors ip address.<br /> <br />Again taking the Chronopay callback as an example: (ext/modules/payment/chronopay/callback.php)<br /> <br /><pre class='prettyprint lang-auto linenums:0'>
  &#036;ip_address = tep_get_ip_address();
 
  if ( (&#036;ip_address == '69.20.58.35') || (&#036;ip_address == '207.97.201.192') ) {
 
</pre>Spoofed ip header:<br /><pre class='prettyprint lang-auto linenums:0'>
POST /ext/modules/payment/chronopay/callback.php HTTP/1.1
Host: localhost
Accept: */*
Content-Type: application/x-www-form-urlencoded
X-CLUSTER-CLIENT-IP: 69.20.58.35
CLIENT-IP: 207.97.201.192
X-FORWARDED-FOR: 69.20.58.35
 
cs1=1&amp;cs2=1&amp;cs3=1........
</pre> <br />By spoofing the IP headers an attacker could quite easily break through the first few lines of defense in callback.php to start creating havoc.<br /> <br />Any 3rd party addon for 2.3.1 and earlier, for example, that currently check the database to match a stored ip address against the visitors ip will fail if ips are spoofed and they are depending on any other array key in &#036;_SERVER other than REMOTE_ADDR, and if it were possible to prevent coders from coding in that manner then it wouldn't matter as much, but that isn't going to happen anytime soon.<br /> <br />All those examples at stackoverflow fail on this issue of ip spoofing.<br /> <br />Unfortunately the only time the string of ips in X-Forwarded-For are completely reliable is when installing osCommerce onto a server...for obvious reasons.<br /> <br />Taipo
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612881'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612881" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612881', { domLikeStripId: 'like_post_1612881', app: 'forums', type: 'pid', typeid: '1612881' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612881' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612881);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612881') )
	{
		$('multiq_1612881').show();
	}
	
	if( $('toggle_post_1612881') )
	{
		$('toggle_post_1612881').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612881] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612883-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612883'>
		<a id='entry1612883'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612883' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612883' rel='bookmark' title='getIPAddress() development: post #12'>
					
					#12
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #12' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T20:20:35+00:00">03 December 2011 - 20:20</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br />
 <br />
So only the value of &#036;_SERVER['REMOTE_ADDR'] should be used as the clients IP address, regardless if it's a proxy?<br />
 <br />
Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612883'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612883" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612883', { domLikeStripId: 'like_post_1612883', app: 'forums', type: 'pid', typeid: '1612883' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612883' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612883);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612883') )
	{
		$('multiq_1612883').show();
	}
	
	if( $('toggle_post_1612883') )
	{
		$('toggle_post_1612883').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612883] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612884-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612884'>
		<a id='entry1612884'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612884' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612884' rel='bookmark' title='getIPAddress() development: post #13'>
					
					#13
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #13' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T20:24:54+00:00">03 December 2011 - 20:24</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br />
 <br />
Regarding the callback from payment modules, these also check against a secret signature so a request from a spoofed IP address is not going to get far.<br />
 <br />
Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612884'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612884" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612884', { domLikeStripId: 'like_post_1612884', app: 'forums', type: 'pid', typeid: '1612884' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612884' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612884);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612884') )
	{
		$('multiq_1612884').show();
	}
	
	if( $('toggle_post_1612884') )
	{
		$('toggle_post_1612884').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612884] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612886-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612886'>
		<a id='entry1612886'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612886' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612886' rel='bookmark' title='getIPAddress() development: post #14'>
					
					#14
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #14' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-03T20:34:04+00:00">03 December 2011 - 20:34</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br />
 <br />
As there are valid reasons to check against proxies, an alternative method is to use the logic of v2.3.1 for general checks, and for more stricter checks when the origin of the request is known (eg, payment gateways), to bypass the proxies and use REMOTE_ADDR only.<br />
 <br />
Do you think that would be sufficient?<br />
 <br />
Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612886'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612886" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612886', { domLikeStripId: 'like_post_1612886', app: 'forums', type: 'pid', typeid: '1612886' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612886' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612886);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612886') )
	{
		$('multiq_1612886').show();
	}
	
	if( $('toggle_post_1612886') )
	{
		$('toggle_post_1612886').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612886] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612919-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612919'>
		<a id='entry1612919'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612919' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612919' rel='bookmark' title='getIPAddress() development: post #15'>
					
					#15
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #15' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-04T06:17:19+00:00">04 December 2011 - 06:17</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000--><blockquote class='ipsBlockquote' data-author="Harald Ponce de Leon" data-cid="1612884" data-time="1322943894"><p>Hi Te..<br /> <br />Regarding the callback from payment modules, these also check against a secret signature so a request from a spoofed IP address is not going to get far.<br /> <br />Kind regards,<br /></p></blockquote> <br />Sure, and there are 5 or 6 other callback scripts that use tep_get_ip_address() as well, some of which I have looked at.<br /> <br />The addon that immediately looked at risk to me was PHPIDS addon for which I <a href='http://forums.oscommerce.com/topic/358046-php-intrusion-detection-system-for-oscommerce/page__pid__1612579__st__220#entry1612579' class='bbc_url' title=''>notified the developer</a>.<br /> <br />The point of that issue though was that there is a false sense of security being employed by callback coders if they believe they can rely on HTTP_X_FORWARDED_FOR or HTTP_CLIENT_IP for self identification. More than likely though they are just depending on the function to provide them with an accurate ip address.<br /> <br />To an attacker it presents about 10 seconds worth of extra work to get around that first layer of security if ips are derived from the HTTP_X_FORWARDED_FOR or HTTP_CLIENT_IP without some other true test.<br /> <br /><blockquote class='ipsBlockquote' data-author="Harald Ponce de Leon" data-cid="1612886" data-time="1322944444"><p>Hi Te..<br /> <br />As there are valid reasons to check against proxies, an alternative method is to use the logic of v2.3.1 for general checks, and for more stricter checks when the origin of the request is known (eg, payment gateways), to bypass the proxies and use REMOTE_ADDR only.<br /> <br />Do you think that would be sufficient?<br /> <br />Kind regards,<br /></p></blockquote> <br />The logic in 2.3.1 depends a lot on correct configuration of proxy servers ip string. The order of ips in the HTTP_X_FORWARDED_FOR for example is sometimes in reverse order.<br /> <br />Sometimes its client, proxy1, proxy2, and sometimes its proxy2, proxy1, client.<br /> <br />With the advent of 'cloud' serving, there is a growing assumption that HTTP_X_CLUSTER_CLIENT_IP = the clients ip, but as you can see from that rackspace information, that is not always the case (when HTTPS is on)...and again, HTTP_X_CLUSTER_CLIENT_IP can also be spoofed.<br /> <br />The reason I focussed on the HTTP_X_CLUSTER_CLIENT_IP in the example above is because I think in the near future the majority of osCommerce websites will be on distributed server clusters, because free and cheap webhosting is moving in that direction.<br /> <br />I didn't really intend on taking this much further code wise due to my own time constraints with other work on, but am hoping to get some debate going around the issue of hardening the getIPAddress() (some of which could also be applied to tep_get_ip_address() in any future updates to it in 2.4).<br /> <br />I can imagine the end result will still have its weaknesses but it would be a big step up from this type of approach which is common and also flawed:<br /> <br /><pre class='prettyprint lang-auto linenums:0'>if HTTP_X_FORWARDED_FOR is set and not empty then ip = validate( HTTP_X_FORWARDED_FOR )
if HTTP_CLIENT_IP is set and not empty then ip = validate( HTTP_CLIENT_IP )
if HTTP_X_CLUSTER_CLIENT_IP is set and not empty then ip = validate( HTTP_X_CLUSTER_CLIENT_IP )
if REMOTE_ADDR is set and not empty then ip = validate( REMOTE_ADDR )
return ( first ip in array)
</pre> <br />The approach I think could be best would be:<br /> <br />1/ have a 'hardened' (or whatever other name) and normal switch option ex: function getIPAddress(&#036;hardened=false);<br /> <br />2/ use a function like validate_ipaddress() to check every ip in the HTTP headers including IPv6 formats for future proofing<br /> <br />3/ when the HTTP_X_CLUSTER_CLIENT_IP is present and HTTPS is not on, set the REMOTE_ADDR as the ip address (rather than the HTTP_X_CLUSTER_CLIENT_IP) except when HTTPS is on for which with hardened set to false, the untrustworthy HTTP_X_FORWARDED_FOR will have to be called upon to extract the clients ip (or proxy they are behind).<br /> <br />4/ for everything else, with hardened switched to false, use the logic from 2.3.1 tep_get_ip_address() minus the HTTP_X_CLUSTER_CLIENT_IP which would be already taken care of above.<br /> <br />5/ for gateways, they could register their proxy server ips (if they are behind them) in their callback code so that it can be verified via the REMOTE_ADDR. But the same rules would apply when the site is installed on a cluster/cloud therefore the REMOTE_ADDR would be accurate if HTTPS is off but the only other place you will find the client callback ip would be in the HTTP_X_FORWARDED_FOR if HTTPS is on (again going only by what is gleaned from <a href='http://goo.gl/xfVls' class='bbc_url' title='External link' rel='nofollow external'>http://goo.gl/xfVls</a>).<br /> <br />6/ with hardened on, any other method of accurately determining the client ip - registering the reverse proxies on install for example, failing that, REMOTE_ADDR for everything even if it reports wrong.<br /> <br />That would allow for some flexibility around clusters, which as mentioned, will be the norm, and therefore there is a higher need to get those right.<br /> <br />This issue with clusters and HTTPS could also explain why some current users are experiencing callback issues where their sites are hosted on clustered servers. Where HTTPS is on, tep_get_ip_address() would be reporting the wrong ip address of the client/call back server.<br /> <br />Taipo
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612919'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612919" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612919', { domLikeStripId: 'like_post_1612919', app: 'forums', type: 'pid', typeid: '1612919' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1612919' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612919);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612919') )
	{
		$('multiq_1612919').show();
	}
	
	if( $('toggle_post_1612919') )
	{
		$('toggle_post_1612919').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612919] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1612935-->

<div class='post_block hentry clear clearfix  ' id='post_id_1612935'>
		<a id='entry1612935'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1612935' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1612935' rel='bookmark' title='getIPAddress() development: post #16'>
					
					#16
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #16' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="2" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/2-harald-ponce-de-leon/' title='View Profile'><span itemprop="name">Harald Ponce de Leon</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Harald Ponce de Leon</span>
	<ul class='basic_info'>
		
			<p class='desc member_title'>Healthy Giraffe</p>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/2-harald-ponce-de-leon/" title="View Profile: Harald Ponce de Leon" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://www.gravatar.com/avatar/476db6793a2ec53e5e8ec2b84fe3a65b?s=100&amp;d=http%3A%2F%2Fforums.oscommerce.com%2Fpublic%2Fstyle_images%2Fmaster%2Fprofile%2Fdefault_large.png' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			<span style='color:blue;font-weight:bold;'>Core Team</span>
		</li>
		<li class='group_icon'>
			
				<img src='http://forums.oscommerce.com/public/style_extra/team_icons/team_member.gif' alt='' />
			
			</li>
		
		<li class='post_count desc lighter'>
			4,682 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Harald Ponce de Leon</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Location:</span><span class='fc'>Solingen, Germany</span>
						</li>
					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Harald Ponce de Leon' ); return false;" title="@Harald Ponce de Leon">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-04T11:47:57+00:00">04 December 2011 - 11:47</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->Hi Te..<br /> <br /><blockquote class='ipsBlockquote' data-author="Taipo" data-cid="1612919" data-time="1322979439"><p>This issue with clusters and HTTPS could also explain why some current users are experiencing callback issues where their sites are hosted on clustered servers. Where HTTPS is on, tep_get_ip_address() would be reporting the wrong ip address of the client/call back server.<br /></p></blockquote> <br />Specifically for Rackspace, it should still work unless HTTP_X_FORWARDED_FOR contains a value in the HTTP request. In HTTPS requests, the value from HTTP_X_FORWARDED_FOR is the first to be used in tep_get_ip_address().<br /> <br />Kind regards,
					
					<br />
					
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1612935'>
				<ul class='ipsList_inline'>
					<li id="like_post_1612935" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1612935', { domLikeStripId: 'like_post_1612935', app: 'forums', type: 'pid', typeid: '1612935' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="2">
	
	<!--signature-cached-Wed, 23 Jul 2014 10:05:22 +0000-->Harald Ponce de Leon
</div>
				
				
				
			
				<ul id='postControlsNormal_1612935' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1612935);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1612935') )
	{
		$('multiq_1612935').show();
	}
	
	if( $('toggle_post_1612935') )
	{
		$('toggle_post_1612935').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1612935] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			

				<!--post:1614006-->

<div class='post_block hentry clear clearfix  ' id='post_id_1614006'>
		<a id='entry1614006'></a>
		
	
		
		<div class='post_wrap' >
			
				<h3 class='row2'>
			
				<span class='post_id right ipsType_small desc blend_links'>
					
						<a itemprop="replyToUrl" data-entry-pid='1614006' href='http://forums.oscommerce.com/topic/381786-getipaddress-development/#entry1614006' rel='bookmark' title='getIPAddress() development: post #17'>
					
					#17
					<img src='http://forums.oscommerce.com/public/style_images/master/icon_share.png' class='small' title='getIPAddress() development: post #17' />
					</a>
				</span>
				
				 &nbsp;
					<span itemprop="creator name" class="author vcard"><a hovercard-ref="member" hovercard-id="288489" data-ipb="noparse" class="_hovertrigger url fn name " href='http://forums.oscommerce.com/user/288489-taipo/' title='View Profile'><span itemprop="name">Taipo</span></a></span>
				
			
				
			</h3>
			<div class='author_info'>
				<div itemscope itemtype="http://schema.org/Person" class='user_details'>
	<span class='hide' itemprop="name">Taipo</span>
	<ul class='basic_info'>
		
		<li class='avatar'>
				
				<a itemprop="url" href="http://forums.oscommerce.com/user/288489-taipo/" title="View Profile: Taipo" class='ipsUserPhotoLink'>
				
				
					<img itemprop="image" src='http://forums.oscommerce.com/uploads/av-288489.jpg?_r=0' class='ipsUserPhoto ipsUserPhoto_large' />
				
				
				</a>
				
			</li>
		<li class='group_title'>
			Members
		</li>
		
		
		<li class='post_count desc lighter'>
			794 posts
		</li>
		
		
	</ul>
	
	
		<ul class='custom_fields'>
			
				
					
						<li>
							<span class="ft">Real Name:</span><span class="fc">Te Taipo</span>
						</li>
					
				

					
						<li>
							<span class='ft'>Gender:</span><span class='fc'>Male</span>
						</li>
					
				

					
				
			
		</ul>
	<ul class="custom_fields"><li><a href="#" onClick="ipb.textEditor.getEditor( ipb.textEditor.getCurrentEditorId() ).insert( '@Taipo' ); return false;" title="@Taipo">@Mention</a>
</li></ul>
	
</div>
			</div>
			<div class='post_body'>
				<p class='posted_info desc lighter ipsType_small'>
					Posted <abbr class="published" itemprop="commentTime" title="2011-12-12T20:17:33+00:00">12 December 2011 - 20:17</abbr>
					
				</p>
				
				<div itemprop="commentText" class='post entry-content '>
					<!--cached-Thu, 17 Jul 2014 06:19:50 +0000-->I guess if the ip address is only used for general logging purposes, and callback companies do not exclusively depend on the ip address as their method of security, then yes, in the case when its a callback, the REMOTE_ADDR should be the only ip address used....assuming 3rd party processors IPs are the REMOTE_ADDR...<br />
 <br />
The point there is to keep in mind that the REMOTE_ADDR can often be (as is the case with rackspace when https is on) the upline load balancing proxy, so that would introduce more problems than it solves if left merely to calling the REMOTE_ADDR for callbacks, for example on the rackspace type cluster configurations.
					
					<br />
					<p class='edit'>
							<strong>Edited by Taipo, 12 December 2011 - 20:18.</strong>
							
						</p>
				</div>
				
				
				<div class='ipsLikeBar right clearfix' id='rep_post_1614006'>
				<ul class='ipsList_inline'>
					<li id="like_post_1614006" class='ipsLikeBar_info' style="display:none">
							
						</li>
					
				</ul>
			</div>
<script type='text/javascript'>
	ipb.global.registerReputation( 'rep_post_1614006', { domLikeStripId: 'like_post_1614006', app: 'forums', type: 'pid', typeid: '1614006' }, parseInt('0') );
</script>
				
								
				
					<div class="signature" data-memberid="288489">
	
	<!--signature-cached-Sun, 15 Jun 2014 19:51:21 +0000-->- Stop Oscommerce hacks dead in their tracks with <a href='http://addons.oscommerce.com/info/8283' class='bbc_url' title='External link' rel='nofollow external'>osC_Sec</a> (see discussion <a href='http://forums.oscommerce.com/topic/373777-oscommerce-security-osc-secphp/' class='bbc_url' title=''>here</a>)<br />- Another discussion about infected files <a href='http://forums.oscommerce.com/topic/372970-malware-cookie-usagephp-explained/' class='bbc_url' title=''>::here::</a><br />- A discussion on file permissions <a href='http://forums.oscommerce.com/topic/373047-a-chat-about-file-permissions/' class='bbc_url' title=''>::here::</a><br />- Site hacked? Should you upgrade or not, some thoughts <a href='http://forums.oscommerce.com/topic/373373-site-hacked-should-you-upgrade-or-try-to-fix-it-as-it-is/' class='bbc_url' title=''>::here::</a><br />- Fix the admin login bypass exploit <a href='http://forums.oscommerce.com/topic/380144-fixing-the-admin-login-bypass-exploit/' class='bbc_url' title=''>here</a><br />- <a href='http://pastebin.com/D76C73SJ' class='bbc_url' title='External link' rel='nofollow external'>Pareto Security</a>: New security addon I am developing, a remake of osC_Sec in PHP 5 with a number of fixes<br />- BTC:1BkbNA1tK3q7ZRkCJj6f1ELK2A152eEtoW
</div>
				
				
				
			
				<ul id='postControlsNormal_1614006' class='post_controls clear clearfix' >
					<li class='top hide'><a href='#ipboard_body' class='top' title='Back to top'>Back to top</a></li>
					
					
					
					
					
					
				</ul>
				
			</div>
		</div>
	</div>
		
		
		<hr />
		
		
<script type="text/javascript">
var pid = parseInt(1614006);
if ( pid > ipb.topic.topPid ){
	ipb.topic.topPid = pid;
}

	// Show multiquote for JS browsers
	if ( $('multiq_1614006') )
	{
		$('multiq_1614006').show();
	}
	
	if( $('toggle_post_1614006') )
	{
		$('toggle_post_1614006').show();
	}
	
	// Add perm data
	ipb.topic.deletePerms[1614006] = { 'canDelete' : 0, 'canSoftDelete' : 0 };

</script>
			
		</div>
	</div>

<hr />
<div class='topic_controls clear ipsPad_top_bottom_half'>
	
	<div class='ipsPad_top_slimmer right'>
		
		<a href='http://forums.oscommerce.com/forum/86-development-proposals/' class="ipsType_small desc">Back to Development Proposals</a>
		
	</div>
</div>

<!-- Close topic -->
</div>
<!-- BOTTOM BUTTONS -->

	<br />
	<div class='clear clearfix left'>
		

	<ul class='topic_share left shareButtons ipsList_inline'>
	
		<li><a href="http://forums.oscommerce.com/index.php?sharelink=twitter;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lw,,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Share this link via Twitter" class='_slink' id='slink_twitter'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/twitter.png" /></a></li>
	

		
				<li class='fbLike'><div class="fb-like" data-href="http://forums.oscommerce.com/topic/381786-getipaddress-development/?p=1612336" data-send="false" data-layout="button_count" data-width="150" data-show-faces="false" data-action="like"></div><div id="fb-root"></div></li>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=203307189516";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
			
	

		
				<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
	
		{lang: 'en-GB'}
	
</script>
<li><div class='googlePlusOne'><g:plusone count="false" size="small"></g:plusone></div></li>
			
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=digg;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lw,,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Share this link via Digg" class='_slink' id='slink_digg'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/digg.png" /></a></li>
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=delicious;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lw,,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Share this link via Del.icio.us" class='_slink' id='slink_delicious'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/delicious.png" /></a></li>
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=reddit;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lw,,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Share this link via Reddit" class='_slink' id='slink_reddit'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/reddit.png" /></a></li>
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=stumble;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lw,,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Share this link via StumbleUpon" class='_slink' id='slink_stumble'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/stumble.png" /></a></li>
	

		
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=print;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lz9wPTE2MTIzMzY,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Print" class='_slink' id='slink_print'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/print.png" /></a></li>
	

		<li><a href="http://forums.oscommerce.com/index.php?sharelink=download;aHR0cDovL2ZvcnVtcy5vc2NvbW1lcmNlLmNvbS90b3BpYy8zODE3ODYtZ2V0aXBhZGRyZXNzLWRldmVsb3BtZW50Lz9wPTE2MTIzMzY,;Z2V0SVBBZGRyZXNzKCkgZGV2ZWxvcG1lbnQ," rel="nofollow" target="_blank" title="Download" class='_slink' id='slink_download'><img src="http://forums.oscommerce.com/public/style_extra/sharelinks/download.png" /></a></li>
	
	</ul>
	<script type="text/javascript">
		ipb.sharelinks.url   = "http://forums.oscommerce.com/topic/381786-getipaddress-development/";
		ipb.sharelinks.title = "getIPAddress() development";
		ipb.sharelinks.bname = "osCommerce Support Forum";
	</script>

	</div>
	<br />

<!-- SAME TAGGED -->

<!-- ACTIVE USERS -->



	<script type="text/javascript" src="http://forums.oscommerce.com/public/js/3rd_party/prettify/prettify.js"></script>
	<script type='text/javascript' src='http://forums.oscommerce.com/public/js/3rd_party/prettify/lang-sql.js'></script>
	<!-- By default we load generic code, php, css, sql and xml/html; load others here if desired -->
	<script type="text/javascript">
	//<![CDATA[
		Event.observe( window, 'load', function(e){ prettyPrint() });
	//]]>
	</script>
<div id='multiQuoteInsert' style='display: none;' class='ipsFloatingAction'>
	<span class='ipsButton no_width' id='mqbutton'>Reply to quoted posts</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#' id='multiQuoteClear' class='ipsType_smaller desc' title='Clear the posts you have selected with MultiQuote'>Clear</a> &nbsp;&nbsp;&nbsp;
</div>
<form id="modform" method="post" action="http://forums.oscommerce.com/index.php?">
	<input type="hidden" name="app" value="forums" />
	<input type="hidden" name="module" value="moderate" />
	<input type="hidden" name="section" value="moderate" />
	<input type="hidden" name="do" value="postchoice" />
	<input type="hidden" name="f" value="86" />
	<input type="hidden" name="t" value="381786" />
	<input type="hidden" name="auth_key" value="880ea6a14ea49e853634fbdc5015a024" />
	<input type="hidden" name="st" value="" />
	<input type="hidden" name="page" value="" />
	<input type="hidden" value="" name="selectedpidsJS" id='selectedpidsJS' />
	<input type="hidden" name="tact" id="tact" value="" />
</form>
				
					<div class='ipsAd'><script>
var oscGetPartnerBannerUrl = 'http://www.oscommerce.com/index.php?RPC&Website&Index&GetPartnerBanner';
if ( typeof oscForumID != 'undefined' ) {
  oscGetPartnerBannerUrl = oscGetPartnerBannerUrl + '&forumid=' + oscForumID;
}
document.write('<script src="' + oscGetPartnerBannerUrl + '"><\/script>');
</script></div>
				
				<ol class='breadcrumb bottom ipsList_inline left clearfix clear'>
											<li><a href='http://forums.oscommerce.com/'>osCommerce Support Forum</a></li>
							
						
							<li><span class='nav_sep'>&rarr;</span> <a href='http://forums.oscommerce.com/forum/88-development/' title='Return to Development'><span>Development</span></a></li>
							
						

							<li><span class='nav_sep'>&rarr;</span> <a href='http://forums.oscommerce.com/forum/86-development-proposals/' title='Return to Development Proposals'><span>Development Proposals</span></a></li>
							
						

					
					<li class='right ipsType_smaller'>
						<a rel="nofollow" href='http://forums.oscommerce.com/privacypolicy/'>Privacy Policy</a>
					</li>
					
					<li class='right ipsType_smaller'>
							<a href='http://forums.oscommerce.com/index.php?app=forums&amp;module=extras&amp;section=boardrules' title='Forum Rules'>Forum Rules</a> &middot; 
						</li>
				</ol>
			</div>
			<!-- ::: FOOTER (Change skin, language, mark as read, etc) ::: -->
			<div id='footer_utilities' class='main_width clearfix clear'>
				<a rel="nofollow" href='#top' id='backtotop' title='Go to top'><img src='http://forums.oscommerce.com/public/style_images/master/top.png' alt='' /></a>
				<ul class='ipsList_inline left'>
					<li>
						<img src='http://forums.oscommerce.com/public/style_images/master/feed.png' alt='RSS Feed' id='rss_feed' class='clickable' />
					</li>
					
							
								<li>
									<a rel="nofollow" id='new_skin' href='#' title='Change Theme'>Change Theme</a>
									<ul id='new_skin_menucontent' class='ipbmenu_content with_checks' style='display: none'>
										
											<li class='selected'>
												<a href='#' data-clicklaunch='changeSkin' data-skinid='1'>IP.Board</a>
											</li>
										

											<li >
												<a href='#' data-clicklaunch='changeSkin' data-skinid='3'>IP.Board Mobile</a>
											</li>
										
									</ul>
								</li>
							
					
					
					<li>
						<a href="http://forums.oscommerce.com/index.php?app=core&amp;module=help" title='View help' rel="help" accesskey='6'>Help</a>
					</li>
				</ul>
				<!-- Copyright Information -->
        				  <p id='copyright'>
        				  	<a href='http://www.invisionpower.com/apps/board/' title='Community Forum Software by Invision Power Services'>Community Forum Software by IP.Board</a></p>
		<!-- / Copyright -->
			</div>
			
			
			
				<script type='text/javascript' src='http://forums.oscommerce.com/public/js/3rd_party/lightbox.js'></script>
<script type='text/javascript'>
//<![CDATA[
	// Lightbox Configuration
	LightboxOptions = Object.extend({
	    fileLoadingImage:        'http://forums.oscommerce.com/public/style_images/master/lightbox/loading.gif',
	    fileBottomNavCloseImage: 'http://forums.oscommerce.com/public/style_images/master/lightbox/closelabel.gif',
	    overlayOpacity: 0.8,   // controls transparency of shadow overlay
	    animate: true,         // toggles resizing animations
	    resizeSpeed: 10,        // controls the speed of the image resizing animations (1=slowest and 10=fastest)
	    borderSize: 10,         //if you adjust the padding in the CSS, you will need to update this variable
		// When grouping images this is used to write: Image # of #.
		// Change it for non-english localization
		labelImage: "Image",
		labelOf: "of"
	}, window.LightboxOptions || {});
/* Watch for a lightbox image and set up our downloadbutton watcher */
document.observe('click', (function(event){
    var target = event.findElement('a[rel*="lightbox"]') || event.findElement('area[rel*="lightbox"]') || event.findElement('span[rel*="lightbox"]');
    if (target) {
        event.stop();
        gbl_addDownloadButton();
    }
}).bind(this));
var _to    = '';
var _last  = '';
function gbl_addDownloadButton()
{
	if ( typeof( ipsLightbox.lightboxImage ) != 'undefined' && ipsLightbox.lightboxImage.src )
	{
		if ( _last != ipsLightbox.lightboxImage.src )
		{
			if ( ! $('gbl_d') )
			{
				$('bottomNav').insert( { top: "<div id='gbl_d' style='text-align:right;padding-bottom:4px;'></div>" } );
			}
			
			$('gbl_d').update( "<a href='"+ ipsLightbox.lightboxImage.src + "' target='_blank'><img src='http://forums.oscommerce.com/public/style_images/master/lightbox/download-icon.png' /></a>" );
			
			_last = ipsLightbox.lightboxImage.src;
		}
	}
	
	/* Check for init and then keep checking for new image */
	_to = setTimeout( "gbl_addDownloadButton()", 1000 );
}
//]]>
</script>
			
			<div id='inline_login_form' style="display:none">
		<form action="http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=login&amp;do=process" method="post" id='login'>
				<input type='hidden' name='auth_key' value='880ea6a14ea49e853634fbdc5015a024' />
				<input type="hidden" name="referer" value="http://forums.oscommerce.com/topic/381786-getipaddress-development/?p=1612336" />
				<h3>Sign In</h3>
				
				<br />
				<div class='ipsForm ipsForm_horizontal'>
					<fieldset>
						<ul>
							<li class='ipsField'>
								<div class='ipsField_content'>
									Need an account? <a href="http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=register" title='Register now!'>Register now!</a>
								</div>
							</li>
							<li class='ipsField ipsField_primary'>
								<label for='ips_username' class='ipsField_title'>Username or email:</label>
								<div class='ipsField_content'>
									<input id='ips_username' type='text' class='input_text' name='ips_username' size='30' tabindex='0' />
								</div>
							</li>
							<li class='ipsField ipsField_primary'>
								<label for='ips_password' class='ipsField_title'>Forum Password</label>
								<div class='ipsField_content'>
									<input id='ips_password' type='password' class='input_text' name='ips_password' size='30' tabindex='0' /><br />
									<a href='http://forums.oscommerce.com/index.php?app=core&amp;module=global&amp;section=lostpass' title='Retrieve password'>I've forgotten my password</a>
								</div>
							</li>
							<li class='ipsField ipsField_checkbox'>
								<input type='checkbox' id='inline_remember' checked='checked' name='rememberMe' value='1' class='input_check' tabindex='0' />
								<div class='ipsField_content'>
									<label for='inline_remember'>
										<strong>Remember me</strong><br />
										<span class='desc lighter'>This is not recommended for shared computers</span>
									</label>
								</div>
							</li>
							
							
							<li class='ipsPad_top ipsForm_center desc ipsType_smaller'>
								<a rel="nofollow" href='http://forums.oscommerce.com/privacypolicy/'>Privacy Policy</a>
							</li>
							
						</ul>
					</fieldset>
					
					<div class='ipsForm_submit ipsForm_center'>
						<input type='submit' class='ipsButton' value='Sign In' tabindex='0' />
					</div>
				</div>
			</form>
	</div>
		</div>
		
		
		<script type='text/javascript'>
			if( $('primary_nav') ){	ipb.global.activateMainMenu(); }
		</script>
			</body>
</html>
