http://www.depesz.com/2008/08/13/nulls-vs-not-in/
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 23 Jul 2014 01:08:18 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=1246>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; NULLs vs. NOT IN() </title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; NULLs vs. NOT IN() Comments Feed" href="http://www.depesz.com/2008/08/13/nulls-vs-not-in/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2008/08/13/nulls-vs-not-in/' />
<link rel='shortlink' href='http://www.depesz.com/?p=1246' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-1246">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2008/08/13/nulls-vs-not-in/" rel="bookmark" title="Permanent Link to NULLs vs. NOT IN()">NULLs vs. NOT IN()</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>August 13th, 2008 by depesz | Tags: <a href="http://www.depesz.com/tag/not-in/" rel="tag">not in</a>, <a href="http://www.depesz.com/tag/null/" rel="tag">null</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a> |  <a href="http://www.depesz.com/2008/08/13/nulls-vs-not-in/#comments" title="Comment on NULLs vs. NOT IN()">20 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>Friend of mine found something that he thought looked like a bug in Pg.</p>
<p>Very simple query:</p>
<p><code>select * from table where id not in (select field from other_table)</code></p>
<p>was not returning any rows, despite the fact that there definitely are some &#8220;ids" that are not in other_table.field. Why is that?</p>
<p><span id="more-1246"></span></p>
<p>First, let's build a test case:</p>
<p><code>CREATE TABLE objects (id INT4 PRIMARY KEY);<br />
CREATE TABLE secondary (object_id INT4);<br />
INSERT INTO objects (id) VALUES (1), (2), (3);<br />
INSERT INTO secondary (object_id) VALUES (NULL), (2), (4);</code></p>
<p>Data:</p>
<p><code># select * from objects ;<br />
 id<br />
----<br />
  1<br />
  2<br />
  3<br />
(3 rows)<br />
&nbsp;<br />
# select * from secondary ;<br />
 object_id<br />
-----------<br />
    [null]<br />
         2<br />
         4<br />
(3 rows)</code></p>
<p>OK. So, first simple check:</p>
<p><code># SELECT * FROM objects WHERE id IN (SELECT object_id FROM secondary);<br />
 id<br />
----<br />
  2<br />
(1 row)</code></p>
<p>OK. Given the fact that we have 3 ids of objects (1,2,3), and &#8220;IN" is only &#8220;2&#8243;, then &#8220;NOT IN" should yield 1 and 3. Right? Wrong:</p>
<p><code># SELECT * FROM objects WHERE id NOT IN (SELECT object_id FROM secondary);<br />
 id<br />
----<br />
(0 rows)</code></p>
<p>Whoa. Why?</p>
<p>Let's check what is the result of &#8220;id NOT IN &#8230;" for every id:</p>
<p><code># SELECT id, id NOT IN (SELECT object_id FROM secondary) FROM objects;<br />
 id | ?column?<br />
----+----------<br />
  1 | [null]<br />
  2 | f<br />
  3 | [null]<br />
(3 rows)</code></p>
<p>Hmm, but why?</p>
<p>Let's consider case where id = 2.</p>
<ul>
<li>When checking against value &#8220;2&#8243; in secondary table &#8211; id (2) is equal to 2, so we know for sure that &#8220;NOT IN" returns false. We can skip going further</li>
<li>When checking against value &#8220;4&#8243; in secondary table &#8211; id (2) is not equal to 4, so, it looks like &#8220;not in" matches. But we have to continue searching.</li>
<li>When checking against value NULL in secondary table &#8211; comparison between id and NULL yields NULL, because NULL <b>is unknown</b>. It might be equal, or it might not. And we still have to search further.</li>
</ul>
<p>This means that for id = 2, we got for sure &#8220;true" (for NOT IN) operator, because there is row in secondary table with object_id = 2.</p>
<p>But what happens when we deal with id = 3?</p>
<ul>
<li>When checking against value &#8220;2&#8243; in secondary table &#8211; id (2) is not equal to 2, so, it looks like &#8220;not in" matches. But we have to continue searching.</li>
<li>When checking against value &#8220;4&#8243; in secondary table &#8211; id (2) is not equal to 4, so, it looks like &#8220;not in" matches. But we have to continue searching.</li>
<li>When checking against value NULL in secondary table &#8211; comparison between id and NULL yields NULL, because NULL <b>is unknown</b>. It might be equal, or it might not. And we still have to search further.</li>
</ul>
<p>For 2 rows we got information &#8220;NOT IN", but for one &#8211; we're not sure. NULL is unknown, so it might as well be 3. We don't know. And since we don't know, NOT IN has to return &#8220;NULL" as well.</p>
<p>If you'll look closely you'll see that it is technically impossible to get &#8220;true" in this case &#8211; as long as there are NULL values in secondary table!</p>
<p>What should we do then?</p>
<p>There is very simple solution:</p>
<p><code># SELECT id, id NOT IN (SELECT object_id FROM secondary WHERE object_id IS NOT NULL) FROM objects;<br />
 id | ?column?<br />
----+----------<br />
  1 | t<br />
  2 | f<br />
  3 | t<br />
(3 rows)</code></p>
<p>Which will return rows with id = 1 and id = 3.</p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">20 comments <a href='http://www.depesz.com/2008/08/13/nulls-vs-not-in/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-26515" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26515" title="">#</a></span> Eric</div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d1a77f2b644fd6e3c8cd113537136e61?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>This seems like really silly behavior.  I can&#8217;t think of any use case where NULL should be considered unknown.  NULL means empty as in nothing there.  Therefore, the object.id that do not  equal NULLs in secondary.object_id should be considered NOT IN.</p>
<p>Stated differently, if something is NULL and something has a value (string, int, numeric, etc&#8230;) they are clearly not equal by no stretch of any imagination or conjecture so they should be considered NOT IN-cluded in the comparisons.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-26516" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26516" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Eric:<br />
well, perhaps it&#8217;s silly. but it&#8217;s the standard. and when you remember to see nulls like *unknown* &#8211; everything makes sense.</p>
	</li>
		
		
			
<li class="odd" id="comment-26517" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26517" title="">#</a></span> Shane</div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/4d19a46872f9db41c77f1c664d6fc3b8?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Honestly, any developer worth their salt will understand the properties of NULL. NULL is treated the same way in every language and every RDBMS that I&#8217;ve encountered in my career. When testing equality, anything tested against NULL returns NULL. </p>
<p>You did good write-up, and I&#8217;m not criticizing you, I&#8217;m just saying that there is no bug, there is no issue. This works as expected. </p>
<p>And if PG changed how this works, THAT would be a problem.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-26518" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26518" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Shane:<br />
Unfortunately not all RDBMSes work this way.<br />
I&#8217;m sure at least some versions of oracle (i haven&#8217;t used it in years) made NULL = &#8221;.<br />
I&#8217;m also sure, that not only Oracle did something with NULLs that is against standard.</p>
	</li>
		
		
			
<li class="odd" id="comment-26519" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26519" title="">#</a></span> Daniel Cheng</div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/e747fe40d20d9a67606480ac7e77fafc?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Oracle never make  NULL = &#8221;,<br />
they make<br />
 &#8221;=&#8221;  &#8211;&gt; NULL<br />
 &#8221; IS NULL &#8211;&gt; True</p>
	</li>
		
		
			
<li class="odd" id="comment-26520" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26520" title="">#</a></span> <a href='http://gim.jogger.pl' rel='external nofollow' class='url'>GiM</a></div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/f7696643253af7e054906f2d91e596ad?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>I&#8217;ve already stumbled upon this few times so I knew what it&#8217;ll be about after title itself, I quite agree with shane, when you take a look at it is very reasonable.<br />
But there is simialar thing when using ALL (at least in Oracle didn&#8217;t tested other dbs), that<br />
lately confused me.<br />
using the following to selects yields different results because &#8216;tbl&#8217; contain NULL values</p>
<p>SELECT name FROM tbl WHERE value &gt; ALL (SELECT value FROM tbl WHERE fltr=&#8217;Blah&#8217;);</p>
<p>SELECT name FROM tbl WHERE value &gt; (SELECT max(value) from tbl WHERE fltr=&#8217;Blah&#8217;);</p>
	</li>
		
		
			
<li class="odd" id="comment-26521" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26521" title="">#</a></span> Robert Treat</div>  <div class="date">Aug 13, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/3faac8774ace915355d2c55c0587f9b4?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Don&#8217;t forget, you can often rewrite IN queries to use the EXISTS clause, which might perform a little more to your liking. </p>
<p>pagila=# SELECT * FROM objects WHERE exists (SELECT object_id FROM secondary where object_id = id);<br />
 id<br />
&#8212;-<br />
  2<br />
(1 row)</p>
<p>pagila=# SELECT * FROM objects WHERE not exists (SELECT object_id FROM secondary where object_id = id);<br />
 id<br />
&#8212;-<br />
  1<br />
  3<br />
(2 rows)</p>
	</li>
		
		
			
<li class="odd" id="comment-26522" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26522" title="">#</a></span> Chris</div>  <div class="date">Aug 14, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/34dee32499fab54be129b0aafa2c169e?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>I have found that, in all cases, the best method is to perform an outer join and use IS NULL on the &#8220;not in&#8221; table. It seems to optimize much better, though it takes a bit more time and though to write the query in an ad hoc fashion. This also ensures you&#8217;re not running into any gotchas like this.</p>
	</li>
		
		
			
<li class="odd" id="comment-26525" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26525" title="">#</a></span> Stephen</div>  <div class="date">Aug 15, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/8b7c4a1df62f647b7d6d927c2ba8bcdf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@despez:</p>
<p>In all recent versions of Oracle (maybe every version) NULL becomes &#8221; when Oracle thinks it needs to and &#8221; becomes NULL always.</p>
<p>In Oracle:</p>
<p>select count(*) from dual where &#8221; is null;</p>
<p>&#8230;returns 1 (dual is an Oracle-standard one row table)</p>
<p>select &#8216;abc&#8217;||null||&#8217;123&#8242; from dual;</p>
<p>&#8230;returns &#8216;abc123&#8242;</p>
<p>select length(&#8221;) from dual;</p>
<p>&#8230;returns NULL</p>
<p>If Oracle followed the standard, the first query would return 0 no matter how many rows dual had, the second would return null, and the third would return 0. These non-standard behaviors are so well entrenched in the Oracle world that I doubt they will change anytime soon.</p>
	</li>
		
		
			
<li class="odd" id="comment-26526" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26526" title="">#</a></span> Jeff Davis</div>  <div class="date">Aug 15, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/f4408f033fc871f3ab95bb54c9cfb8a0?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@depesz:<br />
&#8220;when you remember to see nulls like *unknown* &#8211; everything makes sense&#8221;</p>
<p>That&#8217;s not true. See my slides from this talk:</p>
<p><a href="http://www.pgcon.org/2008/schedule/events/83.en.html" rel="nofollow">http://www.pgcon.org/2008/schedule/events/83.en.html</a></p>
<p>Sometimes NULL is treated like unknown (operators, functions, [NOT] IN), sometimes it&#8217;s treated like no value at all (aggregates and outer joins), sometimes it&#8217;s treated like false (WHERE clause), and sometimes it&#8217;s treated like true (constraints).</p>
<p>These inconsistencies can lead to very unintuitive results.</p>
	</li>
		
		
			
<li class="odd" id="comment-26527" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26527" title="">#</a></span> Jeff Davis</div>  <div class="date">Aug 15, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/f4408f033fc871f3ab95bb54c9cfb8a0?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Also, I wrote up something about NULLs on my blog as well, just before depesz:<br />
<a href="http://people.planetpostgresql.org/jdavis/index.php?/archives/9-None,-nil,-Nothing,-undef,-NA,-and-SQL-NULL.html" rel="nofollow">http://people.planetpostgresql.org/jdavis/index.php?/archives/9-None,-nil,-Nothing,-undef,-NA,-and-SQL-NULL.html</a></p>
	</li>
		
		
			
<li class="mycomment" id="comment-26528" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26528" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 15, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Jeff Davis:<br />
I saw the slides, but I didn&#8217;t found there any examples.</p>
<p>If you could write examples on:<br />
1. null as no value in case of outer join<br />
2. null as false in where<br />
3. null as true in constraints</p>
<p>I&#8217;m not arguing with your points &#8211; I would just like to see some justification for the points, because I can&#8217;t find any examples in my memory, and the only example left (no value in aggregates) is easily explainable by the fact that aggregates should skip null values.</p>
<p>As far as I recall, this &#8220;skip nulls in aggregates&#8221; comes from standard, but I might be wrong.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-26529" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26529" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 15, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Jeff Davis:<br />
sorry, bad wording. not &#8220;didn&#8217;t found there any examples&#8221;, but &#8220;any examples regarding these cases&#8221;.</p>
<p>btw. i swear that wordpress once had the ability to edit comments, but it seems to be gone now.</p>
	</li>
		
		
			
<li class="odd" id="comment-26530" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26530" title="">#</a></span> Jeff Davis</div>  <div class="date">Aug 16, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/f4408f033fc871f3ab95bb54c9cfb8a0?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@depesz:</p>
<p>1. null as no value:</p>
<p>If you select the SUM of a table (or group or subselect) and there are no input tuples, it returns NULL. Clearly this is not unknown, because your source data contains no NULLs. If you know everything, how can the results of a query be unknown?</p>
<p>Also, with outer join, how can outer join produce &#8220;unknown&#8221; when there are no NULLs in your source data? </p>
<p>And as a final observation: if you SUM() a column with NULLs in it in addition to integers, the NULLs will be ignored, and it will produce a value (if NULLs are unknown, clearly it&#8217;s wrong to count them as zero). Thus, as I point out in my slides, SUM() of NULL and 1 is 1, but NULL + 1 is NULL.</p>
<p>2. NULL is clearly false in a WHERE clause:<br />
SELECT 1;<br />
SELECT 1 WHERE NULL; &#8212; same as &#8220;WHERE FALSE&#8221;</p>
<p>3. Add a &#8220;CHECK (NULL)&#8221; as a constraint. It will not reject anything, and is therefore equivalent to &#8220;CHECK (TRUE)&#8221;.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-26531" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26531" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 16, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Jeff Davis:<br />
Hmm, I&#8217;m not sure if I can support the idea that it is not logical.</p>
<p>ad. 1: perhaps it is badly named, but there is nowhere claim that &#8220;+&#8221; should work the same as sum() which is aggregate. the moment you know that aggregates ignore nulls, there are no surprises.</p>
<p>ad. 2: no, it is not false. sql logic is based on not 2, but 3 values. something that isn&#8217;t true doesn&#8217;t have to be false. &#8220;where&#8221; need condition that evaluates to &#8220;true&#8221;. anything else is rejected. it doesn&#8217;t mean in any way that null = false, as this: &#8220;select 1 where not null&#8221; still doesn&#8217;t return any rows, and if it was the case you described &#8211; it would.</p>
<p>ad. 3: basically the same thing as with &#8220;where&#8221;, but checks are checked for *false* value. again. something that isn&#8217;t true doesn&#8217;t mean it&#8217;s false.</p>
<p>and again &#8211; 3 value logic works quite well when you&#8217;ll assume null to be &#8220;unknown&#8221;.</p>
<p>where &#8211; requires &#8220;true&#8221;, not something that we don&#8217;t know or something that we know is false.<br />
check &#8211; it stops entering &#8220;false&#8221; values, but if it is not definitely false &#8211; it can be inserted. it might be &#8220;true&#8221;. it might be simply &#8220;unknown&#8221;. but it&#8217;s not &#8220;false&#8221;.</p>
	</li>
		
		
			
<li class="odd" id="comment-26535" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26535" title="">#</a></span> MikeEnRegalia</div>  <div class="date">Aug 18, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/a6b2854a7ac08d23822e48339f1e971c?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Maybe it&#8217;s better to think of NULL as *undefined*. The aggregate sum() returns NULL if the relation doesn&#8217;t have any tuples, and it&#8217;s correct IMO. Still, developers are drawing conclusions from this undefined return value, like in this case: sum() returns NULL -&gt; relation is empty. </p>
<p>As far as the example is concerned:</p>
<p>SELECT * FROM objects WHERE id NOT IN (SELECT object_id FROM secondary)</p>
<p>Why not write it as</p>
<p>SELECT * FROM objects WHERE id NOT IN (SELECT object_id FROM secondary WHERE object_id IS NOT NULL)</p>
<p>This avoids the problem, doesn&#8217;t it?</p>
	</li>
		
		
			
<li class="odd" id="comment-26536" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26536" title="">#</a></span> <a href='http://deyan.dyankov.name/' rel='external nofollow' class='url'>Deyan Dyankov</a></div>  <div class="date">Aug 18, 2008</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/3988cb4147bc5cc98c71aae7be3b095e?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Featuring Oracle 10gR2 ..</p>
<p>SQL&gt; SELECT &#8216;yes&#8217; AS hehe FROM DUAL WHERE &#8221; IS NULL;</p>
<p>HEHE<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;<br />
yes</p>
<p>SQL&gt;</p>
	</li>
		
		
			
<li class="odd" id="comment-26548" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26548" title="">#</a></span> <a href='http://szeryf.wordpress.com/' rel='external nofollow' class='url'>szeryf</a></div>  <div class="date">Aug 21, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/024f6d59fd34ceca04f3fc18a87bdb98?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>maybe it&#8217;s best to think of NULL as NULL in a three-value logic and not try to bend it into two-value logic because that&#8217;s what causes all the alleged anomalies <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-26571" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-26571" title="">#</a></span> raford</div>  <div class="date">Aug 28, 2008</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/06a80201f22346749bd2d71ed6e5d862?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Very helpful. I spent long time to get rid of this case, and found your advice.<br />
Really thanks a lot for your trouble to find and explain all things.<br />
Thanks.</p>
	</li>
		
		
			
<li class="odd" id="comment-35332" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35332" title="">#</a></span> Tomek</div>  <div class="date">Mar 1, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/1ebe8406d3db6002d3497bb7c588d2d7?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Thanks very much for your post. It was exactly the problem I was having.</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="1246" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a06833658a" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="12"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">4 comments</span> | <span class="wpp-views">586 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">362 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">249 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">192 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">147 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">131 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">118 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">116 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">115 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/11/14/how-i-learned-to-stop-worrying-and-love-the-triggers/" title="How I Learned to Stop Worrying and Love the Triggers" class="wpp-post-title" target="_self">How I Learned to Stop Worrying and Love the Triggers</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">97 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochód</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

