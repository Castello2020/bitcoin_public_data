http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/
HTTP/1.1 200 OK
Server: nginx
Date: Tue, 22 Jul 2014 07:18:45 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=2366>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Some new tools for PostgreSQL or around PostgreSQL</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Some new tools for PostgreSQL or around PostgreSQL Comments Feed" href="http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/' />
<link rel='shortlink' href='http://www.depesz.com/?p=2366' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-2366">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/" rel="bookmark" title="Permanent Link to Some new tools for PostgreSQL or around PostgreSQL">Some new tools for PostgreSQL or around PostgreSQL</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>January 23rd, 2012 by depesz | Tags: <a href="http://www.depesz.com/tag/fast-dump/" rel="tag">fast dump</a>, <a href="http://www.depesz.com/tag/fast-restore/" rel="tag">fast restore</a>, <a href="http://www.depesz.com/tag/omniti/" rel="tag">omniti</a>, <a href="http://www.depesz.com/tag/pg-grep/" rel="tag">pg.grep</a>, <a href="http://www.depesz.com/tag/pg-logs-tail/" rel="tag">pg.logs.tail</a>, <a href="http://www.depesz.com/tag/pgtreats/" rel="tag">pgtreats</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/system_monitoring/" rel="tag">system_monitoring</a>, <a href="http://www.depesz.com/tag/tools/" rel="tag">tools</a> |  <a href="http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/#comments" title="Comment on Some new tools for PostgreSQL or around PostgreSQL">15 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>During last months I wrote some tools to help me with my daily duties.</p>
<p>I'd like to let you know you about them, as you might find them useful.</p>
<p>So, here we go:</p>
<p><span id="more-2366"></span></p>
<h1>pg.logs.tail</h1>
<p>Available from <a href="https://labs.omniti.com/pgtreats/trunk/tools/pg.logs.tail">OmniTI SVN</a>.</p>
<p>It's a smarter &#8220;tail -f" for PostgreSQL logs. Smarter in a way, that it knows that PostgreSQL rotates its log file, so if it will see that the rotation happened, it will switch to next file.</p>
<p>To run the program you just do:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">pg.logs.tail <span style="color: #660033;">-d</span> <span style="color: #000000; font-weight: bold;">/</span>var<span style="color: #000000; font-weight: bold;">/</span>log<span style="color: #000000; font-weight: bold;">/</span>postgresql</pre></td></tr></table></div>

<p>Or whenever you have the logs in.</p>
<p>If you are in logs directory, just run pg.logs.tail without options, and it should work.</p>
<p>Aside from -d option, there are only 2 more:</p>
<ul>
<li>-v &#8211; prints (to STDERR not to mess with data when grepping) whenever it switches to new file</li>
<li>-f &#8211; regexp that is used to find log files &#8211; it defaults to sane postgresql-.*\\.log so generally you don't need to change it</li>
</ul>
<h1>pg.grep</h1>
<p>Available from <a href="https://labs.omniti.com/pgtreats/trunk/tools/pg.grep">OmniTI SVN</a>.</p>
<p>This is grep. But (also) smarter.</p>
<p>For starters &#8211; it understands that given &#8220;message" in log can span over multiple lines.</p>
<p>Also &#8211; it understands that some log messages cause other messages to be shown &#8211; for example, when you have exception/error, usually there is &#8220;STATEMENT:" log line, which is connected to the error before it.</p>
<p>To do it's &#8220;parsing" pg.grep needs to know what is the log_line_prefix that you're using in Pg &#8211; otherwise it wouldn't be able to tell whether given line in log is continuation of message from previous line, or a new message altogether.</p>
<p>So, let's see how it works. My log_line_prefix is &#8220;%m %u@%d %p %r &#8220;, and I just ran query:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span>
<span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #66cc66;">+</span>
<span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #cc66cc;">2</span>
<span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #66cc66;">-</span>
<span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #cc66cc;">123</span>;
 ?<span style="color: #993333; font-weight: bold;">column</span>?
──────────
     <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">120</span>
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span> <span style="color: #993333; font-weight: bold;">row</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>In log, I have:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">27</span>:<span style="color: #cc66cc;">54.929</span> CET <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">unknown</span><span style="color: #66cc66;">&#93;</span>@<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">unknown</span><span style="color: #66cc66;">&#93;</span> <span style="color: #cc66cc;">17743</span>  LOG:  connection received: host<span style="color: #66cc66;">=</span><span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">27</span>:<span style="color: #cc66cc;">54.930</span> CET depesz@depesz <span style="color: #cc66cc;">17743</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> LOG:  connection authorized: <span style="color: #993333; font-weight: bold;">user</span><span style="color: #66cc66;">=</span>depesz <span style="color: #993333; font-weight: bold;">database</span><span style="color: #66cc66;">=</span>depesz
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">27</span>:<span style="color: #cc66cc;">57.447</span> CET depesz@depesz <span style="color: #cc66cc;">17743</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> LOG:  duration: <span style="color: #cc66cc;">0.603</span> ms  statement: <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span>
        <span style="color: #66cc66;">+</span>
        <span style="color: #cc66cc;">2</span>
        <span style="color: #66cc66;">-</span>
        <span style="color: #cc66cc;">123</span>;
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">28</span>:<span style="color: #cc66cc;">04.924</span> CET depesz@depesz <span style="color: #cc66cc;">17743</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> LOG:  disconnection: <span style="color: #993333; font-weight: bold;">session</span> <span style="color: #993333; font-weight: bold;">time</span>: <span style="color: #cc66cc;">0</span>:00:<span style="color: #cc66cc;">09.995</span> <span style="color: #993333; font-weight: bold;">user</span><span style="color: #66cc66;">=</span>depesz <span style="color: #993333; font-weight: bold;">database</span><span style="color: #66cc66;">=</span>depesz host<span style="color: #66cc66;">=</span><span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">28</span>:<span style="color: #cc66cc;">05.225</span> CET <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">unknown</span><span style="color: #66cc66;">&#93;</span>@<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">unknown</span><span style="color: #66cc66;">&#93;</span> <span style="color: #cc66cc;">17778</span>  LOG:  connection received: host<span style="color: #66cc66;">=</span><span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">28</span>:<span style="color: #cc66cc;">05.226</span> CET depesz@depesz <span style="color: #cc66cc;">17778</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> LOG:  connection authorized: <span style="color: #993333; font-weight: bold;">user</span><span style="color: #66cc66;">=</span>depesz <span style="color: #993333; font-weight: bold;">database</span><span style="color: #66cc66;">=</span>depesz</pre></td></tr></table></div>

<p>If I'd just grep it for &#8220;123&#8243; I would get:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">=$ <span style="color: #c20cb9; font-weight: bold;">tail</span> postgresql-<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span>_164637.log <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #000000;">123</span>
        <span style="color: #000000;">123</span>;</pre></td></tr></table></div>

<p>not so helpful. But with pg.grep:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #66cc66;">=</span>$ tail postgresql<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span>_164637<span style="color: #66cc66;">.</span>log <span style="color: #66cc66;">|</span> ~<span style="color: #66cc66;">/</span>pg<span style="color: #66cc66;">.</span>grep <span style="color: #66cc66;">-</span>p <span style="color: #ff0000;">&quot;%m %u@%d %p %r &quot;</span> <span style="color: #66cc66;">-</span>m <span style="color: #cc66cc;">123</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">27</span>:<span style="color: #cc66cc;">57.447</span> CET depesz@depesz <span style="color: #cc66cc;">17743</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> LOG:  duration: <span style="color: #cc66cc;">0.603</span> ms  statement: <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span>
        <span style="color: #66cc66;">+</span>
        <span style="color: #cc66cc;">2</span>
        <span style="color: #66cc66;">-</span>
        <span style="color: #cc66cc;">123</span>;</pre></td></tr></table></div>

<p>Now, let's consider another example:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span> <span style="color: #66cc66;">+</span>
<span style="color: #66cc66;">&gt;&gt;</span> version<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;
ERROR:  operator does <span style="color: #993333; font-weight: bold;">not</span> exist: <span style="color: #993333; font-weight: bold;">integer</span> <span style="color: #66cc66;">+</span> text
LINE <span style="color: #cc66cc;">1</span>: <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span> <span style="color: #66cc66;">+</span>
                 ^
HINT:  No operator matches the given name <span style="color: #993333; font-weight: bold;">and</span> argument <span style="color: #993333; font-weight: bold;">type</span><span style="color: #66cc66;">&#40;</span>s<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">.</span> You might need <span style="color: #993333; font-weight: bold;">to</span> <span style="color: #993333; font-weight: bold;">add</span> explicit <span style="color: #993333; font-weight: bold;">type</span> casts<span style="color: #66cc66;">.</span></pre></td></tr></table></div>

<p>normal grep for ERRORS would show:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">=$ <span style="color: #c20cb9; font-weight: bold;">cat</span> postgresql-<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span>_173247.log <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> ERROR
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">17</span>:<span style="color: #000000;">32</span>:<span style="color: #000000;">53.188</span> CET depesz<span style="color: #000000; font-weight: bold;">@</span>depesz <span style="color: #000000;">17778</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #7a0874; font-weight: bold;">local</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> ERROR:  operator does not exist: integer + text at character <span style="color: #000000;">10</span></pre></td></tr></table></div>

<p>but pg.grep for errors shows:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #66cc66;">=</span>$ cat postgresql<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span>_173247<span style="color: #66cc66;">.</span>log <span style="color: #66cc66;">|</span> ~<span style="color: #66cc66;">/</span>pg<span style="color: #66cc66;">.</span>grep <span style="color: #66cc66;">-</span>p <span style="color: #ff0000;">&quot;%m %u@%d %p %r &quot;</span> <span style="color: #66cc66;">-</span>m ERROR
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">32</span>:<span style="color: #cc66cc;">53.188</span> CET depesz@depesz <span style="color: #cc66cc;">17778</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> ERROR:  operator does <span style="color: #993333; font-weight: bold;">not</span> exist: <span style="color: #993333; font-weight: bold;">integer</span> <span style="color: #66cc66;">+</span> text at <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #cc66cc;">10</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">32</span>:<span style="color: #cc66cc;">53.188</span> CET depesz@depesz <span style="color: #cc66cc;">17778</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> HINT:  No operator matches the given name <span style="color: #993333; font-weight: bold;">and</span> argument <span style="color: #993333; font-weight: bold;">type</span><span style="color: #66cc66;">&#40;</span>s<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">.</span> You might need <span style="color: #993333; font-weight: bold;">to</span> <span style="color: #993333; font-weight: bold;">add</span> explicit <span style="color: #993333; font-weight: bold;">type</span> casts<span style="color: #66cc66;">.</span>
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">32</span>:<span style="color: #cc66cc;">53.188</span> CET depesz@depesz <span style="color: #cc66cc;">17778</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> STATEMENT:  <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #cc66cc;">1</span> <span style="color: #66cc66;">+</span>
        version<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</pre></td></tr></table></div>

<p>In case you'd really need just the ERROR line, you can do so by using -l (&#8211;line) option:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #66cc66;">=</span>$ cat postgresql<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span>_173247<span style="color: #66cc66;">.</span>log <span style="color: #66cc66;">|</span> ~<span style="color: #66cc66;">/</span>pg<span style="color: #66cc66;">.</span>grep <span style="color: #66cc66;">-</span>p <span style="color: #ff0000;">&quot;%m %u@%d %p %r &quot;</span> <span style="color: #66cc66;">-</span>m ERROR <span style="color: #66cc66;">-</span>l
<span style="color: #cc66cc;">2012</span><span style="color: #66cc66;">-</span>01<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">22</span> <span style="color: #cc66cc;">17</span>:<span style="color: #cc66cc;">32</span>:<span style="color: #cc66cc;">53.188</span> CET depesz@depesz <span style="color: #cc66cc;">17778</span> <span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">local</span><span style="color: #66cc66;">&#93;</span> ERROR:  operator does <span style="color: #993333; font-weight: bold;">not</span> exist: <span style="color: #993333; font-weight: bold;">integer</span> <span style="color: #66cc66;">+</span> text at <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #cc66cc;">10</span></pre></td></tr></table></div>

<p>Aside from -p (prefix), -l (line) and -m (match) pg.grep supports also:</p>
<ul>
<li>-s &#8211; skip &#8211; reverse match. -s &#8220;operator does not exist" would skip messages containing this error</li>
<li>-M &#8211; case sensitive -m</li>
<li>-S &#8211; case sensitive -s</li>
</ul>
<p>Of course you can use many -m/-s/-M/-S, for example like this:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">=$ <span style="color: #c20cb9; font-weight: bold;">cat</span> postgresql-<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span>_1<span style="color: #000000; font-weight: bold;">*</span> <span style="color: #000000; font-weight: bold;">|</span> ~<span style="color: #000000; font-weight: bold;">/</span>pg.grep <span style="color: #660033;">-p</span> <span style="color: #ff0000;">&quot;%m %u@%d %p %r &quot;</span> <span style="color: #660033;">-m</span> ERROR:.<span style="color: #000000; font-weight: bold;">*</span>syntax <span style="color: #660033;">-l</span> <span style="color: #660033;">-s</span> integer
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">17</span>:<span style="color: #000000;">32</span>:<span style="color: #000000;">37.787</span> CET depesz<span style="color: #000000; font-weight: bold;">@</span>depesz <span style="color: #000000;">17778</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #7a0874; font-weight: bold;">local</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> ERROR:  syntax error at or near <span style="color: #ff0000;">&quot;;&quot;</span> at character <span style="color: #000000;">11</span></pre></td></tr></table></div>

<p>Which would show all ERRORS related to syntax, except the ones that are related to integers (like: invalid input syntax for integer: &#8220;asbc" at character 12)</p>
<h1>fast dump and restore</h1>
<p>Available from <a href="https://labs.omniti.com/pgtreats/trunk/tools/fast.dump.and.restore">OmniTI SVN</a>.</p>
<p>This are tools that can be used to make fast, but somehow unsafe dump of database, and restore data from the dump.</p>
<p>The general idea was <a href="http://www.depesz.com/index.php/2009/09/19/speeding-up-dumprestore-process/">presented</a> by me some time ago, and used, with success, for one of clients.</p>
<p>The scripts that were written then, got generalized, rewritten, and are now available for you.</p>
<p>The &#8220;unsafe" part is very simple &#8211; to make the dump fast, the script does the work in parallel. By working in parallel it has multiple transactions open, and as such, it cannot have any guarantees (from PostgreSQL) about consistency of the data <b>between</b> the transactions.</p>
<p>So &#8211; you can easily use it, as long as there are no other (than fast.dump) connections to database &#8211; that is writing connections. As long as other connections are only reading &#8211; you're fine. But any write to database can, and most likely will, bite you when you'll work with restore.</p>
<p>To use the tools, just run them with &#8211;help. And always first try on some test/devel machine.</p>
<h1>system_monitoring</h1>
<p>Available from <a href="https://github.com/omniti-labs/system_monitoring">OmniTI SVN</a>.</p>
<p>This tool is not strictly for PostgreSQL, but I use it on virtually any Pg server I have to look after, and I found it very useful.</p>
<p>You most likely all know tools like Cacti, Ganglia, Munin and so on.</p>
<p>system.monitoring is similar in the way that it gets data from system. But it's totally different in a way that it doesn't make any graphs. It just stores the data.</p>
<p>But, addition of new data to be stored is trivial.</p>
<p>Most generally system_monitoring.pl is simply job scheduler &#8211; like cron. But, unlike cron, it is not limited to 1 minute as the shortest interval. It can easily run jobs every second. Or run jobs that never end.</p>
<p>It will run every command you give it to run, and log its output. That's all. But since it's small, and the logged format is normal plain text, it became extremely useful for me.</p>
<p>Let's take a look at <a href="https://labs.omniti.com/pgtreats/trunk/tools/system.monitoring/config-sample.cfg">sample config</a>.</p>
<p>At the beginning I set some variables &#8211; most importantly &#8211; where the logs will go.</p>
<p>Then I set environment variables that will be used for all &#8220;checks" (it can be overridden for every check). And then I set some additional variables which make running checks a bit nicer.</p>
<p>Then, I have the actual checks.</p>
<p>There are three kinds of them: persistent (command), periodic command, and periodic file.</p>
<p>persistent check example looks like this:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="test" style="font-family:monospace;">check.iostat.type=persistent
check.iostat.exec=iostat -kx 5</pre></td></tr></table></div>

<p>On start, system_monitoring.pl will run iostat -kx 5, and then will log everything it will output, when it will output, to the iostat logfile.</p>
<p>Periodic check can looks like this:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">check.ps.type=periodic
check.ps.exec=ps axo user,pid,ppid,pgrp,%cpu,%mem,rss,lstart,nice,nlwp,sgi_p,cputime,tty,wchan:25,args
check.ps.interval=30</pre></td></tr></table></div>

<p>This will run, every 30 seconds, this ps command, and log output.</p>
<p>If first character of exec for check is &#8220;&lt;" the rest of exec line is assumed to be file that should be opened (to read), and it's content be copied to log for given check. Hence:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">check.mem.type=periodic
check.mem.exec=&lt; /proc/meminfo
check.mem.interval=10</pre></td></tr></table></div>

<p>Will log meminfo every 10 seconds to logs.</p>
<p>Logs are stored in tree structure which is based on when even happened. Exact filename for check is:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">LOGDIR/YYYY/MM/DD/CHECK_NAME-HOUR.log</pre></td></tr></table></div>

<p>So, with default logdir, current meminfo log is:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">/var/log/system_monitoring/2012/01/22/mem-2012-01-22-16.log</pre></td></tr></table></div>

<p>It looks like this:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">2012-01-22 16:00:02 UTC BSGMA   MemTotal:     528655576 kB
2012-01-22 16:00:02 UTC BSGMA   MemFree:      14354712 kB
2012-01-22 16:00:02 UTC BSGMA   Buffers:       1099748 kB
2012-01-22 16:00:02 UTC BSGMA   Cached:       465002160 kB
2012-01-22 16:00:02 UTC BSGMA   SwapCached:       5304 kB
2012-01-22 16:00:02 UTC BSGMA   Active:       426886732 kB
2012-01-22 16:00:02 UTC BSGMA   Inactive:     55076184 kB
2012-01-22 16:00:02 UTC BSGMA   HighTotal:           0 kB
2012-01-22 16:00:02 UTC BSGMA   HighFree:            0 kB
2012-01-22 16:00:02 UTC BSGMA   LowTotal:     528655576 kB
2012-01-22 16:00:02 UTC BSGMA   LowFree:      14354712 kB
2012-01-22 16:00:02 UTC BSGMA   SwapTotal:     2048276 kB
2012-01-22 16:00:02 UTC BSGMA   SwapFree:      1902552 kB
2012-01-22 16:00:02 UTC BSGMA   Dirty:            5776 kB
2012-01-22 16:00:02 UTC BSGMA   Writeback:         236 kB
2012-01-22 16:00:02 UTC BSGMA   AnonPages:    15869780 kB
2012-01-22 16:00:02 UTC BSGMA   Mapped:       107046492 kB
2012-01-22 16:00:02 UTC BSGMA   Slab:         10872504 kB
2012-01-22 16:00:02 UTC BSGMA   PageTables:   20694796 kB
2012-01-22 16:00:02 UTC BSGMA   NFS_Unstable:        0 kB
2012-01-22 16:00:02 UTC BSGMA   Bounce:              0 kB
2012-01-22 16:00:02 UTC BSGMA   CommitLimit:  266376064 kB
2012-01-22 16:00:02 UTC BSGMA   Committed_AS: 158592164 kB
2012-01-22 16:00:02 UTC BSGMA   VmallocTotal: 34359738367 kB
2012-01-22 16:00:02 UTC BSGMA   VmallocUsed:    271152 kB
2012-01-22 16:00:02 UTC BSGMA   VmallocChunk: 34359466935 kB
2012-01-22 16:00:02 UTC BSGMA   HugePages_Total:     0
2012-01-22 16:00:02 UTC BSGMA   HugePages_Free:      0
2012-01-22 16:00:02 UTC BSGMA   HugePages_Rsvd:      0
2012-01-22 16:00:02 UTC BSGMA   Hugepagesize:     2048 kB
2012-01-22 16:00:12 UTC BSGPA   MemTotal:     528655576 kB</pre></td></tr></table></div>

<p>And so on.</p>
<p>As you can see nothing really complicated.</p>
<p>There are 2 more features. One of them are checks that are configured so that their output is ignored and not logged &#8211; this is for cleanup jobs &#8211; check last three in example config.</p>
<p>The other feature are headers.</p>
<p>For example, let's look at pg_stat_database check. The way it's written, it logs data like:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">tail</span> pg_stat_database-<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span>-<span style="color: #000000;">15</span>.log
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:06 UTC BSF9w   template1       <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       t       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15545653</span>        <span style="color: #000000;">1663</span>    \N      <span style="color: #7a0874; font-weight: bold;">&#123;</span>=c<span style="color: #000000; font-weight: bold;">/</span>postgres,<span style="color: #007800;">postgres</span>=CTc<span style="color: #000000; font-weight: bold;">/</span>postgres<span style="color: #7a0874; font-weight: bold;">&#125;</span>     <span style="color: #000000;">4689516</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:06 UTC BSF9w   postgres        <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15253018</span>        <span style="color: #000000;">1663</span>    \N      \N      <span style="color: #000000;">42800983660</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:06 UTC BSF9w   pg_audit        <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15252690</span>        <span style="color: #000000;">1663</span>    \N      \N      <span style="color: #000000;">4779628</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:06 UTC BSF9w   template0       <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       t       f       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">3886088170</span>      <span style="color: #000000;">1663</span>    \N      <span style="color: #7a0874; font-weight: bold;">&#123;</span>=c<span style="color: #000000; font-weight: bold;">/</span>postgres,<span style="color: #007800;">postgres</span>=CTc<span style="color: #000000; font-weight: bold;">/</span>postgres<span style="color: #7a0874; font-weight: bold;">&#125;</span>     <span style="color: #000000;">4583020</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:06 UTC BSF9w   magicdb <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">3922373574</span>      <span style="color: #000000;">1663</span>    <span style="color: #7a0874; font-weight: bold;">&#123;</span><span style="color: #ff0000;">&quot;search_path=public, check_postgres, ltree, pgcrypto&quot;</span><span style="color: #7a0874; font-weight: bold;">&#125;</span> \N      <span style="color: #000000;">716819345004</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:<span style="color: #000000;">37</span> UTC BSGFA   template1       <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       t       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15545653</span>        <span style="color: #000000;">1663</span>    \N      <span style="color: #7a0874; font-weight: bold;">&#123;</span>=c<span style="color: #000000; font-weight: bold;">/</span>postgres,<span style="color: #007800;">postgres</span>=CTc<span style="color: #000000; font-weight: bold;">/</span>postgres<span style="color: #7a0874; font-weight: bold;">&#125;</span>     <span style="color: #000000;">4689516</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:<span style="color: #000000;">37</span> UTC BSGFA   postgres        <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15253018</span>        <span style="color: #000000;">1663</span>    \N      \N      <span style="color: #000000;">42800983660</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:<span style="color: #000000;">37</span> UTC BSGFA   pg_audit        <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">15252690</span>        <span style="color: #000000;">1663</span>    \N      \N      <span style="color: #000000;">4779628</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:<span style="color: #000000;">37</span> UTC BSGFA   template0       <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       t       f       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">3886088170</span>      <span style="color: #000000;">1663</span>    \N      <span style="color: #7a0874; font-weight: bold;">&#123;</span>=c<span style="color: #000000; font-weight: bold;">/</span>postgres,<span style="color: #007800;">postgres</span>=CTc<span style="color: #000000; font-weight: bold;">/</span>postgres<span style="color: #7a0874; font-weight: bold;">&#125;</span>     <span style="color: #000000;">4583020</span>
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:<span style="color: #000000;">59</span>:<span style="color: #000000;">37</span> UTC BSGFA   magicdb <span style="color: #000000;">10</span>      <span style="color: #000000;">6</span>       f       t       <span style="color: #660033;">-1</span>      <span style="color: #000000;">11510</span>   <span style="color: #000000;">3922373574</span>      <span style="color: #000000;">1663</span>    <span style="color: #7a0874; font-weight: bold;">&#123;</span><span style="color: #ff0000;">&quot;search_path=public, check_postgres, ltree, pgcrypto&quot;</span><span style="color: #7a0874; font-weight: bold;">&#125;</span> \N      <span style="color: #000000;">716820033132</span></pre></td></tr></table></div>

<p>which is nice, but it would be cool to be able to know what which columns mean.</p>
<p>So we have &#8220;check.pg_stat_database.header" line, which makes system_montoring, to log, whenever it rotates logfile (i.e. every hour) to first log header:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">1</span> pg_stat_database-<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span>-<span style="color: #000000;">15</span>.log
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">15</span>:00:01 UTC :h   datname datdba  encoding        datistemplate   datallowconn    datconnlimit    datlastsysoid   datfrozenxid    dattablespace   datconfig       datacl  <span style="color: #c20cb9; font-weight: bold;">size</span></pre></td></tr></table></div>

<p>And that's about it. The one additional feature is that you can run system_monitoring and request it to show you data for given check for given time (or closest possible time after):</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">=$ .<span style="color: #000000; font-weight: bold;">/</span>system_monitoring.pl <span style="color: #660033;">-s</span> loadavg <span style="color: #660033;">-t</span> <span style="color: #ff0000;">'2012-01-22 18:04:00'</span> config-sample.cfg
<span style="color: #000000;">2012</span>-01-<span style="color: #000000;">22</span> <span style="color: #000000;">18</span>:04:00 CET Kg      <span style="color: #000000;">0.01</span> <span style="color: #000000;">0.10</span> <span style="color: #000000;">0.12</span> <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #000000;">575</span> <span style="color: #000000;">20320</span></pre></td></tr></table></div>

<p>And that's all. But thanks to its simplicity it's trivial to use the data it logs for some graphing tool, or just read it.</p>
<p><br/></p>
<p>And that would be all for now. If you'll use any of these, have fun &#8211; they are free to use, free to modify. Sending me back patches is a nice touch, but I don't require it.</p>
<p><!-- vim: set spell spelllang=en_US ft=xhtml: --></p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">15 comments <a href='http://www.depesz.com/2012/01/23/some-new-tools-for-postgresql-or-around-postgresql/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-34805" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34805" title="">#</a></span> <a href='http://sharingtechknowledge.blogspot.com/' rel='external nofollow' class='url'>Rene Romero Benavides</a></div>  <div class="date">Jan 23, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/035dce5837a3ee3da819a1ec82fa3d85?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Thanks for sharing your tools. I&#8217;m looking forward to use them. Cheers!</p>
	</li>
		
		
			
<li class="odd" id="comment-34818" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34818" title="">#</a></span> yDNA</div>  <div class="date">Jan 24, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>If you&#8217;re on a system with the GNU version of tail, try:</p>
<p>tail -F /var/log/whatever</p>
<p>No need to write a new version of tail.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34819" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34819" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@yDNA:<br />
Sure, I know about tail -F. But this only helps when file gets truncated and/or renamed.<br />
But Pg changes name of logfile. I.e. it can switch from postgresql-2012-01-20.log to postgresql-2012-01-21.log Or anything else &#8211; based of &#8220;log_filename&#8221; GUC.</p>
	</li>
		
		
			
<li class="odd" id="comment-34859" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34859" title="">#</a></span> Sean Chittenden</div>  <div class="date">Jan 24, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/032f0832fef7fa016de14a756fa8ac65?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>I actually use runit to start PostgreSQL and have everything log to stdout. This eliminates the need for PostgreSQL log rotation. This is another way to do it and keep PostgreSQL&#8217;s environment clean.</p>
<p>#postgresql/run<br />
#!/bin/sh &#8211;<br />
exec 2&gt;&amp;1<br />
exec chpst -u postgres /usr/local/bin/postgres -D /pgdata/data</p>
<p>#postgresl/log/run<br />
#!/bin/sh &#8211;<br />
exec 2&gt;&amp;1<br />
exec chpst -ulog svlogd ./main</p>
<p>tail -F postgresql/log/main/current</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34861" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34861" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Sean:<br />
I wouldn&#8217;t really use unrotated logs &#8211; having hundreds of gigabytes in single file gets tedious pretty fast.</p>
	</li>
		
		
			
<li class="odd" id="comment-34914" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34914" title="">#</a></span> John Keith Hohm</div>  <div class="date">Jan 27, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/5c4cc311a59999fd11d3569a0cb2a0d9?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@despez:</p>
<p>svlogd continuously reads log data from its standard input, optionally filters log messages, and writes the data to one or more automatically rotated logs.</p>
<p><a href="http://smarden.org/runit/svlogd.8.html" rel="nofollow">http://smarden.org/runit/svlogd.8.html</a></p>
<p>The current log file is always named current, so tail -F works perfectly as @Sean described.</p>
	</li>
		
		
			
<li class="odd" id="comment-36179" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36179" title="">#</a></span> Matthew Musgrove</div>  <div class="date">Aug 30, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/9946393d72647afb718c7d81a0ac9a1f?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Have the tools been moved or is there a problem with the web server?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-36180" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36180" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Aug 30, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Matthew:</p>
<p>temporary server problems. Should be solved soon(ish).</p>
	</li>
		
		
			
<li class="odd" id="comment-36217" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36217" title="">#</a></span> Matthew Musgrove</div>  <div class="date">Sep 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/9946393d72647afb718c7d81a0ac9a1f?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>I found a minor problem with pg.grep. It was showing me everything in my log files. After further investigation, I realized it was due to pg.grep not knowing what to do with %a in our log_line_prefix.</p>
<p>I used the following to the end of the %re hash in the prefix_to_re subroutine (YMMV):</p>
<p>        &#8216;a&#8217; =&gt; &#8216;(?:[a-z0-9_]*|\[unknown\])&#8217;,</p>
	</li>
		
		
			
<li class="odd" id="comment-36218" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36218" title="">#</a></span> Matthew Musgrove</div>  <div class="date">Sep 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/9946393d72647afb718c7d81a0ac9a1f?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Don&#8217;t try copy and paste&#8230; The comment form converted all of my single ticks into MS Word style single quotes.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-36219" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36219" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Sep 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Matthew:<br />
Committed new version, which has support for (almost) all % sequences that might be in log_line_prefix. Made the %a differently, but it should work fine, please test.</p>
	</li>
		
		
			
<li class="odd" id="comment-36221" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36221" title="">#</a></span> Matthew Musgrove</div>  <div class="date">Sep 24, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/9946393d72647afb718c7d81a0ac9a1f?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Very nice. Thank you very much!</p>
	</li>
		
		
			
<li class="odd" id="comment-83048" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-83048" title="">#</a></span> Pius</div>  <div class="date">Jun 6, 2014</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/31dcfcd65cef63d80cc1df0cdf6a168c?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Does pg.grep work on CSV format database log? I tried but it seems it can not:</p>
<p>cat postgresql.log | pg.grep -p &#8220;%m,%u,%d,%p,%r,%c,%l,%i,%s,%v,%x&#8221;</p>
	</li>
		
		
			
<li class="mycomment" id="comment-83639" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-83639" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jun 7, 2014</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Pius:<br />
no, it doesn&#8217;t. You can grep these at ease with normal grep. pg.grep &#8220;cool&#8221; thing is that it allows you to grep log lines even if they contain multiple &#8220;real&#8221; lines. csv logs don&#8217;t have that problem, afair.</p>
	</li>
		
		
			
<li class="odd" id="comment-85340" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-85340" title="">#</a></span> Pius</div>  <div class="date">Jun 10, 2014</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/31dcfcd65cef63d80cc1df0cdf6a168c?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Hi Depsez,</p>
<p>Too bad :(, multiple lines still exists in csv log:</p>
<p>2014-06-09 16:24:24.878 PDT,&#8221;postgres&#8221;,&#8221;postgres&#8221;,9119,&#8221;[local]&#8220;,53964228.239f,2,&#8221;authentication&#8221;,2014-06-09 16:24:24 PDT,2/71947,0,LOG,00000,&#8221;connection authorized: user=postgres database=postgres&#8221;,,,,,,,,,&#8221;&#8221;<br />
2014-06-09 16:24:25.004 PDT,&#8221;postgres&#8221;,&#8221;postgres&#8221;,9119,&#8221;[local]&#8220;,53964228.239f,3,&#8221;idle&#8221;,2014-06-09 16:24:24 PDT,2/71948,0,LOG,00000,&#8221;statement: SELECT d.datname as &#8220;&#8221;Name&#8221;&#8221;,<br />
       pg_catalog.pg_get_userbyid(d.datdba) as &#8220;&#8221;Owner&#8221;&#8221;,<br />
       pg_catalog.pg_encoding_to_char(d.encoding) as &#8220;&#8221;Encoding&#8221;&#8221;,<br />
       d.datcollate as &#8220;&#8221;Collate&#8221;&#8221;,<br />
       d.datctype as &#8220;&#8221;Ctype&#8221;&#8221;,<br />
       pg_catalog.array_to_string(d.datacl, E&#8217;\n&#8217;) AS &#8220;&#8221;Access privileges&#8221;&#8221;<br />
FROM pg_catalog.pg_database d<br />
ORDER BY 1;&#8221;,,,,,,,,,&#8221;psql.bin&#8221;<br />
2014-06-09 16:24:25.284 PDT,&#8221;postgres&#8221;,&#8221;postgres&#8221;,9119,&#8221;[local]&#8220;,53964228.239f,4,&#8221;SELECT&#8221;,2014-06-09 16:24:24 PDT,2/0,0,LOG,00000,&#8221;duration: 314.140 ms&#8221;,,,,,,,,,&#8221;psql.bin&#8221;<br />
2014-06-09 16:24:25.285 PDT,&#8221;postgres&#8221;,&#8221;postgres&#8221;,9119,&#8221;[local]&#8220;,53964228.239f,5,&#8221;idle&#8221;,2014-06-09 16:24:24 PDT,,0,LOG,00000,&#8221;disconnection: session time: 0:00:00.462 user=postgres database=postgres host=[local]&#8220;,,,,,,,,,&#8221;psql.bin&#8221;</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="2366" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="b2a9cdca92" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="36"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">2 comments</span> | <span class="wpp-views">633 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">4 comments</span> | <span class="wpp-views">615 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">264 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">205 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">144 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">142 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">128 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">126 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">113 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/03/07/waiting-for-9-1-foreach-in-array/" title="Waiting for 9.1 &#8211; FOREACH IN ARRAY" class="wpp-post-title" target="_self">Waiting for 9.1 &#8211; FOREACH IN ARRAY</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">100 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochód</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

