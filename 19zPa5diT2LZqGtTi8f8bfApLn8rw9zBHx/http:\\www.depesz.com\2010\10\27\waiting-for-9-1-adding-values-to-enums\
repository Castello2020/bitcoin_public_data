http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 23 Jul 2014 02:59:50 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=1890>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Waiting for 9.1 &#8211; adding values to enums</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Waiting for 9.1 &#8211; adding values to enums Comments Feed" href="http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/' />
<link rel='shortlink' href='http://www.depesz.com/?p=1890' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-1890">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/" rel="bookmark" title="Permanent Link to Waiting for 9.1 &#8211; adding values to enums">Waiting for 9.1 &#8211; adding values to enums</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>October 27th, 2010 by depesz | Tags: <a href="http://www.depesz.com/tag/alter/" rel="tag">alter</a>, <a href="http://www.depesz.com/tag/alter-type/" rel="tag">alter type</a>, <a href="http://www.depesz.com/tag/enum/" rel="tag">enum</a>, <a href="http://www.depesz.com/tag/pg91/" rel="tag">pg91</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/type/" rel="tag">type</a> |  <a href="http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/#comments" title="Comment on Waiting for 9.1 &#8211; adding values to enums">9 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>Finally, on 25th of October, Tom Lane <a href="http://archives.postgresql.org/pgsql-committers/2010-10/msg00223.php">committed</a> patch which does:</p>
<p><code>Allow new values to be added to an existing enum type.<br />
&nbsp;<br />
After much expenditure of effort, we've got this to the point where the<br />
performance penalty is pretty minimal in typical cases.<br />
&nbsp;<br />
Andrew Dunstan, reviewed by Brendan Jurd, Dean Rasheed, and Tom Lane</code></p>
<p><span id="more-1890"></span></p>
<p>As you perhaps know <a href="http://www.postgresql.org/docs/current/interactive/datatype-enum.html">ENUM</a> datatype was added to PostgreSQL in 8.3, but (at the very least for me) it was virtually unusable, as it couldn't be modified.</p>
<p>Well, truth be told &#8211; it could be modified by changing catalogs, but I just don't feel smart enough to modify catalogs with normal queries, so I just don't do it.</p>
<p>Now &#8211; we got a way to add new values to ENUMS.</p>
<p>Let's see how it works. First I will need some enum:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TYPE</span> mood <span style="color: #993333; font-weight: bold;">AS</span> ENUM <span style="color: #66cc66;">&#40;</span>
    <span style="color: #ff0000;">'sad'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'ok'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'happy'</span>
<span style="color: #66cc66;">&#41;</span>;</pre></td></tr></table></div>

<p>And now I can use the values with casts to enum:</p>
<p><code>select 'sad'::mood;<br />
 mood<br />
------<br />
 sad<br />
(1 row)</code></p>
<p>This example is not really helpful, but I wanted to show as simple as possible something that works, and something that doesn't:</p>
<p><code>select 'dead'::mood;<br />
ERROR:  invalid input value for enum mood: &quot;dead&quot;<br />
LINE 1: select 'dead'::mood;<br />
               ^</code></p>
<p>While is might be debated whether dead is a mood, the fact is that our enum doesn't allow it. But if we'd really need, we can now:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">alter</span> <span style="color: #993333; font-weight: bold;">type</span> mood <span style="color: #993333; font-weight: bold;">add</span> <span style="color: #ff0000;">'dead'</span> <span style="color: #993333; font-weight: bold;">BEFORE</span> <span style="color: #ff0000;">'happy'</span>;</pre></td></tr></table></div>

<p>And now the datatype looks like:</p>
<p><code>\dT+ mood<br />
                      List of data types<br />
 Schema | Name | Internal name | Size | Elements | Description<br />
--------+------+---------------+------+----------+-------------<br />
 public | mood | mood          | 4    | sad     +|<br />
        |      |               |      | ok      +|<br />
        |      |               |      | dead    +|<br />
        |      |               |      | happy    |<br />
(1 row)</code></p>
<p>And so, I can:</p>
<p><code>select 'dead'::mood;<br />
 mood<br />
------<br />
 dead<br />
(1 row)</code></p>
<p>It's great. ENUM still doesn't solve all needs (what if we no longer support users which are dead? There is no way to remove the value from ENUM, but it's a big step towards making ENUMs <b>fully</b> useful.</p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">9 comments <a href='http://www.depesz.com/2010/10/27/waiting-for-9-1-adding-values-to-enums/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-30404" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30404" title="">#</a></span> gregj</div>  <div class="date">Oct 27, 2010</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/6870ded0f7f315d7bc075aca723fdaf9?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>so we will get remove (drop) of enum values in (9.1-8.3)  3 releases from 9.1, so 9.4 <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
<p>nice <img src="http://www.depesz.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-30405" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30405" title="">#</a></span> <a href='http://pgolub.wordpress.com/' rel='external nofollow' class='url'>Pavel Golub</a></div>  <div class="date">Oct 27, 2010</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>It is worth noting that Andrew Dunstan proposed to use:</p>
<p>ALTER TYPE enumtype ADD LABEL &#8216;newlabel&#8217;</p>
<p>And I completely agree with him, just like some other guys.</p>
	</li>
		
		
			
<li class="odd" id="comment-30407" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30407" title="">#</a></span> <a href='http://www.pureinnovation.com' rel='external nofollow' class='url'>Chris Mellish</a></div>  <div class="date">Oct 27, 2010</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/e8c4f8a05d7336ea492e3b2c5ea58fe0?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>These two functions were borrowed from another web page (can&#8217;t remember where, but I&#8217;m sure a google search will find the original author) and modified to take schema&#8217;s into account:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">OR</span> <span style="color: #993333; font-weight: bold;">REPLACE</span> <span style="color: #993333; font-weight: bold;">FUNCTION</span> enum_add<span style="color: #66cc66;">&#40;</span>enum_name <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">,</span> enum_elem <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">,</span> enum_schema <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'public'</span>::<span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">&#41;</span>
  <span style="color: #993333; font-weight: bold;">RETURNS</span> void <span style="color: #993333; font-weight: bold;">AS</span>
$BODY$
<span style="color: #993333; font-weight: bold;">DECLARE</span>
    schemaoid       <span style="color: #993333; font-weight: bold;">integer</span>;
<span style="color: #993333; font-weight: bold;">BEGIN</span>
    <span style="color: #993333; font-weight: bold;">SELECT</span> oid <span style="color: #993333; font-weight: bold;">INTO</span> schemaoid <span style="color: #993333; font-weight: bold;">FROM</span> pg_namespace <span style="color: #993333; font-weight: bold;">WHERE</span> nspname <span style="color: #66cc66;">=</span> enum_schema;
    <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> FOUND <span style="color: #993333; font-weight: bold;">THEN</span>
    RAISE EXCEPTION <span style="color: #ff0000;">'Could not find schema '</span><span style="color: #ff0000;">'%'</span><span style="color: #ff0000;">''</span><span style="color: #66cc66;">,</span> enum_schema;
    <span style="color: #993333; font-weight: bold;">END</span> <span style="color: #993333; font-weight: bold;">IF</span>;
    <span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #993333; font-weight: bold;">INTO</span> pg_enum<span style="color: #66cc66;">&#40;</span>enumtypid<span style="color: #66cc66;">,</span> enumlabel<span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">VALUES</span><span style="color: #66cc66;">&#40;</span>
        <span style="color: #66cc66;">&#40;</span><span style="color: #993333; font-weight: bold;">SELECT</span> oid <span style="color: #993333; font-weight: bold;">FROM</span> pg_type <span style="color: #993333; font-weight: bold;">WHERE</span> typtype<span style="color: #66cc66;">=</span><span style="color: #ff0000;">'e'</span> <span style="color: #993333; font-weight: bold;">AND</span> typname<span style="color: #66cc66;">=</span>enum_name <span style="color: #993333; font-weight: bold;">AND</span> typnamespace <span style="color: #66cc66;">=</span> schemaoid<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
        enum_elem
    <span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">END</span>;
$BODY$
  <span style="color: #993333; font-weight: bold;">LANGUAGE</span> plpgsql VOLATILE
  COST <span style="color: #cc66cc;">100</span>;</pre></td></tr></table></div>


<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">OR</span> <span style="color: #993333; font-weight: bold;">REPLACE</span> <span style="color: #993333; font-weight: bold;">FUNCTION</span> enum_del<span style="color: #66cc66;">&#40;</span>enum_name <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">,</span> enum_elem <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">,</span> enum_schema <span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #ff0000;">'public'</span>::<span style="color: #993333; font-weight: bold;">character</span> <span style="color: #993333; font-weight: bold;">varying</span><span style="color: #66cc66;">&#41;</span>
  <span style="color: #993333; font-weight: bold;">RETURNS</span> void <span style="color: #993333; font-weight: bold;">AS</span>
$BODY$
<span style="color: #993333; font-weight: bold;">DECLARE</span>
    type_oid <span style="color: #993333; font-weight: bold;">INTEGER</span>;
    rec RECORD;
    <span style="color: #993333; font-weight: bold;">sql</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span>;
    ret <span style="color: #993333; font-weight: bold;">INTEGER</span>;
    schemaoid <span style="color: #993333; font-weight: bold;">INTEGER</span>;
<span style="color: #993333; font-weight: bold;">BEGIN</span>
    <span style="color: #993333; font-weight: bold;">SELECT</span> oid <span style="color: #993333; font-weight: bold;">INTO</span> schemaoid <span style="color: #993333; font-weight: bold;">FROM</span> pg_namespace <span style="color: #993333; font-weight: bold;">WHERE</span> nspname <span style="color: #66cc66;">=</span> enum_schema;
    <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> FOUND <span style="color: #993333; font-weight: bold;">THEN</span>
    RAISE EXCEPTION <span style="color: #ff0000;">'Could not find schema '</span><span style="color: #ff0000;">'%'</span><span style="color: #ff0000;">''</span><span style="color: #66cc66;">,</span> enum_schema;
    <span style="color: #993333; font-weight: bold;">END</span> <span style="color: #993333; font-weight: bold;">IF</span>;
    <span style="color: #993333; font-weight: bold;">SELECT</span> pg_type<span style="color: #66cc66;">.</span>oid
    <span style="color: #993333; font-weight: bold;">FROM</span> pg_type
    <span style="color: #993333; font-weight: bold;">WHERE</span> typtype <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'e'</span> <span style="color: #993333; font-weight: bold;">AND</span> typname <span style="color: #66cc66;">=</span> enum_name <span style="color: #993333; font-weight: bold;">AND</span> typnamespace <span style="color: #66cc66;">=</span> schemaoid
    <span style="color: #993333; font-weight: bold;">INTO</span> type_oid;
    <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> FOUND <span style="color: #993333; font-weight: bold;">THEN</span>
        RAISE EXCEPTION <span style="color: #ff0000;">'Cannot find a enum: %'</span><span style="color: #66cc66;">,</span> enum_name;
    <span style="color: #993333; font-weight: bold;">END</span> <span style="color: #993333; font-weight: bold;">IF</span>;
    <span style="color: #808080; font-style: italic;">-- Check column DEFAULT value references.</span>
    <span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #66cc66;">*</span>
    <span style="color: #993333; font-weight: bold;">FROM</span>
        pg_attrdef
        <span style="color: #993333; font-weight: bold;">JOIN</span> pg_attribute <span style="color: #993333; font-weight: bold;">ON</span> attnum <span style="color: #66cc66;">=</span> adnum <span style="color: #993333; font-weight: bold;">AND</span> atttypid <span style="color: #66cc66;">=</span> type_oid
        <span style="color: #993333; font-weight: bold;">JOIN</span> pg_class <span style="color: #993333; font-weight: bold;">ON</span> pg_class<span style="color: #66cc66;">.</span>oid <span style="color: #66cc66;">=</span> attrelid
        <span style="color: #993333; font-weight: bold;">JOIN</span> pg_namespace <span style="color: #993333; font-weight: bold;">ON</span> pg_namespace<span style="color: #66cc66;">.</span>oid <span style="color: #66cc66;">=</span> relnamespace
    <span style="color: #993333; font-weight: bold;">WHERE</span>
        adsrc <span style="color: #66cc66;">=</span> quote_literal<span style="color: #66cc66;">&#40;</span>enum_elem<span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">'::'</span> <span style="color: #66cc66;">||</span> quote_ident<span style="color: #66cc66;">&#40;</span>enum_name<span style="color: #66cc66;">&#41;</span>
    <span style="color: #993333; font-weight: bold;">LIMIT</span> <span style="color: #cc66cc;">1</span>
    <span style="color: #993333; font-weight: bold;">INTO</span> rec;
    <span style="color: #993333; font-weight: bold;">IF</span> FOUND <span style="color: #993333; font-weight: bold;">THEN</span>
        RAISE EXCEPTION
            <span style="color: #ff0000;">'Cannot delete the ENUM element %.%: column %.%.% has DEFAULT value of '</span><span style="color: #ff0000;">'%'</span><span style="color: #ff0000;">''</span><span style="color: #66cc66;">,</span>
            quote_ident<span style="color: #66cc66;">&#40;</span>enum_name<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span> quote_ident<span style="color: #66cc66;">&#40;</span>enum_elem<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
            quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>nspname<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span> quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>relname<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
            rec<span style="color: #66cc66;">.</span>attname<span style="color: #66cc66;">,</span> quote_ident<span style="color: #66cc66;">&#40;</span>enum_elem<span style="color: #66cc66;">&#41;</span>;
    <span style="color: #993333; font-weight: bold;">END</span> <span style="color: #993333; font-weight: bold;">IF</span>;
    <span style="color: #808080; font-style: italic;">-- Check data references.</span>
    <span style="color: #993333; font-weight: bold;">FOR</span> rec <span style="color: #993333; font-weight: bold;">IN</span>
        <span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #66cc66;">*</span>
        <span style="color: #993333; font-weight: bold;">FROM</span>
            pg_attribute
            <span style="color: #993333; font-weight: bold;">JOIN</span> pg_class <span style="color: #993333; font-weight: bold;">ON</span> pg_class<span style="color: #66cc66;">.</span>oid <span style="color: #66cc66;">=</span> attrelid
            <span style="color: #993333; font-weight: bold;">JOIN</span> pg_namespace <span style="color: #993333; font-weight: bold;">ON</span> pg_namespace<span style="color: #66cc66;">.</span>oid <span style="color: #66cc66;">=</span> relnamespace
        <span style="color: #993333; font-weight: bold;">WHERE</span>
            atttypid <span style="color: #66cc66;">=</span> type_oid
            <span style="color: #993333; font-weight: bold;">AND</span> relkind <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'r'</span>
    LOOP
        <span style="color: #993333; font-weight: bold;">sql</span> :<span style="color: #66cc66;">=</span>
            <span style="color: #ff0000;">'SELECT 1 FROM ONLY '</span>
            <span style="color: #66cc66;">||</span> quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>nspname<span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">'.'</span>
            <span style="color: #66cc66;">||</span> quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>relname<span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">' '</span>
            <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">' WHERE '</span>
            <span style="color: #66cc66;">||</span> quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>attname<span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">' = '</span>
            <span style="color: #66cc66;">||</span> quote_literal<span style="color: #66cc66;">&#40;</span>enum_elem<span style="color: #66cc66;">&#41;</span>
            <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">' LIMIT 1'</span>;
        <span style="color: #993333; font-weight: bold;">EXECUTE</span> <span style="color: #993333; font-weight: bold;">sql</span> <span style="color: #993333; font-weight: bold;">INTO</span> ret;
        <span style="color: #993333; font-weight: bold;">IF</span> ret <span style="color: #993333; font-weight: bold;">IS</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">THEN</span>
            RAISE EXCEPTION
                <span style="color: #ff0000;">'Cannot delete the ENUM element %.%: column %.%.% contains references'</span><span style="color: #66cc66;">,</span>
                quote_ident<span style="color: #66cc66;">&#40;</span>enum_name<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span> quote_ident<span style="color: #66cc66;">&#40;</span>enum_elem<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
                quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>nspname<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span> quote_ident<span style="color: #66cc66;">&#40;</span>rec<span style="color: #66cc66;">.</span>relname<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span>
                rec<span style="color: #66cc66;">.</span>attname;
        <span style="color: #993333; font-weight: bold;">END</span> <span style="color: #993333; font-weight: bold;">IF</span>;
    <span style="color: #993333; font-weight: bold;">END</span> LOOP;
    <span style="color: #808080; font-style: italic;">-- OK. We may delete.</span>
    <span style="color: #993333; font-weight: bold;">DELETE</span> <span style="color: #993333; font-weight: bold;">FROM</span> pg_enum <span style="color: #993333; font-weight: bold;">WHERE</span> enumtypid <span style="color: #66cc66;">=</span> type_oid <span style="color: #993333; font-weight: bold;">AND</span> enumlabel <span style="color: #66cc66;">=</span> enum_elem;
<span style="color: #993333; font-weight: bold;">END</span>;
$BODY$
  <span style="color: #993333; font-weight: bold;">LANGUAGE</span> plpgsql VOLATILE
  COST <span style="color: #cc66cc;">100</span>;</pre></td></tr></table></div>

<p>Both functions should work in 8.3, 8.4 and 9.0.  Usage would be as follows:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">SELECT</span> enum_add<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'enumtype'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'label'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'my_schema'</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">SELECT</span> enum_del<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'enumtype'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'label'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'my_schema'</span><span style="color: #66cc66;">&#41;</span>;</pre></td></tr></table></div>

<p>The only big problem I&#8217;ve run into is that calling enum_del to remove a value that&#8217;s still used in the database can cause all kinds of issues particularly in function definitions.  At some point I&#8217;d like to modify the enum_del function to check the entire database to see if the value you wish to remove is in use anywhere, but I haven&#8217;t had time to research this to see if it&#8217;s possible.  I&#8217;d also worry that it may be too performance intensive to perform this check automatically.</p>
	</li>
		
		
			
<li class="odd" id="comment-30408" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30408" title="">#</a></span> <a href='http://www.pureinnovation.com' rel='external nofollow' class='url'>Chris Mellish</a></div>  <div class="date">Oct 27, 2010</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/e8c4f8a05d7336ea492e3b2c5ea58fe0?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Apologies about the formatting on that last post &#8211; if you are able please could you tidy up the new lines?  Thanks!</p>
	</li>
		
		
			
<li class="odd" id="comment-30409" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30409" title="">#</a></span> <a href='http://pgolub.wordpress.com/' rel='external nofollow' class='url'>Pavel Golub</a></div>  <div class="date">Oct 28, 2010</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>I wrote post with poll about syntax of this feature: <a href="http://pgolub.wordpress.com/2010/10/28/poll-alter-type-enumtype-add-what-newlabel/" rel="nofollow">http://pgolub.wordpress.com/2010/10/28/poll-alter-type-enumtype-add-what-newlabel/</a></p>
	</li>
		
		
			
<li class="odd" id="comment-30413" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-30413" title="">#</a></span> Andrew Dunstan</div>  <div class="date">Oct 28, 2010</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d438b256de7b28895c1d0db249969dd8?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>The functions above should not be used for several reasons. The add function does not cope with Oid wraparound, and the delete function is seriously incomplete. In general you should try hard to avoid manually mangling the catalogs. If you care enough about it enough, contribute a patch rather than hacking the system tables like this. </p>
<p>Note that the new 9.1 functionality is guaranteed to preserve the sort order of the existing elements and allows you to add the new element at any arbitrary place in the sort order. That&#8217;s something that&#8217;s quite impossible with 9.0 and previous, since the catalog didn&#8217;t have any support for explicit sort order (the Oids defined the sort order).</p>
	</li>
		
		
			
<li class="odd" id="comment-34728" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34728" title="">#</a></span> szymon</div>  <div class="date">Dec 30, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/710012815df91f89c966a621192d6ad5?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>its limited:</p>
<p>&#8216;ALTER TYPE &#8230; ADD cannot be executed from a function or multi-command string&#8217;</p>
<p> <img src="http://www.depesz.com/wp-includes/images/smilies/icon_sad.gif" alt=":(" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-35518" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35518" title="">#</a></span> Gyorgy Abraham</div>  <div class="date">May 17, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/aa4a704f50ab5bc7fe7292d8fd92fa96?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Also:</p>
<p>&#8220;ALTER TYPE &#8230; ADD VALUE (the form that adds a new value to an enum type) cannot be executed inside a transaction block.&#8221;</p>
<p>We got serious work while being on 9.0 with enums, 9.1 won&#8217;t really help us because of this limitation.</p>
	</li>
		
		
			
<li class="odd" id="comment-36151" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36151" title="">#</a></span> asghar</div>  <div class="date">Aug 26, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/03759d9a24c26c03e21d63a7bd08f6bb?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>SOLVED !</p>
<p>use this  syntax :<br />
alter type cve_severity ADD VALUE &#8216;aaa&#8217;;</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="1890" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="f6fbe6d9cc" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="77"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">4 comments</span> | <span class="wpp-views">587 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">364 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">251 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">192 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">147 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">132 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">118 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">116 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">116 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/11/14/how-i-learned-to-stop-worrying-and-love-the-triggers/" title="How I Learned to Stop Worrying and Love the Triggers" class="wpp-post-title" target="_self">How I Learned to Stop Worrying and Love the Triggers</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">97 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochód</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

