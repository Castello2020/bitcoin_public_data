http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 24 Jul 2014 10:40:41 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=2831>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Waiting for 9.4 &#8211; Introduce logical decoding</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Waiting for 9.4 &#8211; Introduce logical decoding Comments Feed" href="http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/' />
<link rel='shortlink' href='http://www.depesz.com/?p=2831' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-2831">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/" rel="bookmark" title="Permanent Link to Waiting for 9.4 &#8211; Introduce logical decoding">Waiting for 9.4 &#8211; Introduce logical decoding</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>March 6th, 2014 by depesz | Tags: <a href="http://www.depesz.com/tag/decoding/" rel="tag">decoding</a>, <a href="http://www.depesz.com/tag/logical/" rel="tag">logical</a>, <a href="http://www.depesz.com/tag/pg94/" rel="tag">pg94</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/replication/" rel="tag">replication</a> |  <a href="http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/#comments" title="Comment on Waiting for 9.4 &#8211; Introduce logical decoding">10 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>On 3rd of March, Robert Haas <a href="http://git.postgresql.org/pg/commitdiff/b89e151054a05f0f6d356ca52e3b725dd0505e53">committed</a> patch:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">Introduce logical decoding.
&nbsp;
This feature, building on previous commits, allows the write-ahead log
stream to be decoded into a series of logical changes; that is,
inserts, updates, and deletes and the transactions which contain them.
It is capable of handling decoding even across changes to the schema
of the effected tables.  The output format is controlled by a
so-called &quot;output plugin&quot;; an example is included.  To make use of
this in a real replication system, the output plugin will need to be
modified to produce output in the format appropriate to that system,
and to perform filtering.
&nbsp;
Currently, information can be extracted from the logical decoding
system only via SQL; future commits will add the ability to stream
changes via walsender.
&nbsp;
Andres Freund, with review and other contributions from many other
people, including √Ålvaro Herrera, Abhijit Menon-Sen, Peter Gheogegan,
Kevin Grittner, Robert Haas, Heikki Linnakangas, Fujii Masao, Abhijit
Menon-Sen, Michael Paquier, Simon Riggs, Craig Ringer, and Steve
Singer.</pre></td></tr></table></div>

<p><span id="more-2831"></span></p>
<h1>This is <big>BIG</big></h1>
<p>Some time ago I wrote about <a href="http://www.depesz.com/2013/12/17/waiting-for-9-4-add-new-wal_level-logical-sufficient-for-logical-decoding/">logical wal_level</a>, and I mentioned that this is one of steps to get to Logical Replication.</p>
<p>Now, with this patch &#8211; we're getting really, really close.</p>
<p>Let's see what's going on, and what can be done with it.</p>
<p>Setting up is not really complex, but <a href="http://www.postgresql.org/docs/devel/static/test-decoding.html">docs</a> need fixing.</p>
<p>First, you need to setup your PostgreSQL to even allow logical replication. This means two changes in postgresql.conf, and restart:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">wal_level = logical
max_replication_slots = 3</pre></td></tr></table></div>

<p>It would be enough to have &#8220;1&#8243; as max_replication_slots, but I like to have more than I need <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
<p>Anyway. After it has been done, I connect to pg, and issue:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #ff0000;">'init'</span> <span style="color: #993333; font-weight: bold;">FROM</span> pg_create_logical_replication_slot<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'test_decoding'</span><span style="color: #66cc66;">&#41;</span>;</pre></td></tr></table></div>

<p>This creates the slot that will contain data. It will be named depesz, obviously.</p>
<p>From this moment on all changes will be available in here.</p>
<p>Let's see:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> z  <span style="color: #66cc66;">&#40;</span>id serial <span style="color: #993333; font-weight: bold;">primary</span> <span style="color: #993333; font-weight: bold;">key</span><span style="color: #66cc66;">,</span> whatever text<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">FROM</span> pg_logical_slot_get_changes<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'include-xids'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'0'</span><span style="color: #66cc66;">&#41;</span>;
  location  <span style="color: #66cc66;">|</span> xid <span style="color: #66cc66;">|</span>  <span style="color: #993333; font-weight: bold;">data</span>  
<span style="color: #808080; font-style: italic;">------------+-----+--------</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>52042D60 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">930</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">BEGIN</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A540 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">930</span> <span style="color: #66cc66;">|</span> COMMIT
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">2</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Nothing really cool &#8211; just information that transaction did happen (it could have happened in another connection &#8211; it still works.</p>
<p>What I see also is that &#8220;create table" didn't get &#8220;caught". No worries &#8211; we're in here for DML, and not DDL <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
<p>Next test &#8211; let's insert something:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> z <span style="color: #66cc66;">&#40;</span>id<span style="color: #66cc66;">,</span> whatever<span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">values</span> <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">-</span><span style="color: #cc66cc;">1000</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">FROM</span> pg_logical_slot_get_changes<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'include-xids'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'0'</span><span style="color: #66cc66;">&#41;</span>;
  location  <span style="color: #66cc66;">|</span> xid <span style="color: #66cc66;">|</span>                               <span style="color: #993333; font-weight: bold;">data</span>                                
<span style="color: #808080; font-style: italic;">------------+-----+-------------------------------------------------------------------</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A650 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">931</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">BEGIN</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A650 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">931</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">table</span> public<span style="color: #66cc66;">.</span>z: <span style="color: #993333; font-weight: bold;">INSERT</span>: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">1000</span> whatever<span style="color: #66cc66;">&#91;</span>text<span style="color: #66cc66;">&#93;</span>:<span style="color: #ff0000;">'depesz'</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A758 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">931</span> <span style="color: #66cc66;">|</span> COMMIT
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">3</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Looks promising. Now, let's see how it will work out with updates, inserts with not-all-columns, and deletes:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> z <span style="color: #66cc66;">&#40;</span>whatever<span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">values</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'row2'</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">begin</span>;
<span style="color: #993333; font-weight: bold;">BEGIN</span>
&nbsp;
<span style="color: #66cc66;">*</span>$ <span style="color: #993333; font-weight: bold;">update</span> z <span style="color: #993333; font-weight: bold;">set</span> whatever <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'new value'</span> <span style="color: #993333; font-weight: bold;">where</span> id <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span>;
<span style="color: #993333; font-weight: bold;">UPDATE</span> <span style="color: #cc66cc;">1</span>
&nbsp;
<span style="color: #66cc66;">*</span>$ <span style="color: #993333; font-weight: bold;">update</span> z <span style="color: #993333; font-weight: bold;">set</span> id <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2000</span> <span style="color: #993333; font-weight: bold;">where</span> id <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">1000</span>;
<span style="color: #993333; font-weight: bold;">UPDATE</span> <span style="color: #cc66cc;">1</span>
&nbsp;
<span style="color: #66cc66;">*</span>$ commit;
COMMIT
&nbsp;
$ <span style="color: #993333; font-weight: bold;">delete</span> <span style="color: #993333; font-weight: bold;">from</span> z <span style="color: #993333; font-weight: bold;">where</span> id <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">0</span>;
<span style="color: #993333; font-weight: bold;">DELETE</span> <span style="color: #cc66cc;">1</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">FROM</span> pg_logical_slot_get_changes<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #993333; font-weight: bold;">null</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'include-xids'</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">'0'</span><span style="color: #66cc66;">&#41;</span>;
  location  <span style="color: #66cc66;">|</span> xid <span style="color: #66cc66;">|</span>                                                  <span style="color: #993333; font-weight: bold;">data</span>                                                   
<span style="color: #808080; font-style: italic;">------------+-----+---------------------------------------------------------------------------------------------------------</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A858 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">932</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">BEGIN</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A858 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">932</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">table</span> public<span style="color: #66cc66;">.</span>z: <span style="color: #993333; font-weight: bold;">INSERT</span>: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #cc66cc;">1</span> whatever<span style="color: #66cc66;">&#91;</span>text<span style="color: #66cc66;">&#93;</span>:<span style="color: #ff0000;">'row2'</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A928 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">932</span> <span style="color: #66cc66;">|</span> COMMIT
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A960 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">933</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">BEGIN</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204A960 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">933</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">table</span> public<span style="color: #66cc66;">.</span>z: <span style="color: #993333; font-weight: bold;">UPDATE</span>: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #cc66cc;">1</span> whatever<span style="color: #66cc66;">&#91;</span>text<span style="color: #66cc66;">&#93;</span>:<span style="color: #ff0000;">'new value'</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204AA00 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">933</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">table</span> public<span style="color: #66cc66;">.</span>z: <span style="color: #993333; font-weight: bold;">UPDATE</span>: old<span style="color: #66cc66;">-</span><span style="color: #993333; font-weight: bold;">key</span>: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">1000</span> new<span style="color: #66cc66;">-</span>tuple: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2000</span> whatever<span style="color: #66cc66;">&#91;</span>text<span style="color: #66cc66;">&#93;</span>:<span style="color: #ff0000;">'depesz'</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204AAF0 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">933</span> <span style="color: #66cc66;">|</span> COMMIT
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204AAF0 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">934</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">BEGIN</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204AAF0 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">934</span> <span style="color: #66cc66;">|</span> <span style="color: #993333; font-weight: bold;">table</span> public<span style="color: #66cc66;">.</span>z: <span style="color: #993333; font-weight: bold;">DELETE</span>: id<span style="color: #66cc66;">&#91;</span><span style="color: #993333; font-weight: bold;">integer</span><span style="color: #66cc66;">&#93;</span>:<span style="color: #66cc66;">-</span><span style="color: #cc66cc;">2000</span>
 <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">/</span>5204AB78 <span style="color: #66cc66;">|</span> <span style="color: #cc66cc;">934</span> <span style="color: #66cc66;">|</span> COMMIT
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">10</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>This is very cool. Insert got proper value extracted. Update has new rows, and if I change primary key column &#8211; it is shown there. And delete is nice too.</p>
<p>Actually &#8211; with just a bit of logic, you could get output from test_decoding and convert it to real, sensible, SQL queries.</p>
<p>Andres &#8211; you're way above great for this. All the guys that reviewed and helped &#8211; thank you too.</p>
<p>Logical replication is so much closer now&#8230;</p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">10 comments <a href='http://www.depesz.com/2014/03/06/waiting-for-9-4-introduce-logical-decoding/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-44864" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44864" title="">#</a></span> Bob Henkel</div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/67956e89ead8fbe53917725858581ec1?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Could this be used for change data capture?</p>
	</li>
		
		
			
<li class="odd" id="comment-44866" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44866" title="">#</a></span> Andreas</div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Does it work on tables without primary keys?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-44868" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44868" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Andres: well, no. But:</p>
<p>1. it&#8217;s just *test* decoder<br />
2. why do you even have table without primary key ?!</p>
	</li>
		
		
			
<li class="odd" id="comment-44870" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44870" title="">#</a></span> Andreas</div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>@depesz: I do not think I have any. I was just wondering how and if it would work on tables without PKs since most logical replication solutions require PKs.</p>
	</li>
		
		
			
<li class="odd" id="comment-44871" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44871" title="">#</a></span> Andres Freund</div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Hi,</p>
<p>Depesz, thanks for the flowers and the explanations. There&#8217;s a larger documentation patch pending, that gives a lot more explanation.</p>
<p>Bob, yes, it essentially *is* change capture.</p>
<p>Andreas, yes, you can use it for tables without a pkey. INSERT is replicated for all tables without a pkey, the old key is only replicated for updates and deletes if an alternative replica identity has been configured. Check <a href="http://www.postgresql.org/docs/devel/static/sql-altertable.html" rel="nofollow">http://www.postgresql.org/docs/devel/static/sql-altertable.html</a></p>
	</li>
		
		
			
<li class="odd" id="comment-44873" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44873" title="">#</a></span> Andreas</div>  <div class="date">Mar 7, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>@Andres Freund: Thanks for the answer.</p>
<p>I really look forward to see external projects starting to use the building blocks of logical replication.</p>
	</li>
		
		
			
<li class="odd" id="comment-44894" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44894" title="">#</a></span> Bob Henkel</div>  <div class="date">Mar 9, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/67956e89ead8fbe53917725858581ec1?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Andres Sorry I was excited and posted a bit brief reaction.  I assume this would meet the needs for getting changes down into a data warehouse.Microsoft SQL Server has a feature in 2012 they call CDC that is advertised as the ideal means to capture change vs the standard method of timestamp or dml triggers.</p>
	</li>
		
		
			
<li class="odd" id="comment-44913" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44913" title="">#</a></span> Gunnar "Nick" Bluth</div>  <div class="date">Mar 10, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>That&#8217;s pretty cool, as someone recently mentioned it might not make it in&#8230;</p>
<p>Out of curiosity: did you try things like now(), random(), stored procedure calls and the like?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-44914" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-44914" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Mar 10, 2014</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Gunnar: I didn&#8217;t, but given that the value from sequence got properly propagated, I don&#8217;t doubt that values from random or now() will too. As far as I can see, it just gets real values, and not &#8220;what was in the query&#8221;.</p>
	</li>
		
		
			
<li class="odd" id="comment-45064" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-45064" title="">#</a></span> <a href='http://bonesmoses.org/' rel='external nofollow' class='url'>Shaun Thomas</a></div>  <div class="date">Mar 18, 2014</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/645a3997823b4f1943dfaca90022b937?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>I&#8217;ve been waiting for this for ages. Anything to get rid of slony. <img src="http://www.depesz.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /> </p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="2831" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="eee786a103" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="13"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">335 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">312 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">263 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">207 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">152 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">149 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">131 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">130 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">129 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/11/14/how-i-learned-to-stop-worrying-and-love-the-triggers/" title="How I Learned to Stop Worrying and Love the Triggers" class="wpp-post-title" target="_self">How I Learned to Stop Worrying and Love the Triggers</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">101 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samoch√≥d</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

