http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 23 Jul 2014 16:15:19 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=2308>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Waiting for 9.2 &#8211; Index only scans</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Waiting for 9.2 &#8211; Index only scans Comments Feed" href="http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/' />
<link rel='shortlink' href='http://www.depesz.com/?p=2308' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-2308">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/" rel="bookmark" title="Permanent Link to Waiting for 9.2 &#8211; Index only scans">Waiting for 9.2 &#8211; Index only scans</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>October 8th, 2011 by depesz | Tags: <a href="http://www.depesz.com/tag/covering/" rel="tag">covering</a>, <a href="http://www.depesz.com/tag/index/" rel="tag">index</a>, <a href="http://www.depesz.com/tag/pg92/" rel="tag">pg92</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/scan/" rel="tag">scan</a>, <a href="http://www.depesz.com/tag/visibility/" rel="tag">visibility</a>, <a href="http://www.depesz.com/tag/visibility-maps/" rel="tag">visibility maps</a> |  <a href="http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/#comments" title="Comment on Waiting for 9.2 &#8211; Index only scans">16 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>On 8th of October, Tom Lane <a href="http://archives.postgresql.org/pgsql-committers/2011-10/msg00039.php">committed</a> patch:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="text" style="font-family:monospace;">Support index-only scans using the visibility map to avoid heap fetches.
&nbsp;
When a btree index contains all columns required by the query, and the
visibility map shows that all tuples on a target heap page are
visible-to-all, we don't need to fetch that heap page.  This patch depends
on the previous patches that made the visibility map reliable.
&nbsp;
There's a fair amount left to do here, notably trying to figure out a less
chintzy way of estimating the cost of an index-only scan, but the core
functionality seems ready to commit.
&nbsp;
Robert Haas and Ibrar Ahmed, with some previous work by Heikki Linnakangas.</pre></td></tr></table></div>

<p><span id="more-2308"></span></p>
<p>Before I will go into details, let me just say one thing:</p>
<h1>YEAAAAAAAAAAAAAAAHHHH!</h1>
<p>I <a href="http://www.depesz.com/index.php/2007/01/27/mysql-rzadzi-indeksy-pokrywajace/">wrote</a> about lack of this functionality in PostgreSQL in January 2007. Since then I mentioned it on my wishlists. And now, we got it.</p>
<p>So, let's see what it is, how it works, and what it can do for us.</p>
<p>Explain looks very simply:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> test <span style="color: #993333; font-weight: bold;">as</span>
    <span style="color: #993333; font-weight: bold;">select</span>
        i <span style="color: #993333; font-weight: bold;">as</span> id<span style="color: #66cc66;">,</span>
        i <span style="color: #66cc66;">||</span> <span style="color: #ff0000;">' '</span> <span style="color: #66cc66;">||</span> repeat<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'depesz'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">as</span> z<span style="color: #66cc66;">,</span>
        repeat<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'xxx'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">500</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">as</span> q
    <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">3000</span><span style="color: #66cc66;">&#41;</span> i;
<span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #cc66cc;">3000</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> zx <span style="color: #993333; font-weight: bold;">on</span> test <span style="color: #66cc66;">&#40;</span>id<span style="color: #66cc66;">,</span> z <span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span></pre></td></tr></table></div>

<p>And with this I can:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze <span style="color: #993333; font-weight: bold;">select</span> id<span style="color: #66cc66;">,</span> z <span style="color: #993333; font-weight: bold;">from</span> test <span style="color: #993333; font-weight: bold;">order</span> <span style="color: #993333; font-weight: bold;">by</span> id <span style="color: #993333; font-weight: bold;">limit</span> <span style="color: #cc66cc;">20</span>;
                                                         QUERY PLAN
<span style="color: #808080; font-style: italic;">----------------------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Limit</span>  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>9<span style="color: #66cc66;">.</span>09 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">21</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.017</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>027 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #66cc66;">-&gt;</span>  <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> zx <span style="color: #993333; font-weight: bold;">on</span> test  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>1363<span style="color: #66cc66;">.</span>69 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">3000</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">21</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.015</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>024 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
 Total runtime: <span style="color: #cc66cc;">0.051</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">3</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Please note the word &#8220;Only" in above explain. If I'd change the index to <b>not</b> contain column z, I would get:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">drop</span> <span style="color: #993333; font-weight: bold;">index</span> zx;
<span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">INDEX</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> zx <span style="color: #993333; font-weight: bold;">on</span> test <span style="color: #66cc66;">&#40;</span>id<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">explain</span> analyze <span style="color: #993333; font-weight: bold;">select</span> id<span style="color: #66cc66;">,</span> z <span style="color: #993333; font-weight: bold;">from</span> test <span style="color: #993333; font-weight: bold;">order</span> <span style="color: #993333; font-weight: bold;">by</span> id <span style="color: #993333; font-weight: bold;">limit</span> <span style="color: #cc66cc;">20</span>;
                                                      QUERY PLAN
<span style="color: #808080; font-style: italic;">----------------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Limit</span>  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>4<span style="color: #66cc66;">.</span>22 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">21</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.020</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>035 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #66cc66;">-&gt;</span>  <span style="color: #993333; font-weight: bold;">Index</span> Scan <span style="color: #993333; font-weight: bold;">using</span> zx <span style="color: #993333; font-weight: bold;">on</span> test  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>632<span style="color: #66cc66;">.</span>25 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">3000</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">21</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.019</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>031 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">20</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
 Total runtime: <span style="color: #cc66cc;">0.057</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">3</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>The idea is that explain quite well in the commit message, but let me just shed a bit more light on it.</p>
<p>Whenever you select data from table using index, index returns list of<br />
tuples that <em>might</em> be part of the result. Might because it is<br />
possible that some of the rows were deleted, or that they were inserted, but<br />
your current transaction shouldn't see it yet.</p>
<p>This means that for every row PostgreSQL has to fetch the page of table<br />
data, if only to check if the row is visible for the transaction that<br />
requested it.</p>
<p>But now, since 8.4 we have <a href="http://www.depesz.com/index.php/2008/12/08/waiting-for-84-visibility-maps/">&#8220;visibility maps"</a>.</p>
<p>The point is that for every page (8192 bytes) PostgreSQL will keep information about (as I understand) newest transaction that changed anything on this page.</p>
<p>So now, with this new patch, PostgreSQL no longer has to read the page &#8211; it just checks if the newest transaction that changed given page is older than the transaction requiring the data. If so, and if the index contains all the information we need &#8211; we can skip getting data from table.</p>
<p>So, what exactly does &#8220;has all the information we need" mean? As simple as that &#8211; index has to contain all fields used in query for all clauses &#8211; SELECT, WHERE, ORDER BY.</p>
<p>So, for example, if you have query:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">SELECT</span> a<span style="color: #66cc66;">,</span> b<span style="color: #66cc66;">,</span> c <span style="color: #993333; font-weight: bold;">FROM</span> <span style="color: #993333; font-weight: bold;">table</span> <span style="color: #993333; font-weight: bold;">WHERE</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span> <span style="color: #993333; font-weight: bold;">order</span> <span style="color: #993333; font-weight: bold;">by</span> b <span style="color: #993333; font-weight: bold;">desc</span> <span style="color: #993333; font-weight: bold;">limit</span> <span style="color: #cc66cc;">20</span></pre></td></tr></table></div>

<p>Normally you'd just make index on (a,b) to get maximum performance. But now, it might be beneficial to make the index on (a, b, c) &#8211; i.e. to include column c in the index, so that this query will return data from index only.</p>
<p>Of course there is drawback &#8211; index on (a,b,c) will be larger &#8211; so it's general performance might be worse. But it should be simply tested on case-by-case basis to see what makes sense and when.</p>
<p>All in all &#8211; great stuff.</p>
<p><!-- vim: set spell spelllang=en_US ft=xhtml: --></p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">16 comments <a href='http://www.depesz.com/2011/10/08/waiting-for-9-2-index-only-scans/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-34211" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34211" title="">#</a></span> Thom Brown</div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/dbcb65fb838c40d5fb1a08363bfb3ca2?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>And of course you can disable this functionality with enable_indexonlyscan = false, which you&#8217;d only want to do for comparing performance of different methods.  I&#8217;ve been testing this using various data set sizes, and the performance gain I saw in one instance was 700x without patch.  Naturally the effectiveness of this feature will vary, but it&#8217;s something PostgreSQL has needed for a long time (as you mentioned).</p>
<p>But this certainly improves the whole count(*) situation for many cases, which has been a bugbear of many a PostgreSQL user.  So this will be one of many awesome performance improvements in 9.2! <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-34213" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34213" title="">#</a></span> <a href='http://www.helpame.com' rel='external nofollow' class='url'>Emanuel</a></div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/feab95437f1c77a31dc92b8a41c6774c?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Yeaahhhh!!! It was one of my voted features since time ago. I saw the commit by Tom Lane in the git.</p>
<p>Postgresql&#8217;s Rock level: 95 <img src="http://www.depesz.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-34214" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34214" title="">#</a></span> Thomas</div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/e74de2943e3f4505ab3d07acb083f428?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Finally!!!! This is great news</p>
	</li>
		
		
			
<li class="odd" id="comment-34215" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34215" title="">#</a></span> pijoter</div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>To taki &#8220;ogólny feature&#8221; czy uzależniony od konkretnego typu indeksu? Czy to oznacza, że postgis także przyspieszy gdy będę wyszukiwał współrzędne po indeksie gist/gin?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34216" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34216" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@pijoter:<br />
Z tego co wiem to tylko dla B-Tree.</p>
	</li>
		
		
			
<li class="odd" id="comment-34217" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34217" title="">#</a></span> Alexander Korotkov</div>  <div class="date">Oct 8, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/049dd7dfcd1931183e4d12a5154c34f8?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@pijoter:<br />
IMHO, index only scans is impossible for GIN and potentially possible for GiST, but require changes in both index only scans and GiST interface.</p>
	</li>
		
		
			
<li class="odd" id="comment-34218" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34218" title="">#</a></span> Hugo</div>  <div class="date">Oct 9, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/f2b801ec8a40360d88a83f6762cbebde?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>How I can do the test? How I apply the patch? I apply it to 9.1? or you make available a version of 9.2 with the patch included?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34220" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34220" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Oct 9, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Hugo &#8211; just download current git HEAD, and you&#8217;ll have 9.2 with this patch.</p>
	</li>
		
		
			
<li class="odd" id="comment-34230" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34230" title="">#</a></span> jigar shah</div>  <div class="date">Oct 10, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>&#8220;So now, with this new patch, PostgreSQL no longer has to read the page – it just checks if the newest transaction that changed given page is older than the transaction requiring the data. If so, and if the index contains all the information we need – we can skip getting data from table.&#8221;</p>
<p>how does it know that the newest transaction that changed the page was committed? it is quite possible that a transaction changed the page and has not committed yet and a new transaction starts and requests that page. what will happen in that case?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34231" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34231" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Oct 10, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Jigar:</p>
<p>in exactly the same way it knows usually &#8211; pg keeps information about which transaction committed.</p>
	</li>
		
		
			
<li class="odd" id="comment-34242" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34242" title="">#</a></span> jigar shah</div>  <div class="date">Oct 12, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>if i am not mistaken, it keeps the commit information in xmin/xmax_committed columns of the tuple. if the index-only scan has to get that info from the tuple on disk or in some cases from pg_clog, where is the performance gain coming from?</p>
	</li>
		
		
			
<li class="odd" id="comment-34348" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34348" title="">#</a></span> jigar shah</div>  <div class="date">Oct 20, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>here is the answer to my own question.</p>
<p><a href="http://pgsnaga.blogspot.com/2011/10/index-only-scans-and-heap-block-reads.html" rel="nofollow">http://pgsnaga.blogspot.com/2011/10/index-only-scans-and-heap-block-reads.html</a></p>
	</li>
		
		
			
<li class="odd" id="comment-36279" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36279" title="">#</a></span> Lars Overland</div>  <div class="date">Sep 30, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/7c3eeb6fbe245e4e0836061744316b81?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Great stuff. Does anyone know if index only scan is available over multiple single-column indexes (ie. not just multi-column indexes) ? Eg. in your example, if you created one index for column id and one index for z, would it possible to achieve index-only scans for the same query? I guess not but if it did, this would make postgres very suitable for analytical queries on wide tables.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-36284" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36284" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Oct 1, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Lars:<br />
I don&#8217;t know, but I don&#8217;t think so.</p>
<p>What&#8217;s more important &#8211; why don&#8217;t you simply try?</p>
	</li>
		
		
			
<li class="odd" id="comment-36285" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36285" title="">#</a></span> Anonymous</div>  <div class="date">Oct 1, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Thanks. I did try without succeeding and was interested in whether I was overlooking something.</p>
	</li>
		
		
			
<li class="odd" id="comment-36286" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-36286" title="">#</a></span> Lars Overland</div>  <div class="date">Oct 1, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/7c3eeb6fbe245e4e0836061744316b81?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Thanks. I did try without succeeding and was interested in whether I was overlooking something.</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="2308" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="185c3a61eb" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="231"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">602 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">375 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">273 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">214 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">161 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">150 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">149 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">133 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">129 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/03/07/waiting-for-9-1-foreach-in-array/" title="Waiting for 9.1 &#8211; FOREACH IN ARRAY" class="wpp-post-title" target="_self">Waiting for 9.1 &#8211; FOREACH IN ARRAY</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">108 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochód</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

