http://onsmalltalk.com/2010-10-30-installing-a-gemstone-seaside-server-on-ubuntu-10.10
HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 23:13:56 GMT
Server: KomHttpServer/7.1a (unix)
Expires: Wed, 11 Jun 1980 12:00:00 GMT
Pragma: no-cache
Author: Ramon Leon found at http://onsmalltalk.com
Cache-Control: no-cache, must-revalidate
Content-type: text/html;charset=utf-8
Set-Cookie: blog=LMWF8fbXMi1fwiXB; path=/
Via: 1.0 onsmalltalk.com
Vary: Accept-Encoding
Content-Encoding: gzip
Connection: close

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>Installing a Gemstone Seaside Server on Ubuntu 10.10</title><link rel="stylesheet" type="text/css" href="/seaside/files/WAStandardFiles/window.css"/><script type="text/javascript" src="/seaside/files/WAStandardFiles/externalAnchors.js"></script><script type="text/javascript" src="/seaside/files/WAStandardFiles/misc.js"></script><script type="text/javascript" src="/seaside/files/WAStandardFiles/shortcuts.js"></script><meta http-equiv="Content-Type" content="text/html;charset=utf-8; charset=utf-8"/><meta http-equiv="Content-Script-Type" content="text/javascript"/><link rel="alternate" type="application/atom+xml" title="On Smalltalk Atom Feed" href="/seaside/atomFeed"/><link rel="alternate" type="application/rss+xml" title="On Smalltalk RSS Feed" href="/seaside/rssFeed"/><link rel="stylesheet" type="text/css" href="/blogStyle.css"/><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.2/prototype.js"></script><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/scriptaculous/1.8.1/scriptaculous.js"></script><script type="text/javascript" src="/mainScript.js"></script><meta name="description" content="I'll assume you've already installed Apache and now want to install Gemstone behind it as a Seaside server.  Let's install a few things that we're going to need later, just to get the dependencies out..."/><meta name="keywords" content="Apache Databases Seaside Smalltalk Gemstone Linux"/><link rel="stylesheet" type="text/css" href="/?_s=YzgcUg2QM03akBhC"/></head><body onload="onLoad()" onkeydown="onKeyDown(event)"><script type="text/javascript">/*<![CDATA[*/new PeriodicalExecuter(function(){new Ajax.Request('http://onsmalltalk.com/2010-10-30-installing-a-gemstone-seaside-server-on-ubuntu-10.10',{'parameters':['_s=LMWF8fbXMi1fwiXB','_k=rZXZzSV6','1'].join('&')})},81)/*]]>*/</script><div class="blog"><div id="header"><h1><a href="/">On Smalltalk</a></h1><div id="byLine">thoughts on Smalltalk and programming in general...</div></div><div id="commands" style="right: 2000px;"><a accesskey="l" href="http://onsmalltalk.com/2010-10-30-installing-a-gemstone-seaside-server-on-ubuntu-10.10?_s=LMWF8fbXMi1fwiXB&amp;_k=rZXZzSV6&amp;2">Login</a></div><table border="0" cellspacing="0" cellpadding="0" class="blogLayout"><tr><td valign="top" class="mainContent"><div id="posts"><div class="post"><h2><a href="/2010-10-30-installing-a-gemstone-seaside-server-on-ubuntu-10.10">Installing a Gemstone Seaside Server on Ubuntu 10.10</a></h2><p class="postMeta"> By Ramon Leon - 30 October 2010 under <a href="/apache">Apache</a>, <a href="/databases">Databases</a>, <a href="/seaside">Seaside</a>, <a href="/smalltalk">Smalltalk</a>, <a href="/gemstone">Gemstone</a>, <a href="/linux">Linux</a></p><div class="postBody"><p>I'll assume you've already installed Apache and now want to install Gemstone behind it as a Seaside server.  Let's install a few things that we're going to need later, just to get the dependencies out of the way.  Login to your server/workstation as an admin user, someone who can sudo.</p><pre>sudo aptitude install bc zip build-essential apache2-threaded-dev ia32-libs</pre><p>Now let's setup the user we're going to run Gemstone under.</p><pre>sudo adduser glass</pre><p>Add him to the admin group so he can sudo.</p><pre>sudo usermod -a -G admin glass</pre><p>Login as this user.</p><pre>su glasscd</pre><p>Download Gemstone and install it.</p><pre>wget http://seaside.gemstone.com/scripts/installGemstone.shchmod +x installGemstone.sh ./installGemstone.sh</pre><p>Download some init scripts so we can setup Gemstone as a service rather than manually starting it.</p><pre>wget http://onsmalltalk.com/downloads/gemstone_initd_scripts.tgztar xf gemstone_initd_scripts.tgz</pre><p>Edit each of these scripts and change the line RUNASUSER=USER to RUNASUSER=glass and change the first line to #!/bin/bash instead of #/bin/sh as the Gemstone scripts need bash and Ubuntu changed the bin/sh link to point to dash instead of bash which won't work.</p><p>Install the init scripts.  There's a shorter way to write these, but it will fit better on the blog if I do each one separately.</p><pre>sudo mv gemstone_initd_scripts/gemstone /etc/init.d/sudo mv gemstone_initd_scripts/gs_fastcgi /etc/init.d/sudo mv gemstone_initd_scripts/netldi /etc/init.d/chmod a+x /etc/init.d/gemstone chmod a+x /etc/init.d/gs_fastcgichmod a+x /etc/init.d/netldi sudo chown root:root /etc/init.d/gemstonesudo chown root:root /etc/init.d/gs_fastcgisudo chown root:root /etc/init.d/netldi  sudo update-rc.d gemstone defaultssudo update-rc.d gs_fastcgi defaultssudo update-rc.d netldi defaults</pre><p>Start just the <em>gemstone</em> and <em>netldi</em> services.</p><pre>sudo /etc/init.d/gemstone startsudo /etc/init.d/netldi start</pre><p>Grab GemTools and fire it up.  I'm installing on my local machine so I can just fire this up here; if you're installing on a remote server, refer to my previous post about <a href="http://onsmalltalk.com/2010-10-23-faster-remote-gemstone">setting up X11Forwarding and running GemTools on a remote host</a>.</p><pre>wget http://seaside.gemstone.com/squeak/GemTools-1.0-beta.8-244x.app.zipunzip GemTools-1.0-beta.8-244x.app.zipGemTools-1.0-beta.8-244x.app/GemTools.sh</pre><p>Edit the connection to point at localhost and login to Gemstone and open Monticello; open the MetacelloRepository; load either ConfigurationOfSeaside28 or ConfigurationOfSeaside30.  I'm still on 2.8 so that's what I'm loading.  If you're going to load 3.0, you'll need to edit the gs_fastcgi script accordingly as it's built to startup 2.8.  Just change the DAEMON line to runSeasideGems30 instead of runSeasideGems.</p><p>Click the admin button on the gem launcher and check commit on almost out of memory option (just in case loading anything takes up too much temp space), then run ConfigurationOfSeaside28 load in the workspace.  Once Seaside is loaded, we can continue and start up the Seaside gems.</p><pre>sudo /etc/init.d/gs_fastcgi start</pre><p>Next we need to setup Apache to be able to use FastCGI and enable a few modules we'll need and will need to first build the FastCGI module.</p><pre>wget http://www.fastcgi.com/dist/mod_fastcgi-current.tar.gztar zxvf mod_fastcgi-current.tar.gzcd mod_fastcgi*cp Makefile.AP2 Makefilemake top_dir=/usr/share/apache2sudo make install top_dir=/usr/share/apache2echo "LoadModule fastcgi_module /usr/lib/apache2/modules/mod_fastcgi.so" &gt; fastcgi.loadsudo mv fastcgi.load /etc/apache2/mods-available/sudo a2enmod fastcgi expires proxy proxy_http proxy_balancer deflate rewrite</pre><p>And fix the host file so FastCGI doesn't wig out over the ip6 address you're not even using.</p><pre>sudo nano /etc/hosts</pre><p>Comment out ipv6 line like so.</p><pre>#::1     localhost ip6-localhost ip6-loopback</pre><p>Now create a configuration for the site.</p><pre>sudo nano /etc/apache2/sites-available/gemstone</pre><p>Using the below config and modifying where necessary.</p><pre>ServerAdmin your@someplace.comListen 8081Listen 8082Listen 8083FastCgiExternalServer /var/www1 -host localhost:9001 -pass-header AuthorizationFastCgiExternalServer /var/www2 -host localhost:9002 -pass-header AuthorizationFastCgiExternalServer /var/www3 -host localhost:9003 -pass-header Authorization&lt;VirtualHost *:80&gt;    ServerName yourComputerName    RewriteEngine On    DocumentRoot /var/www/    #http expiration    ExpiresActive on    ExpiresByType text/css A864000    ExpiresByType text/javascript A864000    ExpiresByType application/x-javascript A864000    ExpiresByType image/gif A864000    ExpiresByType image/jpeg A864000    ExpiresByType image/png A864000    FileETag none    # http compression    DeflateCompressionLevel 9    SetOutputFilter DEFLATE    AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml$    BrowserMatch ^Mozilla/4 gzip-only-text/html    BrowserMatch ^Mozilla/4.0[678] no-gzip    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html    # Let apache serve any static files NOW    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} -f    RewriteRule (.*) %{DOCUMENT_ROOT}$1 [L]    &lt;Proxy *&gt;       AddDefaultCharset off       Order allow,deny       Allow from all    &lt;/Proxy&gt;    ProxyPreserveHost On    #main app    ProxyPass / balancer://gemfarm/    ProxyPassReverse / balancer://gemfarm/    &lt;Proxy balancer://gemfarm&gt;        Order allow,deny        Allow from all        BalancerMember http://localhost:8081        BalancerMember http://localhost:8082        BalancerMember http://localhost:8083    &lt;/Proxy&gt;&lt;/VirtualHost&gt;&lt;VirtualHost *:8081&gt;        DocumentRoot /var/www1&lt;/VirtualHost&gt;&lt;VirtualHost *:8082&gt;        DocumentRoot /var/www2&lt;/VirtualHost&gt;&lt;VirtualHost *:8083&gt;        DocumentRoot /var/www3&lt;/VirtualHost&gt;</pre><p>Make a few symbolic links for those www directories, FastCGI seems to want these to all be different and Apache will complain if they don't actually exist.</p><pre>sudo ln -s /var/www /var/www1sudo ln -s /var/www /var/www2sudo ln -s /var/www /var/www3</pre><p>And enable the new site and restart Apache.</p><pre>sudo a2ensite gemstonesudo /etc/init.d/apache2 restart</pre><p>Hopefully you've gotten no errors at this point and you can navigate to http://yourMachineName/seaside/config and see that everything is working.  Gemstone is now installed as a service, as is netldi and the Seaside FastCGI gems, and they'll start up automatically when the machine starts.  </p><p>I'm not thrilled with running the Seaside gems this way because if they die nothing will restart them.  I'll be following up later with a post on running the Seaside gems and maintenance gem under Monit which will ensure they're restarted should a gem crash for any reason.  Gemstone itself and netldi I'm not worried about and this approach should work fine.</p><p>Since I did this on my workstation which already had apache installed as well as other things I run, I may have missed a dependency or two that I already had installed and didn't notice.  If the above procedure doesn't work for you for any reason, please let me know what I overlooked.</p></div><div class="postInfo"></div><div class="relatedPosts"><h3>Related Posts</h3><ul><li><a href="/2010-10-23-faster-remote-gemstone">Faster Remote Gemstone</a></li><li><a href="/scaling-seaside-redux-enter-the-penguin">Scaling Seaside Redux: Enter the Penguin</a></li><li><a href="/2010-02-01-dynamic-web-development-with-seaside-pdf-available-for-purchase">Dynamic Web Development with Seaside PDF Available for Purchase</a></li><li><a href="/sandstonedb-simple-activerecord-style-persistence-in-squeak">SandstoneDb, Simple ActiveRecord Style Persistence in Squeak</a></li><li><a href="/simple-file-based-application-configuration">Simple File Based Application Configuration</a></li></ul></div><a name="comments"></a><h3>Comments (automatically disabled after 1 year)</h3><div id="commentAjax"><div id="id3" class="comment"><div class="title"><strong>Bart Veenstra</strong>&nbsp;1360 days ago</div><div class="body"><p>Very coool! I alread setup a gemstone server using the instructions on the glassdb page, but that did not include the automatic starting of gemstone and other services. Do you run this as a headless server? maybe you can add instructions on how to access it from outside the box (as I would run it on a headless VM)</p></div><div id="id4" class="meta"></div><div id="id5" class="comment"><div class="title"><strong>Ramon Leon</strong>&nbsp;1360 days ago</div><div class="body"><p>Already mentioned how to access headless server in the previous post.  Mentioned again about halfway through the article when discussing launching GemTools.</p></div><div id="id6" class="meta"></div></div></div><div id="id7" class="comment"><div class="title"><a target="_new" href="http://www.getitmade.com">Nick Ager</a>&nbsp;1350 days ago</div><div class="body"><p>I'm eagerly anticipating you upcoming blog post on integrating Gemstone and Monit.</p></div><div id="id8" class="meta"></div></div><div id="id9" class="comment"><div class="title"><strong>Max Leske</strong>&nbsp;1266 days ago</div><div class="body"><p>Thanks mate!A huge help.</p><p>BTW, you missed the apache rewrite module.</p><p>Cheers,Max</p></div><div id="id10" class="meta"></div><div id="id11" class="comment"><div class="title"><strong>Ramon Leon</strong>&nbsp;1266 days ago</div><div class="body"><p>Thanks, fixed.</p></div><div id="id12" class="meta"></div></div></div><div id="id13" class="comment"><div class="title"><a target="_new" href="http://www.9ek.net">porno izle</a>&nbsp;1045 days ago</div><div class="body"><p>uu beybi great job. porno izle.</p></div><div id="id14" class="meta"></div></div></div></div></div></td><td valign="top" class="navigation"><div id="extras"><form accept-charset="utf-8" method="post" action="http://onsmalltalk.com/2010-10-30-installing-a-gemstone-seaside-server-on-ubuntu-10.10" id="searchForm"><div><input tabindex="-1" value="Default" name="15" style="position: absolute; top: -100em" type="submit" class="submit"/></div><div id="search"><input onfocus="if(value=='Search'){value='';style.color=null}" style="color: #aaa" value="Search" name="16" type="text" class="text"/></div><div><input name="_s" value="LMWF8fbXMi1fwiXB" type="hidden" class="hidden"/><input name="_k" value="rZXZzSV6" type="hidden" class="hidden"/></div></form><div id="categories"><h3>Topics</h3><ul><li><a href="/ajax">Ajax</a>&nbsp;(6)</li><li><a href="/apache">Apache</a>&nbsp;(5)</li><li><a href="/databases">Databases</a>&nbsp;(12)</li><li><a href="/gemstone">Gemstone</a>&nbsp;(2)</li><li><a href="/linux">Linux</a>&nbsp;(6)</li><li><a href="/lisp">Lisp</a>&nbsp;(9)</li><li><a href="/magritte">Magritte</a>&nbsp;(10)</li><li><a href="/performance">Performance</a>&nbsp;(8)</li><li><a href="/profiling">Profiling</a>&nbsp;(1)</li><li><a href="/programming">Programming</a>&nbsp;(39)</li><li><a href="/ruby">Ruby</a>&nbsp;(25)</li><li><a href="/seaside">Seaside</a>&nbsp;(64)</li><li><a href="/smalltalk">Smalltalk</a>&nbsp;(82)</li><li><a href="/sql">Sql</a>&nbsp;(13)</li><li><a href="/squeak">Squeak</a>&nbsp;(6)</li><li><a href="/updates">Updates</a>&nbsp;(9)</li></ul></div></div></td></tr></table><div id="pages"><a href="/about">about me</a>|<a href="/books-worth-reading">good books</a>|<a href="/top-posts">popular posts</a>|<a href="/seaside/atomFeed">atom</a>|<a href="/seaside/rssFeed">rss</a></div></div><div style="text-align: center" class="donate">Donate if you like this blog<br/><div>BTC: 12a9hmRF8Aueu38tXyuj7eswTUgsemszp2</div></div><script type="text/javascript">
		document.write(unescape("%3Cscript src='http://www.google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">	try {var pageTracker = _gat._getTracker("UA-118308-7"); pageTracker._trackPageview();} catch(err) {}</script><script type="text/javascript">/*<![CDATA[*/function onLoad(){}/*]]>*/</script></body></html>
