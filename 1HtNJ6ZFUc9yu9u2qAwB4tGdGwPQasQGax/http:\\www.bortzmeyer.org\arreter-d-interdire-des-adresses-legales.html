http://www.bortzmeyer.org/arreter-d-interdire-des-adresses-legales.html
HTTP/1.1 200 OK
Date: Thu, 24 Jul 2014 02:10:32 GMT
Server: Apache/2.2.22 (Debian)
Last-Modified: Sat, 17 May 2014 14:22:41 GMT
ETag: "24176-4b5a-4f9994348ce40"
Accept-Ranges: bytes
Vary: Accept-Encoding
Content-Encoding: gzip
Link: <http://www.gnu.org/copyleft/fdl.html>; rel="license"; title="GFDL"
Content-Length: 6471
Connection: close
Content-Type: text/html; charset=UTF-8

<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="fr" lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Generated on ludwigVII.sources.org on 2014-05-17T16:22 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" type="text/css" href="screen.css" media="screen"/>
<link rel="stylesheet" type="text/css" href="print.css" media="print"/>
<link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
<link rel="openid2.local_id" href="https://openid.stackexchange.com/user/ce28a43a-5060-423a-8574-25e24a8f096e">
<!-- TODO: add META tags from the text of the entry, for instance keywords ? -->
<link rel="alternate" type="application/atom+xml" title="Atom syndication feed - summaries" href="feed.atom" />
<link rel="alternate" type="application/atom+xml" title="Atom syndication feed - full content" href="feed-full.atom" />
<link rel="search"
           type="application/opensearchdescription+xml" 
           href="http://www.bortzmeyer.org/others/add-search-engine.xml"
           title="Blog Bortzmeyer" />
<link rel="author" href="http://www.bortzmeyer.org/static/moi.html"/>
<link rel="privacy-policy" href="/privacy-policy.html"/>
<title>
Blog Stéphane Bortzmeyer: Arrêter d'interdire des adresses de courrier légales

</title>
</head>

<body>

<div id="page-container">
<div id="masthead">
<div class="inside">
			<h1><a href="index.html">Mon blog</a></h1>
			<hr class="hide" />
</div>
</div>
<div id="outer-column-container">
<div id="inner-column-container">
<div id="source-order-container">
<div id="left-column">
<div id="leftmenu" class="inside">
<h3>Autres trucs</h3>
<p><a href="index.html">Accueil</a></p>
<p><a href="rfcs.html">Seulement les RFC</a></p>
<p><a href="ficheslecture.html">Seulement les fiches de lecture</a></p>
<p><a href="http://echoping.sourceforge.net/">echoping</a></p>
<p><a href="http://www.demaziere.fr/eve/">Ève</a></p>
<form action="/search"><p>Recherche dans ce blog : <input type="text" name="pattern" style="width:100%"/>
</p>
</form>
</div>
</div> <!-- End of left-column -->
<div id="middle-column">
<div class="inside">


<h2 xml:lang="fr">Arrêter d'interdire des adresses de courrier légales</h2><p>Première rédaction de cet article le 4 octobre 2006<br/>Dernière mise à jour le 13 décembre 2009<br/></p><hr/><div xml:lang="fr">
<div class="para"><p>Combien de fois ai-je vu une adresse de
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Courrier%20%C3%A9lectronique" title="Consultez l'article &quot;Courrier électronique&quot; de l'encyclopédie libre Wikipedia">courrier</a></b> parfaitement légale être refusée par un
formulaire d'inscription quelconque, en général avec une remarque
désobligeante, du genre "ERREUR : Votre adresse email est invalide". À quoi
est-ce dû ? Au fait que le plupart du temps, les programmeurs qui ont
écrit cette vérification ne connaissent pas les règles de syntaxe des
adresses de courrier et ne se rendent pas compte qu'il en existe plus
de variétés qu'ils ne l'imaginent.</p></div>
<div class="para"><p>Lorsqu'un formulaire sur le Web vous demande d'indiquer une adresse
de <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/courrier%20%C3%A9lectronique" title="Consultez l'article &quot;courrier électronique&quot; de l'encyclopédie libre Wikipedia">courrier électronique</a></b>, le programme situé
derrière vérifie souvent la syntaxe de ladite adresse. Bien sûr, le
mieux serait de tester l'adresse, en y envoyant un mot de passe, par
exemple. C'est ce que font en général les formulaires d'abonnement à
une <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/liste%20de%20diffusion" title="Consultez l'article &quot;liste de diffusion&quot; de l'encyclopédie libre Wikipedia">liste de diffusion</a></b>. Si cette méthode est un
très bon test (si le message est reçu, c'est, par définition, que
l'adresse est valide), elle est plus complexe à programmer, nécessite
de garder un état (ce qui a été envoyé, ce qui a été confirmé), et elle
peut ennuyer le destinataire.</p></div>
<div class="para"><p>Aussi, le test se limite souvent à la syntaxe : on vérifie, par
exemple (<b class="emphasis">attention</b>, je prends exprès un exemple
complètement faux) que l'adresse correspond à l'<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/expression%20rationnelle" title="Consultez l'article &quot;expression rationnelle&quot; de l'encyclopédie libre Wikipedia">expression rationnelle</a></b>
<code>[A-Za-z0-9_\-\.]+@[A-Za-z0-9\-\.]+</code>, qui autorise
<code>postmaster@example.org</code> mais pas
<code>stephane+blog@bortzmeyer.org</code> qui est pourtant
parfaitement légale.</p></div>
<div class="para"><p>J'utilise en général des "adresses plus" comme
<code>stephane+blog@bortzmeyer.org</code> car elles permettent
facilement de trier son courrier (on la retrouve dans l'en-tête
<code>Delivered-To</code>). Le <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Serveur%20de%20messagerie%20%C3%A9lectronique" title="Consultez l'article &quot;Serveur de messagerie électronique&quot; de l'encyclopédie libre Wikipedia">MTA</a></b> est
configuré pour délivrer à la boîte dont le nom précède le signe plus (en <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Sieve" title="Consultez l'article &quot;Sieve&quot; de l'encyclopédie libre Wikipedia">Sieve</a></b>, cela se fait avec le <a href="5233.html" class="rfc" title="Consultez l'analyse du RFC 5233">RFC 5233</a>)
et on peut donc créer sans formalité une infinité d'adresses. À chaque
formulaire que je remplis, je laisse une adresse différente,
comportant le nom de l'organisation qui gère le formulaire, ce qui me
permet de savoir ensuite d'où vient l'adresse par laquelle on me
joint. Ce n'est pas forcément le signe plus qui est utilisé, d'ailleurs
(le <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Serveur%20de%20messagerie%20%C3%A9lectronique" title="Consultez l'article &quot;Serveur de messagerie électronique&quot; de l'encyclopédie libre Wikipedia">MTA</a></b> <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Postfix" title="Consultez l'article &quot;Postfix&quot; de l'encyclopédie libre Wikipedia">Postfix</a></b> permet
de configurer ce caractère avec l'option
<code>recipient_delimiter</code>, <b><a class="wikipedia" hreflang="en" href="http://en.wikipedia.org/wiki/MMDF" title="Consultez l'article &quot;MMDF&quot; de l'encyclopédie libre Wikipedia (en anglais)">MMDF</a></b>utilisait le signe égal, qui a les mêmes problèmes).</p></div>
<div class="para"><p>Mais le résultat est que je me fais jeter par de nombreux sites
Web. Par exemple, je cherchais à louer un serveur dédié <a href="http://www.kimsufi.com/">Kimsufi</a> pour l'hébergement de ce
blog mais je n'ai jamais réussi à me créer un compte client chez <a href="http://www.ovh.net/">OVH</a>, le fournisseur, car celui-ci
s'obstine à refuser mon adresse. J'ai finalement choisi <a href="slicehost-debut.html" title="Consultez ce blog à propos de &quot;slicehost-debut&quot;">SliceHost</a> qui avait pile la même
bogue, mais qui l'a corrigée en quelques heures (alors que, la plupart du
temps, les rapports de bogue sur ce sujet sont ignorés).</p></div>
<div class="para"><p>Le manque de main d'œuvre pour le développement (une
technologie comme <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/XForms" title="Consultez l'article &quot;XForms&quot; de l'encyclopédie libre Wikipedia">XForms</a></b> ou comme les <a href="http://blog.oldworld.fr/index.php?post/2010/11/17/HTML5-Forms-Validation-in-Firefox-4">formulaires de HTML 5</a> simplifiera peut-être
les choses dans le futur) fait que les programmes de vérification des
données saisies, qu'ils soient écrits en
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Javascript" title="Consultez l'article &quot;Javascript&quot; de l'encyclopédie libre Wikipedia">Javascript</a></b>, <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/PHP%3A%20Hypertext%20Preprocessor" title="Consultez l'article &quot;PHP: Hypertext Preprocessor&quot; de l'encyclopédie libre Wikipedia">PHP</a></b> ou un
autre langage, sont en général assez bâclés. Il est exceptionnel que
leur auteur vérifie la norme qui régit la syntaxe des adresses de
courrier, le <a href="5322.html" class="rfc" title="Consultez l'analyse du RFC 5322">RFC 5322</a>, section 3.4. À leur
décharge, il faut préciser que ladite norme est redoutable. Par
exemple, toutes les adresses suivantes sont valides :
</p><ul>
<li><code>{tropdur}@example.org</code></li>
<li><code>c&amp;a@hotmail.com</code></li>
<li><code>directeur@arts-premiers.museum</code> (j'ai vu une
fois un code Javascript qui vérifiait que le
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Domaine%20de%20premier%20niveau" title="Consultez l'article &quot;Domaine de premier niveau&quot; de l'encyclopédie libre Wikipedia">TLD</a></b> avait moins de quatre lettres, ce qui est
absurde vue l'existence de <b><a class="wikipedia" hreflang="en" href="http://en.wikipedia.org/wiki/.museum" title="Consultez l'article &quot;.museum&quot; de l'encyclopédie libre Wikipedia (en anglais)">.museum</a></b> ou
<b><a class="wikipedia" hreflang="en" href="http://en.wikipedia.org/wiki/.travel" title="Consultez l'article &quot;.travel&quot; de l'encyclopédie libre Wikipedia (en anglais)">.travel</a></b>)</li>
<li><code>"Stephane[Bortzmeyer]"@laposte.net</code></li>
</ul></div>
<div class="para"><p>Alors, quel conseil donner au programmeur ? D'abord, il faut bien
voir qu'il a très peu de chances de vérifier une adresse par une
simple <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/expression%20rationnelle" title="Consultez l'article &quot;expression rationnelle&quot; de l'encyclopédie libre Wikipedia">expression rationnelle</a></b>. Certes,
<b><a class="wikipedia" hreflang="en" href="http://en.wikipedia.org/wiki/Tom%20Christiansen" title="Consultez l'article &quot;Tom Christiansen&quot; de l'encyclopédie libre Wikipedia (en anglais)">Tom Christiansen</a></b> l'a <a href="http://www.cpan.org/authors/Tom_Christiansen/scripts/ckaddr.gz">fait</a>
mais tout le monde n'est pas Tom Christiansen (lisez la très 
intéressante <a href="http://fightingforalostcause.net/misc/2006/compare-email-regex.php">
page de test des expressions</a>). La syntaxe des adresses est décrite
par une <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Grammaire%20formelle" title="Consultez l'article &quot;Grammaire formelle&quot; de l'encyclopédie libre Wikipedia">grammaire</a></b>, pas par une
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/expression%20rationnelle" title="Consultez l'article &quot;expression rationnelle&quot; de l'encyclopédie libre Wikipedia">expression rationnelle</a></b>. Si on veut analyser
tous les cas, il faut utiliser un vrai <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/analyseur%20syntaxique" title="Consultez l'article &quot;analyseur syntaxique&quot; de l'encyclopédie libre Wikipedia">analyseur syntaxique</a></b>. N'est-ce pas trop lourd pour une simple et
vague vérification ? Dans ce cas, une approche raisonnable est de ne
pas chercher à vérifier tous les cas mais de se contenter d'une
vérification légère. Par exemple, le <a href="4287.html" class="rfc" title="Consultez l'analyse du RFC 4287">RFC 4287</a>,
qui normalise le format de <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/syndication" title="Consultez l'article &quot;syndication&quot; de l'encyclopédie libre Wikipedia">syndication</a></b>
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Atom" title="Consultez l'article &quot;Atom&quot; de l'encyclopédie libre Wikipedia">Atom</a></b> a choisi une méthode simple et radicale :
<code>atomEmailAddress = xsd:string { pattern = ".+@.+"
}</code>. Cette expressione est trop laxiste (elle accepte
<code>"foo bar[@truc.machin</code>) mais elle attrape quand
même une partie des erreurs, en ne refusant aucune adresse légale (ce
que je trouve pire que d'accepter des adresses illégales). (Les pros
des <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Expression%20rationnelle" title="Consultez l'article &quot;Expression rationnelle&quot; de l'encyclopédie libre Wikipedia">expressions rationnelles</a></b> - comme Pascal
Courtois qui m'a signalé celle-ci - auront noté que,
si le moteur d'expressions est gourmand - <i class="foreign" xml:lang="en">greedy</i>,
il faut réécrire l'expression en <code>.+?@.+</code>.)</p></div>
<div class="para"><p>Pour <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/PHP%3A%20Hypertext%20Preprocessor" title="Consultez l'article &quot;PHP: Hypertext Preprocessor&quot; de l'encyclopédie libre Wikipedia">PHP</a></b>, je recommande très chaudement un
excellent article de Douglas Lovell dans le <b><a class="wikipedia" hreflang="en" href="http://en.wikipedia.org/wiki/Linux%20Journal" title="Consultez l'article &quot;Linux Journal&quot; de l'encyclopédie libre Wikipedia (en anglais)">Linux Journal</a></b>,
<i class="foreign" xml:lang="en"><a href="http://www.linuxjournal.com/article/9585" hreflang="en">Validate
an E-Mail Address with PHP, the Right Way</a></i>, qui décrit
très bien la difficulté du problème et propose des solutions. Je
partage notamment son inquiétude que « <i class="foreign" xml:lang="en">There is some danger
that common usage and widespread sloppy coding will establish a de
facto standard for e-mail addresses that is more restrictive than the
recorded formal standard.</i> »</p></div>
<div class="para"><p>J'ai parlé dans cet article du cas de formulaires Web
d'enregistrement, qui vous demandent votre adresse de courrier. Mais
Emmanuel Haguet me signale qu'il y a plus fort : des
<i class="foreign" xml:lang="en"><b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Webmail" title="Consultez l'article &quot;Webmail&quot; de l'encyclopédie libre Wikipedia">webmails</a></b></i> comme celui
d'<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Orange%20(entreprise)" title="Consultez l'article &quot;Orange (entreprise)&quot; de l'encyclopédie libre Wikipedia">Orange</a></b> qui refusent d'envoyer du courrier aux
adresses qu'ils jugent, bêtement, non standards.
</p></div>
<div class="para"><p>Quelques autres références intéressantes :
</p><ul>
<li>Un bon <a href="http://simonslick.com/VEAF/">validateur en ligne</a> 
qui semble complètement conforme au RFC.</li>
<li><i class="foreign" xml:lang="en"><a href="http://stackoverflow.com/questions/201323/what-is-the-best-regular-expression-for-validating-email-addresses" hreflang="en">What
is the best regular expression for validating email
addresses?</a></i> sur <a href="stack-overflow.html" title="Consultez ce blog à propos de &quot;stack-overflow&quot;">StackOverflow</a>.</li>
<li>(Transmis par Pierre Beyssac) Un <a href="http://worsethanfailure.com/Articles/Validating_Email_Addresses.aspx">bon
article de Derrick Pallas</a> sur WTF, avec <a href="http://worsethanfailure.com/Comments/Validating_Email_Addresses.aspx">plein
de commentaires intéressants</a></li>
<li>(Transmis par Jean-Marc Liotier) Un <a href="http://davidcelis.com/blog/2012/09/06/stop-validating-email-addresses-with-regex/">bon article sur la vanité des expressions rationnelles</a> pour valider des adresses de courrier</li>
<li>Pour PHP, une <a href="http://www.php.net/manual/fr/filter.filters.validate.php">outil
de validation des adresses</a> qui <b class="emphasis">semble</b>
correct. C'est certainement mieux que les bricolages maison des
neuneus PHP typiques.</li>
<li>Un autre bon article, <a href="http://blog.sinjakli.co.uk/2011/02/13/email-address-validation-please-stop/">par Sinjo</a>, avec d'intéressants commentaires.</li>
<li>Une <a href="http://mdswanson.com/blog/2013/10/14/how-not-to-validate-email-addresses.html">réflexion de Matt Swanson</a> sur ce sujet.</li>
<li>Un exemple <b class="emphasis">erroné</b> pour <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/PostgreSQL" title="Consultez l'article &quot;PostgreSQL&quot; de l'encyclopédie libre Wikipedia">PostgreSQL</a></b>, <a href="http://binodsblog.blogspot.com/2011/02/regular-expression-in-postgresql.html">par un auteur qui s'y connait davantage en expressions rationnelles qu'en courrier électronique</a>.</li>
</ul></div>
<div class="para"><p>J'espère que cet article aura convaincu quelques auteurs de
formulaires d'accepter toutes les adresses de courrier
légales. Espérons. En attendant, je <a href="publier-ral.html" title="Consultez ce blog à propos de &quot;publier-ral&quot;">publie
régulièrement les noms</a> de ceux qui sont mal configurés. Il existe aussi <a href="https://github.com/rwz/cant-parse-emails">un autre projet de publication</a>.</p></div>
</div>




<p id="get-pdf" class="verysmall"><a href="arreter-d-interdire-des-adresses-legales.pdf" rel="noindex,nofollow">Version PDF de cette page</a> (mais vous pouvez aussi imprimer depuis votre navigateur, il y a une feuille de style prévue pour cela)</p>
<p id="get-source" class="verysmall"><a href="arreter-d-interdire-des-adresses-legales.xml" rel="nofollow">Source XML de cette page</a> (cette 
page est distribuée sous les termes de la licence <a href="http://www.gnu.org/copyleft/fdl.html">GFDL</a>)</p>
</div>
</div><!-- End of middle-column -->
</div><!-- End of source-order-container -->
</div><!-- End of inner-column-container -->
</div><!-- End of outer-column-container -->
<div class="clear-columns"><!-- do not delete --></div>
<div id="footer">
<div class="inside">
<hr class="hide" />
<p>Si vous aimez, vous pouvez payer avec <a href="/flattr.html">Flattr</a> <a href="https://flattr.com/submit/auto?user_id=bortzmeyer&url=http%3A%2F%2Fwww.bortzmeyer.org%2Farreter-d-interdire-des-adresses-legales.html" target="_blank"><img src="/images/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0"></a> ou avec <a href="/bitcoin-blog.html">Bitcoin</a> : adresse <code>1HtNJ6ZFUc9yu9u2qAwB4tGdGwPQasQGax</code> (ou voyez le <a href="/images/bitcoin-qrcode.png">code QR</a>). Pour toute remarque sur ce blog, s'adresser à
Stéphane Bortzmeyer <code>&lt;stephane+blog@bortzmeyer.org&gt;</code>. Je suis <a href="http://sl4.org/crocker.html">les règles de Crocker</a> donc pas besoin de faire des excès de diplomatie. Ce blog est strictement personnel et les opinions exprimées ici n'engagent donc que moi, et notamment pas mon employeur présent ou mes employeurs passés.</p>
<a href="http://prefetch.validatorsearch.verisignlabs.com"></a><!-- See http://validatorsearch.verisignlabs.com/ -->
</div>
</div><!-- End of footer -->
</div><!-- End of page-container -->
</body>
</html>


