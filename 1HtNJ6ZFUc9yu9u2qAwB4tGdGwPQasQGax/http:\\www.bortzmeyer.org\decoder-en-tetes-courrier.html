http://www.bortzmeyer.org/decoder-en-tetes-courrier.html
HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 03:53:00 GMT
Server: Apache/2.2.22 (Debian)
Last-Modified: Sat, 14 Jun 2014 14:27:42 GMT
ETag: "2331d-242c-4fbcc98c83380"
Accept-Ranges: bytes
Vary: Accept-Encoding
Content-Encoding: gzip
Link: <http://www.gnu.org/copyleft/fdl.html>; rel="license"; title="GFDL"
Content-Length: 3498
Connection: close
Content-Type: text/html; charset=UTF-8

<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="fr" lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Generated on ludwigVII.sources.org on 2014-06-14T16:27 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" type="text/css" href="screen.css" media="screen"/>
<link rel="stylesheet" type="text/css" href="print.css" media="print"/>
<link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
<link rel="openid2.local_id" href="https://openid.stackexchange.com/user/ce28a43a-5060-423a-8574-25e24a8f096e">
<!-- TODO: add META tags from the text of the entry, for instance keywords ? -->
<link rel="alternate" type="application/atom+xml" title="Atom syndication feed - summaries" href="feed.atom" />
<link rel="alternate" type="application/atom+xml" title="Atom syndication feed - full content" href="feed-full.atom" />
<link rel="search"
           type="application/opensearchdescription+xml" 
           href="http://www.bortzmeyer.org/others/add-search-engine.xml"
           title="Blog Bortzmeyer" />
<link rel="author" href="http://www.bortzmeyer.org/static/moi.html"/>
<link rel="privacy-policy" href="/privacy-policy.html"/>
<title>
Blog Stéphane Bortzmeyer: Décoder les en-têtes du courrier électronique

</title>
</head>

<body>

<div id="page-container">
<div id="masthead">
<div class="inside">
			<h1><a href="index.html">Mon blog</a></h1>
			<hr class="hide" />
</div>
</div>
<div id="outer-column-container">
<div id="inner-column-container">
<div id="source-order-container">
<div id="left-column">
<div id="leftmenu" class="inside">
<h3>Autres trucs</h3>
<p><a href="index.html">Accueil</a></p>
<p><a href="rfcs.html">Seulement les RFC</a></p>
<p><a href="ficheslecture.html">Seulement les fiches de lecture</a></p>
<p><a href="http://echoping.sourceforge.net/">echoping</a></p>
<p><a href="http://www.demaziere.fr/eve/">Ève</a></p>
<form action="/search"><p>Recherche dans ce blog : <input type="text" name="pattern" style="width:100%"/>
</p>
</form>
</div>
</div> <!-- End of left-column -->
<div id="middle-column">
<div class="inside">


<h2 xml:lang="fr">Décoder les en-têtes du courrier électronique</h2><p>Première rédaction de cet article le 10 avril 2006<br/></p><hr/><div xml:lang="fr">
<div class="para"><p>Ma langue maternelle étant le <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/fran%C3%A7ais" title="Consultez l'article &quot;français&quot; de l'encyclopédie libre Wikipedia">français</a></b>, je
reçois une bonne proportion de <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Courrier%20%C3%A9lectronique" title="Consultez l'article &quot;Courrier électronique&quot; de l'encyclopédie libre Wikipedia">messages
électroniques</a></b> dans cette langue, avec des caractères
composés comme ç ou ê. La façon dont ils sont encodés pour le voyage
dans l'Internet ne me convient pas et je les décode à l'arrivée. Voici
comment.</p></div>
<div class="para"><p>Le <a href="2822.html" class="rfc" title="Consultez l'analyse du RFC 2822">RFC 2822</a>, qui normalise la représentation
des messages « sur le câble » précise que les en-têtes des
messages (donc le sujet, l'expéditeur, etc) doivent être en
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/American%20Standard%20Code%20for%20Information%20Interchange" title="Consultez l'article &quot;American Standard Code for Information Interchange&quot; de l'encyclopédie libre Wikipedia">US-ASCII</a></b> uniquement. Pour pouvoir représenter
des prénoms comme le lien ou bien des sujets avec caractères composés,
le <a href="2047.html" class="rfc" title="Consultez l'analyse du RFC 2047">RFC 2047</a>, qui fait partie de la série sur
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Multipurpose%20Internet%20Mail%20Extensions" title="Consultez l'article &quot;Multipurpose Internet Mail Extensions&quot; de l'encyclopédie libre Wikipedia">MIME</a></b>, précise qu'ils doivent être
encodés. Ainsi, <code>From: Stéphane Bortzmeyer</code> devient
typiquement <code>From: =?ISO-8859-1?Q?St=E9phane?= Bortzmeyer</code>.</p></div>
<div class="para"><p>Lire ces messages n'est pas un problème, tous les
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Client%20de%20messagerie" title="Consultez l'article &quot;Client de messagerie&quot; de l'encyclopédie libre Wikipedia">MUA</a></b> modernes savent le lire et l'afficher
proprement (j'utilise <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/mutt" title="Consultez l'article &quot;mutt&quot; de l'encyclopédie libre Wikipedia">mutt</a></b>).</p></div>
<div class="para"><p>Mais j'utilise mon courrier électronique pour bien d'avantage
qu'une lecture rapide, suivie d'une poubellisation : c'est ma
bibliothèque, mon outil de travail, une source d'information et une
référence. Notamment, il faut absolument que je puisse chercher dans
ce corpus de messages. Et, comme je suis un grand partisan de la
séparation des outils (un <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Client%20de%20messagerie" title="Consultez l'article &quot;Client de messagerie&quot; de l'encyclopédie libre Wikipedia">MUA</a></b> gère le courrier,
il n'a pas besoin de concurrencer les outils de recherche), j'utilise
l'excellent <a href="http://grepmail.sourceforge.net/">grepmail</a>.</p></div>
<div class="para"><p>Je dois donc décoder ces en-têtes avant de les stocker sur ma
machine, dans le jeu de caractères que j'utilise
(<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Latin-1" title="Consultez l'article &quot;Latin-1&quot; de l'encyclopédie libre Wikipedia">Latin-1</a></b> puisque je ne suis <a href="pas-encore-utf8.html" title="Consultez ce blog à propos de &quot;pas-encore-utf8&quot;">pas encore passé à UTF-8</a>).</p></div>
<div class="para"><p>Le programme pour décoder est un script <b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/Python%20(langage)" title="Consultez l'article &quot;Python (langage)&quot; de l'encyclopédie libre Wikipedia">Python</a></b> trivial, qui n'utilise que la
bibliothèque standard du langage :
</p><pre>
#!/usr/bin/python

import email.Header
import sys

header_and_encoding = email.Header.decode_header(sys.stdin.readline())
for part in header_and_encoding:
    if part[1] is None:
        print part[0],
    else:
        upart = (part[0]).decode(part[1])
        print upart.encode('latin-1'),
print
</pre></div>
<div class="para"><p>Et, pour extraire du message ce que je veux décoder, j'utilise
l'outil formail, qui fait partie de
<b><a class="wikipedia" hreflang="fr" href="http://fr.wikipedia.org/wiki/procmail" title="Consultez l'article &quot;procmail&quot; de l'encyclopédie libre Wikipedia">procmail</a></b>. formail extrait le champ indiqué :
</p><pre>
SUBPYTHON=`formail -czxSubject: | bin/rewrite-email.py`

:0fw
| formail -i"Subject: $SUBPYTHON" 
</pre></div>
<div class="para"><p>Et voilà, le courrier est stocké dans ma boîte aux lettres comme si
c'était un fichier texte que j'ai édité, dans l'encodage qui convient
à mes outils.</p></div>
</div>




<p id="get-pdf" class="verysmall"><a href="decoder-en-tetes-courrier.pdf" rel="noindex,nofollow">Version PDF de cette page</a> (mais vous pouvez aussi imprimer depuis votre navigateur, il y a une feuille de style prévue pour cela)</p>
<p id="get-source" class="verysmall"><a href="decoder-en-tetes-courrier.xml" rel="nofollow">Source XML de cette page</a> (cette 
page est distribuée sous les termes de la licence <a href="http://www.gnu.org/copyleft/fdl.html">GFDL</a>)</p>
</div>
</div><!-- End of middle-column -->
</div><!-- End of source-order-container -->
</div><!-- End of inner-column-container -->
</div><!-- End of outer-column-container -->
<div class="clear-columns"><!-- do not delete --></div>
<div id="footer">
<div class="inside">
<hr class="hide" />
<p>Si vous aimez, vous pouvez payer avec <a href="/flattr.html">Flattr</a> <a href="https://flattr.com/submit/auto?user_id=bortzmeyer&url=http%3A%2F%2Fwww.bortzmeyer.org%2Fdecoder-en-tetes-courrier.html" target="_blank"><img src="/images/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0"></a> ou avec <a href="/bitcoin-blog.html">Bitcoin</a> : adresse <code>1HtNJ6ZFUc9yu9u2qAwB4tGdGwPQasQGax</code> (ou voyez le <a href="/images/bitcoin-qrcode.png">code QR</a>). Pour toute remarque sur ce blog, s'adresser à
Stéphane Bortzmeyer <code>&lt;stephane+blog@bortzmeyer.org&gt;</code>. Je suis <a href="http://sl4.org/crocker.html">les règles de Crocker</a> donc pas besoin de faire des excès de diplomatie. Ce blog est strictement personnel et les opinions exprimées ici n'engagent donc que moi, et notamment pas mon employeur présent ou mes employeurs passés.</p>
<a href="http://prefetch.validatorsearch.verisignlabs.com"></a><!-- See http://validatorsearch.verisignlabs.com/ -->
</div>
</div><!-- End of footer -->
</div><!-- End of page-container -->
</body>
</html>


