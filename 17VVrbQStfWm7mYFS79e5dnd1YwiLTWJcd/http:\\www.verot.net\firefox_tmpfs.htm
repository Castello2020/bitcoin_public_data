http://www.verot.net/firefox_tmpfs.htm
HTTP/1.1 200 OK
Set-Cookie: 240planBAK=R2339298881; path=/; expires=Wed, 23-Jul-2014 08:32:42 GMT
Content-Type: text/html; charset=utf-8
Set-Cookie: 240plan=R496454118; path=/; expires=Wed, 23-Jul-2014 08:37:06 GMT
Server: Apache
Set-Cookie: PHPSESSID=c65e8e0314c256cd561c94a05e3b172e; path=/
Vary: Accept-Encoding
Content-Encoding: gzip
Date: Wed, 23 Jul 2014 07:23:13 GMT
Connection: close
X-Geo: varn25.rbx5
X-Geo-Port: 1003
X-Cacheable: Not cacheable: no cache headers from backend

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Speed up Firefox with tmpfs - verot.net</title>
    <meta name="verify-v1" content="Z5X87kNhRmOTQjlQt+xgCGgdGE7fSoY9zr2Ig5lcBQA=" />
    <meta name="Author" content="Colin Verot" />
    <meta name="Identifier-URL" content="www.verot.net" />
    <meta name="Reply-to" content="web@verot.net" />
    <meta name="description" content="How to setup Firefox to use tmpfs to store its profile during runtime, which considerably speeds up browsing as the SQLite databases are accessed much faster." />
    <meta name="keywords" content="Colin Verot, design, development, web developer, web design, website creation, freelance, melbourne, site, website, content management system, class upload, php class upload, php upload" />
    <meta name="revisit-after" content="15" />
    <meta name="robots" content="index,follow,noarchive" />
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="Content-Language" content="en-GB" />
    <link rel="Shortcut Icon" href="tpl/aqueous_light/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="js/prettify/prettify.css" />
<link rel="stylesheet" type="text/css" href="cmf.css" />
<link rel="stylesheet" type="text/css" href="tpl/aqueous_light/default.css" />
    <script src="js/prettify/prettify.js" type="text/javascript"></script>
 </head>


<body>

    <div id="wrapper">
    <div id="innerwrapper">

		<div id="header">

            <div id="searchbox"><div id="cmf-search" class="cmf-search"><form method="post" class="cmf-form" action="" name="inline_search_form"><input type="hidden" name="PHPSESSID" value="c65e8e0314c256cd561c94a05e3b172e" /><input type="text" name="search" value="search"  onfocus="if(this.value=='search')this.value='';" /><input type="hidden" name="page" value="search" /></form></div></div>

            <div id="star"><a href="hire_me.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" ><span>hire me</span></a></div>

            <h1><a href="home.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" ><span>verot.net</span></a></h1>

            <h2>quality web development</h2>

            <div id="languages">
                            </div>

            <div id="nav"><ul id="childmenu-menu" ><li id="menuh-home" class=" cmf-menuh-non-selected"><a href="home.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-home" >Home</a></li><li id="menuh-about" class=" cmf-menuh-non-selected"><a href="about.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-about" >About</a></li><li id="menuh-portfolio" class=" cmf-menuh-non-selected"><a href="portfolio.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-portfolio" >Portfolio</a></li><li id="menuh-coding" class=" cmf-menuh-sub-selected"><a href="coding.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-coding" >Coding</a></li><li id="menuh-field-recordings" class=" cmf-menuh-non-selected"><a href="field_recordings.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-field-recordings" >Recordings</a></li><li id="menuh-contact" class=" cmf-menuh-non-selected"><a href="contact.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-contact" >Contact</a></li></ul></div>
            <div id="subnav"><div id="submenu"><ul id="childmenu-coding" ><li id="menuh-php-class-upload" class=" cmf-menuh-non-selected"><a href="php_class_upload.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-php-class-upload" >class.upload.php</a></li><li id="menuh-php" class=" cmf-menuh-non-selected"><a href="php.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-php" >PHP</a></li><li id="menuh-javascript" class=" cmf-menuh-non-selected"><a href="javascript.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-javascript" >Javascript</a></li><li id="menuh-scripts" class=" cmf-menuh-sub-selected"><a href="scripts.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-scripts" >Scripts</a></li><li id="menuh-socks" class=" cmf-menuh-non-selected"><a href="socks.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-socks" >SOCKS & wifi hotspots</a></li></ul></div></div>

		</div>

		<div id="sidebar"  class="hassubsubmenu">

            
                                    <h2>Scripts</h2>
                
                <div id="subsubnav"><div id="subsubmenu"><ul id="childmenu-scripts" ><li id="menuh-thinkpad-antitheft" class=" cmf-menuh-non-selected"><a href="thinkpad_antitheft.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-thinkpad-antitheft" >Anti-Theft system for Thinkpad &amp; KDE</a></li><li id="menuh-kmail-spam" class=" cmf-menuh-non-selected"><a href="kmail_spam.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-kmail-spam" >Using Spamassassin with KMail</a></li><li id="menuh-firefox-tmpfs" class=" cmf-menuh-selected"><a href="firefox_tmpfs.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-selected cmf-menu-firefox-tmpfs" >Speed up Firefox with tmpfs</a></li><li id="menuh-google-language" class=" cmf-menuh-non-selected"><a href="google_language.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-google-language" >Google language</a></li><li id="menuh-amule-monitor" class=" cmf-menuh-non-selected"><a href="amule_monitor.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-amule-monitor" >aMule monitor</a></li><li id="menuh-xvnc-kde" class=" cmf-menuh-non-selected"><a href="xvnc_kde.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-xvnc-kde" >xVNC on KDE</a></li><li id="menuh-ozforces" class=" cmf-menuh-non-selected"><a href="ozforces.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" class=" cmf-menu-ozforces" >OzForces meter</a></li></ul></div></div>

            
		</div>


        		<div id="sidebarright">


            <div id="sidebox">
                
<h2><b>class.upload.php</b></h2>
<a href="php_class_upload.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" ><img width="55" height="57" border="0" align="right" alt="upload_s2.jpg" title="upload_s2.jpg" src="res/upload_s2.jpg" /></a><p class="small"><a href="php_class_upload.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" >class.upload.php</a> is a powerful and mature PHP class to manage uploaded files, and manipulate images in many ways. The script is available under a GPL license.</p>
<ul><li><b>latest version: <a href="php_class_upload.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" >0.32</a>!</b></li>
</ul>
            </div>

            <div id="donatebox">
                Donations accepted
               <div id="hash"><input  onClick="this.select();" type="text" name="hash" value="17VVrbQStfWm7mYFS79e5dnd1YwiLTWJcd" readonly="readonly" /></div>
            </div>

            
                
                <h2>Hosted on verot.net</h2>
                <div id="hosted">
                    <ul>          <li><a target="_new" href="http://www.acihl.org">ACIHL</a></li>              <li><a target="_new" href="http://www.manfromuranus.com">Man from Uranus</a></li>              <li><a target="_new" href="http://www.thevichygovernment.com/">The Vichy Government</a></li>             <li><a target="_new" href="http://www.verot.net/electronaut.co.uk/">Electronaut Records</a></li>             <li><a target="_new" href="http://www.ribeyrons.com">Ribeyron Agro</a></li>              <li><a target="_new" href="http://www.amandinegay.com">Amandine Gay</a></li>                    <li><a target="_new" href="http://www.mezzomonde.com">Mezzo Monde</a></li>                   <li><a target="_new" href="http://www.curry-vavart.com">Collectif Curry-Vavart</a></li>              <li><a target="_new" href="http://www.ecoconfiance-renovation.com/">EcoConfiance Renovation</a></li>              <li><a target="_new" href="http://www.alltrip-tourism.com/">Alltrip-Tourism</a></li>              <li><a target="_new" href="http://www.ladebordante.com/">La Débordante</a></li>              <li><a target="_new" href="http://www.jphilippeau.com/">Jérémy Philippeau</a></li>        <li><a target="_new" href="http://www.vincentprieur.com/">Vincent Prieur</a></li>        <li><a target="_new" href="http://www.alicegarnierjacob.com/">Alice Garnier Jacob</a></li>        <li><a target="_new" href="http://www.takeholdoflife.com/">Take Hold Of Life</a></li>        <li><a target="_new" href="http://www.fugaces.com/">Les Fugaces</a></li>        <li><a target="_new" href="http://www.laurakpegli.com/">Laura Kpegli</a></li>       <li><a target="_new" href="http://www.elsafoucaud.com/">Elsa Foucaud</a></li>    <li><a target="_new" href="http://www.compagniealyopa.com/">Compagnie Alyopa</a></li>     <li><a target="_new" href="http://www.novaobiecta.com/">Nova Obiecta</a></li>  <li><a target="_new" href="http://www.angeleguerre.fr/">Angèle Guerre</a></li>         </ul>                </div>

            
		</div>
		
        <div id="contentwrapper">
		<div id="content" >

            <h2>Speed up Firefox with tmpfs</h2>
<p>Firefox uses SQLlite to store most of its information, which makes it quite slow. As SQLite accesses are IO-bound, Firefox suffers when the disk is heavily used by other processes. Here is a solution to move the profile is a RAM partition, using <i>tmpfs</i>. Note that this solution has been exposed <a href="http://forums.gentoo.org/viewtopic-t-717117-highlight-firefox.html" target="_new">here</a>. I am just presenting a modified solution, which uses <i>rsync</i> to sync the profile on RAM and on disk.</p>


<h3>Prepare your profile</h3>
<p>First, we need to prepare the profile, in order to make it lighter. The original author suggests these change of configuration (in <i>about:config</i> in Firefox):</p>
<pre class="code">set browser.cache.disk.capacity to 20000
set browser.safebrowsing.enabled to false
set browser.safebrowsing.malware.enabled to false</pre>


<p>Then copy your profile in another directory. Your profile is in <i>~/.mozilla/firefox/</i> and looks like <i>xxxxxxxx.default</i>. Create a new directory called <i>profile</i> and copy the contents of your profile into it. before doing that, delete the files <i>urlclassifier*.sqlite</i> in your profile, and empty your cache.</p>
<pre class="code">cd ~/.mozilla/firefox/
mkdir profile
cp -r *.default/* profile/</pre>

<p class="smallnote">Note that this tutorial assumes that you have only one Firefox profile. It can easily be adapted to several profiles. Here, we use the profile <i>xxxxxxxx.default</i>, but replace it with your own profile. Same for the user, which here is <i>xxxx</i>.</p>



<h3>Create RAM partition</h3>
<p>Add this entry in <i>/etc/fstab</i>:</p>
<pre class="code">firefox /home/xxxx/.mozilla/firefox/xxxxxxxx.default tmpfs size=128M,noauto,user,exec,uid=1000,gid=1000 0 0</pre>
<p>Of course, adapt the line above with your user name, your profile directory and the <i>uid</i> and <i>gid</i>.</p>

<h3>Test the profile in RAM</h3>
<p>You will need here to close Firefox, so note the following steps. Close Firefox. Then make sure that the profile is copied in <i>~/.mozilla/firefox/profile/</i>. Empty your original profile directory, so that it is just an empty directory:</p>
<pre class="code">rm -Rf *.default/*</pre>

<p>Before we start Firefox, we need to mount the RAM partition, and copy over the contents of the profile into it.  In the same vein, we will need to regularly copy back the profile in RAM into the profile directory, otherwise all changes to your profile will be lost when you turn off your computer.</p>

<p>We use <i>rsync</i> for that (which is a better solution than using <i>tar</i> IMHO). We create a script that checks whether the profile is in RAM or not (checking for the presence of a <i>.unpacked</i> file). If it is not, we mount the RAM partition, and copy the profile over. If the profile is already in RAM, we synchronise the profile directory with the profile in RAM.</p>

<p>Here is the script (I call it tmpfs_firefox.sh):</p>
<pre class="code">#!/bin/bash

# Change this to match your correct profile
PROFILE="xxxxxxxx.default"

cd "${HOME}/.mozilla/firefox"

if test -z "$(mount | grep -F "${HOME}/.mozilla/firefox/${PROFILE}" )"
then
    mount "${HOME}/.mozilla/firefox/${PROFILE}"
fi

if test -f "${PROFILE}/.unpacked"
then
    rsync -av --delete --exclude .unpacked ./"$PROFILE"/ ./profile/
else
    rsync -av ./profile/ ./"$PROFILE"/
    touch "${PROFILE}/.unpacked"
fi

exit</pre>

<p>You have closed Firefox. Run this script a first time, and it should mount the partition, and copy the profile over. Then, if you list the profile directory, you should see all the profile files:</p>
<pre class="code">~/tmpfs_firefox.sh
ls ~/.mozilla/firefox/*.default/</pre>

<p>Run the script a second time. It should then synchronize the saved profile with the RAM profile.</p>
<pre class="code">~/tmpfs_firefox.sh

# you should see something like:
#    building file list ... done
#    sent 36643 bytes  received 20 bytes  73326.00 bytes sec
#    total size is 45390178  speedup is 1238.04
</pre>

<h3>Test Firefox</h3>
<p>First, make sure that the profile has been mounted correctly in the RAM partition. You can try to unmount the RAm partition, and run the above script again. If your profile is there, simply run Firefox. Hopefully, you will notice that it is real faster. You can see that easily with the so-called <i>smart bar</i> auto completion: results should be instantaneous.</i>

<p>We now need to regularly synchronize the backup profile with profile in RAM. We could do that when you log out, but it is not reliable enough. Since we use <i>rsync</i> to synchronize the profiles, we can run it often. Set up a cron job which calls the above script each 5 or 10 minutes. So if your compter crashes, you will always have your profile saved just a few minutes ago.</p>
<pre class="code">*/5 * * * * $HOME/.tmpfs_firefox.sh</pre>

<p>We should also create a little script to start Firefox, so that we can make sure that the profile is loaded into RAM before Firefox loads. You can use this little script, and use it instead the normal Firefox shortcut:</p>
<pre class="code">#!/bin/bash
~/tmpfs_firefox.sh
firefox &amp;
exit</pre>

<h3>Conclusion</h3>
<p>So what we do is basically backup the profile, and use a script that mounts the normal Firefox profile directory in RAM, and synchronize back and forth the RAM profile with the backup profile. Each 5 minutes, the RAM profile is saved in the backup profile directory. Firefox should just work as before, except it will be noticeably faster as most of the disk access that it does will be done in RAM. And this only cost 128MB of your RAM!</p>

		</div>
		</div>


		<div id="footer">

            <div id="extra">

                <div id="formats">
                    <a href="firefox_tmpfs.print?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e"  rel="nofollow">print version</a>                     | <a href="firefox_tmpfs.txt?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e"  rel="nofollow">plain text version</a>                                       </div>
                <div class="clear"></div>
            </div>

			<div><div id="legal"><a href="legal.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" >copyright</a> 2001-2014 © <a href="http://www.verot.net">Colin Verot</a> - powered by <a href="cmf.htm?PHPSESSID=c65e8e0314c256cd561c94a05e3b172e" >The CMF</a><br />
			<span class="designer">Template design by <a href="http://www.sixshootermedia.com">Six Shooter Media</a></span>.<div></div>

		</div>


        
        <script type="text/javascript"><!--
prettyPrint();

--></script><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-703645-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

    </div>
    </div>
</body>
</html>









