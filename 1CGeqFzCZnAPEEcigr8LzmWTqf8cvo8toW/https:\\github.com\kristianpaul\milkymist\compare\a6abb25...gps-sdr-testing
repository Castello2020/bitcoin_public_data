https://github.com/kristianpaul/milkymist/compare/a6abb25...gps-sdr-testing
Comparing a6abb25...gps-sdr-testing · kristianpaul/milkymist · GitHub
Skip to content
Sign up
Sign in
Explore
Features
Enterprise
Blog
This repository
This repository
All repositories
Star
4
Fork
18
public
kristianpaul/milkymist
forked from m-labs/milkymist
Code
Pull Requests
0
Pulse
Graphs
Network
HTTPS clone URL
Subversion checkout URL
You can clone with
HTTPS
or Subversion.
Download ZIP
Permalink
Edit
a6abb25
...
gps-sdr-testing
We’re showing branches in this repository, but you can also compare across forks.
base fork:
kristianpaul/milkymist
Choose a Base Repository
m-labs/milkymist
kristianpaul/milkymist
bhavikmake/milkymist
binro/milkymist
carlobar/milkymist
danfengzi/milkymist
fallen/milkymist-avnet
gbraad/milkymist
gbraadnl/milkymist
isprin/milkymist
jamiepg1/milkymist
jvillar/milkymist
kamino/milkymist-various
lixxx333/milkymist
mayhem1990/milkymist
mwalle/milkymist
optixx/milkymist-nexys2
piliwilliam0306/milkymist
tangwhut/milkymist
Nothing to show
base:
a6abb25
Choose a base branch
gnss-sdr
gps-sdr
gps-sdr-testing
hello_world
master
Nothing to show
...
head fork:
kristianpaul/milkymist
Choose a Head Repository
m-labs/milkymist
kristianpaul/milkymist
bhavikmake/milkymist
binro/milkymist
carlobar/milkymist
danfengzi/milkymist
fallen/milkymist-avnet
gbraad/milkymist
gbraadnl/milkymist
isprin/milkymist
jamiepg1/milkymist
jvillar/milkymist
kamino/milkymist-various
lixxx333/milkymist
mayhem1990/milkymist
mwalle/milkymist
optixx/milkymist-nexys2
piliwilliam0306/milkymist
tangwhut/milkymist
Nothing to show
compare:
gps-sdr-testing
Choose a head branch
gnss-sdr
gps-sdr
gps-sdr-testing
hello_world
master
Nothing to show
99
commits
233
files changed
0
comments
6
contributors
Commits
Files changed
Commit comments
Nov 27, 2011
sbourdeauducq
standby: auto-on
be2f599
Nov 28, 2011
sbourdeauducq
standby: work around intermittent reconfiguration problem
b6241f0
Nov 30, 2011
sbourdeauducq
Bump version number
33e91c9
wpwrak
softusb: move implementation of trigger into macros
…
This is just a bit of cleanup.

- Werner
398cf75
wpwrak
softusb: correct misunderstanding of use of rx_pending
…
Note that this change increases the risk of rx_pending vs. rx_active
races.
afd24aa
wpwrak
softusb: remove rx_pending vs. rx_active race
…
When testing rx_pending and rx_active in a loop, the following race
can have happened:

- we test rx_pending and find it clear
- the packet's last byte finishes and rx_pending is set
- the EOP is detected and rx_active is cleared
- we test rx_active and conclude that the packet has terminated

Thus, we don't reach the test of rx_pending and miss the packet's
last byte.

This patch changes the SIE_RX_PENDING register such that it allows
both rx_active and rx_pending to be retrieved atomically.
00c097c
wpwrak
softusb: move (still hard-coded) device address to #define
efd771a
wpwrak
softusb: move retrieval of device descriptor to separate function
b2fc9ce
wpwrak
softusb: make EP0 size variable and store it in struct port_status
…
Also increase size of usb_buffer in control_transfer for maximum size
full-speed EP0 (64 bytes).
0031e5c
wpwrak
softusb: end data stage of SETUP also when size limit is reached
…
USB 1.1, 5.5.3, page 37: "The Data stage [...] is complete when the endpoint
[...] Has transferred exactly the amount of data specified [.]"
98e19c9
wpwrak
softusb: set EP0 size before trying any larger accesses
…
For transfers of more than 8 bytes, we need to know the EP0 size
to correctly detect the end of the transfer. This patch adds a
new state to read the first 8 bytes of the device descriptor and
to set the EP0 size for the following steps in enumeration.
217c33d
wpwrak
softusb: use symbolic names for various USB constants
4923a9d
wpwrak
softusb: move protocol identification (interface descriptor) to separ…
…
…ate function
4d9920b
wpwrak
softusb: remove trailing whitespace
…
Some lines had trailing tabs. Those can sometimes trip patch.
dae5ff5
wpwrak
softusb: minimize time between SETUP/OUT and DATAx
…
By not waiting until the transmitter is idle, we can reduce the
time between the end of the SE0 indicating EOP of SETUP or OUT
and the first transition of the following DATAx to a mere two
bit times (as oppose to ~6 bit times before).

While I haven't been able to find anything in the USB standard
that would require such tight timing, AVR USB chips (i.e., the
ATmega32U2 of atusb and the AT90USB162 of the Faderfox LV3)
flat out ignore any transfers with longer delays.
6ca46c2
wpwrak
softusb: clean up device reporting
…
Moved reporting of the device(s) detected out of port_service, making
it a bit less cluttered and providing a more comfortable basis for
future additions.
b553999
wpwrak
softusb: added detection of MIDI devices (WIP)
0294551
wpwrak
softusb: move protocol-specfic data processing to separate functions
…
This will prevent "poll" from getting too cluttered when MIDI is added.
98be89d
wpwrak
softusb: protect macro arguments in comloc.h
…
This change is purely cosmetic.
b452f54
wpwrak
softusb: poll MIDI EPs and pass control changes to the LM32
…
Adding other events should be easy, but one step at a time.
9e05e46
sbourdeauducq
Constrain VGA DAC timing. This fixes the 'gradient bug' that can occu…
…
…r depending on PAR results.
39fc153
Dec 01, 2011
wpwrak
softusb: allow IN transfers with a payload of up to 64 bytes
…
Commit 9e05e46 increased the buffer
size for IN transfers but still only read no more than 8 bytes. Ooops.
This patch makes it receive up to 64 bytes.
b663a05
wpwrak
softusb: ignore the CIN when classifying USB-MIDI messages
…
iCON don't always send a correct CIN value. Luckily, we can use the
first byte of the actual MIDI message instead.
9ede465
wpwrak
softusb: don't forget notifying the host when there are news from MIDI
…
The host interrupt wasn't asserted when enqueuing MIDI messages.
No surprise some controls acted strangely ...
dbcce91
wpwrak
softusb: accept everything but non-MIDI and system messages
…
This patch removes the limitation to control change messages. We can
now also have "piano" notes and so on.
58daf4c
Dec 02, 2011
Xiangfu Liu
bios: make the LIBS as .PHONY
…
Signed-off-by: Xiangfu Liu &lt;xiangfu@sharism.cc&gt;
72005cf
Dec 03, 2011
wpwrak
libfpvm: use C operator precedence
…
Placing each operator at its own precedence level subtly alters the
evaluation order for +, -, *, and /, which can produce unexpected
results where rounding errors are considered.

More significantly, the precendence of % differs from that used in
C (and various other languages). For example,

2 * 3.1 % 2  with C precedence would be
(2 * 3.1) % 2 = 6.2 % 2 = 0.2   (unlike C's %, our % if really fmod)

By giving % higher precedence than *, we get
2 * (3.1 % 2) = 2 * 1.1 = 2.2  instead.

I don't know if this difference is intentional, e.g., required for
compatibility with Milkdrop. But it does at least look suspicious.

- Werner
36b1e07
kristianpaul
Merge branch 'master' into gps-sdr-testing
f41cc07
Dec 07, 2011
wpwrak
libfpvm: wrap some overlong lines in fpvm.c
…
fpvm.c contains many lines longer than 80 characters, which makes the
code hard to read. This patch wraps most of them. Some are left long,
because they will be rewritten in a later patch.
a733673
wpwrak
fpvm.c: replace code patterns involving add_isn with macros
9cc6afe
wpwrak
fpvm.c: replace code patterns of register allocation with macro
81aea32
wpwrak
fpvm.c: replace code patterns with constant register with macro
d0e72af
wpwrak
fpvm.c: replace code patterns involving add_inv_sqrt and add_int with…
…
… macros
b5277a3
wpwrak
fpvm.c: replace code patterns involving "compile" with macros
9631279
wpwrak
fpvm.c: changed form of REG_ALLOC and REG_CONST (suggested by Michael…
…
… Walle)

This is the patch with just the declaration style change.
2b3952e
Xiangfu Liu
delete all script file. Makefile soon
…
Signed-off-by: Xiangfu Liu &lt;xiangfu@sharism.cc&gt;
644c8a7
Xiangfu Liu
use Makefile manage the build progress cleanup the gcc output, make V…
…
…=1 will output all detail message

Signed-off-by: Xiangfu Liu &lt;xiangfu@sharism.cc&gt;
81cbd14
wpwrak
libfpvm: make scanner aware of function names and handle arity in parser
…
This patch makes the scanner recognize function names as distinct tokens
(and not just as identifiers). This gives the parser more information
and will also enable further changes.

The parser now only accepts functions with the correct number of
arguments. Before, mistakes like sin(a, b) or min(a) were silently
accepted.
af32d45
wpwrak
parser.y: move node allocation and initialization to shared function
…
parser.y had a lot of copies of what's essentially the same code.
This patch tidies it up.
428da57
wpwrak
libfpvm: pass token in struct ast_node
…
This will help with further optimizations.
d495b3a
wpwrak
fpvm.c: use token instead of operator name in operator2opcode
1cf5a46
wpwrak
fpvm.c: use token instead of operator name in "compile"
08249b0
wpwrak
libfpvm: infrastructure for efficient unique ID pointers
8acc7a1
wpwrak
libfpvm: use unique strings in interface between scanner and parser
91963c5
wpwrak
libfpvm: convert constants already in fpvm_parse
…
That way, we don't need to carry the string along.
82aaab6
wpwrak
libfpvm: copy only pointer to identifier into AST, not the entire string
c164d92
wpwrak
libfpvm: copy only pointer into bindings, not the entire string
0500751
wpwrak
fpvm.c: use unique strings also in fpvm_assign ... and bring in the h…
…
…arvest

Since everything in libfpvm now uses unique strings, we can compare
strings for equality simply by comparing pointers.
92eefac
Dec 11, 2011
kristianpaul
added support for short int signed read from unsigned int reg from ac…
…
…cumulator
f675333
kristianpaul
fake usb irq value and removing non-needed code HACK
d1e4dab
Dec 12, 2011
wpwrak
fpvm.c: renaming decision in fpvm_assign got reversed
9e61c7f
wpwrak
libfpvm: add also functions and internal variables to fnp.ids
08f9c18
wpwrak
libfpvm/unique.c: fix grow_table and strcmp_n
…
- grow_table didn't update the array size after growing
- if string "b" was longer than "a", strcmp_n returned a positive value
  indicating a &gt; b
55b8e61
wpwrak
libfpvm: don't store non-identifiers in the cache of unique identifiers
57d8617
wpwrak
unique.c: use libc functions instead of DIY replacements
b92595f
wpwrak
libfpvm/Makefile: build now for RTEMS (instead of the demo firmware)
…
Note that "make depend" gets a bit whiny after this change, because it
doesn't know where to find the system headers. We also get two new
compiler warnings from isalnum, due to newlib not consistently casting
to "int".
e4f4529
wpwrak
libfpvm: git rm -rf lm32-rtems/
75e8acb
wpwrak
libfpvm: don't use TOK_* inside fpvm.c
…
Code generation will have no access to the token numbers assigned by the
parser, so we create our own numbering scheme and translate between
parsing and code generation.
b29910c
wpwrak
libfpvm: split parser from fpvm.c (to fpvm-export.c)
9ffb383
wpwrak
libfpvm: export ast.h and split internal communication (to parser_itf.h)
20b0f1c
wpwrak
libfpvm: departure of scanner and parser
4fdae4a
wpwrak
fpvm/fpvm.h: declare bottom functions still here, not migrated functions
…
fpvm_init and fpvm_assign no longer live here. Instead, declare their
lower-level remains.
7cec37e
wpwrak
milkymist: ANSI-style fpvm_version declaration
d30353b
sbourdeauducq
Remove demo firmware
6f50e96
kristianpaul
Merge branch 'master' into gps-sdr-testing
ffbc89b
Dec 14, 2011
wpwrak
milkymist: remove unused variables in libbase/softfloat.c
555e97f
wpwrak
milkymist: use -Wstrict-prototypes
…
And fix resulting warnings.
abec542
wpwrak
milkymist: try -Wmissing-prototypes
…
The math functions have too many issues to make this viable without
substantially more fixing. Just fix what little else is there.
ad11623
wpwrak
milkymist: use -Wold-style-definition
f043b4c
wpwrak
milkymist: use -Wshadow
…
Only one minor conflict found.
14a31d4
sbourdeauducq
Remove libmath
14ad8ba
Dec 23, 2011
kristianpaul
updated gold codes
99cc5f5
kristianpaul
cosmetic changes
c877aa2
kristianpaul
NOW is really update prn/gold codes from namuru datasheet
f9a4ec3
Dec 28, 2011
wpwrak
software/libfpvm/Makefile: update dependencies
…
They still contained lots of old junk.
29230eb
wpwrak
fpvm.c: suppress compiler warning caused by -Wunused-value
…
This warning was generated when compiling x86-linux/, which uses clang
instead of gcc.
2ce4328
Dec 29, 2011
wpwrak
milkymist: declare "code" argument of pfpu_dump "const"
…
A small bit of cleanup, to allow Flickernoise to do the same.

- Werner
5645389
Dec 30, 2011
wpwrak
libfpvm: rename op_not to op_negate
…
We'll soon use "not", and this would get confusing.
f630928
wpwrak
libfpvm: end enum ast_op with op_vops, for parser-internal extensions
9f71dde
Jan 07, 2012
wpwrak
libfpvm: only access node->label if we have an indentifier
…
We provide a function node_is_op for the library user to make this
distiction as well (used in parser_helper.c).

Note that this change means that we can't report the name of the
operator that causes an "Operation not supported" error. This is
visible to users in the case of op_not. Fix later.
44acf61
Jan 09, 2012
wpwrak
libfpvm: introduce "struct sym" as abstraction for an identifier
…
This has ripple effects all through libfpvm but shouldn't change
functionality.
99f2502
Jan 11, 2012
wpwrak
libfpvm: rename "struct sym" to "struct fpvm_sym"
8dbe0fd
Jan 12, 2012
wpwrak
libfpvm: make op_not a regular operator and implement it in all cases
…
We can substitute  !X  it with  X == 0. This catches cases where boolean
not is used algorithmically and not directly with if.
3e056a9
wpwrak
libfpvm/x86-linux/Makefile: support silent builds as well
9f8e947
Jan 15, 2012
wpwrak
tools/asm: PFPU assembler
8696dfc
wpwrak
tools/asm/pfpu: quick and dirty script to run pfpuasm and execute the…
…
… result

The environment variable M1_HOST defines on which M1 to execute
the code. M1_USER and M1_PW define the telnet access.
c844116
wpwrak
tools/asm/pfpu: fix processing of option -i
…
The option -i wasn't shifted off, causing pfpuasm and ultimately cpp
to fail.
6e3e917
wpwrak
pfpuasm: auto-NOP, pass all regs, and some syntax corrections
…
A number of small improvements:

- VECTOUT doesn't need a destination register (use 0)
- QUAKE is unary, not binary
- option -a to automatically fill the latency slots with NOP
  (without caring about efficiency)
- all registers referenced (read or write) are listed
539486b
wpwrak
asm/pfpu: new option -v; cleanup
…
This patch contains the following changes:

- new option -v for verbose operation. By default, pfpu now only displays
  the result line and ignores the rest of the session.

- send nc's diagnostics to standard output so that we can suppress
  its "connected" line (alas, this means that error messages are
  only shown in verbose mode)

- added header comment
da4c311
wpwrak
asm/fpvm: fpvm-like execution engine
…
This engine also accepts symbolic register names. Uses pfpu for
stepwise execution.
9f7ff2c
wpwrak
asm/mod.fpvm: modulo calculation example
…
Run with
./fpvm mod.fpvm

Or, more entertaining
./fpvm -x mod.fpvm

For every last gory detail, use
./fpvm -d -x mod.fpvm
6f346c3
Jan 17, 2012
wpwrak
libfpvm: rename op_not to op_bnot, to follow MilkDrop naming
f2650b2
Jan 25, 2012
wpwrak
libfpvm: added operators for logical AND and OR (untested, WIP)
530ae74
Feb 08, 2012
dvdkhlng
fix 'make install' target
…
Just a slight fix.  Don't like non-distribution stuff to populate /usr/bin

cheers,

David
0a5dc08
Feb 10, 2012
fpgaminer
improvement for libbase uart.c
…
  uart_isr, when applicable, will reset CSR_UART_STAT after it has
  written new data to the UART module. If the UART module is able
  to finish that request before uart_isr writes to CSR_UART_STAT,
  then uart_isr will end up clearing the wrong event. This prevents
  uart_isr from ever being called again, and stalls all outgoing data
832e989
Feb 19, 2012
kristianpaul
Merge branches 'master' and 'gps-sdr-testing' into gps-sdr-testing
b1c6d66
kristianpaul
Fix clock frequency to 4x SiGE EVB Sampling clock
5fc3020
kristianpaul
warning comment (to remenber my self)
e2d56b8
Feb 28, 2012
kristianpaul
clear after read support
ec596a9
Showing 233 changed files
with 1,838 additions
and 18,702 deletions.
Show diff stats
Hide diff stats
+48
−0
 Makefile
+1
−19
 README
+2
−2
 boards/milkymist-one/rtl/setup.v
+2
−2
 boards/milkymist-one/rtl/system.v
+29
−0
 boards/milkymist-one/standby/standby.v
+1
−0
 boards/milkymist-one/synthesis/common.ucf
+0
−77
 build_bios.sh
+0
−42
 build_bitstream.sh
+0
−85
 build_demo.sh
+0
−37
 build_doc.sh
+0
−74
 build_sdk.sh
+0
−37
 clean_all.sh
+0
−1
 coredoc.inc
+29
−29
 cores/namuru/rtl/namuru_baseband.v
+1
−1
 cores/softusb/rtl/softusb_sie.v
+0
−27
 load_bitstream.sh
+0
−43
 load_demo.sh
+0
−76
 patches/Aderrasi - Candy Avian.milk
+0
−84
 patches/Aderrasi - Kevlar Tunnel.milk
+0
−75
 patches/Aderrasi - Variants Of Eternity (Shaking mix).milk
+0
−67
 patches/Bmelgren & Krash - Rainbow Orb Peacock (Lonely Signal Gone Mad Mix) simplified.milk
+0
−59
 patches/DaNOnE - Highway to Heaven (rotating) brighter.milk
+0
−61
 patches/EvilJim - Ice Drops.milk
+0
−80
 patches/Fvese - A Blur.milk
+0
−83
 patches/Fvese - The Tunnel (Final Stage Mix) simplified.milk
+0
−65
 patches/Geiss - Aieeeeee!!!.milk
+0
−54
 patches/Geiss - Anomaly 2.milk
+0
−74
 patches/Geiss - Asymptote.milk
+0
−76
 patches/Geiss - Bipolar 1.milk
+0
−64
 patches/Geiss - Blasto.milk
+0
−69
 patches/Geiss - Bonfire.milk
+0
−48
 patches/Geiss - Bright Fiber Matrix 1.milk
+0
−68
 patches/Geiss - Bright Fiber Matrix 2.milk
+0
−71
 patches/Geiss - Cepiasound.milk
+0
−47
 patches/Geiss - Corpus Callosum.milk
+0
−69
 patches/Geiss - Cosmic Dust 2.milk
+0
−54
 patches/Geiss - Digital Smoke.milk
+0
−54
 patches/Geiss - Eggs.milk
+0
−55
 patches/Geiss - El Cubismo.milk
+0
−70
 patches/Geiss - Hovering.milk
+0
−51
 patches/Geiss - Hyperion.milk
+0
−79
 patches/Geiss - Iris.milk
+0
−69
 patches/Geiss - Journey.milk
+0
−77
 patches/Geiss - Julia Fractal 1.milk
+0
−68
 patches/Geiss - Microcosm.milk
+0
−47
 patches/Geiss - Quasilinear Submanifolds.milk
+0
−71
 patches/Geiss - Scary.milk
+0
−78
 patches/Geiss - Sound And The Fury.milk
+0
−63
 patches/Geiss - Spacedust.milk
+0
−75
 patches/Geiss - Supernova 1.milk
+0
−68
 patches/Geiss - Swirl 1.milk
+0
−75
 patches/Geiss - Swirlie 1.milk
+0
−69
 patches/Geiss - Swirlie 3.milk
+0
−68
 patches/Geiss - Swirlie 5.milk
+0
−53
 patches/Geiss - Symmetry.milk
+0
−77
 patches/Geiss - The Fatty Lumpkin Sunkle Tweaker.milk
+0
−55
 patches/Geiss - Three And A Half Kinds Of Amphetamines.milk
+0
−71
 patches/Geiss - Toy.milk
+0
−49
 patches/Geiss - Warp Of Dali 1.milk
+0
−67
 patches/Geiss - Waterfall.milk
+0
−79
 patches/Illusion & Rovastar - Clouded Bottle.milk
+0
−74
 patches/Illusion & Rovastar - Snowflake Delight.milk
+0
−77
 patches/Illusion & Rovastar - Snowflake Return.milk
+0
−79
 patches/Krash - Digital Flame simplified.milk
+0
−74
 patches/Krash - Interwoven (Nightmare Weft Mix) simplified.milk
+0
−56
 patches/Philpraxis - Eight bit starfield.milk
+0
−55
 patches/Philpraxis - La respiration de texture.milk
+0
−67
 patches/Reenen - phoenix.milk
+0
−59
 patches/Rocke - Personal Comet brighter.milk
+0
−65
 patches/Rovastar & EvilJim - Bass Tube of Light.milk
+0
−76
 patches/Rovastar & Fvese - Dark Subconscious simplified.milk
+0
−82
 patches/Rovastar & Idiot24-7 - Balk Acid (DMX madness).milk
+0
−77
 patches/Rovastar & Idiot24-7 - Balk Acid.milk
+0
−85
 patches/Rovastar & Rocke - Headspin.milk
+0
−75
 patches/Rovastar - A Million Miles from Earth.milk
+0
−71
 patches/Rovastar - Cosmic Echoes 2.milk
+0
−75
 patches/Rovastar - Forgotten Moon simplified.milk
+0
−68
 patches/Rovastar - LabFunk simplified.milk
+0
−71
 patches/Rovastar - Multiverse Starfield 1.milk
+0
−75
 patches/Rovastar - Oozing Resistance simplified.milk
+0
−67
 patches/Rovastar - Touchdown on Mars (Detailed Pictures Mix).milk
+0
−85
 patches/Rozzor & Aderrasi - Canon (DMX).milk
+0
−81
 patches/Rozzor & Aderrasi - Canon simplified.milk
+0
−61
 patches/StudioMusic - Twisted Galaxy.milk
+0
−77
 patches/Telek - Slow Shift Matrix (bb4.5) simplified.milk
+0
−80
 patches/Unchained & Rovastar - Wormhole Pillars (Hall of Shadows mi.milk
+0
−91
 patches/Unchained - Goofy Beat Detection heavily simplified.milk
+0
−73
 patches/Zylot & Aderrasi - Oceanic Bassograph (New Jersey Shore Mix).milk
+0
−69
 patches/Zylot - Color Of Music simplified.milk
+0
−72
 patches/Zylot - The Inner Workings of my New Computer.milk
+0
−67
 patches/nil - Cid and Lucy simplified.milk
+0
−70
 patches/nil - Disco Comet.milk
+0
−11
 setup.inc
+5
−3
 softusb-input/comloc.h
+293
−137
 softusb-input/main.c
+3
−1
 softusb-input/sie.h
+1
−1
 software/bios/Makefile
+0
−3
 software/bios/isr.c
+62
−31
 software/bios/main.c
+0
−157
 software/demo/Makefile
+0
−96
 software/demo/analyzer.c
+0
−39
 software/demo/analyzer.h
+0
−278
 software/demo/apipe.c
+0
−26
 software/demo/apipe.h
+0
−395
 software/demo/bandfilters.h
+0
−48
 software/demo/bandfilters.sce
+0
−53
 software/demo/color.h
+0
−112
 software/demo/cpustats.c
+0
−28
 software/demo/cpustats.h
+0
−158
 software/demo/crt0.S
+0
−564
 software/demo/eval.c
+0
−213
 software/demo/eval.h
+0
−93
 software/demo/font.c
+0
−35
 software/demo/font.h
+0
−63
 software/demo/isr.c
+0
−492
 software/demo/line.c
+0
−25
 software/demo/line.h
+0
−64
 software/demo/linker.ld
BIN

software/demo/logo.png
+0
−89
 software/demo/main.c
+0
−76
 software/demo/memstats.c
+0
−31
 software/demo/memstats.h
+0
−348
 software/demo/osd.c
+0
−27
 software/demo/osd.h
+0
−220
 software/demo/renderer.c
+0
−34
 software/demo/renderer.h
+0
−622
 software/demo/rpipe.c
+0
−67
 software/demo/rpipe.h
+0
−1,089
 software/demo/shell.c
+0
−24
 software/demo/shell.h
+0
−30
 software/demo/tick.c
+0
−4,749
 software/demo/vera20_tff.c
+0
−131
 software/demo/wave.c
+0
−43
 software/demo/wave.h
+39
−10
 software/include.mak
+1
−1
 software/include/base/blockdev.h
+2
−2
 software/include/base/board.h
+4
−4
 software/include/base/console.h
+1
−1
 software/include/base/fatfs.h
+3
−3
 software/include/base/irq.h
+0
−86
 software/include/base/math.h
+2
−2
 software/include/base/stdlib.h
+5
−5
 software/include/base/system.h
+4
−4
 software/include/base/uart.h
+1
−1
 software/include/base/version.h
+42
−18
 software/{libfpvm → include/fpvm}/ast.h
+16
−11
 software/include/fpvm/fpvm.h
+1
−1
 software/include/fpvm/pfpu.h
+18
−0
 software/include/fpvm/symbol.h
+1
−1
 software/include/hal/brd.h
+0
−25
 software/include/hal/correlator.h
+1
−1
 software/include/hal/dmx.h
+1
−1
 software/include/hal/mem.h
+2
−2
 software/include/hal/pfpu.h
+11
−11
 software/include/hal/snd.h
+3
−3
 software/include/hal/time.h
+2
−2
 software/include/hal/tmu.h
+1
−1
 software/include/hal/ukb.h
+2
−2
 software/include/hal/usb.h
+4
−4
 software/include/hal/vga.h
+1
−1
 software/include/hal/vin.h
+1
−0
 software/include/hw/interrupts.h
+2
−2
 software/include/net/microudp.h
+6
−6
 software/libbase/blockdev.c
+2
−2
 software/libbase/board.c
+2
−2
 software/libbase/console.c
+1
−1
 software/libbase/fatfs.c
+2
−2
 software/libbase/libc.c
+1
−2
 software/libbase/softfloat.c
+5
−5
 software/libbase/system.c
+5
−5
 software/libbase/uart.c
+0
−1
 software/libbase/vsnprintf.c
+18
−43
 software/libfpvm/Makefile
+307
−237
 software/libfpvm/fpvm.c
+0
−16
 software/libfpvm/lm32-rtems/Makefile
+0
−146
 software/libfpvm/parser.y
+0
−70
 software/libfpvm/parser_helper.c
+0
−26
 software/libfpvm/parser_helper.h
+1
−1
 software/libfpvm/pfpu.c
+0
−48
 software/libfpvm/scanner.h
+0
−88
 software/libfpvm/scanner.re
+3
−15
 software/libfpvm/subdir.mak
+18
−3
 software/libfpvm/x86-linux/Makefile
+2
−2
 software/libhal/brd.c
+1
−1
 software/libhal/dmx.c
+1
−1
 software/libhal/mem.c
+2
−2
 software/libhal/pfpu.c
+11
−11
 software/libhal/snd.c
+2
−2
 software/libhal/time.c
+2
−2
 software/libhal/tmu.c
+3
−3
 software/libhal/ukb.c
+3
−3
 software/libhal/usb.c
+11
−11
 software/libhal/vga.c
+6
−6
 software/libhal/vin.c
+0
−47
 software/libmath/Makefile
+0
−35
 software/libmath/acosf.c
+0
−85
 software/libmath/asincosf.c
+0
−36
 software/libmath/asinf.c
+0
−48
 software/libmath/atan2f.c
+0
−73
 software/libmath/atanf.c
+0
−35
 software/libmath/ceilf.c
+0
−33
 software/libmath/cosf.c
+0
−32
 software/libmath/coshf.c
+0
−44
 software/libmath/cotf.c
+0
−89
 software/libmath/expf.c
+0
−34
 software/libmath/fabsf.c
+0
−35
 software/libmath/floorf.c
+0
−40
 software/libmath/frexpf.c
+0
−39
 software/libmath/ldexpf.c
+0
−30
 software/libmath/log10f.c
+0
−69
 software/libmath/logf.c
+0
−31
 software/libmath/modff.c
+0
−34
 software/libmath/powf.c
+0
−89
 software/libmath/sincosf.c
+0
−92
 software/libmath/sincoshf.c
+0
−33
 software/libmath/sinf.c
+0
−32
 software/libmath/sinhf.c
+0
−54
 software/libmath/sqrtf.c
+0
−88
 software/libmath/tancotf.c
+0
−33
 software/libmath/tanf.c
+0
−63
 software/libmath/tanhf.c
+3
−3
 software/libnet/mdio.c
+6
−6
 software/libnet/microudp.c
+0
−2
 software/update_depend.sh
+2
−2
 tools/Makefile
+65
−0
 tools/asm/Makefile
+68
−0
 tools/asm/asm.l
+174
−0
 tools/asm/asm.y
+80
−0
 tools/asm/fpvm
+86
−0
 tools/asm/mod.fpvm
+37
−0
 tools/asm/pfpu
+180
−0
 tools/asm/pfpuasm.c
+74
−0
 tools/asm/pfpuasm.h
48 
Makefile
show inline notes
View
...
...
@@ -0,0 +1,48 @@
1
+#
2
+# Authors: Xiangfu Liu <xiangfu@sharism.cc>
3
+# bitcoin: 1CGeqFzCZnAPEEcigr8LzmWTqf8cvo8toW
4
+#
5
+# License GPLv3 or later. NO WARRANTY.
6
+#
7
+
8
+BASEDIR=${CURDIR}
9
+
10
+SYNTOOL?=xst
11
+BOARD?=milkymist-one
12
+
13
+SDK_DIRS=libbase libhal libfpvm libnet
14
+SW_DIRS=${SDK_DIRS} libhpdmc libfpvm libfpvm/x86-linux libfpvm/lm32-linux bios
15
+
16
+CORE_DIRS=ac97 bt656cap conbus dmx fmlbrg fmlmeter hpdmc_ddr32 \
17
+	memcard pfpu rc5 softusb sysctl tmu2 uart vgafb
18
+
19
+host:
20
+	make -C ${BASEDIR}/tools
21
+
22
+bios: host
23
+	make -C ${BASEDIR}/software/bios
24
+
25
+bitstream: host
26
+	make -C ${BASEDIR}/boards/${BOARD}/synthesis -f Makefile.${SYNTOOL}
27
+
28
+sdk: host
29
+	for d in $(SDK_DIRS); do make -C ${BASEDIR}/software/$$d || exit 1; done
30
+
31
+load-bitstream: bitstream
32
+	make -C ${BASEDIR}/boards/${BOARD}/synthesis -f Makefile.${SYNTOOL} load
33
+
34
+docs:
35
+	make -C ${BASEDIR}/doc
36
+	for d in $(CORE_DIRS); do make -C ${BASEDIR}/cores/$$d/doc || exit 1; done
37
+
38
+.PHONY: clean load-bitstream
39
+clean:
40
+	make -C ${BASEDIR}/boards/milkymist-one/synthesis -f common.mak clean
41
+	make -C ${BASEDIR}/boards/milkymist-one/standby clean
42
+	make -C ${BASEDIR}/boards/milkymist-one/flash clean
43
+	make -C ${BASEDIR}/doc clean
44
+	make -C ${BASEDIR}/tools clean
45
+	make -C ${BASEDIR}/softusb-input clean
46
+	for d in $(CORE_DIRS); do make -C ${BASEDIR}/cores/$$d/doc clean || exit 1; done
47
+	for d in $(SW_DIRS); do make -C ${BASEDIR}/software/$$d clean || exit 1; done
48
+	(cd ${BASEDIR}/cores/pfpu ./cleanroms.sh)
20 
README
show inline notes
View
@@ -26,27 +26,9 @@ You will need:
26
26
- Xilinx ISE for synthesizing the FPGA bitstream (WebPack is enough),
27
27
- LatticeMico32 toolchain for building the SoC software,
28
28
- AVR toolchain for building the USB firmware,
29
- - SRecord,
30
29
- xxd,
31
30
- native Clang/LLVM toolchain,
32
- - libGD,
33
- - RE2C,
34
- - Lemon parser generator.
35
-
36
-To regenerate the FIR filter coefficients (only if you touch it):
37
- - Scilab.
38
-
39
-NB. Before switching synthesis tools, don't forget to run "make clean" in the
40
-synthesis directory.
41
-
42
-
43
-[> Output files
44
- /boards/xxx/synthesis/build/system.bit build_bitstream.sh FPGA bitstream.
45
- /software/bios/bios.bin build_bios.sh BIOS image.
46
- /software/demo/boot.bin build_demo.sh Demonstration firmware image.
47
- /boards/xxx/flash/yyy.fpg use Makefile Flash images.
48
- /doc/xxx.pdf build_doc.sh System-wide documentation.
49
- /cores/xxx/doc/xxx.pdf build_doc.sh Core-specific documentation.
31
+ - libGD.
50
32
51
33
52
34
[> Development
4 
boards/milkymist-one/rtl/setup.v
show inline notes
View
@@ -42,12 +42,12 @@
42
42
/*
43
43
* System clock frequency in Hz.
44
44
*/
45
-`define CLOCK_FREQUENCY 81920000
45
+`define CLOCK_FREQUENCY 65536000
46
46
47
47
/*
48
48
* System clock period in ns (must be in sync with CLOCK_FREQUENCY).
49
49
*/
50
-`define CLOCK_PERIOD 61
50
+`define CLOCK_PERIOD 15.2
51
51
52
52
/*
53
53
* Default baudrate for the debug UART.
4 
boards/milkymist-one/rtl/system.v
show inline notes
View
@@ -160,7 +160,7 @@ wire sys_clk_dcm;
160
160
wire sys_clk_n_dcm;
161
161
162
162
DCM_SP #(
163
-	.CLKDV_DIVIDE(1.5),	// 1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0,5.5,6.0,6.5
163
+	.CLKDV_DIVIDE(1.5),	// 1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0,5.5,6.0,6.5 - ignored
164
164
165
165
.CLKFX_DIVIDE(1),	// 1 to 32
166
166
.CLKFX_MULTIPLY(4),	// 2 to 32
@@ -935,7 +935,7 @@ sysctl #(
935
935
.ninputs(7),
936
936
.noutputs(2),
937
937
.clk_freq(`CLOCK_FREQUENCY),
938
-	.systemid(32'h11004D31) /* 1.1.0 final (0) on M1 */
938
+	.systemid(32'h12004D31) /* 1.2.0 final (0) on M1 */
939
939
) sysctl (
940
940
.sys_clk(sys_clk),
941
941
.sys_rst(sys_rst),
29 
boards/milkymist-one/standby/standby.v
show inline notes
View
@@ -15,6 +15,8 @@
15
15
* along with this program. If not, see <http://www.gnu.org/licenses/>.
16
16
*/
17
17
18
+`define AUTO_ON
19
+ 18
20
module standby(
19
21
input clk50,
20
22
@@ -84,6 +86,7 @@ BUFG b1(
84
86
.O(clk)
85
87
);
86
88
89
+`ifndef AUTO_ON
87
90
reg btn1_r0;
88
91
reg btn1_r;
89
92
reg btn2_r0;
@@ -111,6 +114,7 @@ end
111
114
reg [19:0] debounce_r;
112
115
always @(posedge clk) debounce_r <= debounce_r + 20'd1;
113
116
assign debounce = &debounce_r;
117
+`endif
114
118
115
119
reg ce_r;
116
120
reg [15:0] d_r;
@@ -179,6 +183,7 @@ always @(posedge clk, negedge locked)
179
183
else
180
184
state <= next_state;
181
185
186
+`ifndef AUTO_ON
182
187
reg rescue;
183
188
reg next_rescue;
184
189
always @(posedge clk, negedge locked)
@@ -186,20 +191,40 @@ always @(posedge clk, negedge locked)
186
191
rescue <= 1'b0;
187
192
else
188
193
rescue <= next_rescue;
194
+`endif
195
+
196
+`ifdef AUTO_ON
197
+/* HACK: for some reason, reconfiguring right away fails intermittently.
198
+ * Work around this with a timer.
199
+ */
200
+reg [19:0] timer;
201
+always @(posedge clk, negedge locked)
202
+	if(~locked)
203
+	timer <= 20'd0;
204
+	else
205
+	timer <= timer + 20'd1;
206
+`endif
189
207
190
208
always @(*) begin
191
209
d = 16'hxxxx;
192
210
icap_en_n = 1'b1;
193
211
212
+`ifndef AUTO_ON
194
213
next_rescue = rescue;
214
+`endif
195
215
196
216
next_state = state;
197
217
198
218
case(state)
199
219
IDLE: begin
220
+`ifdef AUTO_ON
221
+	if(timer[19])
222
+	next_state = DUMMY;
223
+`else
200
224
next_rescue = btn1_r;
201
225
if(btn2_r & ~btn2_r2)
202
226
next_state = DUMMY;
227
+`endif
203
228
end
204
229
DUMMY: begin
205
230
d = 16'hffff;
@@ -229,7 +254,11 @@ always @(*) begin
229
254
GENERAL2_C: begin
230
255
d = 16'h3281;
231
256
icap_en_n = 1'b0;
257
+`ifdef AUTO_ON
258
+	if(btn1)
259
+`else
232
260
if(rescue)
261
+`endif
233
262
next_state = GENERAL2_D_RESCUE;
234
263
else
235
264
next_state = GENERAL2_D_REGULAR;
1 
boards/milkymist-one/synthesis/common.ucf
show inline notes
View
@@ -348,6 +348,7 @@ TIMESPEC "TSsdramout" = FROM FFS TO "GRPsdramout" 10 ns;
348
348
NET "vga/vga_iclk" TNM_NET = "GRPvga";
349
349
TIMESPEC "TSvga_async1" = FROM "GRPsys" TO "GRPvga" TIG;
350
350
TIMESPEC "TSvga_async2" = FROM "GRPvga" TO "GRPsys" TIG;
351
+OFFSET = OUT 5 ns AFTER "vga_clk";
351
352
352
353
TIMESPEC "TSac97_async1" = FROM "GRPsys" TO "GRPac97_clk" TIG;
353
354
TIMESPEC "TSac97_async2" = FROM "GRPac97_clk" TO "GRPsys" TIG;
77 
build_bios.sh
show inline notes
View
...
...
@@ -1,77 +0,0 @@
1
-#!/bin/bash
2
-
3
-BASEDIR=`pwd`
4
-LOGFILEHOST=$BASEDIR/tools.log
5
-LOGFILE=$BASEDIR/software.log
6
-
7
-echo "================================================================================"
8
-echo "Building Milkymist BIOS image"
9
-echo ""
10
-echo "Log file (host): $LOGFILEHOST"
11
-echo "Log file (target): $LOGFILE"
12
-echo "================================================================================"
13
-echo ""
14
-
15
-echo -n "Building host utilities..."
16
-cd $BASEDIR/tools
17
-echo >> $LOGFILEHOST
18
-date >> $LOGFILEHOST
19
-make >> $LOGFILEHOST 2>&1
20
-if [ "$?" != 0 ] ; then
21
- echo "FAILED"
22
-	exit 1
23
-else
24
- echo "OK"
25
-fi
26
-
27
-echo "Building embedded software :"
28
-echo -n " HPDMC runtime..."
29
-echo >> $LOGFILE
30
-date >> $LOGFILE
31
-cd $BASEDIR/software/libhpdmc && make >> $LOGFILE 2>&1
32
-if [ "$?" != 0 ] ; then
33
- echo "FAILED"
34
-	exit 1
35
-else
36
- echo "OK"
37
-fi
38
-echo -n " Base library..."
39
-echo >> $LOGFILE
40
-date >> $LOGFILE
41
-cd $BASEDIR/software/libbase && make >> $LOGFILE 2>&1
42
-if [ "$?" != 0 ] ; then
43
- echo "FAILED"
44
-	exit 1
45
-else
46
- echo "OK"
47
-fi
48
-echo -n " HAL..."
49
-echo >> $LOGFILE
50
-date >> $LOGFILE
51
-cd $BASEDIR/software/libhal && make >> $LOGFILE 2>&1
52
-if [ "$?" != 0 ] ; then
53
- echo "FAILED"
54
-	exit 1
55
-else
56
- echo "OK"
57
-fi
58
-echo -n " Networking library..."
59
-cd $BASEDIR/software/libnet && make >> $LOGFILE 2>&1
60
-if [ "$?" != 0 ] ; then
61
- echo "FAILED"
62
-	exit 1
63
-else
64
- echo "OK"
65
-fi
66
-echo -n " BIOS..."
67
-cd $BASEDIR/software/bios && make >> $LOGFILE 2>&1
68
-if [ "$?" != 0 ] ; then
69
- echo "FAILED"
70
-	exit 1
71
-else
72
- echo "OK"
73
-fi
74
-
75
-cd $BASEDIR
76
-
77
-echo "Build complete!"
42 
build_bitstream.sh
show inline notes
View
...
...
@@ -1,42 +0,0 @@
1
-#!/bin/bash
2
-
3
-source setup.inc
4
-BASEDIR=`pwd`
5
-LOGFILEHOST=$BASEDIR/tools.log
6
-LOGFILE=$BASEDIR/synthesis.log
7
-
8
-echo "================================================================================"
9
-echo "Building Milkymist bitstream file"
10
-echo ""
11
-echo "Synthesis tool: $SYNTOOL"
12
-echo "Board: $BOARD"
13
-echo "Log file: $LOGFILE"
14
-echo "================================================================================"
15
-echo ""
16
-
17
-echo -n "Building host utilities..."
18
-cd $BASEDIR/tools
19
-echo >> $LOGFILEHOST
20
-date >> $LOGFILEHOST
21
-make >> $LOGFILEHOST 2>&1
22
-if [ "$?" != 0 ] ; then
23
- echo "FAILED"
24
-	exit 1
25
-else
26
- echo "OK"
27
-fi
28
-
29
-echo -n "Building FPGA bitstream..."
30
-echo >> $LOGFILE
31
-date >> $LOGFILE
32
-cd $BASEDIR/boards/$BOARD/synthesis && make -f Makefile.$SYNTOOL >> $LOGFILE 2>&1
33
-if [ "$?" != 0 ] ; then
34
- echo "FAILED"
35
-	exit 1
36
-else
37
- echo "OK"
38
-fi
39
-
40
-cd $BASEDIR
41
-
42
-echo "Build complete!"
85 
build_demo.sh
show inline notes
View
...
...
@@ -1,85 +0,0 @@
1
-#!/bin/bash
2
-
3
-BASEDIR=`pwd`
4
-LOGFILEHOST=$BASEDIR/tools.log
5
-LOGFILE=$BASEDIR/software.log
6
-
7
-echo "================================================================================"
8
-echo "Building Milkymist demo firmware"
9
-echo ""
10
-echo "Log file (host): $LOGFILEHOST"
11
-echo "Log file (target): $LOGFILE"
12
-echo "================================================================================"
13
-echo ""
14
-
15
-BASEDIR=`pwd`
16
-
17
-echo -n "Building host utilities..."
18
-cd $BASEDIR/tools
19
-echo >> $LOGFILEHOST
20
-date >> $LOGFILEHOST
21
-make >> $LOGFILEHOST 2>&1
22
-if [ "$?" != 0 ] ; then
23
- echo "FAILED"
24
-	exit 1
25
-else
26
- echo "OK"
27
-fi
28
-
29
-echo -n "Building USB firmware..."
30
-cd $BASEDIR/softusb-input
31
-echo >> $LOGFILE
32
-make >> $LOGFILE 2>&1
33
-if [ "$?" != 0 ] ; then
34
- echo "FAILED"
35
-	exit 1
36
-else
37
- echo "OK"
38
-fi
39
-
40
-echo "Building embedded software:"
41
-echo -n " Base library..."
42
-echo >> $LOGFILE
43
-cd $BASEDIR/software/libbase && make >> $LOGFILE 2>&1
44
-if [ "$?" != 0 ] ; then
45
- echo "FAILED"
46
-	exit 1
47
-else
48
- echo "OK"
49
-fi
50
-echo -n " Math library..."
51
-cd $BASEDIR/software/libmath && make >> $LOGFILE 2>&1
52
-if [ "$?" != 0 ] ; then
53
- echo "FAILED"
54
-	exit 1
55
-else
56
- echo "OK"
57
-fi
58
-echo -n " HAL..."
59
-cd $BASEDIR/software/libhal && make >> $LOGFILE 2>&1
60
-if [ "$?" != 0 ] ; then
61
- echo "FAILED"
62
-	exit 1
63
-else
64
- echo "OK"
65
-fi
66
-echo -n " FPVM library..."
67
-cd $BASEDIR/software/libfpvm && make >> $LOGFILE 2>&1
68
-if [ "$?" != 0 ] ; then
69
- echo "FAILED"
70
-	exit 1
71
-else
72
- echo "OK"
73
-fi
74
-echo -n " Demonstration firmware..."
75
-cd $BASEDIR/software/demo && make >> $LOGFILE 2>&1
76
-if [ "$?" != 0 ] ; then
77
- echo "FAILED"
78
-	exit 1
79
-else
80
- echo "OK"
81
-fi
82
-
83
-cd $BASEDIR
84
-
85
-echo "Build complete!"
37 
build_doc.sh
show inline notes
View
...
...
@@ -1,37 +0,0 @@
1
-#!/bin/bash
2
-
3
-source coredoc.inc
4
-BASEDIR=`pwd`
5
-LOGFILE=$BASEDIR/doc.log
6
-
7
-echo "================================================================================"
8
-echo "Building Milkymist documentation"
9
-echo ""
10
-echo "Log file: $LOGFILE"
11
-echo "================================================================================"
12
-echo ""
13
-
14
-echo -n "Building system documentation..."
15
-echo >> $LOGFILE
16
-date >> $LOGFILE
17
-cd $BASEDIR/doc && make >> $LOGFILE 2>&1
18
-if [ "$?" != 0 ] ; then
19
- echo "FAILED"
20
-else
21
- echo "OK"
22
-fi
23
-
24
-echo "Building IP core documentation..."
25
-for i in $COREDOC; do
26
-	echo -n " $i..."
27
-	cd $BASEDIR/cores/$i/doc && make >> $LOGFILE 2>&1
28
-	if [ "$?" != 0 ] ; then
29
- echo "FAILED"
30
-	else
31
- echo "OK"
32
-	fi
33
-done
34
-
35
-cd $BASEDIR
36
-
37
-echo "Build complete!"
74 
build_sdk.sh
show inline notes
View
...
...
@@ -1,74 +0,0 @@
1
-#!/bin/bash
2
-
3
-BASEDIR=`pwd`
4
-LOGFILEHOST=$BASEDIR/tools.log
5
-LOGFILE=$BASEDIR/software.log
6
-
7
-echo "================================================================================"
8
-echo "Building Milkymist SDK"
9
-echo ""
10
-echo "Log file (host): $LOGFILEHOST"
11
-echo "Log file (target): $LOGFILE"
12
-echo "================================================================================"
13
-echo ""
14
-
15
-BASEDIR=`pwd`
16
-
17
-echo -n "Building host utilities..."
18
-cd $BASEDIR/tools
19
-echo >> $LOGFILEHOST
20
-date >> $LOGFILEHOST
21
-make >> $LOGFILEHOST 2>&1
22
-if [ "$?" != 0 ] ; then
23
- echo "FAILED"
24
-	exit 1
25
-else
26
- echo "OK"
27
-fi
28
-
29
-echo -n "Building base library..."
30
-echo >> $LOGFILE
31
-date >> $LOGFILE
32
-cd $BASEDIR/software/libbase && make >> $LOGFILE 2>&1
33
-if [ "$?" != 0 ] ; then
34
- echo "FAILED"
35
-	exit 1
36
-else
37
- echo "OK"
38
-fi
39
-echo -n "Building math library..."
40
-cd $BASEDIR/software/libmath && make >> $LOGFILE 2>&1
41
-if [ "$?" != 0 ] ; then
42
- echo "FAILED"
43
-	exit 1
44
-else
45
- echo "OK"
46
-fi
47
-echo -n "Building HAL..."
48
-cd $BASEDIR/software/libhal && make >> $LOGFILE 2>&1
49
-if [ "$?" != 0 ] ; then
50
- echo "FAILED"
51
-	exit 1
52
-else
53
- echo "OK"
54
-fi
55
-echo -n "Building FPVM library..."
56
-cd $BASEDIR/software/libfpvm && make >> $LOGFILE 2>&1
57
-if [ "$?" != 0 ] ; then
58
- echo "FAILED"
59
-	exit 1
60
-else
61
- echo "OK"
62
-fi
63
-echo -n "Building networking library..."
64
-cd $BASEDIR/software/libnet && make >> $LOGFILE 2>&1
65
-if [ "$?" != 0 ] ; then
66
- echo "FAILED"
67
-	exit 1
68
-else
69
- echo "OK"
70
-fi
71
-
72
-cd $BASEDIR
73
-
74
-echo "Build complete!"
37 
clean_all.sh
show inline notes
View
...
...
@@ -1,37 +0,0 @@
1
-#!/bin/bash
2
-
3
-BASEDIR=`pwd`
4
-
5
-source $BASEDIR/coredoc.inc
6
-
7
-cd $BASEDIR/tools && make clean
8
-
9
-cd $BASEDIR/software/libhpdmc && make clean
10
-cd $BASEDIR/software/libbase && make clean
11
-cd $BASEDIR/software/libmath && make clean
12
-cd $BASEDIR/software/libhal && make clean
13
-cd $BASEDIR/software/libfpvm && make clean
14
-cd $BASEDIR/software/libfpvm/x86-linux && make clean
15
-cd $BASEDIR/software/libfpvm/lm32-linux && make clean
16
-cd $BASEDIR/software/libfpvm/lm32-rtems && make clean
17
-cd $BASEDIR/software/libnet && make clean
18
-cd $BASEDIR/software/bios && make clean
19
-cd $BASEDIR/software/demo && make clean
20
-
21
-cd $BASEDIR/softusb-input && make clean
22
-
23
-cd $BASEDIR/boards/milkymist-one/synthesis && make -f common.mak clean
24
-cd $BASEDIR/boards/milkymist-one/standby && make clean
25
-cd $BASEDIR/boards/milkymist-one/flash && make clean
26
-
27
-cd $BASEDIR/doc && make clean
28
-for i in $COREDOC; do
29
-	cd $BASEDIR/cores/$i/doc && make clean
30
-done 31
-
32
-cd $BASEDIR/cores/pfpu
33
-./cleanroms.sh
34
-
35
-cd $BASEDIR
36
-
37
-rm -f tools.log software.log synthesis.log doc.log load.log
1 
coredoc.inc
show inline notes
View
...
...
@@ -1 +0,0 @@
1
-COREDOC="ac97 bt656cap conbus dmx fmlbrg fmlmeter hpdmc_ddr32 memcard pfpu rc5 softusb sysctl tmu2 uart vgafb"
58 
cores/namuru/rtl/namuru_baseband.v
show inline notes
View
@@ -163,56 +163,55 @@ reg [31:0] wb_dat_o;
163
163
reg [31:0] temp;
164
164
always @(posedge correlator_clk) begin
165
165
if(correlator_rst) begin
166
-	wb_dat_o <= 32'd0;
167
-	ch0_prn_key_enable <= 1'b0;
168
-	ch0_prn_key <= 10'b0;
169
-	ch0_carr_nco <= 29'd0;// Need to initialize nco's (at least for simulation) or they don't run.
170
-	ch0_code_nco <= 28'd0;
171
-	ch0_slew_enable <= 1'b0;
172
-	ch0_code_slew <= 11'b0;
173
-	ch0_epoch_enable <= 1'b0;
174
-	ch0_epoch_load <= 11'b0;
175
-	prog_accum_int <= 24'b0;
176
-	prog_tic <= 24'b0;
166
+	wb_dat_o <= 0;
167
+	ch0_prn_key_enable <= 0;
168
+	ch0_prn_key <= 0;
169
+	ch0_carr_nco <= 0;
170
+	ch0_code_nco <= 0;
171
+	ch0_slew_enable <= 0;
172
+	ch0_code_slew <= 0;
173
+	ch0_epoch_enable <= 0;
174
+	ch0_epoch_load <= 0;
175
+	prog_accum_int <= 0;
176
+	prog_tic <= 0;
177
177
178
-	sw_rst <= 1'b0;
179
-	status_read <= 1'b0;
180
-	new_data_read <= 1'b0;
178
+	sw_rst <= 0;
179
+	status_read <= 0;
180
+	new_data_read <= 0;
181
181
182
-	gps_led <= 1'b0;
182
+	gps_led <= 0;
183
183
184
184
end else begin
185
-	wb_dat_o <= 32'd0;
185
+	if(status_read) begin
186
+	status_read <= 0;
187
+	end
186
188
187
-	status_read <= 1'b0;
188
-	new_data_read <= 1'b0;
189
-	ch0_prn_key_enable <= 1'b0;
189
+	if(new_data_read) begin
190
+	new_data_read <= 0;
191
+	end
190
192
if(next_csr_we) begin
191
193
/* write */
192
194
case(wb_adr_i[9:2])
193
195
/* channel 0 */
194
196
8'h00: begin
197
+	ch0_prn_key_enable <= 1'b1;
195
198
ch0_prn_key <= wb_dat_i[9:0];
196
199
end
197
200
8'h01: ch0_carr_nco <= wb_dat_i[28:0];
198
201
8'h02: ch0_code_nco <= wb_dat_i[27:0];
199
202
8'h03: begin
203
+	ch0_slew_enable <= 1'b1;
200
204
ch0_code_slew <= wb_dat_i[10:0];
201
205
end
202
206
203
207
8'h0E : begin
208
+	ch0_epoch_enable <= 1'b1;
204
209
ch0_epoch_load <= wb_dat_i[10:0];
205
210
end
206
-	/* enable flags for channel 0 tracking logic */
207
-	8'h0F: {ch0_epoch_enable,ch0_slew_enable,ch0_prn_key_enable} <= wb_dat_i[2:0];
208
-
209
211
/* status */ 210
-	8'hE4: begin // clear status flag
211
-	{new_data_read,status_read} <= wb_dat_i[1:0];
212
-	end
213
212
214
213
/* control */ 215
-	8'hF0: sw_rst <= wb_dat_i[0:0]; // software reset
214
+	8'hF0: sw_rst <= 1'b1; // correlator software reset
216
215
8'hF1: prog_tic <= wb_dat_i[23:0]; // program TIC
217
216
8'hF2: prog_accum_int <= wb_dat_i[23:0]; // program ACCUM_INT
218
217
8'hF3: temp <= wb_dat_i[31:0]; // temp
@@ -238,15 +237,16 @@ always @(posedge correlator_clk) begin
238
237
8'h0C: wb_dat_o <= {21'h0, ch0_epoch}; // 11 bits
239
238
8'h0D: wb_dat_o <= {21'h0, ch0_epoch_check}; // 11 bits
240
239
8'h0E: wb_dat_o <= {21'h0, ch0_epoch_load};
241
-	8'h0F: wb_dat_o <= {28'h0, ch0_epoch_enable,ch0_slew_enable,ch0_prn_key_enable};
242
240
243
241
/* status */ 244
242
8'hE0: begin // get status and pulse status_flag to clear status
245
243
wb_dat_o <= {30'h0, status}; // only 2 status bits, therefore need to pad 30ms bits
244
+	status_read <= 1'b1;
246
245
end
247
246
8'hE1: begin // get new_data
248
247
wb_dat_o <= {30'h0,new_data}; //one new_data bit per channel, need to pad other bits
249
248
// pulse the new data flag to clear new_data register
249
+	new_data_read <= 1'b1;
250
250
// make sure the flag is not cleared if a dump is aligned to new_data_read
251
251
dump_mask[0] <= ch0_dump;
252
252
/* more channels to come */
@@ -257,10 +257,10 @@ always @(posedge correlator_clk) begin
257
257
8'hE3: begin // accum count read
258
258
wb_dat_o <= {8'h0,accum_count}; // 24 bits of accum count
259
259
end
260
-	8'hE4: begin // accum count read
260
+	8'hE4: begin // status read
261
261
wb_dat_o <= {30'h0,new_data_read,status_read}; // 24 bits of accum count
262
262
end
263
-	8'hEF: begin // accum count read
263
+	8'hEF: begin
264
264
wb_dat_o <= 32'h6e6d7275; // HW_TAG nmru
265
265
end
266
266
/* control */ 2 
cores/softusb/rtl/softusb_sie.v
show inline notes
View
@@ -96,7 +96,7 @@ always @(posedge usb_clk) begin
96
96
if(io_re)
97
97
rx_pending <= 1'b0;
98
98
end
99
-	6'h0a: io_do <= rx_pending;
99
+	6'h0a: io_do <= { rx_pending, rx_active };
100
100
6'h0b: io_do <= rx_active;
101
101
6'h0c: begin
102
102
io_do <= rx_error_pending;
27 
load_bitstream.sh
show inline notes
View
...
...
@@ -1,27 +0,0 @@
1
-#!/bin/bash
2
-
3
-source setup.inc
4
-
5
-BASEDIR=`pwd`
6
-LOGFILE=$BASEDIR/load.log
7
-
8
-echo "================================================================================"
9
-echo "Loading Milkymist bitstream file"
10
-echo ""
11
-echo "Board: $BOARD"
12
-echo "Log file: $LOGFILE"
13
-echo "================================================================================"
14
-echo ""
15
-
16
-echo -n "Loading FPGA bitstream..."
17
-cd $BASEDIR/boards/$BOARD/synthesis && make -f Makefile.$SYNTOOL load > $LOGFILE 2>&1
18
-if [ "$?" != 0 ] ; then
19
- echo "FAILED"
20
-	exit 1
21
-else
22
- echo "OK"
23
-fi
24
-
25
-cd $BASEDIR
26
-
27
-echo "Load complete!"
43 
load_demo.sh
show inline notes
View
...
...
@@ -1,43 +0,0 @@
1
-#!/bin/bash
2
-
3
-if [ -z "$PORT" ]
4
-then
5
-	PORT=/dev/ttyUSB0
6
-fi
7
-
8
-if [ -z "$LOADADDR" ]
9
-then
10
-	LOADADDR=0x40000000
11
-fi
12
-
13
-if [ -z "$IMAGE" ]
14
-then
15
-	IMAGE=software/demo/boot.bin
16
-fi
17
-
18
-BASEDIR=`pwd`
19
-LOGFILE=$BASEDIR/tools.log
20
-
21
-echo "================================================================================"
22
-echo "Starting Milkymist debug terminal"
23
-echo ""
24
-echo "Log file (host): $LOGFILE"
25
-echo "Serial port: $PORT"
26
-echo "Image: $IMAGE"
27
-echo "Load address: $LOADADDR"
28
-echo "================================================================================"
29
-echo ""
30
-
31
-echo -n "Building host utilities..."
32
-cd $BASEDIR/tools
33
-make >> $LOGFILE 2>&1
34
-if [ "$?" != 0 ] ; then
35
- echo "FAILED"
36
-	exit 1
37
-else
38
- echo "OK"
39
-fi
40
-
41
-echo "Executing flterm..."
42
-
43
-exec $BASEDIR/tools/flterm --port $PORT --kernel $BASEDIR/$IMAGE --kernel-adr $LOADADDR
76 
patches/Aderrasi - Candy Avian.milk
show inline notes
View
...
...
@@ -1,76 +0,0 @@
1
-[preset00]
2
-fRating=3.000000
3
-fGammaAdj=1.000000
4
-fDecay=1.000000
5
-fVideoEchoZoom=0.923483
6
-fVideoEchoAlpha=0.000000
7
-nVideoEchoOrientation=0
8
-nWaveMode=5
9
-bAdditiveWaves=0
10
-bWaveDots=0
11
-bWaveThick=1
12
-bModWaveAlphaByVolume=0
13
-bMaximizeWaveColor=0
14
-bTexWrap=0
15
-bDarkenCenter=0
16
-bRedBlueStereo=0
17
-bBrighten=0
18
-bDarken=0
19
-bSolarize=0
20
-bInvert=0
21
-fWaveAlpha=2.063785
22
-fWaveScale=0.724297
23
-fWaveSmoothing=0.500000
24
-fWaveParam=-0.300000
25
-fModWaveAlphaStart=0.500000
26
-fModWaveAlphaEnd=1.000000
27
-fWarpAnimSpeed=1.000000
28
-fWarpScale=2.500333
29
-fZoomExponent=1.000000
30
-fShader=0.100000
31
-zoom=0.990099
32
-rot=0.000000
33
-cx=0.500000
34
-cy=0.410000
35
-dx=-0.003990
36
-dy=0.000010
37
-warp=0.010000
38
-sx=1.000000
39
-sy=1.000000
40
-wave_r=1.000000
41
-wave_g=1.000000
42
-wave_b=0.000000
43
-wave_x=0.500000
44
-wave_y=0.500000
45
-ob_size=0.005000
46
-ob_r=0.000000
47
-ob_g=0.000000
48
-ob_b=0.000000
49
-ob_a=0.200000
50
-ib_size=0.050000
51
-ib_r=0.000000
52
-ib_g=0.000000
53
-ib_b=0.000000
54
-ib_a=0.100000
55
-nMotionVectorsX=55.680000
56
-nMotionVectorsY=47.999996
57
-mv_dx=0.000000
58
-mv_dy=0.000000
59
-mv_l=0.250000
60
-mv_r=1.000000
61
-mv_g=1.000000
62
-mv_b=1.000000
63
-mv_a=0.000000
64
-per_frame_1=wave_r = wave_r + 0.4*sin(1.5*time) + 0.25*sin(2.14*time);
65
-per_frame_2=wave_b = wave_b + 0.41*sin(1.2*time) + 0.26*sin(2.11*time);
66
-per_frame_3=wave_g = wave_g + 0.4*sin(1.34*time) + 0.25*sin(2.34*time);
67
-per_frame_4=ib_r = 4;
68
-per_frame_5=ib_g = 0;
69
-per_frame_6=ib_b = 0;
70
-per_frame_7=wave_x = wave_x + if(above(wave_y,0.75),0.40*sin(time), 0.15*sin(time));
71
-per_frame_9=wave_y = wave_y + 0.30*cos(0.9*time);
72
-per_frame_14=ob_r = 0.5*sin(treb)*time;
73
-per_frame_15=ob_b = 0.5*sin(mid)*0.9*time;
74
-per_frame_16=ob_g = 0.5*sin(bass)*0.8*time;
75
-per_frame_17=warp = warp + if (above(bass_att,1.5), 1.5, 0);
76
-per_frame_18=rot = rot + 0.08*sin(3*time);
84 
patches/Aderrasi - Kevlar Tunnel.milk
show inline notes
View
...
...
@@ -1,84 +0,0 @@
1
-[preset00]
2
-fRating=1.0
3
-fGammaAdj=1.0
4
-fDecay=0.990000
5
-fVideoEchoZoom=1.0
6
-fVideoEchoAlpha=0.0
7
-nVideoEchoOrientation=3
8
-nWaveMode=5
9
-bAdditiveWaves=1
10
-bWaveDots=1
11
-bWaveThick=1
12
-bModWaveAlphaByVolume=0
13
-bMaximizeWaveColor=1
14
-bTexWrap=0
15
-bDarkenCenter=0
16
-bRedBlueStereo=0
17
-bBrighten=0
18
-bDarken=0
19
-bSolarize=0
20
-bInvert=0
21
-fWaveAlpha=100.0
22
-fWaveScale=1.186472
23
-fWaveSmoothing=0.0
24
-fWaveParam=0.4
25
-fModWaveAlphaStart=0.5
26
-fModWaveAlphaEnd=1.0
27
-fWarpAnimSpeed=1.0
28
-fWarpScale=1.0
29
-fZoomExponent=1.0
30
-fShader=0.0
31
-zoom=1.0
32
-rot=0.0
33
-cx=0.5
34
-cy=0.5
35
-dx=0.000010
36
-dy=0.000010
37
-warp=0.010000
38
-sx=1.0
39
-sy=1.0
40
-wave_r=0.5
41
-wave_g=0.5
42
-wave_b=0.5
43
-wave_x=0.5
44
-wave_y=0.5
45
-ob_size=0.005000
46
-ob_r=0.0
47
-ob_g=0.0
48
-ob_b=0.0
49
-ob_a=0.5
50
-ib_size=0.005000
51
-ib_r=0.0
52
-ib_g=0.0
53
-ib_b=0.0
54
-ib_a=0.5
55
-nMotionVectorsX=0.0
56
-nMotionVectorsY=0.0
57
-mv_dx=0.0
58
-mv_dy=0.0
59
-mv_l=1.0
60
-mv_r=1.0
61
-mv_g=1.0
62
-mv_b=1.0
63
-mv_a=0.0
64
-per_frame_1=wave_r = wave_r + 0.25*sin(1.4*time) + 0.25*sin(2.25*time);
65
-per_frame_2=wave_g = wave_g + 0.25*sin(1.7*time) + 0.25*sin(2.11*time);
66
-per_frame_3=wave_b = wave_b + 0.25*sin(1.84*time) + 0.25*sin(2.3*time);
67
-per_frame_4=warp = 0;
68
-per_frame_5=
69
-per_frame_6=ob_r = ob_r + wave_r;
70
-per_frame_7=ob_g = ob_g + wave_b;
71
-per_frame_8=ob_b = ob_b + wave_g;
72
-per_frame_9=ib_r = wave_r-0.8;
73
-per_frame_10=ib_b = wave_b-0.8;
74
-per_frame_11=ib_g = wave_g-.8;
75
-per_frame_12=wave_x = wave_x + 0.2*sin(1.2*time) - 0.05*cos(2*time);
76
-per_frame_13=wave_y = wave_y + 0.2*sin(0.9*time) - 0.06*cos(2.3*time);
77
-per_frame_1=thresh = above(bass_att,thresh)*2+(1-above(bass_att,thresh))*((thresh-1.3)*0.96+1.3);
78
-per_frame_2=q1 = equal(thresh,2)*0.015*sin(5*time)+(1-equal(thresh,2))*q1;
79
-per_frame_3=q2 = equal(thresh,2)*0.015*sin(6*time)+(1-equal(thresh,2))*q2;
80
-per_pixel_4=
81
-per_pixel_5=rot = rot + 0.2*(0.36*sin(rad-0.22/abs(rad*12+bass/time))*0.4-treb/1.3*cos(bass_att));
82
-per_pixel_6=zoom = zoom - 0.07*abs(sin(bass-time/30*rad)-cos(0.3*bass-mid_att));
83
-per_pixel_7=dx = dx + q1*(1.2*bass_att);
84
-per_pixel_8=dy = dy + q2*(1.2*mid_att);
75 
patches/Aderrasi - Variants Of Eternity (Shaking mix).milk
show inline notes
View
...
...
@@ -1,75 +0,0 @@
1
-[preset00]
2
-fRating=1.0
3
-fGammaAdj=1.0
4
-fDecay=1.0
5
-fVideoEchoZoom=1.0
6
-fVideoEchoAlpha=0.5
7
-nVideoEchoOrientation=3
8
-nWaveMode=6
9
-bAdditiveWaves=0
10
-bWaveDots=0
11
-bWaveThick=1
12
-bModWaveAlphaByVolume=0
13
-bMaximizeWaveColor=1
14
-bTexWrap=0
15
-bDarkenCenter=0
16
-bRedBlueStereo=0
17
-bBrighten=0
18
-bDarken=0
19
-bSolarize=0
20
-bInvert=0
21
-fWaveAlpha=100.0
22
-fWaveScale=0.50000
23
-fWaveSmoothing=0.5
24
-fWaveParam=0.0
25
-fModWaveAlphaStart=0.5
26
-fModWaveAlphaEnd=1.0
27
-fWarpAnimSpeed=1.0
28
-fWarpScale=1.0
29
-fZoomExponent=1.0
30
-fShader=0.0
31
-zoom=1.0
32
-rot=0.0
33
-cx=0.5
34
-cy=0.5
35
-dx=0.000010
36
-dy=0.000010
37
-warp=0.010000
38
-sx=1.0
39
-sy=1.0
40
-wave_r=0.5
41
-wave_g=0.5
42
-wave_b=0.5
43
-wave_x=0.5
44
-wave_y=0.5
45
-ob_size=0.005000
46
-ob_r=0.0
47
-ob_g=0.0
48
-ob_b=0.0
49
-ob_a=1.0
50
-ib_size=0.0
51
-ib_r=0.0
52
-ib_g=0.0
53
-ib_b=0.0
54
-ib_a=0.0
55
-nMotionVectorsX=1.280000
56
-nMotionVectorsY=9.599999
57
-mv_dx=0.4
58
-mv_dy=-0.2
59
-mv_l=5.0
60
-mv_r=1.0
61
-mv_g=1.0
62
-mv_b=1.0
63
-mv_a=1.0
64
-per_frame_1=wave_r = wave_r + 0.25*sin(1.4*time) + 0.25*sin(2.25*time);
65
-per_frame_2=wave_g = wave_g + 0.25*sin(1.7*time) + 0.25*sin(2.11*time);
66
-per_frame_3=wave_b = wave_b + 0.25*sin(1.84*time) + 0.25*sin(2.3*time);
67
-per_frame_4=warp = 0;
68
-per_frame_5=mv_r = wave_r;
69
-per_frame_6=mv_b = wave_b;
70
-per_frame_7=mv_g = wave_g;
71
-per_pixel_4=zoom = zoom - 0.03 + 0.06*sin(time);
72
-per_pixel_5=rot = rot + 0.15;
73
-per_pixel_6=cy = cy + 0.25 + 0.025*cos(time);
74
-per_pixel_7=cx = cx + 0.25 + 0.025*sin(time);
75
-per_pixel_8=rot = rot - 0.02*sin((1-rad)*(time*bass_att*2));
67 
patches/Bmelgren & Krash - Rainbow Orb Peacock (Lonely Signal Gone Mad Mix) simplified.milk
show inline notes
View
...
...
@@ -1,67 +0,0 @@
1
-[preset00]
2
-fRating=2
3
-fGammaAdj=1.56
4
-fDecay=1
5
-fVideoEchoZoom=1
6
-fVideoEchoAlpha=0.4
7
-nVideoEchoOrientation=1
8
-nWaveMode=6
9
-bAdditiveWaves=0
10
-bWaveDots=0
11
-bModWaveAlphaByVolume=0
12
-bMaximizeWaveColor=1
13
-bTexWrap=0
14
-bDarkenCenter=1
15
-bMotionVectorsOn=0
16
-bRedBlueStereo=0
17
-nMotionVectorsX=64
18
-nMotionVectorsY=1
19
-bBrighten=0
20
-bDarken=0
21
-bSolarize=0
22
-bInvert=0
23
-fWaveAlpha=1
24
-fWaveScale=1.59918
25
-fWaveSmoothing=0.75
26
-fWaveParam=1
27
-fModWaveAlphaStart=0.85
28
-fModWaveAlphaEnd=1.95
29
-fWarpAnimSpeed=1
30
-fWarpScale=1
31
-fZoomExponent=1
32
-fShader=0
33
-zoom=1
34
-rot=0
35
-cx=0.5
36
-cy=0.5
37
-dx=0
38
-dy=0
39
-warp=0
40
-sx=0.844378
41
-sy=1.06152
42
-wave_r=0.4
43
-wave_g=0.4
44
-wave_b=0.4
45
-wave_x=0.5
46
-wave_y=0.5
47
-ob_size=0.005
48
-ob_r=0
49
-ob_g=0
50
-ob_b=0
51
-ob_a=1
52
-ib_size=0
53
-ib_r=0
54
-ib_g=0
55
-ib_b=0
56
-ib_a=0
57
-per_frame_2=x_wave_x = 0.5+0.3*sin(bass+treb+mid);

