http://kaimi.ru/2012/04/php-generic-eval-unpacker/
HTTP/1.1 200 OK
Server: nginx
Date: Wed, 23 Jul 2014 22:10:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Vary: Accept-Encoding
X-Pingback: http://kaimi.ru/xmlrpc.php
Link: <http://kaimi.ru/?p=3074>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>PHP Generic Eval Unpacker</title>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
<link rel="stylesheet" href="http://kaimi.ru/wp-content/themes/cbone/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds.feedburner.com/kaimi/dev" />
<link rel="pingback" href="http://kaimi.ru/xmlrpc.php" />

<link rel="alternate" type="application/rss+xml" title="Misc &raquo; Лента комментариев к &laquo;PHP Generic Eval Unpacker&raquo;" href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/feed/" />
<link rel='stylesheet' id='crayon-css'  href='http://kaimi.ru/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.6.5' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='http://kaimi.ru/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=2.6.5' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://kaimi.ru/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.6.5' type='text/css' media='all' />
<link rel='stylesheet' id='github-ribbon-css'  href='http://kaimi.ru/wp-content/plugins/github-ribbon/styles/github-ribbon.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='github-ribbon-print-css'  href='http://kaimi.ru/wp-content/plugins/github-ribbon/styles/github-ribbon-print.css?ver=3.9.1' type='text/css' media='print' />
<link rel='stylesheet' id='wp-polls-css'  href='http://kaimi.ru/wp-content/plugins/wp-polls/polls-css.css?ver=2.63' type='text/css' media='all' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='http://kaimi.ru/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<script type='text/javascript' src='http://kaimi.ru/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://kaimi.ru/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.6.5","is_admin":"0","ajaxurl":"https:\/\/kaimi.ru\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"\u041d\u0430\u0436\u043c\u0438\u0442\u0435 %s \u0434\u043b\u044f \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, %s \u0434\u043b\u044f \u0432\u0441\u0442\u0430\u0432\u043a\u0438","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://kaimi.ru/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=2.6.5'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://kaimi.ru/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://kaimi.ru/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Windows &#8211; автоматизация задач с помощью скриптов. Интересные возможности WSH' href='http://kaimi.ru/2012/04/windows-script-host/' />
<link rel='next' title='Quest 4' href='http://kaimi.ru/2012/05/quest-4/' />
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://kaimi.ru/2012/04/php-generic-eval-unpacker/' />
<link rel='shortlink' href='http://kaimi.ru/?p=3074' />

<!-- platinum seo pack 1.3.8 -->
<meta name="robots" content="index,follow,noodp,noydir" />
<meta name="description" content="В предыдущей статье dx рассказывал о ручной методике снятия типовой и довольно" />
<link rel="canonical" href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/" />
<!-- /platinum one seo pack -->
<script type="text/javascript">
	window._wp_rp_static_base_url = 'https://wprp.zemanta.com/static/';
	window._wp_rp_wp_ajax_url = "https://kaimi.ru/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '3.5.1';
	window._wp_rp_post_id = '3074';
	window._wp_rp_num_rel_posts = '5';
	window._wp_rp_thumbnails = false;
	window._wp_rp_post_title = 'PHP+Generic+Eval+Unpacker';
	window._wp_rp_post_tags = ['%3F%3F%3F%3F%3F%3F%3F%3F%3F%3F', 'zend', 'php', 'eval', 'windows', 'php', 'c%2Fc%2B%2B', 'alt', 'dx', 'null', 'php', 'pre', 'a', 'gui', 'gener', 'hook'];
	window._wp_rp_promoted_content = false;
</script>
<script type="text/javascript" src="https://wprp.zemanta.com/static/js/loader.js?version=3.5.1" async></script>
<style type="text/css">
.related_post_title {
}
ul.related_post {
}
ul.related_post li {
}
ul.related_post li a {
}
ul.related_post li img {
}</style>
<style type="text/css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 2px;
	line-height: 4px;
	height: 4px;
	background-image: url('http://kaimi.ru/wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}
</style>
<!-- wp thread comment 1.4.9.4.002 -->
<style type="text/css" media="screen">
.editComment, .editableComment, .textComment{
	display: inline;
}
.comment-childs{
	border: 1px solid #999;
	margin: 5px 2px 2px 4px;
	padding: 4px 2px 2px 4px;
	background-color: white;
}
.chalt{
	background-color: #E2E2E2;
}
#newcomment{
	border:1px dashed #777;width:90%;
}
#newcommentsubmit{
	color:red;
}
.adminreplycomment{
	border:1px dashed #777;
	width:99%;
	margin:4px;
	padding:4px;
}
.mvccls{
	color: #999;
}
			
</style>
<meta name="blogcatalog" content="9BC9175258" />
<meta name='yandex-verification' content='41749f3e894a31b3' />
</head>

<body>
<div id="shadow_h">
&nbsp;
</div>
<div id="shadow">
<div id="header">
	<div class="content">
		<h1><a href="http://kaimi.ru/">Misc</a></h1>
		<div class="description">Misc development</div>
	</div>
	<div id="headsearch">
	<form method="get" id="searchform" action="/">
    <div>
	<input type="text" name="s" id="s" onblur="this.value=(this.value=='') ? 'Поиск' : this.value;" onfocus="this.value=(this.value=='Поиск') ? '' : this.value;" value="Поиск" />
	<input type="submit" id="searchsubmit" value="" />
    </div>
    </form>
	</div>
</div>

<div id="navigation">
<li>	
<ul>
<li class="current_page_item"><a href="http://kaimi.ru">Главная</a></li>
<li class="page_item page-item-199"><a href="http://kaimi.ru/articles/">Статьи</a></li>
<li class="page_item page-item-4406"><a href="http://kaimi.ru/software/">Софт</a></li>
<li class="page_item page-item-2103"><a href="http://kaimi.ru/forum/">Форум</a></li>
<li class="page_item page-item-2496"><a href="http://kaimi.ru/mentions/">О нас пишут</a></li>
<li class="page_item page-item-16"><a href="http://kaimi.ru/about-blog/">О блоге</a></li>
</ul>
</li>
</div>

<div id="container">
<div id="content">
<div style="padding-left:100px;padding-top:5px;">

</div>



<div class="post" id="post-3074">

<h2><a href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/print/" title="Print This Post" rel="nofollow"><img class="WP-PrintIcon" src="http://kaimi.ru/wp-content/plugins/wp-print/images/print.gif" alt="Print This Post" title="Print This Post" style="border: 0px;" /></a>
PHP Generic Eval Unpacker</h2>
<p class="time">
Четверг, 26. Апрель 2012<br />
Раздел: <a href="http://kaimi.ru/category/cpp/" title="Просмотреть все записи в рубрике &laquo;C/C++&raquo;" rel="category tag">C/C++</a>, <a href="http://kaimi.ru/category/php/" title="Просмотреть все записи в рубрике &laquo;PHP&raquo;" rel="category tag">PHP</a>, <a href="http://kaimi.ru/category/windows/" title="Просмотреть все записи в рубрике &laquo;Windows&raquo;" rel="category tag">Windows</a>, автор: <b><a href="http://kaimi.ru/author/kaimi/" title="Записи Kaimi" rel="author">Kaimi</a></b>
</p>
<div class="entry">
<p>В <a href="http://kaimi.ru/2012/01/php-deobfuscate/" target="_blank">предыдущей статье</a> dx рассказывал о ручной методике снятия типовой и довольно распространенной защиты PHP-скрипта. Если проанализировать наиболее часто встречающиеся типы защиты (например, в разделе запросов на расшифровку на Античате), то можно заметить, что в большинстве случаев защита построена на максимальном сохранении исходного кода скрипта и использовании функции eval в конечном счете. Снимать такую защиту очень просто, но слегка занудно, поэтому я решил написать примитивную программу, которая осуществляет сие действо автоматически.<br />
Чтобы пост не был унылым, я кратенько опишу, что из себя представляет анпакер. Итак, из-за своей лени я решил использовать php-cli, расширение для php (которое перехватывает <a href="http://php.net/manual/en/function.eval.php" target="_blank" rel="nofollow">eval</a>) и сделать к этому простой GUI. Результирующая программа выглядит следующим образом:</p>
<p><img src="http://kaimi.ru/wp-content/uploads/2012/04/unpacker.png" alt="" title="unpacker" width="569" height="340" class="aligncenter size-full wp-image-3079" /><br />
<span id="more-3074"></span><br />
Начнем с расширения. Процесс создания расширения и используемая техника перехвата довольно примитивны и описаны <a href="http://blog.slickedit.com/2007/09/creating-a-php-5-extension-with-visual-c-2005/" target="_blank" rel="nofollow">здесь</a> и <a href="http://php-security.org/2010/05/13/article-decoding-a-user-space-encoded-php-script/index.html" target="_blank" rel="nofollow">здесь</a>. Код, описанный в последней ссылке, я слегка изменил под себя. Приведу его одним куском:</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d032cfa3372980435888" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" max-width: 587px; margin-top: 12px; margin-bottom: 12px; margin-left: 20px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Включить/Отключить нумерацию строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Включить/Отключить подсветку кода"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Включить/Отключить перенос строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Показать код в новом окне"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#define PHP_WIN32
#define ZEND_WIN32
#define ZTS 1
#define ZEND_DEBUG 0

#pragma comment(lib, "php5ts.lib")

#include "zend_config.w32.h"
#include "php.h"


PHP_MINIT_FUNCTION(evalhook);
PHP_MSHUTDOWN_FUNCTION(evalhook);
PHP_MINFO_FUNCTION(evalhook);


zend_module_entry evalhook_ext_module_entry = {
    STANDARD_MODULE_HEADER,
    "Eval Hook",
    NULL,
    PHP_MINIT(evalhook),
    PHP_MSHUTDOWN(evalhook),
    NULL, NULL, NULL,
    "1.0",
    STANDARD_MODULE_PROPERTIES
};

ZEND_GET_MODULE(evalhook_ext);

static zend_op_array *(*orig_compile_string)(zval *source_string, char *filename TSRMLS_DC);
static zend_bool evalhook_hooked = 0;

static zend_op_array *evalhook_compile_string(zval * input, char *filename TSRMLS_DC)
{
    /* Разделитель */
    const unsigned char delim[] = {0xDE, 0xAD, 0xBE, 0xEF};

    if (Z_TYPE_P(input) != IS_STRING)
    {
        return orig_compile_string(input, filename TSRMLS_CC);
    }

    /* Записываем содержимое, переданное в eval, в stdout */
    fwrite(input-&gt;value.str.val, 1, input-&gt;value.str.len, stdout);
    /* Добавляем разделитель, чтобы была возможность разделения кода, относящегося к разным eval'ам */
    fwrite(delim, 1, sizeof(delim), stdout);

    
    return orig_compile_string(input, filename TSRMLS_CC);
}

/* Функция, вызываемая при загрузке расширения */
PHP_MINIT_FUNCTION(evalhook)
{
    /* Отключаем буферизацию stdout */
    setvbuf(stdout, NULL, _IONBF, 0);

    if (evalhook_hooked == 0)
    {
        evalhook_hooked = 1;
        orig_compile_string = zend_compile_string;
        zend_compile_string = evalhook_compile_string;
    }
    return SUCCESS;
}

/* Функция, вызываемая при выгрузке расширения */
PHP_MSHUTDOWN_FUNCTION(evalhook)
{
    if (evalhook_hooked == 1)
    {
        evalhook_hooked = 0;
        zend_compile_string = orig_compile_string;
    }

    return SUCCESS;
}</textarea></div>
			<div class="crayon-main" style=" max-width: 587px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-2">2</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-4">4</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-6">6</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-8">8</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-10">10</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-12">12</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-14">14</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-16">16</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-18">18</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-20">20</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-22">22</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-24">24</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-26">26</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-28">28</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-30">30</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-32">32</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-34">34</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-36">36</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-38">38</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-40">40</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-42">42</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-44">44</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-46">46</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-48">48</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-50">50</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-52">52</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-54">54</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-56">56</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-58">58</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-60">60</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-62">62</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-64">64</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-66">66</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-68">68</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-70">70</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-72">72</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-74">74</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3372980435888-76">76</div><div class="crayon-num" data-line="crayon-53d032cfa3372980435888-77">77</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d032cfa3372980435888-1"><span class="crayon-c">#define PHP_WIN32</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-2"><span class="crayon-c">#define ZEND_WIN32</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-3"><span class="crayon-c">#define ZTS 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-4"><span class="crayon-c">#define ZEND_DEBUG 0</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-6"><span class="crayon-c">#pragma comment(lib, "php5ts.lib")</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-8"><span class="crayon-c">#include "zend_config.w32.h"</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-9"><span class="crayon-c">#include "php.h"</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-10">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3372980435888-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-12"><span class="crayon-e">PHP_MINIT_FUNCTION</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-13"><span class="crayon-e">PHP_MSHUTDOWN_FUNCTION</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-14"><span class="crayon-e">PHP_MINFO_FUNCTION</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-16">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3372980435888-17"><span class="crayon-e">zend_module_entry </span><span class="crayon-i">evalhook_ext_module_entry</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">STANDARD_MODULE_HEADER</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"Eval Hook"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">PHP_MINIT</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">PHP_MSHUTDOWN</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"1.0"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">STANDARD_MODULE_PROPERTIES</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-26"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-28"><span class="crayon-e">ZEND_GET_MODULE</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook_ext</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-30"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-i">zend_op_array</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-sy">(</span><span class="crayon-o">*</span><span class="crayon-i">orig_compile_string</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-i">zval</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-i">source_string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">filename </span><span class="crayon-cn">TSRMLS_DC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-31"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">zend_bool </span><span class="crayon-i">evalhook_hooked</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-32">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3372980435888-33"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-i">zend_op_array</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">evalhook_compile_string</span><span class="crayon-sy">(</span><span class="crayon-i">zval</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-i">input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-e">filename </span><span class="crayon-cn">TSRMLS_DC</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-34"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Разделитель */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-i">delim</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-cn">0xDE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xAD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xBE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xEF</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Z_TYPE_P</span><span class="crayon-sy">(</span><span class="crayon-i">input</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">IS_STRING</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-e">orig_compile_string</span><span class="crayon-sy">(</span><span class="crayon-i">input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-cn">TSRMLS_CC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-42">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3372980435888-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Записываем содержимое, переданное в eval, в stdout */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fwrite</span><span class="crayon-sy">(</span><span class="crayon-i">input</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">.</span><span class="crayon-i">str</span><span class="crayon-sy">.</span><span class="crayon-i">val</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">input</span><span class="crayon-o">-&gt;</span><span class="crayon-i">value</span><span class="crayon-sy">.</span><span class="crayon-i">str</span><span class="crayon-sy">.</span><span class="crayon-i">len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">stdout</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Добавляем разделитель, чтобы была возможность разделения кода, относящегося к разным eval'ам */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fwrite</span><span class="crayon-sy">(</span><span class="crayon-i">delim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">sizeof</span><span class="crayon-sy">(</span><span class="crayon-i">delim</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">stdout</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-e">orig_compile_string</span><span class="crayon-sy">(</span><span class="crayon-i">input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-cn">TSRMLS_CC</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-50"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-52"><span class="crayon-c">/* Функция, вызываемая при загрузке расширения */</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-53"><span class="crayon-e">PHP_MINIT_FUNCTION</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-54"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Отключаем буферизацию stdout */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">setvbuf</span><span class="crayon-sy">(</span><span class="crayon-i">stdout</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">_IONBF</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-57">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">evalhook_hooked</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">evalhook_hooked</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">orig_compile_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">zend_compile_string</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">zend_compile_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">evalhook_compile_string</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-cn">SUCCESS</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-65"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-66">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3372980435888-67"><span class="crayon-c">/* Функция, вызываемая при выгрузке расширения */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-68"><span class="crayon-e">PHP_MSHUTDOWN_FUNCTION</span><span class="crayon-sy">(</span><span class="crayon-i">evalhook</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-69"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">evalhook_hooked</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">evalhook_hooked</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">zend_compile_string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">orig_compile_string</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-75">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3372980435888-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">return</span><span class="crayon-h"> </span><span class="crayon-cn">SUCCESS</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3372980435888-77"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0157 seconds] -->
<p>Как видно из приведенного выше кода, перехват осуществляется довольно просто, если знать как. Никаких грязных методов, трамплинов и прочей лабуды. Теперь рассмотрим не менее простой GUI к этому делу, который написан на адовой смеси C/C++ и является примером того, как не следует писать программы. Код GUI приведу частями. Начнем с инклюдов и глобальных переменных:</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d032cfa3384212940837" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" max-width: 587px; margin-top: 12px; margin-bottom: 12px; margin-left: 20px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Включить/Отключить нумерацию строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Включить/Отключить подсветку кода"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Включить/Отключить перенос строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Показать код в новом окне"><div class="crayon-button-icon"></div></div><span class="crayon-language">C++</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#include &lt;vector&gt;
#include &lt;string&gt;
#include &lt;algorithm&gt;
#include &lt;iterator&gt;

#include &lt;Windows.h&gt;
#include &lt;Shlwapi.h&gt;
#include &lt;process.h&gt;
#include &lt;tchar.h&gt;

#include "resource.h"

#pragma comment (lib, "Shlwapi")

/* Хендл основного окна */
HWND ghWnd;
/* Вектор для хранения данных eval'ов */
std::vector&lt;std::wstring&gt; eval_results;
/* Хендлы, используемые для перенаправления stdout дочернего процесса */
HANDLE child_read = NULL, child_write = NULL;
/* Сигнатура для разделения кода, относящегося к разным eval'ам */
const unsigned char signature[] = {0xDE, 0xAD, 0xBE, 0xEF};</textarea></div>
			<div class="crayon-main" style=" max-width: 587px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-2">2</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-4">4</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-6">6</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-8">8</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-10">10</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-12">12</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-14">14</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-16">16</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-18">18</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-20">20</div><div class="crayon-num" data-line="crayon-53d032cfa3384212940837-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3384212940837-22">22</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d032cfa3384212940837-1"><span class="crayon-p">#include &lt;vector&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-2"><span class="crayon-p">#include &lt;string&gt;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-3"><span class="crayon-p">#include &lt;algorithm&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-4"><span class="crayon-p">#include &lt;iterator&gt;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-6"><span class="crayon-p">#include &lt;Windows.h&gt;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-7"><span class="crayon-p">#include &lt;Shlwapi.h&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-8"><span class="crayon-p">#include &lt;process.h&gt;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-9"><span class="crayon-p">#include &lt;tchar.h&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-10">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3384212940837-11"><span class="crayon-p">#include "resource.h"</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-12">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3384212940837-13"><span class="crayon-p">#pragma comment (lib, "Shlwapi")</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-14">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3384212940837-15"><span class="crayon-c">/* Хендл основного окна */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-16"><span class="crayon-e">HWND </span><span class="crayon-v">ghWnd</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-17"><span class="crayon-c">/* Вектор для хранения данных eval'ов */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-18"><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">wstring</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">eval_results</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-19"><span class="crayon-c">/* Хендлы, используемые для перенаправления stdout дочернего процесса */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-20"><span class="crayon-e">HANDLE </span><span class="crayon-v">child_read</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">child_write</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3384212940837-21"><span class="crayon-c">/* Сигнатура для разделения кода, относящегося к разным eval'ам */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3384212940837-22"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">signature</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-cn">0xDE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xAD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xBE</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0xEF</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>Несколько вспомогательных функций:</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d032cfa338c797605420" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" max-width: 587px; margin-top: 12px; margin-bottom: 12px; margin-left: 20px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Включить/Отключить нумерацию строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Включить/Отключить подсветку кода"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Включить/Отключить перенос строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Показать код в новом окне"><div class="crayon-button-icon"></div></div><span class="crayon-language">C++</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
/* Функция очевидного преобразования */
std::wstring str2wstr(const std::string&amp; s)
{
    std::wstring result;
    size_t len, slength = s.length() + 1;

    len = MultiByteToWideChar(CP_ACP, 0, s.c_str(), slength, 0, 0); 
    result.resize(len);

    MultiByteToWideChar(CP_ACP, 0, s.c_str(), slength, &amp;result[0], len);

    return result;
}
/* Мой любимый Structured Exception Handler */
LONG WINAPI SEH(struct _EXCEPTION_POINTERS *lpTopLevelExceptionFilter)
{
    FatalAppExit(0, TEXT("Необрабатываемое исключение"));
    return 0L;
}
/* Функция для включения/отключения элементов управления на основной форме */
void enable_gui_controls(BOOL enable)
{
    EnableWindow(GetDlgItem(ghWnd, IDC_LIST), enable);
    EnableWindow(GetDlgItem(ghWnd, IDC_UNPACK), enable);
    EnableWindow(GetDlgItem(ghWnd, IDC_CLEAR), enable);
}
/* Функция, отвечающая за диалог выбора файла */
DWORD GetOpenName(TCHAR * outbuf, const TCHAR * filter, const TCHAR * title)
{
    OPENFILENAME ofn = {0};
    TCHAR buf[MAX_PATH + 2];

    GetModuleFileName(NULL, buf, MAX_PATH);

    TCHAR * tmp = StrRChr(buf, NULL, L'\\');
    if(tmp != 0)
    {
        *tmp = 0;
        ofn.lpstrInitialDir = buf;
    }

    ofn.hInstance = GetModuleHandle(NULL);
    ofn.hwndOwner = ghWnd;
    ofn.lStructSize = sizeof(OPENFILENAME);
    ofn.lpstrFilter = filter;
    ofn.nFilterIndex = 1;
    ofn.lpstrFile = outbuf;
    ofn.lpstrFile[0] = 0;
    ofn.lpstrFile[1] = 0;
    ofn.nMaxFile = MAX_PATH;
    ofn.lpstrTitle = title;
    ofn.Flags = OFN_EXPLORER | OFN_DONTADDTORECENT | OFN_FILEMUSTEXIST | OFN_HIDEREADONLY | OFN_LONGNAMES | OFN_NONETWORKBUTTON | OFN_PATHMUSTEXIST;

    return GetOpenFileName(&amp;ofn);
}</textarea></div>
			<div class="crayon-main" style=" max-width: 587px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-2">2</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-4">4</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-6">6</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-8">8</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-10">10</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-12">12</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-14">14</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-16">16</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-18">18</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-20">20</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-22">22</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-24">24</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-26">26</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-28">28</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-30">30</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-32">32</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-34">34</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-36">36</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-38">38</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-40">40</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-42">42</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-44">44</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-46">46</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-48">48</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-50">50</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-52">52</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa338c797605420-54">54</div><div class="crayon-num" data-line="crayon-53d032cfa338c797605420-55">55</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d032cfa338c797605420-1"><span class="crayon-c">/* Функция очевидного преобразования */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-2"><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-e">wstring </span><span class="crayon-e">str2wstr</span><span class="crayon-sy">(</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-t">string</span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-3"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-e">wstring </span><span class="crayon-v">result</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">size_t </span><span class="crayon-v">len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">slength</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">length</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-6">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa338c797605420-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MultiByteToWideChar</span><span class="crayon-sy">(</span><span class="crayon-v">CP_ACP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">c_str</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">slength</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">resize</span><span class="crayon-sy">(</span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MultiByteToWideChar</span><span class="crayon-sy">(</span><span class="crayon-v">CP_ACP</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">c_str</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">slength</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;result</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-13"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-14"><span class="crayon-c">/* Мой любимый Structured Exception Handler */</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-15"><span class="crayon-t">LONG</span><span class="crayon-h"> </span><span class="crayon-e">WINAPI </span><span class="crayon-e">SEH</span><span class="crayon-sy">(</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-v">_EXCEPTION_POINTERS</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">lpTopLevelExceptionFilter</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-16"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">FatalAppExit</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Необрабатываемое исключение"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0L</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-19"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-20"><span class="crayon-c">/* Функция для включения/отключения элементов управления на основной форме */</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-21"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">enable_gui_controls</span><span class="crayon-sy">(</span><span class="crayon-t">BOOL</span><span class="crayon-h"> </span><span class="crayon-v">enable</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-22"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EnableWindow</span><span class="crayon-sy">(</span><span class="crayon-e">GetDlgItem</span><span class="crayon-sy">(</span><span class="crayon-v">ghWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_LIST</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enable</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EnableWindow</span><span class="crayon-sy">(</span><span class="crayon-e">GetDlgItem</span><span class="crayon-sy">(</span><span class="crayon-v">ghWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_UNPACK</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enable</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EnableWindow</span><span class="crayon-sy">(</span><span class="crayon-e">GetDlgItem</span><span class="crayon-sy">(</span><span class="crayon-v">ghWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_CLEAR</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">enable</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-26"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-27"><span class="crayon-c">/* Функция, отвечающая за диалог выбора файла */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-28"><span class="crayon-e">DWORD </span><span class="crayon-e">GetOpenName</span><span class="crayon-sy">(</span><span class="crayon-v">TCHAR</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">outbuf</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">TCHAR</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">filter</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">TCHAR</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-29"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">OPENFILENAME </span><span class="crayon-v">ofn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-cn">0</span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">TCHAR </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-v">MAX_PATH</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-32">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa338c797605420-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">GetModuleFileName</span><span class="crayon-sy">(</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MAX_PATH</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-34">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa338c797605420-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TCHAR</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">StrRChr</span><span class="crayon-sy">(</span><span class="crayon-v">buf</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">L</span><span class="crayon-s">'\\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">*</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrInitialDir</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">hInstance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">GetModuleHandle</span><span class="crayon-sy">(</span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">hwndOwner</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ghWnd</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lStructSize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">OPENFILENAME</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrFilter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">filter</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">nFilterIndex</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrFile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">outbuf</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrFile</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrFile</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">nMaxFile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">MAX_PATH</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">lpstrTitle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ofn</span><span class="crayon-sy">.</span><span class="crayon-v">Flags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">OFN_EXPLORER</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_DONTADDTORECENT</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_FILEMUSTEXIST</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_HIDEREADONLY</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_LONGNAMES</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_NONETWORKBUTTON</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">OFN_PATHMUSTEXIST</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa338c797605420-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">GetOpenFileName</span><span class="crayon-sy">(</span><span class="crayon-v">&amp;ofn</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa338c797605420-55"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0125 seconds] -->
<p>И, наконец, основные функции в порядке убывания "важности":</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d032cfa3395128677702" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" max-width: 587px; margin-top: 12px; margin-bottom: 12px; margin-left: 20px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Включить/Отключить нумерацию строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Включить/Отключить подсветку кода"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Включить/Отключить перенос строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Показать код в новом окне"><div class="crayon-button-icon"></div></div><span class="crayon-language">C++</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
unsigned __stdcall process_pipe(void * arg)
{
    BYTE buffer[1024];
    DWORD bytes_read = 0;
    std::wstring temporary;
    std::vector&lt;unsigned char&gt; data;
    std::vector&lt;unsigned char&gt;::iterator begin, end;
    std::vector&lt;std::wstring&gt;::const_iterator it;
    
    
    for (;;) 
    {
        /* Проверяем, есть ли данные в пайпе */
        if(!PeekNamedPipe(child_read, NULL, 0, NULL, &amp;bytes_read, NULL) &amp;&amp; bytes_read == 0)
        {
            
            begin = data.begin();
            
            /* Разделяем содержимое data на составляющие, */
            /* попутно занося результаты в глобальный вектор eval_results */
            /* и добавляя перечень в форму */
            while(1)
            {
                end = std::search(begin, data.end(), signature, signature + sizeof(signature));
                
                /* Преобразуем в wide-string для адекватного отображения многобайтовых кодировок */
                temporary = str2wstr(std::string(begin, end));
                eval_results.push_back(temporary);
                /* Добавляем в ListBox урезанных вариант содержимого */
                temporary = temporary.substr(0, 12) + L"...";
                SendDlgItemMessage(ghWnd, IDC_LIST, LB_ADDSTRING, NULL, reinterpret_cast&lt;LPARAM&gt;(temporary.c_str()));

                if(end == data.end())
                {
                    break;
                }
                begin = end + sizeof(signature);
            }
            /* Активируем элементы управления на форме */
            enable_gui_controls(TRUE);

            break;
        }
        
        /* Читаем данные из пайпа */
        ReadFile(child_read, buffer, min(bytes_read, sizeof(buffer)), &amp;bytes_read, NULL);
        if(bytes_read != 0)
        {
            data.insert(data.end(), buffer, buffer + bytes_read);
        }
    }

    CloseHandle(child_read);

    return 0;
}</textarea></div>
			<div class="crayon-main" style=" max-width: 587px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-2">2</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-4">4</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-6">6</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-8">8</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-10">10</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-12">12</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-14">14</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-16">16</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-18">18</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-20">20</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-22">22</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-24">24</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-26">26</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-28">28</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-30">30</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-32">32</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-34">34</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-36">36</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-38">38</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-40">40</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-42">42</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-44">44</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-46">46</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-48">48</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-50">50</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-52">52</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-54">54</div><div class="crayon-num" data-line="crayon-53d032cfa3395128677702-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa3395128677702-56">56</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d032cfa3395128677702-1"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-r">__stdcall</span><span class="crayon-h"> </span><span class="crayon-e">process_pipe</span><span class="crayon-sy">(</span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">arg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">BYTE</span><span class="crayon-h"> </span><span class="crayon-v">buffer</span><span class="crayon-sy">[</span><span class="crayon-cn">1024</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">DWORD </span><span class="crayon-v">bytes_read</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-e">wstring </span><span class="crayon-v">temporary</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-o">&gt;</span><span class="crayon-o">::</span><span class="crayon-e">iterator </span><span class="crayon-v">begin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">vector</span><span class="crayon-o">&lt;</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-v">wstring</span><span class="crayon-o">&gt;</span><span class="crayon-o">::</span><span class="crayon-e">const_iterator </span><span class="crayon-v">it</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">;</span><span class="crayon-sy">;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Проверяем, есть ли данные в пайпе */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-e">PeekNamedPipe</span><span class="crayon-sy">(</span><span class="crayon-v">child_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;bytes_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">bytes_read</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">begin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">begin</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Разделяем содержимое data на составляющие, */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* попутно занося результаты в глобальный вектор eval_results */</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* и добавляя перечень в форму */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">begin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">signature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">signature</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">signature</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Преобразуем в wide-string для адекватного отображения многобайтовых кодировок */</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">temporary</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str2wstr</span><span class="crayon-sy">(</span><span class="crayon-v">std</span><span class="crayon-o">::</span><span class="crayon-t">string</span><span class="crayon-sy">(</span><span class="crayon-v">begin</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eval_results</span><span class="crayon-sy">.</span><span class="crayon-e">push_back</span><span class="crayon-sy">(</span><span class="crayon-v">temporary</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Добавляем в ListBox урезанных вариант содержимого */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">temporary</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">temporary</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">L</span><span class="crayon-s">"..."</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SendDlgItemMessage</span><span class="crayon-sy">(</span><span class="crayon-v">ghWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_LIST</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">LB_ADDSTRING</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">reinterpret_cast</span><span class="crayon-o">&lt;</span><span class="crayon-v">LPARAM</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-v">temporary</span><span class="crayon-sy">.</span><span class="crayon-e">c_str</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-32">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3395128677702-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">begin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">signature</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Активируем элементы управления на форме */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">enable_gui_controls</span><span class="crayon-sy">(</span><span class="crayon-t">TRUE</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Читаем данные из пайпа */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">ReadFile</span><span class="crayon-sy">(</span><span class="crayon-v">child_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buffer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">min</span><span class="crayon-sy">(</span><span class="crayon-v">bytes_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">buffer</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;bytes_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">bytes_read</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">insert</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-st">end</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buffer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">buffer</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">bytes_read</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa3395128677702-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-52">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3395128677702-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CloseHandle</span><span class="crayon-sy">(</span><span class="crayon-v">child_read</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-54">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa3395128677702-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa3395128677702-56"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0147 seconds] -->
<p>В общем-то основную функцию мы рассмотрели, теперь остался всеми любимый DlgProc и WinMain:</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d032cfa339e201912211" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" max-width: 587px; margin-top: 12px; margin-bottom: 12px; margin-left: 20px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Включить/Отключить нумерацию строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Включить/Отключить подсветку кода"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Включить/Отключить перенос строк"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Показать код в новом окне"><div class="crayon-button-icon"></div></div><span class="crayon-language">C++</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
int DlgProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
{
    static HICON ico;
    unsigned int selection_index;
    static TCHAR file_path[MAX_PATH], cmd[MAX_PATH * 2];
    TCHAR * tmp;

    STARTUPINFO si;
    PROCESS_INFORMATION pi;
    SECURITY_ATTRIBUTES sa;

    ghWnd = hWnd;

    switch(uMsg)
    {
        case WM_INITDIALOG:
            /* Устанавливаем иконку для основного окна */
            ico = LoadIcon(GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_ICON));
            SendMessage(hWnd, WM_SETICON, ICON_SMALL, (LPARAM)ico);
        break;

        case WM_COMMAND:
            switch(LOWORD(wParam))
            {
                case IDC_LIST:
                    switch(HIWORD(wParam))
                    {
                        case LBN_DBLCLK:
                        case LBN_SELCHANGE:
                            selection_index = SendDlgItemMessage(hWnd, IDC_LIST, LB_GETCURSEL, 0, 0);
                            if(selection_index &lt; eval_results.size())
                            {
                                /* Выводим в IDC_DATA содержимое в соответствии с выбранным элементом из IDC_LIST */
                                SetDlgItemText(hWnd, IDC_DATA, eval_results[selection_index].c_str());
                            }
                        break;
                    }
                break;
                
                case IDC_CLEAR:
                    /* Очищаем вектор и сопутствующие элементы на форме */
                    eval_results.clear();

                    SetDlgItemText(hWnd, IDC_DATA, L"");
                    SendDlgItemMessage(hWnd, IDC_LIST, LB_RESETCONTENT, 0, 0);
                break;

                case IDC_BROWSE:
                    /* Вызываем диалог выбора файла, результат записываем в IDC_PATH */
                    if(GetOpenName(file_path, TEXT("PHP (*.php)\0*.php\0Все файлы (*.*)\0*.*\0\0"), TEXT("Открыть...")))
                    {
                        SetDlgItemText(hWnd, IDC_PATH, file_path);
                    }
                break;

                case IDC_UNPACK:
                    if(GetDlgItemText(hWnd, IDC_PATH, file_path, sizeof(file_path)))
                    {
                        /* Деактивируем некоторые элементы интерфейса */
                        /* А то будет ататат из-за потоков */
                        enable_gui_controls(FALSE);
                        
                        /* Формируем аргумент командной строки для последующего запуска процесса */
                        _stprintf_s
                        (
                            cmd,
                            sizeof(cmd)/sizeof(cmd[0]),
                            TEXT("-f \"%s\""),
                            file_path
                        );

                        memset(&amp;si, 0, sizeof(STARTUPINFO));
                        memset(&amp;pi, 0, sizeof(PROCESS_INFORMATION));
                        memset(&amp;sa, 0, sizeof(SECURITY_ATTRIBUTES));
                        
                        /* Включаем наследование дескрипторов дочерним процессом */
                        sa.nLength = sizeof(SECURITY_ATTRIBUTES);
                        sa.bInheritHandle = TRUE;
                        sa.lpSecurityDescriptor = NULL;
                        /* Создаем пайп для перенаправления stdout */
                        CreatePipe(&amp;child_read, &amp;child_write, &amp;sa, 0);
                        SetHandleInformation(child_read, HANDLE_FLAG_INHERIT, 0);

                        /* Устанавливаем хендл, куда будет перенаправлен stdout дочернего процесса */
                        /* и флаги для скрытия консольного окна дочернего процесса */
                        si.cb = sizeof(STARTUPINFO);
                        si.wShowWindow = SW_HIDE;
                        si.hStdOutput = child_write;
                        si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW;

                        GetModuleFileName(NULL, file_path, MAX_PATH);
                        
                        tmp = StrRChr(file_path, NULL, L'\\');
                        if(tmp != 0)
                        {
                            *tmp = 0;
                        }
                        /* Путь к интерпретатору PHP */
                        _tcscat_s(file_path, MAX_PATH, TEXT("\\php-5.3.3\\php.exe"));
                        
                        if
                        (
                            CreateProcess
                            (
                                file_path,
                                cmd,
                                NULL,
                                NULL,
                                TRUE,
                                0,
                                NULL,
                                NULL,
                                &amp;si,
                                &amp;pi
                            ) == NULL
                        )
                        {
                            MessageBox(hWnd, TEXT("Ошибка создания процесса"), TEXT("Ошибка"), MB_OK | MB_ICONERROR);
                            break;
                        }

                        /* Закрываем ненужные хендлы */
                        CloseHandle(pi.hProcess);
                        CloseHandle(pi.hThread);
                        CloseHandle(child_write);

                        _beginthreadex(NULL, 0, &amp;process_pipe, NULL, 0, NULL);
                    }
                    else
                    {
                        MessageBox(hWnd, TEXT("Укажите путь к файлу"), TEXT("Ошибка"), MB_OK | MB_ICONERROR);
                    }
                break;
            }
        break;

        case WM_CLOSE:
            if(child_write)
            {
                CloseHandle(child_write);
            }
            
            DestroyIcon(ico);
            EndDialog(hWnd, 0);
        break;

        default:
            return 0;
    }

    return 1;
}

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
    SetUnhandledExceptionFilter(SEH);

    DialogBoxParam(hInstance, MAKEINTRESOURCE(IDD_MAIN), 0, (DLGPROC) DlgProc, 0);

    return 0;
}</textarea></div>
			<div class="crayon-main" style=" max-width: 587px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-2">2</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-4">4</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-6">6</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-8">8</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-10">10</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-12">12</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-14">14</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-16">16</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-18">18</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-20">20</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-22">22</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-24">24</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-26">26</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-28">28</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-30">30</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-32">32</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-34">34</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-36">36</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-38">38</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-40">40</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-42">42</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-44">44</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-46">46</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-48">48</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-50">50</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-52">52</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-54">54</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-56">56</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-58">58</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-60">60</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-62">62</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-64">64</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-66">66</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-68">68</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-70">70</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-72">72</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-74">74</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-76">76</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-78">78</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-80">80</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-82">82</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-84">84</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-86">86</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-88">88</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-90">90</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-92">92</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-94">94</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-96">96</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-98">98</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-100">100</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-102">102</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-104">104</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-106">106</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-108">108</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-110">110</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-112">112</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-114">114</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-116">116</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-118">118</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-120">120</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-122">122</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-124">124</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-126">126</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-128">128</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-130">130</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-132">132</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-134">134</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-136">136</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-138">138</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-140">140</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-142">142</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-144">144</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-146">146</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-148">148</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-150">150</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-152">152</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-154">154</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-156">156</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-158">158</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d032cfa339e201912211-160">160</div><div class="crayon-num" data-line="crayon-53d032cfa339e201912211-161">161</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d032cfa339e201912211-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">DlgProc</span><span class="crayon-sy">(</span><span class="crayon-e">HWND </span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">UINT </span><span class="crayon-v">uMsg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">WPARAM </span><span class="crayon-v">wParam</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">LPARAM </span><span class="crayon-v">lParam</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">HICON </span><span class="crayon-v">ico</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">selection_index</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">TCHAR </span><span class="crayon-v">file_path</span><span class="crayon-sy">[</span><span class="crayon-v">MAX_PATH</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cmd</span><span class="crayon-sy">[</span><span class="crayon-v">MAX_PATH</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TCHAR</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">tmp</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">STARTUPINFO </span><span class="crayon-v">si</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">PROCESS_INFORMATION </span><span class="crayon-v">pi</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SECURITY_ATTRIBUTES </span><span class="crayon-v">sa</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ghWnd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">hWnd</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-v">uMsg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">WM_INITDIALOG</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Устанавливаем иконку для основного окна */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ico</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LoadIcon</span><span class="crayon-sy">(</span><span class="crayon-e">GetModuleHandle</span><span class="crayon-sy">(</span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MAKEINTRESOURCE</span><span class="crayon-sy">(</span><span class="crayon-v">IDI_ICON</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SendMessage</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">WM_SETICON</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ICON_SMALL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">LPARAM</span><span class="crayon-sy">)</span><span class="crayon-v">ico</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">WM_COMMAND</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-e">LOWORD</span><span class="crayon-sy">(</span><span class="crayon-v">wParam</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">IDC_LIST</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-e">HIWORD</span><span class="crayon-sy">(</span><span class="crayon-v">wParam</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">LBN_DBLCLK</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">LBN_SELCHANGE</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">selection_index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SendDlgItemMessage</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_LIST</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">LB_GETCURSEL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">selection_index</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">eval_results</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Выводим в IDC_DATA содержимое в соответствии с выбранным элементом из IDC_LIST */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SetDlgItemText</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_DATA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eval_results</span><span class="crayon-sy">[</span><span class="crayon-v">selection_index</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">c_str</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">IDC_CLEAR</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Очищаем вектор и сопутствующие элементы на форме */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eval_results</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SetDlgItemText</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_DATA</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">L</span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SendDlgItemMessage</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_LIST</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">LB_RESETCONTENT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">IDC_BROWSE</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Вызываем диалог выбора файла, результат записываем в IDC_PATH */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">GetOpenName</span><span class="crayon-sy">(</span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"PHP (*.php)\0*.php\0Все файлы (*.*)\0*.*\0\0"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Открыть..."</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SetDlgItemText</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_PATH</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">file_path</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-55">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">IDC_UNPACK</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-e">GetDlgItemText</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">IDC_PATH</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">file_path</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Деактивируем некоторые элементы интерфейса */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* А то будет ататат из-за потоков */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">enable_gui_controls</span><span class="crayon-sy">(</span><span class="crayon-t">FALSE</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Формируем аргумент командной строки для последующего запуска процесса */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">_stprintf_s</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cmd</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">cmd</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">cmd</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"-f \"%s\""</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">file</span><span class="crayon-sy">_</span>path</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">memset</span><span class="crayon-sy">(</span><span class="crayon-v">&amp;si</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">STARTUPINFO</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">memset</span><span class="crayon-sy">(</span><span class="crayon-v">&amp;pi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">PROCESS_INFORMATION</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">memset</span><span class="crayon-sy">(</span><span class="crayon-v">&amp;sa</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">SECURITY_ATTRIBUTES</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Включаем наследование дескрипторов дочерним процессом */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sa</span><span class="crayon-sy">.</span><span class="crayon-v">nLength</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">SECURITY_ATTRIBUTES</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sa</span><span class="crayon-sy">.</span><span class="crayon-v">bInheritHandle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">TRUE</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sa</span><span class="crayon-sy">.</span><span class="crayon-v">lpSecurityDescriptor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Создаем пайп для перенаправления stdout */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CreatePipe</span><span class="crayon-sy">(</span><span class="crayon-v">&amp;child_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;child_write</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;sa</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SetHandleInformation</span><span class="crayon-sy">(</span><span class="crayon-v">child_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">HANDLE_FLAG_INHERIT</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Устанавливаем хендл, куда будет перенаправлен stdout дочернего процесса */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* и флаги для скрытия консольного окна дочернего процесса */</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">si</span><span class="crayon-sy">.</span><span class="crayon-v">cb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">STARTUPINFO</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">si</span><span class="crayon-sy">.</span><span class="crayon-v">wShowWindow</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">SW_HIDE</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">si</span><span class="crayon-sy">.</span><span class="crayon-v">hStdOutput</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">child_write</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">si</span><span class="crayon-sy">.</span><span class="crayon-v">dwFlags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">STARTF_USESTDHANDLES</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">STARTF_USESHOWWINDOW</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-90">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa339e201912211-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">GetModuleFileName</span><span class="crayon-sy">(</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MAX_PATH</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">StrRChr</span><span class="crayon-sy">(</span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">L</span><span class="crayon-s">'\\'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">*</span><span class="crayon-v">tmp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Путь к интерпретатору PHP */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">_tcscat_s</span><span class="crayon-sy">(</span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MAX_PATH</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"\\php-5.3.3\\php.exe"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CreateProcess</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">file_path</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">cmd</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">TRUE</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">&amp;si</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">&amp;pi</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-115"><span class="crayon-v">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-116"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-117"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-118"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MessageBox</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Ошибка создания процесса"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Ошибка"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MB_OK</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">MB_ICONERROR</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-119"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-120"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-121">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Закрываем ненужные хендлы */</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CloseHandle</span><span class="crayon-sy">(</span><span class="crayon-v">pi</span><span class="crayon-sy">.</span><span class="crayon-v">hProcess</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-124"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CloseHandle</span><span class="crayon-sy">(</span><span class="crayon-v">pi</span><span class="crayon-sy">.</span><span class="crayon-v">hThread</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-125"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CloseHandle</span><span class="crayon-sy">(</span><span class="crayon-v">child_write</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-126">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa339e201912211-127"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">_beginthreadex</span><span class="crayon-sy">(</span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">&amp;process_pipe</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-128"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-129"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-131"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">MessageBox</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Укажите путь к файлу"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TEXT</span><span class="crayon-sy">(</span><span class="crayon-s">"Ошибка"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MB_OK</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">MB_ICONERROR</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-136">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa339e201912211-137"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">WM_CLOSE</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">child_write</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-139"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-140"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CloseHandle</span><span class="crayon-sy">(</span><span class="crayon-v">child_write</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-142"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">DestroyIcon</span><span class="crayon-sy">(</span><span class="crayon-v">ico</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-144"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EndDialog</span><span class="crayon-sy">(</span><span class="crayon-v">hWnd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-145"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-146">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa339e201912211-147"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">default</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-148"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-149"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-150">&nbsp;</div><div class="crayon-line" id="crayon-53d032cfa339e201912211-151"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-152"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-153">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-154"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">WINAPI </span><span class="crayon-e">WinMain</span><span class="crayon-sy">(</span><span class="crayon-e">HINSTANCE </span><span class="crayon-v">hInstance</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">HINSTANCE </span><span class="crayon-v">hPrevInstance</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">LPSTR </span><span class="crayon-v">lpCmdLine</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">nCmdShow</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-155"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-156"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">SetUnhandledExceptionFilter</span><span class="crayon-sy">(</span><span class="crayon-v">SEH</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-157">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-158"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">DialogBoxParam</span><span class="crayon-sy">(</span><span class="crayon-v">hInstance</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MAKEINTRESOURCE</span><span class="crayon-sy">(</span><span class="crayon-v">IDD_MAIN</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">DLGPROC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">DlgProc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-159">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d032cfa339e201912211-160"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d032cfa339e201912211-161"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0317 seconds] -->
<p>Вот и все. Приведенный выше код является ужасно примитивным и нелепым, но позволяет сэкономить немного времени при распаковке очередного PHP-скрипта. Но какие же скрипты может распаковать данная программа? Ну, например, подобные этим:</p>
<p>http://pastebin.com/rLhMLui2</p>
<p>http://pastebin.com/r8m1Vj2b</p>
<p>Обратите внимание на то, что <strong><font color="red">при распаковке скрипт исполняется</font></strong>, а также скрипт может до конца не распаковаться, если в нем существует, например, привязка к домену.</p>
<p>Бинарник с PHP: <a href="http://kaimi.ru/wp-content/uploads/2012/04/php_generic_unpacker.zip" target="_blank">скачать</a><br />
Исходный код: <a href="http://kaimi.ru/wp-content/uploads/2012/04/php_generic_unpacker_src.zip" target="_blank">скачать</a></p>

      <div class = "github-ribbon right ribbon-holder">
        <a href="https://github.com/kaimi-ru/php-eval-unpacker" class="orange ribbon"  target = "_blank" >
          <span class="text">Fork me on GitHub</span>
        </a>
      </div>

<div class="wp_rp_wrap  wp_rp_plain" id="wp_rp_first"><div class="wp_rp_content"><h3 class="related_post_title">Также рекомендую почитать</h3><ul class="related_post wp_rp"><li data-position="0" data-poid="in-1782" data-post-type="none" ><a href="http://kaimi.ru/2010/10/php-obfuscator-1-5/" class="wp_rp_title">PHP Obfuscator 1.5</a><small class="wp_rp_comments_count"> (65)</small><br /></li><li data-position="1" data-poid="in-648" data-post-type="none" ><a href="http://kaimi.ru/2009/10/php-obfuscator-1-4/" class="wp_rp_title">PHP Obfuscator 1.4</a><small class="wp_rp_comments_count"> (19)</small><br /></li><li data-position="2" data-poid="in-2724" data-post-type="none" ><a href="http://kaimi.ru/2012/01/php-deobfuscate/" class="wp_rp_title">Методика деобфускации PHP-скриптов для чайников. Полезные советы.</a><small class="wp_rp_comments_count"> (34)</small><br /></li><li data-position="3" data-poid="in-171" data-post-type="none" ><a href="http://kaimi.ru/2009/03/php-obfuscator-13-extended/" class="wp_rp_title">PHP obfuscator 1.3 extended</a><small class="wp_rp_comments_count"> (2)</small><br /></li><li data-position="4" data-poid="in-2880" data-post-type="none" ><a href="http://kaimi.ru/2012/03/quest-3-return-to-classics-full-solution/" class="wp_rp_title">Quest 3 &#8211; Return to Classics &#8211; Полное прохождение</a><small class="wp_rp_comments_count"> (25)</small><br /></li></ul></div></div>
<h4><a href="//forum.kaimi.ru/viewforum.php?id=5" target="_blank"><img src="http://kaimi.ru/wp-content/themes/cbone/go.png" style="border-style:none; vertical-align:middle;" /></a>&nbsp;<a href="//forum.kaimi.ru/viewforum.php?id=5" style="text-decoration:none; color:#7A7A7A; vertical-align:middle;" target="_blank">Обсудить на форуме</a></h4>
<br />
<div class="box">
<form action="http://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open('http://feedburner.google.com/fb/a/mailverify?uri=kaimi/dev', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true"><p>Получать обновления на почту: &nbsp;&nbsp;<input type="text" style="width:160px" name="email" value="Ваш e-mail"/>&nbsp;&nbsp;<input type="hidden" value="kaimi/dev" name="uri"/><input type="hidden" name="loc" value="ru_RU"/><input type="submit" value="Подписаться"/></p></form>
</div>

<div id="tags">
<span style="float: left">
Метки: <a href="http://kaimi.ru/tag/eval/" rel="tag">eval</a>, <a href="http://kaimi.ru/tag/php/" rel="tag">PHP</a>, <a href="http://kaimi.ru/tag/zend/" rel="tag">zend</a>, <a href="http://kaimi.ru/tag/%d1%80%d0%b0%d1%81%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d0%ba%d0%b0/" rel="tag">распаковка</a>.</span>
<script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script>
<div class="yashare-auto-init" data-yashareL10n="ru" ata-yashareType="button" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir,lj,gplus" style="float: right;"></div> 

</div>

</div>

<p class="postmetadata">
Раздел: <a href="http://kaimi.ru/category/cpp/" title="Просмотреть все записи в рубрике &laquo;C/C++&raquo;" rel="category tag">C/C++</a>, <a href="http://kaimi.ru/category/php/" title="Просмотреть все записи в рубрике &laquo;PHP&raquo;" rel="category tag">PHP</a>, <a href="http://kaimi.ru/category/windows/" title="Просмотреть все записи в рубрике &laquo;Windows&raquo;" rel="category tag">Windows</a>, автор: <b>Kaimi</b>
</p>

</div>

<!-- You can start editing here. -->

	<h3 id="comments">Комментариев: 9 к &#8220;PHP Generic Eval Unpacker&#8221;</h3>

	<div class="wp-pagenavi" align="center"><div class="previous_next"></div></div>

	<ol class="commentlist">
	<li class="comment even thread-even depth-1" id="li-comment-12801">
<div id="comment-12801">
<div class="comment-author vcard">
<img alt='' src='http://1.gravatar.com/avatar/59e8e5f1344f15bb4265e52381137ca9?s=48&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' /><br /><cite class="fn"><a href="#" class="jqcl" title="nowonline.ru/" rel="nofollow">nowonline</a></cite> <span class="says">:</span></div>
<div class="comment-meta commentmetadata"><a href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/comment-page-1/#comment-12801"><small>Апрель 28, 2012 в 00:49</small></a></div>
<p>спасибо, полезная вещь</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12801,1,'nowonline');">Ответить</a>]</p><!--
<div class="reply">
<a class='comment-reply-link' href='/2012/04/php-generic-eval-unpacker/?replytocom=12801#respond' onclick='return addComment.moveForm("comment-12801", "12801", "respond", "3074")'>Ответить</a></div>
-->

</div>
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-12803">
<div id="comment-12803">
<div class="comment-author vcard">
<img alt='' src='http://1.gravatar.com/avatar/3731f606afa8dccc9123bdd4062c4af1?s=48&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' /><br /><cite class="fn">AsseR</cite> <span class="says">:</span></div>
<div class="comment-meta commentmetadata"><a href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/comment-page-1/#comment-12803"><small>Апрель 29, 2012 в 00:28</small></a></div>
<p>Господа, напишите пожалуйста криптософт. Сорцев мало достойных<br />
К примеру алго PAQ а поверх RSA 4096.<br />
Криптография довольно инстересная штука, и мало реализаций хороших.<br />
Архиватор Ваш видел, но там банально: ZLib+AES, а вышепредложенный алгоритм повзрослее чтоли будет.<br />
С уважением.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12803,1,'AsseR');">Ответить</a>]</p><div class="comment-childs chalt" id="comment-12804"><img alt='' src='http://0.gravatar.com/avatar/68263912c39b44daeafc5bfa3ecc9426?s=32&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite>dx</cite>:<br /><small class="commentmetadata">Апрель 29th, 2012 at 00:41</small></p><p>Да вы параноик, сэр.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12804,2,'dx');">Ответить</a>]</p><div class="comment-childs" id="comment-12808"><img alt='' src='http://1.gravatar.com/avatar/7003c3bac89e607192aba1fd97eca557?s=32&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite>AsseR</cite>:<br /><small class="commentmetadata">Апрель 30th, 2012 at 00:37</small></p><p>Да, сэр, Вы правы.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12808,3,'AsseR');">Ответить</a>]</p></div></div><div class="comment-childs chalt" id="comment-12805"><img alt='' src='http://0.gravatar.com/avatar/ec3a94a252a6004c43717bc187b9d852?s=32&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite><a href='http://kaimi.ru' rel='external nofollow' class='url'>Kaimi</a></cite>:<br /><small class="commentmetadata">Апрель 29th, 2012 at 00:44</small></p><p>Гуглишь реализацию PAQ, добавляешь OpenSSL и получается готовая реализация.<br />
Смысл? Вся практическая сложность сведется к интерфейсу и мелочам.<br />
С нуля, опираясь на математические описания алгоритмов, писать все это дело - ну, как минимум результат будет медленнее работать, да и косяки могут быть.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12805,2,'Kaimi');">Ответить</a>]</p><div class="comment-childs" id="comment-12809"><img alt='' src='http://1.gravatar.com/avatar/7003c3bac89e607192aba1fd97eca557?s=32&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite>AsseR</cite>:<br /><small class="commentmetadata">Апрель 30th, 2012 at 00:38</small></p><p>Ок, я понял, что никому из Вас это неинтересно.<br />
Спасибо за совет.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12809,3,'AsseR');">Ответить</a>]</p><div class="comment-childs chalt" id="comment-12810"><img alt='' src='http://0.gravatar.com/avatar/ec3a94a252a6004c43717bc187b9d852?s=32&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite><a href='http://kaimi.ru' rel='external nofollow' class='url'>Kaimi</a></cite>:<br /><small class="commentmetadata">Апрель 30th, 2012 at 01:33</small></p><p>Вопрос скорее в целесообразности и смысле. Лично я не вижу конечного смысла затеи.<br />
Уникальной криптостойкости не будет, реализация по готовым выкладкам, юзабилити под вопросом...<br />
Эта задача скорее напоминает то, что обычно просят на форумах в качестве курсовой или диплома, а security through obscurity за счет кастомного формата, хрен знает, например, rar-архив с 32 символьным паролем люди как-то не вскрывают, так почему бы не его...</p>
</div></div></div><!--
<div class="reply">
<a class='comment-reply-link' href='/2012/04/php-generic-eval-unpacker/?replytocom=12803#respond' onclick='return addComment.moveForm("comment-12803", "12803", "respond", "3074")'>Ответить</a></div>
-->

</div>
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="li-comment-12828">
<div id="comment-12828">
<div class="comment-author vcard">
<img alt='' src='http://1.gravatar.com/avatar/bf7d8ccea35bd9689e8c11deb0ab3c88?s=48&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' /><br /><cite class="fn"><a href="#" class="jqcl" title="fromtheauthor.narod.ru" rel="nofollow">Alexey</a></cite> <span class="says">:</span></div>
<div class="comment-meta commentmetadata"><a href="http://kaimi.ru/2012/04/php-generic-eval-unpacker/comment-page-1/#comment-12828"><small>Май 2, 2012 в 17:13</small></a></div>
<p>Привет админ! Не смог найти контакты. Отпишись мне пожалуйста. Хочу разместить рекламу в твоем блоге.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12828,1,'Alexey');">Ответить</a>]</p><div class="comment-childs chalt" id="comment-12830"><img alt='' src='http://1.gravatar.com/avatar/fe236ce96db542f2ac08a0ce0c5cc546?s=32&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G' class='avatar avatar-32 photo' height='32' width='32' /><p><cite>Anon</cite>:<br /><small class="commentmetadata">Май 2nd, 2012 at 20:20</small></p><p>1. Купи очки (или линзы) и сразу же начни пользоваться ими.<br />
2. Нажми на кнопке "О блоге" под шапкой сайта.<br />
3. Сделай усилия, и попробуй там отыскать контакты админа.</p>
<p class="thdrpy">[<a href="javascript:void(0)" onclick="movecfm(event,12830,2,'Anon');">Ответить</a>]</p></div><!--
<div class="reply">
<a class='comment-reply-link' href='/2012/04/php-generic-eval-unpacker/?replytocom=12828#respond' onclick='return addComment.moveForm("comment-12828", "12828", "respond", "3074")'>Ответить</a></div>
-->

</div>
</li><!-- #comment-## -->
	</ol>
	<br />
	<div class="wp-pagenavi" align="center"><div class="previous_next"></div></div>
	
 


<h3 id="respond">Оставьте ваш комментарий</h3>


<form action="http://kaimi.ru/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
<label for="author"><small>Имя (обязательно)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />
<label for="email"><small>E-mail (не будет опубликован) (обязательно)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Сайт</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: &lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code class=&quot;&quot; title=&quot;&quot; data-url=&quot;&quot;&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre class=&quot;&quot; title=&quot;&quot; data-url=&quot;&quot;&gt; &lt;span class=&quot;&quot; title=&quot;&quot; data-url=&quot;&quot;&gt; </small></p>-->

<p><textarea name="d5d6f-comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea><textarea name="comment" style="display:none" rows="1" cols="1"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Сказать" />
<input type="hidden" name="comment_post_ID" value="3074" />
</p>

<script type="text/javascript">/*<![CDATA[*/
var $j = jQuery.noConflict();
$j(document).ready(function() {
	$j('a.jqcl').each(function() {
		var link = $j(this).attr('title');
		$j(this).attr('href', 'http://'+link).attr('title', 'http://'+link);
	});
})
/*]]>*/</script>
<p><input type="hidden" id="comment_reply_ID" name="comment_reply_ID" value="0" /><input type="hidden" id="comment_reply_dp" name="comment_reply_dp" value="0" /></p><div id="cancel_reply" style="display:none;"><a href="javascript:void(0)" onclick="movecfm(null,0,1,null);" style="color:red;">Отменить написание комментария</a></div><p><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" style="width: auto;" /><label for="comment_mail_notify" style="display: inline;">Notify me of follow-up comments via e-mail</label></p><script type="text/javascript">
/* <![CDATA[ */
var commentformid = "commentform";
var USERINFO = false;
var atreply = "author";
/* ]]> */
</script>
<script type="text/javascript" src="//kaimi.ru/wp-content/plugins/wp-thread-comment/wp-thread-comment.js.php?jsver=common"></script>

</form>



<div class="previous_next">
	</div>

</div>
<div id="sidebar">
     <br />
	 
	<div align="center"><noindex><a href="http://feeds.feedburner.com/kaimi/dev" rel="nofollow"><img border="0" style="border-width:0px 0px 0px 0px;" src="//kaimi.ru/wp-content/themes/cbone/rss.gif" width="70" height="70"/></a></noindex>
	<p><noindex><a href="http://feeds.feedburner.com/kaimi/dev" rel="nofollow"><img src="http://kaimi.ru/projects/feedburner/image.gif?44825" height="26" width="88" style="border:0" alt="" /></a></noindex></p>
	</div>
	<ul>
    <li id="text-3" class="widget widget_text"><h2 class="widgettitle">Предупреждение</h2>
			<div class="textwidget"><p style="text-align:justify; font-family: Arial Sans, sans-serif; margin: 0px">Все материалы сайта предоставлены исключительно в ознакомительных и обучающих целях. Ответственность за использование их в корыстных целях полностью ложится на ваши плечи.</p></div>
		</li>
<li id="text-2" class="widget widget_text"><h2 class="widgettitle">Нравится? Поддержи!</h2>
			<div class="textwidget">R629006595092<br />
Z419989046047<br />
E612729169063<br />
<div id="btc" onmouseover="javascript:if(this.innerHTML.length==1)this.innerHTML='<textarea>1KaimiRU35AAAY3YBNqeSzqJmcfN7eBTug</textarea>'">฿</div></div>
		</li>
<li id="categories-3" class="widget widget_categories"><h2 class="widgettitle">Категории</h2>
		<ul>
	<li class="cat-item cat-item-88"><a href="http://kaimi.ru/category/%d0%b4%d0%b5%d0%bd%d1%8c%d0%b3%d0%b8/" title="Просмотреть все записи в рубрике &laquo;$$$&raquo;">$$$</a>
</li>
	<li class="cat-item cat-item-222"><a href="http://kaimi.ru/category/net/" title="Просмотреть все записи в рубрике &laquo;.NET&raquo;">.NET</a>
</li>
	<li class="cat-item cat-item-48"><a href="http://kaimi.ru/category/assembler/" title="Assembler x86">Assembler</a>
</li>
	<li class="cat-item cat-item-108"><a href="http://kaimi.ru/category/c-sharp/" title="Просмотреть все записи в рубрике &laquo;C#&raquo;">C#</a>
</li>
	<li class="cat-item cat-item-173"><a href="http://kaimi.ru/category/cpp/" title="Просмотреть все записи в рубрике &laquo;C/C++&raquo;">C/C++</a>
</li>
	<li class="cat-item cat-item-448"><a href="http://kaimi.ru/category/code-review-2/" title="Просмотреть все записи в рубрике &laquo;Code Review&raquo;">Code Review</a>
</li>
	<li class="cat-item cat-item-274"><a href="http://kaimi.ru/category/html-js/" title="Просмотреть все записи в рубрике &laquo;HTML/JS&raquo;">HTML/JS</a>
</li>
	<li class="cat-item cat-item-491"><a href="http://kaimi.ru/category/java/" title="Просмотреть все записи в рубрике &laquo;Java&raquo;">Java</a>
</li>
	<li class="cat-item cat-item-143"><a href="http://kaimi.ru/category/linux/" title="Просмотреть все записи в рубрике &laquo;Linux&raquo;">Linux</a>
</li>
	<li class="cat-item cat-item-152"><a href="http://kaimi.ru/category/lua/" title="Просмотреть все записи в рубрике &laquo;Lua&raquo;">Lua</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://kaimi.ru/category/perl/" title="perl scripts">Perl</a>
</li>
	<li class="cat-item cat-item-24"><a href="http://kaimi.ru/category/php/" title="Просмотреть все записи в рубрике &laquo;PHP&raquo;">PHP</a>
</li>
	<li class="cat-item cat-item-142"><a href="http://kaimi.ru/category/windows/" title="Просмотреть все записи в рубрике &laquo;Windows&raquo;">Windows</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://kaimi.ru/category/uncategorized/" title="Просмотреть все записи в рубрике &laquo;Без категории&raquo;">Без категории</a>
</li>
	<li class="cat-item cat-item-453"><a href="http://kaimi.ru/category/b/" title="Просмотреть все записи в рубрике &laquo;Бред&raquo;">Бред</a>
</li>
	<li class="cat-item cat-item-204"><a href="http://kaimi.ru/category/%d0%b4%d0%bb%d1%8f-%d0%bd%d0%be%d0%b2%d0%b8%d1%87%d0%ba%d0%be%d0%b2/" title="Просмотреть все записи в рубрике &laquo;Для новичков&raquo;">Для новичков</a>
</li>
	<li class="cat-item cat-item-100"><a href="http://kaimi.ru/category/life/" title="Просмотреть все записи в рубрике &laquo;Жизнь&raquo;">Жизнь</a>
</li>
	<li class="cat-item cat-item-261"><a href="http://kaimi.ru/category/snippets/" title="Просмотреть все записи в рубрике &laquo;Сниппеты&raquo;">Сниппеты</a>
</li>
	<li class="cat-item cat-item-269"><a href="http://kaimi.ru/category/soft/" title="Просмотреть все записи в рубрике &laquo;Софт&raquo;">Софт</a>
</li>
	<li class="cat-item cat-item-17"><a href="http://kaimi.ru/category/%d1%81%d0%be%d1%86%d0%b8%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d1%81%d0%b5%d1%82%d0%b8/" title="Просмотреть все записи в рубрике &laquo;Социальные сети&raquo;">Социальные сети</a>
</li>
	<li class="cat-item cat-item-166"><a href="http://kaimi.ru/category/%d1%8d%d1%82%d0%be-%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d0%b5%d1%81%d0%bd%d0%be/" title="Просмотреть все записи в рубрике &laquo;Это интересно&raquo;">Это интересно</a>
</li>
	<li class="cat-item cat-item-242"><a href="http://kaimi.ru/category/%d1%8e%d0%bc%d0%be%d1%80/" title="Просмотреть все записи в рубрике &laquo;Юмор&raquo;">Юмор</a>
</li>
		</ul>
</li>
<li id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="widgettitle">Метки</h2>
<div class="tagcloud"><a href='http://kaimi.ru/tag/assembler/' class='tag-link-48' title='17 записей' style='font-size: 18.38202247191pt;'>Assembler</a>
<a href='http://kaimi.ru/tag/bruteforce/' class='tag-link-22' title='3 записи' style='font-size: 8pt;'>bruteforce</a>
<a href='http://kaimi.ru/tag/c/' class='tag-link-61' title='24 записи' style='font-size: 20.584269662921pt;'>c++</a>
<a href='http://kaimi.ru/tag/cmd/' class='tag-link-139' title='3 записи' style='font-size: 8pt;'>cmd</a>
<a href='http://kaimi.ru/tag/crypto-api/' class='tag-link-69' title='4 записи' style='font-size: 9.5730337078652pt;'>crypto api</a>
<a href='http://kaimi.ru/tag/dll/' class='tag-link-77' title='11 записей' style='font-size: 15.550561797753pt;'>dll</a>
<a href='http://kaimi.ru/tag/exe/' class='tag-link-180' title='3 записи' style='font-size: 8pt;'>exe</a>
<a href='http://kaimi.ru/tag/gui/' class='tag-link-54' title='3 записи' style='font-size: 8pt;'>gui</a>
<a href='http://kaimi.ru/tag/http/' class='tag-link-79' title='3 записи' style='font-size: 8pt;'>http</a>
<a href='http://kaimi.ru/tag/inject/' class='tag-link-194' title='7 записей' style='font-size: 12.719101123596pt;'>inject</a>
<a href='http://kaimi.ru/tag/javascript/' class='tag-link-105' title='6 записей' style='font-size: 11.932584269663pt;'>JavaScript</a>
<a href='http://kaimi.ru/tag/lastfm/' class='tag-link-53' title='7 записей' style='font-size: 12.719101123596pt;'>last.fm</a>
<a href='http://kaimi.ru/tag/masm32/' class='tag-link-50' title='17 записей' style='font-size: 18.38202247191pt;'>masm32</a>
<a href='http://kaimi.ru/tag/packer/' class='tag-link-366' title='12 записей' style='font-size: 16.022471910112pt;'>packer</a>
<a href='http://kaimi.ru/tag/pe/' class='tag-link-215' title='11 записей' style='font-size: 15.550561797753pt;'>pe</a>
<a href='http://kaimi.ru/tag/perl/' class='tag-link-4' title='30 записей' style='font-size: 22pt;'>Perl</a>
<a href='http://kaimi.ru/tag/php/' class='tag-link-24' title='20 записей' style='font-size: 19.325842696629pt;'>PHP</a>
<a href='http://kaimi.ru/tag/plugin/' class='tag-link-75' title='5 записей' style='font-size: 10.831460674157pt;'>plugin</a>
<a href='http://kaimi.ru/tag/portable-executable/' class='tag-link-220' title='17 записей' style='font-size: 18.38202247191pt;'>Portable Executable</a>
<a href='http://kaimi.ru/tag/proxy/' class='tag-link-129' title='4 записи' style='font-size: 9.5730337078652pt;'>proxy</a>
<a href='http://kaimi.ru/tag/quest/' class='tag-link-248' title='10 записей' style='font-size: 14.921348314607pt;'>quest</a>
<a href='http://kaimi.ru/tag/splicing/' class='tag-link-202' title='5 записей' style='font-size: 10.831460674157pt;'>splicing</a>
<a href='http://kaimi.ru/tag/ssh/' class='tag-link-110' title='3 записи' style='font-size: 8pt;'>ssh</a>
<a href='http://kaimi.ru/tag/tk/' class='tag-link-52' title='4 записи' style='font-size: 9.5730337078652pt;'>tk</a>
<a href='http://kaimi.ru/tag/vkontakte/' class='tag-link-31' title='13 записей' style='font-size: 16.651685393258pt;'>vkontakte</a>
<a href='http://kaimi.ru/tag/webmoney/' class='tag-link-176' title='4 записи' style='font-size: 9.5730337078652pt;'>webmoney</a>
<a href='http://kaimi.ru/tag/win32/' class='tag-link-145' title='3 записи' style='font-size: 8pt;'>win32</a>
<a href='http://kaimi.ru/tag/win32-api/' class='tag-link-51' title='12 записей' style='font-size: 16.022471910112pt;'>win32 api</a>
<a href='http://kaimi.ru/tag/winapi/' class='tag-link-237' title='9 записей' style='font-size: 14.292134831461pt;'>winapi</a>
<a href='http://kaimi.ru/tag/windows-2/' class='tag-link-231' title='10 записей' style='font-size: 14.921348314607pt;'>windows</a>
<a href='http://kaimi.ru/tag/%d1%81%d0%be%d1%86%d0%b8%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d1%81%d0%b5%d1%82%d0%b8/' class='tag-link-17' title='3 записи' style='font-size: 8pt;'>Социальные сети</a>
<a href='http://kaimi.ru/tag/%d0%b0%d0%bd%d1%82%d0%b8%d0%ba%d0%b0%d0%bf%d1%87%d0%b0/' class='tag-link-55' title='6 записей' style='font-size: 11.932584269663pt;'>антикапча</a>
<a href='http://kaimi.ru/tag/%d0%b0%d1%81%d1%81%d0%b5%d0%bc%d0%b1%d0%bb%d0%b5%d1%80/' class='tag-link-49' title='9 записей' style='font-size: 14.292134831461pt;'>ассемблер</a>
<a href='http://kaimi.ru/tag/%d0%b1%d1%80%d1%83%d1%82%d1%84%d0%be%d1%80%d1%81/' class='tag-link-16' title='5 записей' style='font-size: 10.831460674157pt;'>брутфорс</a>
<a href='http://kaimi.ru/tag/%d0%b2%d0%ba%d0%be%d0%bd%d1%82%d0%b0%d0%ba%d1%82%d0%b5/' class='tag-link-30' title='17 записей' style='font-size: 18.38202247191pt;'>вконтакте</a>
<a href='http://kaimi.ru/tag/%d0%ba%d0%b0%d0%bf%d1%87%d0%b0/' class='tag-link-114' title='3 записи' style='font-size: 8pt;'>капча</a>
<a href='http://kaimi.ru/tag/%d0%ba%d0%b2%d0%b5%d1%81%d1%82/' class='tag-link-247' title='11 записей' style='font-size: 15.550561797753pt;'>квест</a>
<a href='http://kaimi.ru/tag/%d0%be%d0%b1%d1%84%d1%83%d1%81%d0%ba%d0%b0%d1%86%d0%b8%d1%8f/' class='tag-link-38' title='5 записей' style='font-size: 10.831460674157pt;'>обфускация</a>
<a href='http://kaimi.ru/tag/%d0%bf%d0%b0%d1%80%d1%81%d0%b5%d1%80/' class='tag-link-13' title='3 записи' style='font-size: 8pt;'>парсер</a>
<a href='http://kaimi.ru/tag/%d0%bf%d0%bb%d0%b0%d0%b3%d0%b8%d0%bd/' class='tag-link-74' title='4 записи' style='font-size: 9.5730337078652pt;'>плагин</a>
<a href='http://kaimi.ru/tag/%d1%81%d0%ba%d1%80%d0%b8%d0%bf%d1%82-%d1%80%d0%b0%d1%81%d1%81%d1%8b%d0%bb%d0%ba%d0%b8/' class='tag-link-83' title='3 записи' style='font-size: 8pt;'>скрипт рассылки</a>
<a href='http://kaimi.ru/tag/%d1%81%d0%be%d0%ba%d0%b5%d1%82%d1%8b/' class='tag-link-37' title='3 записи' style='font-size: 8pt;'>сокеты</a>
<a href='http://kaimi.ru/tag/%d1%81%d0%bf%d0%bb%d0%b0%d0%b9%d1%81%d0%b8%d0%bd%d0%b3/' class='tag-link-203' title='5 записей' style='font-size: 10.831460674157pt;'>сплайсинг</a>
<a href='http://kaimi.ru/tag/%d1%82%d1%80%d0%b0%d1%84%d0%b8%d0%ba/' class='tag-link-89' title='3 записи' style='font-size: 8pt;'>трафик</a>
<a href='http://kaimi.ru/tag/%d1%83%d0%bf%d0%b0%d0%ba%d0%be%d0%b2%d1%89%d0%b8%d0%ba/' class='tag-link-365' title='12 записей' style='font-size: 16.022471910112pt;'>упаковщик</a></div>
</li>
<li id="linkcat-96" class="widget widget_links"><h2 class="widgettitle">Ссылки</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://brutezone.ru/" target="_blank">BruteZone</a></li>
<li><a href="http://freedomscripts.org/forum/forumdisplay.php?f=15" target="_blank">Freedom Team &#8211; софт на заказ</a></li>
<li><a href="http://godinside.ru" target="_blank">GODINSIDE.RU | Уникальный блог</a></li>
<li><a href="http://forum.reverse4you.org" target="_blank">r0 Crew</a></li>
<li><a href="http://blog.rebz.net/" target="_blank">Rebz&#039;s blog</a></li>
<li><a href="http://mrthe.name/" target="_blank">Блог mr.The</a></li>
<li><a href="http://rushter.com" target="_blank">Блог RushteR</a></li>
<li><a href="http://mrfizik-soft.ru" target="_blank">Софт для ВКонтакте</a></li>
<li><a href="http://zacodim.ru" target="_blank">Форум кодеров и вебмастеров</a></li>

	</ul>
</li>

	</ul>
	<br />
</div>
<div class="endfloat">&nbsp;</div>
</div>

<div id="footer">
	<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/kaimi.ru\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"0","show_fading":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='http://kaimi.ru/wp-content/plugins/wp-polls/polls-js.js?ver=2.63'></script>
	<p>
		<center>Использование материалов на других ресурсах разрешено только с указанием активной гиперссылки на kaimi.ru</center>
<span id="7ecd33c2f49aaa63357450844bbc1fcb"></span>
<!-- Yandex.Metrika -->
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>
<div style="display:none;">
<script type="text/javascript">
try 
{
	var yaCounter1810114 = new Ya.Metrika(1810114);
	yaCounter1810114.clickmap(true);
	yaCounter1810114.trackLinks(true);
} catch(e){}
</script>
</div>
<noscript><div style="position:absolute"><img src="//mc.yandex.ru/watch/1810114" alt="" /></div></noscript>
<!-- /Yandex.Metrika -->
<!--LiveInternet counter-->
<script type="text/javascript"><!-- 
new Image().src = "//counter.yadro.ru/hit?r"+ escape(document.referrer)+((typeof(screen)=="undefined")?"": ";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth ? screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+";"+Math.random();
</script>
<!--/LiveInternet-->
<br /><a href="http://kaimi.ru/feed/">Посты (RSS)</a> и <a href="http://kaimi.ru/comments/feed/">Комментарии (RSS)</a>.
</p>

</div>
</div>
<div id="shadow_f">
&nbsp;
</div>
</body>
</html>

