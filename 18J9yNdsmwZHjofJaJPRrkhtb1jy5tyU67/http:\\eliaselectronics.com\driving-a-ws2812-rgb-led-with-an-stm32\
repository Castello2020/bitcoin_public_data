http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/
HTTP/1.1 200 OK
Date: Wed, 23 Jul 2014 16:01:00 GMT
Server: Apache
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
X-Pingback: http://eliaselectronics.com/xmlrpc.php
Link: <http://eliaselectronics.com/?p=1227>; rel=shortlink
Set-Cookie: PHPSESSID=e1401a5b0898fafeaca9d204200528f3; path=/
Content-Length: 70582
Connection: close
Content-Type: text/html; charset=UTF-8

<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Driving a WS2812 RGB LED with an STM32 | /dev/thrash</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://eliaselectronics.com/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://eliaselectronics.com/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26340745-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<link rel="alternate" type="application/rss+xml" title="/dev/thrash &raquo; Feed" href="http://eliaselectronics.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="/dev/thrash &raquo; Comments Feed" href="http://eliaselectronics.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="/dev/thrash &raquo; Driving a WS2812 RGB LED with an STM32 Comments Feed" href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/feed/" />
<link rel='stylesheet' id='cntctfrm_stylesheet-css'  href='http://eliaselectronics.com/wp-content/plugins/contact-form-plugin/css/style.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-polls-css'  href='http://eliaselectronics.com/wp-content/plugins/wp-polls/polls-css.css?ver=2.63' type='text/css' media='all' />
<link rel='stylesheet' id='wpt-twitter-feed-css'  href='http://eliaselectronics.com/wp-content/plugins/wp-to-twitter/css/twitter-feed.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='http://eliaselectronics.com/wp-content/themes/twentytwelve-child/style.css?ver=3.9.1' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://eliaselectronics.com/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">{lang: "en-US"}</script><script type="text/javascript">
function wdgpo_plusone_click (el) {
	if (typeof window._gaq != "undefined") {
		 _gaq.push(['_trackEvent', 'Google +1', el.state, document.title]);
	}
}
</script><script type='text/javascript' src='http://eliaselectronics.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://eliaselectronics.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://eliaselectronics.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://eliaselectronics.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Reading SD cards with the STM32F4-Discovery' href='http://eliaselectronics.com/reading-sd-cards-with-the-stm32f4-discovery/' />
<link rel='next' title='PIC microcontroller tutorial #6 &#8211; USART' href='http://eliaselectronics.com/pic-microcontroller-tutorial-6-usart/' />
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/' />
<link rel='shortlink' href='http://eliaselectronics.com/?p=1227' />
<link rel="stylesheet" type="text/css" href="http://eliaselectronics.com/wp-content/plugins/wp-code-highlight/css/wp-code-highlight.css" media="screen" />
<style type="text/css">
.wp-polls .pollbar {
	margin: 1px;
	font-size: 8px;
	line-height: 10px;
	height: 10px;
	background: #d8e1eb;
	border: 1px solid #c8c8c8;
}
</style>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">{lang: "en-US"}</script><script type="text/javascript">
function wdgpo_plusone_click (el) {
	if (typeof window._gaq != "undefined") {
		 _gaq.push(['_trackEvent', 'Google +1', el.state, document.title]);
	}
}
</script><style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; }
/* ]]> */
</style>
</head>

<body class="single single-post postid-1227 single-format-standard custom-background custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="http://eliaselectronics.com/" title="/dev/thrash" rel="home">/dev/thrash</a></h1>
			<h2 class="site-description">Elia experiments with electronics</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h3 class="menu-toggle">Menu</h3>
			<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul><li ><a href="http://eliaselectronics.com/">Home</a></li><li class="page_item page-item-763"><a href="http://eliaselectronics.com/about/">About</a></li><li class="page_item page-item-846"><a href="http://eliaselectronics.com/contact/">Contact</a></li><li class="page_item page-item-548 page_item_has_children"><a href="http://eliaselectronics.com/projects/">Projects</a><ul class='children'><li class="page_item page-item-1035"><a href="http://eliaselectronics.com/projects/20-pin-dip-pic-breakout-board/">20-pin DIP PIC breakout board</a></li><li class="page_item page-item-630"><a href="http://eliaselectronics.com/projects/diy-variable-bipolar-power-supply/">DIY variable bipolar power supply</a></li><li class="page_item page-item-812"><a href="http://eliaselectronics.com/projects/easylcd/">EasyLCD &#8211; yet another LCD backpack</a></li><li class="page_item page-item-744"><a href="http://eliaselectronics.com/projects/pic18f2xxx-breakout-board/">PIC18F2XXX breakout board</a></li><li class="page_item page-item-550"><a href="http://eliaselectronics.com/projects/voltage-spikedrop-detector/">Voltage spike/drop detector</a></li></ul></li><li class="page_item page-item-487 page_item_has_children"><a href="http://eliaselectronics.com/robots/">Robots</a><ul class='children'><li class="page_item page-item-432"><a href="http://eliaselectronics.com/robots/artemis-sigma/">Artemis Sigma</a></li><li class="page_item page-item-501"><a href="http://eliaselectronics.com/robots/ronnie-2/">Ronnie 2</a></li><li class="page_item page-item-491"><a href="http://eliaselectronics.com/robots/tlor-the-little-one-reloaded/">TLOR &#8211; The Little One Reloaded</a></li></ul></li><li class="page_item page-item-684 page_item_has_children"><a href="http://eliaselectronics.com/stm32f4-tutorials/">STM32F4 tutorials</a><ul class='children'><li class="page_item page-item-1142"><a href="http://eliaselectronics.com/stm32f4-tutorials/getting-started-with-chibios-on-stm32f4/">Getting started with ChibiOS on the STM32F4</a></li><li class="page_item page-item-1083"><a href="http://eliaselectronics.com/stm32f4-tutorials/setting-up-the-stm32f4-arm-development-toolchain/">Setting up the STM32 ARM development toolchain</a></li><li class="page_item page-item-920"><a href="http://eliaselectronics.com/stm32f4-tutorials/setting-up-the-stm32f4-with-keil-%c2%b5vision/">Setting up the STM32F4 with Keil ÂµVision</a></li><li class="page_item page-item-716"><a href="http://eliaselectronics.com/stm32f4-tutorials/stm32f4-i2c-master-tutorial/">STM32F4 I2C Master tutorial</a></li><li class="page_item page-item-997"><a href="http://eliaselectronics.com/stm32f4-tutorials/stm32f4-spi-tutorial/">STM32F4 SPI tutorial</a></li><li class="page_item page-item-701"><a href="http://eliaselectronics.com/stm32f4-tutorials/stm32f4-getting-started/">STM32F4 getting started</a></li><li class="page_item page-item-698"><a href="http://eliaselectronics.com/stm32f4-tutorials/stm32f4-gpio-tutorial/">STM32F4 GPIO tutorial</a></li><li class="page_item page-item-686"><a href="http://eliaselectronics.com/stm32f4-tutorials/stm32f4-usart-tutorial/">STM32F4 USART tutorial</a></li></ul></li></ul></div>
		</nav><!-- #site-navigation -->

					<a href="http://eliaselectronics.com/"><img src="http://eliaselectronics.com/wp-content/uploads/2012/12/cropped-cropped-DSC_04311.jpg" class="header-image" width="1997" height="520" alt="" /></a>
			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-1227" class="post-1227 post type-post status-publish format-standard hentry category-microcontrollers category-projects category-stm32 tag-dma tag-led tag-neopixel tag-rgb tag-stm32 tag-timer tag-ws2812">
				<header class="entry-header">
			
						<h1 class="entry-title">Driving a WS2812 RGB LED with an STM32</h1>
										<div class="comments-link">
					<a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comments" title="Comment on Driving a WS2812 RGB LED with an STM32">29 Replies</a>				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content">
			
<!-- This is the start of the WP Twitter Button code -->
<div id="rk_wp_twitter_button" style="margin: 0px 0px 0px 0px; float: right"><a href="http://twitter.com/share" class="twitter-share-button" data-url="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/" data-count="horizontal" data-via="EsEblog">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script></div>
<!-- This is the end of the WP Twitter Button code -->

<div class='wdgpo wdgpo_standard_count'><g:plusone size='standard' count='true' href='http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/' callback='wdgpo_plusone_click'></g:plusone></div> <p><a href="http://hackaday.com/2013/11/22/using-dma-to-drive-ws2812-led-pixels/"><strong>As seen on Hackaday!</strong></a></p>
<p>If you like blinky LEDs &#8211; especially the full color RGB ones &#8211; you might have already come across the WS2812 LEDs.<br />
These little suckers are extremely bright and can be purchased rather cheaply from eBay, 50 or a 100 pcs at a time or strips with 60 LEDs per meter.<br />
You can also get them as bare LEDS, as strips or even as breadboard friendly breakout boards from Adafruit (NeoPixel) and SparkFun.</p>
<p><iframe width="625" height="352" src="http://www.youtube.com/embed/EZa9yF68Im8?feature=oembed" frameborder="0" allowfullscreen></iframe></p>
<p>These devices can be chained together to endless strings (given you can supply enough power) and therefore are perfect for making big RGB screens/matrices.</p>
<p><span id="more-1227"></span></p>
<p>As it turns out all the awesomeness comes with a downside: the digital interface used is not a standard interface. It&#8217;s an 800kHz data stream (1.25us per bit) with different duty cycles (high/low times) to represent a &#8217;0&#8242; or a &#8217;1&#8242; bit. </p>
<h3>WS2812 timing diagram</h3>
<div id="attachment_1228" style="width: 410px" class="wp-caption aligncenter"><a href="https://learn.sparkfun.com/tutorials/ws2812-breakout-hookup-guide/ws2812-overview"><img src="http://eliaselectronics.com/wp-content/uploads/2013/11/WS2812-timing.png" alt="Image source: SparkFun Electronics" width="400" height="192" class="size-full wp-image-1228" /></a><p class="wp-caption-text">Image source: SparkFun Electronics</p></div>
<h3>WS2812 data packet format</h3>
<div id="attachment_1232" style="width: 610px" class="wp-caption aligncenter"><a href="https://learn.sparkfun.com/tutorials/ws2812-breakout-hookup-guide/ws2812-overview"><img src="http://eliaselectronics.com/wp-content/uploads/2013/11/WS2812-transmission.png" alt="Image source: SparkFun Electronics" width="600" height="29" class="size-full wp-image-1232" /></a><p class="wp-caption-text">Image source: SparkFun Electronics</p></div>
<p>In between each data sequence of 24 bits there is a 50us dead time which the LED uses to update it&#8217;s PWM output for each emitter.</p>
<h2>Bit banging</h2>
<p>Because the WS2812 protocol is not standard interface there are no hardware peripherals on most microcontrollers to support this interface.<br />
This leaves only one possible solution on most microcontrollers: bit banging.</p>
<p>This means that the micro has to fetch the next bit, figure out if it&#8217;s high or low and then set the GPIO pin low at the correct time, all within 1.25us.</p>
<p>The timing requirements of the protocol will actually be rather tough to come by for most 8 bit micros clocked at 16MHz (depending on architecture).<br />
It&#8217;s almost impossible to bit bang the protocol without coding directly in assembly and optimizing the code for execution time and paying close attention to the number of instructions (which is what the <a href="https://github.com/adafruit/Adafruit_NeoPixel">Adafruit NeoPixel library</a> is doing).</p>
<h2>A different approach</h2>
<p>Therefore I decided to try my luck using an STM32VL Discovery board to drive the LED. As I have mentioned earlier the protocol used is non standard. As we can see from the timing diagram above, it basically is a crude form of PWM (pulse width modulation) and I&#8217;m actually leveraging the PWM and DMA capabilities of the STM32 to generate the needed PWM signals.</p>
<p>The trick with DMA (direct memory access) is that a number of data bytes (in this case a buffer) can be transferred from a memory location to the compare register of a timer without CPU intervention. The DMA controller will listen for an event, in this case the counter register reaching the compare value (i.e. the PWM pin going low) and then send the next byte to the timer&#8217;s compare register. </p>
<p>It might seem a bit overkill at first but the cool thing about DMA is that the compare register gets updated with a new value <b>before</b> the current PWM cycle is over, therefore the <b>next</b> PWM cycle will already use an update compare value and there will be no duplication of bits due to the CPU not being able to keep up with the timer.</p>
<p>This is an abstract of what my code is doing:</p>
<ol>
<li>Bring the 8 bit R, G and B values into the correct order (LED wants G-R-B)</li>
<li>Figure out the bit sequence from the ordered bytes and create a buffer with 24 bytes of compare values to give the correct pulse width</li>
<li>Append a number of 0 bytes to the buffer in order to create 50us dead time between data packets (pulse width = 0)</li>
<li>Configure the DMA buffer size, memory location of the buffer and enable DMA channel for the timer</li>
<li>Start the timer configured to create an 800kHz PWM signal and wait until the DMA buffer is empty</li>
<li>Stop the timer and return to main program</li>
</ol>
<p>The code can be found on <a href="https://github.com/Torrentula/STM32F1-workarea/tree/master/Project/WS2812">GitHub</a> as always.</p>
<p>Thanks for reading!<br />
Elia</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="http://eliaselectronics.com/category/microcontrollers/" title="View all posts in Microcontrollers" rel="category tag">Microcontrollers</a>, <a href="http://eliaselectronics.com/category/projects/" title="View all posts in Projects" rel="category tag">Projects</a>, <a href="http://eliaselectronics.com/category/stm32/" title="View all posts in STM32" rel="category tag">STM32</a> and tagged <a href="http://eliaselectronics.com/tag/dma/" rel="tag">DMA</a>, <a href="http://eliaselectronics.com/tag/led/" rel="tag">LED</a>, <a href="http://eliaselectronics.com/tag/neopixel/" rel="tag">NeoPixel</a>, <a href="http://eliaselectronics.com/tag/rgb/" rel="tag">RGB</a>, <a href="http://eliaselectronics.com/tag/stm32/" rel="tag">STM32</a>, <a href="http://eliaselectronics.com/tag/timer/" rel="tag">Timer</a>, <a href="http://eliaselectronics.com/tag/ws2812/" rel="tag">WS2812</a> on <a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/" title="9:00 pm" rel="bookmark"><time class="entry-date" datetime="2013-11-05T21:00:20+00:00">November 5, 2013</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="http://eliaselectronics.com/author/elia/" title="View all posts by Elia" rel="author">Elia</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="http://eliaselectronics.com/reading-sd-cards-with-the-stm32f4-discovery/" rel="prev"><span class="meta-nav">&larr;</span> Reading SD cards with the STM32F4-Discovery</a></span>
					<span class="nav-next"><a href="http://eliaselectronics.com/pic-microcontroller-tutorial-6-usart/" rel="next">PIC microcontroller tutorial #6 &#8211; USART <span class="meta-nav">&rarr;</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			29 thoughts on &ldquo;<span>Driving a WS2812 RGB LED with an STM32</span>&rdquo;		</h2>

		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-840">
		<article id="comment-840" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d4eec2ac3810e7dcc7389bd0783ff739?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://spectrum4ever.org' rel='external nofollow' class='url'>trawen</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-840"><time datetime="2013-11-10T22:37:52+00:00">November 10, 2013 at 10:37 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Why link to github leads to sparkfun site? you do not have the source code?</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=840#respond' onclick='return addComment.moveForm("comment-840", "840", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor odd alt depth-2" id="li-comment-841">
		<article id="comment-841" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-841"><time datetime="2013-11-10T23:18:27+00:00">November 10, 2013 at 11:18 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Thanks for telling me, I&#8217;ve fixed the link.</p>
<p><a href="https://github.com/Torrentula/STM32F1-workarea/tree/master/Project/WS2812" rel="nofollow">Here&#8217;s the link</a> again.</p>
<p>Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=841#respond' onclick='return addComment.moveForm("comment-841", "841", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-848">
		<article id="comment-848" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d4eec2ac3810e7dcc7389bd0783ff739?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://spectrum4ever.org' rel='external nofollow' class='url'>trawen</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-848"><time datetime="2013-11-16T02:20:24+00:00">November 16, 2013 at 2:20 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Strange. But on my STM32F103 your code works is not entirely correct.<br />
Some colors are transferred to the LED is not correct.</p>
<p>Your controller runs on 24 MHz or 72 MHz?</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=848#respond' onclick='return addComment.moveForm("comment-848", "848", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-849">
		<article id="comment-849" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d4eec2ac3810e7dcc7389bd0783ff739?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://spectrum4ever.org' rel='external nofollow' class='url'>trawen</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-849"><time datetime="2013-11-16T02:28:21+00:00">November 16, 2013 at 2:28 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>You will see what first bit wrong size.</p>
<p><a href="https://dl.dropboxusercontent.com/u/6439155/pwm.png" rel="nofollow">https://dl.dropboxusercontent.com/u/6439155/pwm.png</a></p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=849#respond' onclick='return addComment.moveForm("comment-849", "849", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-850">
		<article id="comment-850" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d4eec2ac3810e7dcc7389bd0783ff739?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://spectrum4ever.org' rel='external nofollow' class='url'>trawen</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-850"><time datetime="2013-11-16T02:29:23+00:00">November 16, 2013 at 2:29 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>it shot of 255,255,255 value.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=850#respond' onclick='return addComment.moveForm("comment-850", "850", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-851">
		<article id="comment-851" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d4eec2ac3810e7dcc7389bd0783ff739?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://spectrum4ever.org' rel='external nofollow' class='url'>trawen</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-851"><time datetime="2013-11-16T02:39:39+00:00">November 16, 2013 at 2:39 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>By the way. Why DMA_BufferSize = 42?<br />
We have 2 diode, 2*24 = 48 &#8230;.</p>
<p>&#8220;(len*24)+42;	// number of bytes needed is #LEDs * 24 bytes + 42 trailing bytes&#8221;</p>
<p>What is trailing bytes?</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=851#respond' onclick='return addComment.moveForm("comment-851", "851", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor even depth-2" id="li-comment-852">
		<article id="comment-852" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-852"><time datetime="2013-11-16T12:51:58+00:00">November 16, 2013 at 12:51 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I have found the timing not to be too critical on these LEDs, I have even managed to use a PIC microcontroller with 4MHz SPI to drive those LEDs.<br />
I have tried multiple things to get rid of the wrong timing on the first bit but unfortunately I have not found out why it would be shorter than the other bits.</p>
<p>I am using an STM32F100RBT6B with an HSE frequency of 24MHz (8MHz crystal with *4 PLL).</p>
<p>The 42 trailing bytes are set to 0 to ensure that the next stream of data will be transmitted after a delay of more than 50Âµs (I know it&#8217;s actually 40 bytes at 1.25Âµs but I use 42 instead to add a margin for timing that&#8217;s slightly off).<br />
Remember that these LEDs will shift through all data bytes until the data line goes low for more than 50Âµs, then the PWM of all LEDs is updated at once. So in this case the 42 trailing bytes are sent at the very end of the transmission.</p>
<p>In the DMA initialization code I used 42 bytes at some point during development. That figure is irrelevant because the DMA buffer size is reloaded every time before a transmission (after it has been calculated on the fly).</p>
<p>I hope this clears things up a bit <img src="http://eliaselectronics.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /><br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=852#respond' onclick='return addComment.moveForm("comment-852", "852", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="pingback odd alt thread-odd thread-alt depth-1" id="comment-853">
		<p>Pingback: <a href='http://hackaday.com/2013/11/22/using-dma-to-drive-ws2812-led-pixels/' rel='external nofollow' class='url'>Using DMA to Drive WS2812 LED Pixels</a> </p>
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-862">
		<article id="comment-862" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/aa4028e09ff9f8c25d04c18d36886f7d?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Tody</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-862"><time datetime="2013-11-26T11:41:37+00:00">November 26, 2013 at 11:41 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi,<br />
which toolchain are you using? I&#8217;ve tried compiling/linking the code with emIDE (GCC toolchain) and get 16 error messages.<br />
CU</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=862#respond' onclick='return addComment.moveForm("comment-862", "862", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor odd alt depth-2" id="li-comment-863">
		<article id="comment-863" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-863"><time datetime="2013-11-26T16:24:36+00:00">November 26, 2013 at 4:24 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I am using arm-none-eabi-gcc, have a look at my Makefile at the GitHub repository to find out if our build options differ: <a href="http://github.com/Torrentula/STM32F4-workarea" rel="nofollow">STM32F4-workarea</a></p>
<p>Cheers,<br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=863#respond' onclick='return addComment.moveForm("comment-863", "863", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment byuser comment-author-elia bypostauthor even depth-2" id="li-comment-867">
		<article id="comment-867" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-867"><time datetime="2013-11-30T09:21:26+00:00">November 30, 2013 at 9:21 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hey again,</p>
<p>I have fixed the Makefile to include files inside the project directory.<br />
Strangely enough I was only getting the error on my Windows machine, Linux box was working fine and dandy.</p>
<p>Anyway, let me know if it has worked for you!</p>
<p>Cheers,<br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=867#respond' onclick='return addComment.moveForm("comment-867", "867", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-869">
		<article id="comment-869" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c45c0d628d4deb3b2ddf10d3f2238d1b?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://www.kean.com.au/' rel='external nofollow' class='url'>Kean</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-869"><time datetime="2013-12-02T08:54:49+00:00">December 2, 2013 at 8:54 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Note that the timing on the WS2812/WS2812B LEDs has changed as of batches from WorldSemi manufactured made in October 2013, and timing tolerance for approx 10-30% of parts is very small.<br />
Recommendation from WorldSemi is now: 0 = 400ns high/850ns low, and 1 = 850ns high, 400ns low.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=869#respond' onclick='return addComment.moveForm("comment-869", "869", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment even depth-2" id="li-comment-880">
		<article id="comment-880" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/b9b872cf0d30dfeca2cc721c93da4eef?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Noep</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-880"><time datetime="2013-12-11T16:53:38+00:00">December 11, 2013 at 4:53 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Do you have more information about this &#8211; Is the pause of 50ns still needed? I see that the datasheet at Adafruit hasn&#8217;t been updated yet: <a href="http://www.adafruit.com/datasheets/WS2812.pdf" rel="nofollow">http://www.adafruit.com/datasheets/WS2812.pdf</a></p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=880#respond' onclick='return addComment.moveForm("comment-880", "880", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-874">
		<article id="comment-874" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/2ca0462fc25d3018b5ff94e4fdf2cb9d?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dadita</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-874"><time datetime="2013-12-09T20:12:25+00:00">December 9, 2013 at 8:12 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hey,<br />
thanks for the article! One thing: I ported the code to an STM32F0 discovery board. Now I get a strange behaviour: sending all zeroes and sending all ones works fine at ~800kHz with the expected duty cycles. But as soon as you switch from a &#8220;0&#8243; to a &#8220;1&#8243;, the PWM period for the &#8220;1&#8243; is shortened by a factor of two or so. </p>
<p>Any idea on that? I tried resetting the CCR register after disabling the DMA and the TIM3, but that didn&#8217;t change it.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=874#respond' onclick='return addComment.moveForm("comment-874", "874", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor even depth-2" id="li-comment-875">
		<article id="comment-875" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-875"><time datetime="2013-12-09T21:09:46+00:00">December 9, 2013 at 9:09 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I have had erroneous behaviour on PWM every time I wrote a new set of 24 bits. I don&#8217;t know if that is due to the timer already counting the next period as the first byte is loaded into the compare register.</p>
<p>I haven&#8217;t had any other problems like you mention. Have you made sure that your compare values are correct and that the DMA is updating the compare register as soon as the compare match has occured?</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=875#respond' onclick='return addComment.moveForm("comment-875", "875", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-877">
		<article id="comment-877" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/2ca0462fc25d3018b5ff94e4fdf2cb9d?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dadita</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-877"><time datetime="2013-12-10T08:06:29+00:00">December 10, 2013 at 8:06 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I tried again to<br />
For testing I set the compare values fix to G=0, R=FF, B=0. The output stream is correct up to the bit where 0 changes to 1.  It looks like the compare register is updated too soon because the high pulse of the last 0 is 350ns, then there is a low time of only 187ns, goes high for 150ns and then low again for 560ns. After that the stream is ok again.</p>
<p>The first compare is at 9 (=0). It resets the output, then the register is set to 17 by the DMA, but the counter is still at ten or so, so the output is set high again. Then the counter reaches 17, so the output goes low.</p>
<p>I need to figure out how to let the DMA update the cycle after the counter is reset, not when the compare event happens.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=877#respond' onclick='return addComment.moveForm("comment-877", "877", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-878">
		<article id="comment-878" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/2ca0462fc25d3018b5ff94e4fdf2cb9d?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dadita</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-878"><time datetime="2013-12-10T08:35:02+00:00">December 10, 2013 at 8:35 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Got it: I used the TIM3_UPDATE on DMA channel 3. This way the CCR is updated when the Timer is reset. </p>
<p>Found another bug though: The first bit of a stream was longer than the next (around 1Âµs high time).  I fixed that by adding a CCR=0 in front of the data, so the buffersize is now  (len*24)+43.</p>
<p>So far I only used a scope to check if it&#8217;s working but the LEDs should be delivered today so I&#8217;ll be able try for real <img src="http://eliaselectronics.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=878#respond' onclick='return addComment.moveForm("comment-878", "878", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-879">
		<article id="comment-879" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/2ca0462fc25d3018b5ff94e4fdf2cb9d?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dadita</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-879"><time datetime="2013-12-10T08:44:37+00:00">December 10, 2013 at 8:44 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Sorry, me again: I did another optimization on your code:<br />
You had the LED_BYTE_Buffer declared as uint16_t which takes twice the RAM space you actually need. Due to the fact that I&#8217;ll drive over 1500 LEDs with the processor I ran out of memory.<br />
The fix is to declare the buffer as uint8_t and set the DMA_MemoryDataSize = DMA_MemoryDataSize_Byte. </p>
<p>Cheers,<br />
Dadita</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=879#respond' onclick='return addComment.moveForm("comment-879", "879", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment even depth-2" id="li-comment-887">
		<article id="comment-887" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e3cf11b000d7e149122a2a3f39911cc6?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">LeddeL</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-887"><time datetime="2013-12-17T21:46:09+00:00">December 17, 2013 at 9:46 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi Dadita</p>
<p>I guess I&#8217;m having the same trouble you describe. When I measure the single with my scope the signal is jittering. It is not as stable as seen in the movie. Can you describe the steps you made?</p>
<p>My sincerly,</p>
<p>LeddeL</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=887#respond' onclick='return addComment.moveForm("comment-887", "887", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment odd alt depth-3" id="li-comment-900">
		<article id="comment-900" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6d87335e8655fdc81c7d1c8a0301dcdb?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dadita</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-900"><time datetime="2014-01-02T18:56:53+00:00">January 2, 2014 at 6:56 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi LeddeL,</p>
<p>I stopped writing all the steps I made because I didnt want to spam this comment section. The answer to your question is 2 posts above yours. I used the TIM3_UPDATE on DMA channel 3. This way the CCR is updated when the Timer is reset, instead of when the Compare-Event is set.</p>
<p>BUT: I ran into the next thing which is memory. I want to drive over 1500 LEDs which means with the solution proposed in this article I would need ~12kBytes of RAM. My STM32F0 doesn&#8217;t have that much. So I built a small breadboard with two D-Flip-Flops and an OR-Gate and now I can use the SPI as it should be (every SPI-Bit is one WS2812-Bit). If anyone is interested, I can try to put a small tutorial together. </p>
<p>Thanks to Elia nonetheless, because without him I&#8217;d still be stuck in DMA routines <img src="http://eliaselectronics.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=900#respond' onclick='return addComment.moveForm("comment-900", "900", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor even depth-4" id="li-comment-902">
		<article id="comment-902" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-902"><time datetime="2014-01-03T09:19:21+00:00">January 3, 2014 at 9:19 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>The idea of using two D-Flip Flops and an OR gate sounds interesting.<br />
Would you mind posting a schematic?</p>
<p>Cheers,<br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=902#respond' onclick='return addComment.moveForm("comment-902", "902", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt depth-4" id="li-comment-944">
		<article id="comment-944" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/5171ccf4b1967e84f1a12148ca6f28bd?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Frieder</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-944"><time datetime="2014-02-15T14:18:11+00:00">February 15, 2014 at 2:18 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi Dadita,</p>
<p>I&#8217;m interested in the hardware/software setup you use to create the WS2812 signal out of your SPI Interface. Maybe you could post a code snippet and a schematic?</p>
<p>Thanks!<br />
Frieder</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=944#respond' onclick='return addComment.moveForm("comment-944", "944", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-901">
		<article id="comment-901" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/8412200114f038d79c31552c37d85f88?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">carl</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-901"><time datetime="2014-01-03T05:38:11+00:00">January 3, 2014 at 5:38 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I am developing a controller for an RGB led strip based on WS2812B ( <a href="http://www.ledlightinghut.com/144-led-m-ws2812-digital-intelligent-rgb-led-strip-light.html" rel="nofollow">http://www.ledlightinghut.com/144-led-m-ws2812-digital-intelligent-rgb-led-strip-light.html</a> )  using STM32F373, which requires very specific timing. I decided to use DMA and timers for the tight control, using the ideas described by the OctoWS2811 library (<a href="http://www.pjrc.com/teensy/td_libs_OctoWS2811.html" rel="nofollow">http://www.pjrc.com/teensy/td_libs_OctoWS2811.html</a>).</p>
<p>I am having issues with getting the PWM channels to trigger DMA transfers as the DIER register is being reset in the HAL PWM initialize code.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=901#respond' onclick='return addComment.moveForm("comment-901", "901", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-939">
		<article id="comment-939" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d2dd9cbbab1d5f0f3eff20cb8476ebee?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">arouna</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-939"><time datetime="2014-02-09T20:37:17+00:00">February 9, 2014 at 8:37 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Dear Elia,<br />
Thank you for this example.<br />
Please, can you provide an example for a single LED!<br />
Thank in advance<br />
arouna</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=939#respond' onclick='return addComment.moveForm("comment-939", "939", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor even depth-2" id="li-comment-946">
		<article id="comment-946" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-946"><time datetime="2014-02-15T20:11:37+00:00">February 15, 2014 at 8:11 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>A single LED would be easier, just call the function appropriately: <code>WS2812_send(&#038;eightbit[i], 1);</code>.</p>
<p>Happy hacking,<br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=946#respond' onclick='return addComment.moveForm("comment-946", "946", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-943">
		<article id="comment-943" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/99a873ef2e326734f87906fba949fafc?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://digfor.net' rel='external nofollow' class='url'>Angel G.</a></b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-943"><time datetime="2014-02-15T01:06:03+00:00">February 15, 2014 at 1:06 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Thank you for the trick with PWM &amp; DMA ! Is it specific to this CPU or it works the same way in other STM32&#8242;s  ? I plan to use it to output a long scanline of bits.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=943#respond' onclick='return addComment.moveForm("comment-943", "943", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	<ol class="children">
	<li class="comment byuser comment-author-elia bypostauthor even depth-2" id="li-comment-945">
		<article id="comment-945" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/c6780dc4cf52a666ef92004231309a82?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Elia</b> <span>Post author</span></cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-945"><time datetime="2014-02-15T20:09:07+00:00">February 15, 2014 at 8:09 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>This should work for basically all STM32 with DMA as it uses standard ST peripheral library functions. There might be some differences between families though, you might need to try it out <img src="http://eliaselectronics.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /> </p>
<p>Note that this is not exactly memory efficient or fast, you&#8217;d be hard pressed to be able to drive a lot of LEDs (memory limitation) at a high update rate for a display or something (because of the preprocessing).</p>
<p>There are other solutions for the STM32s like the OctoWS2812 library which might be a better fit for what you&#8217;re doing.</p>
<p>Cheers,<br />
Elia</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=945#respond' onclick='return addComment.moveForm("comment-945", "945", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-959">
		<article id="comment-959" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/755099154720e6d9adf3e47597a02889?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Daniel Schnell</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-959"><time datetime="2014-03-01T12:06:36+00:00">March 1, 2014 at 12:06 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>This is a good approach. Basically a fixed buffer for DMA  and circular DMA mode with double buffering is still missing to be as memory friendly as possible. I use that approach in my Stm32f0 to convert any numbet of RGB values to the DMA buffer pwm values. Its a bit tricky to geht right, but it works like a charm. Special handling has to be implemented for adding the 50 us 0 values.</p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=959#respond' onclick='return addComment.moveForm("comment-959", "959", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-992">
		<article id="comment-992" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/bd50f3d8882586d31abdc7f81651b99a?s=44&amp;d=blank&amp;r=G' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Omri</b> </cite><a href="http://eliaselectronics.com/driving-a-ws2812-rgb-led-with-an-stm32/#comment-992"><time datetime="2014-03-27T08:49:53+00:00">March 27, 2014 at 8:49 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I created an example for a 100% DMA driven controller, no software required to push the buffer to the WS2812.<br />
Using ChibiOS and STM32F373 but should be easy to adapt to any other OS and uC.<br />
<a href="https://github.com/omriiluz/WS2812B-LED-Driver-ChibiOS" rel="nofollow">https://github.com/omriiluz/WS2812B-LED-Driver-ChibiOS</a></p>
							</section><!-- .comment-content -->

			<div class="reply">
				<a class='comment-reply-link' href='/driving-a-ws2812-rgb-led-with-an-stm32/?replytocom=992#respond' onclick='return addComment.moveForm("comment-992", "992", "respond", "1227")'>Reply</a> <span>&darr;</span>			</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
		</ol><!-- .commentlist -->

		
		
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/driving-a-ws2812-rgb-led-with-an-stm32/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://eliaselectronics.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" /></p>
<p class="cptch_block"><label>Are you not just a Raspberry Pi or a BeagleBone?<span class="required"> </span></label><br />		<input type="hidden" name="cptch_result" value="AQg=" />
		<input type="hidden" name="cptch_time" value="1406131260" />
		<input type="hidden" value="Version: 2.4" />
		6 &minus; <input id="cptch_input" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;" /> =  fo&#117;r	</p>												<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='1227' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="e0d4f6d866" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="175"/></p>					</form>
							</div><!-- #respond -->
			
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://eliaselectronics.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></aside><aside id="text-2" class="widget widget_text"><h3 class="widget-title">Stay tuned!</h3>			<div class="textwidget"><!-- Twitter -->

<a href="https://twitter.com/#!/devthrash" target="_blank" style="text-decoration: none;" title="Twitter">
<img src="http://eliaselectronics.com/wp-content/social/twitter.png" />
</a>

<!-- Google+ -->

<a href="https://plus.google.com/106429634656676190895/about/p/pub" target="_blank" style="text-decoration: none;" title="Google+">
<img src="http://eliaselectronics.com/wp-content/social/google+.png" />
</a>

<!-- RSS feed -->

<a href="http://eliaselectronics.com/?feed=rss2" target="_blank" style="text-decoration: none;" title="RSS feed">
<img src="http://eliaselectronics.com/wp-content/social/rss.png" />
</a>
<br />
<!-- YouTube -->
<a href="http://www.youtube.com/user/EsEblog/" target="_blank" style="text-decoration: none;" title="YouTube">
<img src="http://eliaselectronics.com/wp-content/social/youtube.png" />
</a>

<!-- LMR -->

<a href="http://letsmakerobots.com/user/16359/pages/robot" target="_blank" style="text-decoration: none;" title="Let's Make Robots!">
<img src="http://eliaselectronics.com/wp-content/social/lmr.png" />
</a>

<!-- Github -->

<a href="http://github.com/devthrash" target="_blank" style="text-decoration: none;" title="GitHub">
<img src="http://eliaselectronics.com/wp-content/social/github.png" />
</a>
</div>
		</aside><aside id="wpt-latest-tweets-2" class="widget wpt-latest-tweets"><h3 class="widget-title">@devthrash on Twitter</h3><div class="wpt-header"><p>
			<a href='https://twitter.com/devthrash' class='twitter-follow-button wpt-right' data-width='30px' data-show-screen-name='false' data-size='large' data-show-count='false' data-lang='en'>Follow @devthrash</a>
			<img src='https://abs.twimg.com/sticky/default_profile_images/default_profile_0_normal.png' alt='' class='wpt-twitter-avatar wpt-left' />
			<span class='wpt-twitter-name'>Elia</span><br />
			<span class='wpt-twitter-id'><a href='https://twitter.com/devthrash'>@devthrash</a></span>
			</p></div><ul>
<li class="lang-en">When it says 'serves two people' better believe it, I ate too much <a href="https://twitter.com/search?q=%23ouch" rel="nofollow">#ouch</a><br /><span class='wpt-tweet-time'><a href="http://twitter.com/devthrash/status/490547926704586752">about 4 days ago</a></span>  </li>
<li class="lang-en">I mean what a stupid attitude "well at least they release music" bloody hell if the music is shit you might as well not release it<br /><span class='wpt-tweet-time'><a href="http://twitter.com/devthrash/status/489801733368184832">about 6 days ago</a></span>  </li>
<li class="lang-en">"They are adapting their music to survive, at least they're still releasing records" - they're selling out is what you're trying to say mate<br /><span class='wpt-tweet-time'><a href="http://twitter.com/devthrash/status/489801550349742081">about 6 days ago</a></span>  </li>
<li class="lang-en">Okay this really sucks have to redo the whole PCB... I think I'll rather go to bed, what a kick in the balls for this project...<br /><span class='wpt-tweet-time'><a href="http://twitter.com/devthrash/status/489173525597810689">about 1 week ago</a></span>  </li>
<li class="lang-en">Re: layout, always make sure the schematic is right, just lost 2 hours of layout work, schematic was completely borked<br /><span class='wpt-tweet-time'><a href="http://twitter.com/devthrash/status/489169433190223872">about 1 week ago</a></span>  </li>
</ul>
</aside><aside id="text-3" class="widget widget_text"><h3 class="widget-title">Donate</h3>			<div class="textwidget">Please consider making a donation to keep the projects running and the tutorials coming, thanks!
<br />
<img src="http://eliaselectronics.com/files/images/donations.png" />
<br />
The bitcoin address is:
<a href="bitcoin:18J9yNdsmwZHjofJaJPRrkhtb1jy5tyU67?label=Donations">18J9yNdsmwZHjofJaJPRrkhtb1jy5tyU67</a></div>
		</aside><aside id="linkcat-281" class="widget widget_links"><h3 class="widget-title">Podcasts I listen to</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://www.deutschlandfunk.de/computer-und-kommunikation.683.de.html" target="_blank">DLF Computer &amp; Kommunikation</a></li>
<li><a href="http://www.deutschlandfunk.de/forschung-aktuell.675.de.html" target="_blank">DLF Forschung Aktuell</a></li>
<li><a href="http://embedded.fm/" target="_blank">Embedded</a></li>
<li><a href="http://robotiklabor.de" target="_blank">Robotiklabor</a></li>
<li><a href="http://theamphour.com/" title="Keep current" target="_blank">The AmpHour</a></li>

	</ul>
</aside>
<aside id="linkcat-187" class="widget widget_links"><h3 class="widget-title">Forums &amp; Help</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://eevblog.com/forum" title="An electronics forum with professional and hobbyist members" target="_blank">EEVforum</a></li>
<li><a href="http://letsmakerobots.com" title="A community of fellow roboteers and hobbyists" target="_blank">Let&#039;s Make Robots</a></li>
<li><a href="http://mjlorton.com/forum" title="Forum by video blogger Martin Lorton" target="_blank">Solar power and electronic measurement equipment forum</a></li>

	</ul>
</aside>
<aside id="linkcat-195" class="widget widget_links"><h3 class="widget-title">People and Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://direcs.de" title="Markus Knapp&#8217;s blog about his robot DIRECS" target="_blank">direcs.de robot blog</a></li>
<li><a href="http://eevblog.com" title="The famous EEVblog" target="_blank">EEVblog</a></li>
<li><a href="http://www.youtube.com/w2aew" title="Very good explained analog electronics and HAM radio tutorials" target="_blank">HAM radio and analog electronics by w2aew</a></li>
<li><a href="http://phalox.be" title="Young EE from Belgium" target="_blank">Phalox&#039; Blog</a></li>

	</ul>
</aside>
<aside id="calendar-2" class="widget widget_calendar"><h3 class="widget-title">Posts throughout the month</h3><div id="calendar_wrap"><table id="wp-calendar">
	<caption>July 2014</caption>
	<thead>
	<tr>
		<th scope="col" title="Monday">M</th>
		<th scope="col" title="Tuesday">T</th>
		<th scope="col" title="Wednesday">W</th>
		<th scope="col" title="Thursday">T</th>
		<th scope="col" title="Friday">F</th>
		<th scope="col" title="Saturday">S</th>
		<th scope="col" title="Sunday">S</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev"><a href="http://eliaselectronics.com/2014/04/" title="View posts for April 2014">&laquo; Apr</a></td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next" class="pad">&nbsp;</td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="1" class="pad">&nbsp;</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td><a href="http://eliaselectronics.com/2014/07/06/" title="Fixing ${KIGITHUB} issue in newer KiCAD builds">6</a></td>
	</tr>
	<tr>
		<td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td>
	</tr>
	<tr>
		<td>14</td><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td>
	</tr>
	<tr>
		<td>21</td><td>22</td><td id="today">23</td><td>24</td><td>25</td><td>26</td><td>27</td>
	</tr>
	<tr>
		<td>28</td><td>29</td><td>30</td><td>31</td>
		<td class="pad" colspan="3">&nbsp;</td>
	</tr>
	</tbody>
	</table></div></aside><aside id="text-4" class="widget widget_text"><h3 class="widget-title">Licensing </h3>			<div class="textwidget"><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a><br />This content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</div>
		</aside>		</div><!-- #secondary -->
		<!--WP Code Highlight_start-->
	<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	<script type="text/javascript" src="http://eliaselectronics.com/wp-content/plugins/wp-code-highlight/js/wp-code-highlight.js"></script>
	<!--WP Code Highlight_end-->
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="https://apis.google.com/js/plusone.js">{lang: "en-US"}</script><script type="text/javascript">
function wdgpo_plusone_click (el) {
	if (typeof window._gaq != "undefined") {
		 _gaq.push(['_trackEvent', 'Google +1', el.state, document.title]);
	}
}
</script><script type='text/javascript' src='http://eliaselectronics.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/eliaselectronics.com\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='http://eliaselectronics.com/wp-content/plugins/wp-polls/polls-js.js?ver=2.63'></script>
<script type='text/javascript' src='http://eliaselectronics.com/wp-includes/js/comment-reply.min.js?ver=3.9.1'></script>
<script type='text/javascript' src='http://eliaselectronics.com/wp-content/themes/twentytwelve/js/navigation.js?ver=20140318'></script>
<script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=3.9.1'></script>
</body>
</html>
